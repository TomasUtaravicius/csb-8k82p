parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"J3Xk":[function(require,module,exports) {
var global = arguments[3];
var e,d=arguments[3];e="undefined"!=typeof window?window:void 0!==d?d:"undefined"!=typeof self?self:{},module.exports=e;
},{}],"sC8V":[function(require,module,exports) {

},{}],"DnRs":[function(require,module,exports) {
var global = arguments[3];
var e,d=arguments[3],n=void 0!==d?d:"undefined"!=typeof window?window:{},o=require("min-document");"undefined"!=typeof document?e=document:(e=n["__GLOBAL_DOCUMENT_CACHE@4"])||(e=n["__GLOBAL_DOCUMENT_CACHE@4"]=o),module.exports=e;
},{"min-document":"sC8V"}],"ea3I":[function(require,module,exports) {
function e(){return module.exports=e=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},module.exports.default=module.exports,module.exports.__esModule=!0,e.apply(this,arguments)}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"VmQe":[function(require,module,exports) {
function e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"Jibl":[function(require,module,exports) {
function e(o,t){return module.exports=e=Object.setPrototypeOf||function(e,o){return e.__proto__=o,e},module.exports.default=module.exports,module.exports.__esModule=!0,e(o,t)}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"tere":[function(require,module,exports) {
var e=require("./setPrototypeOf.js");function o(o,t){o.prototype=Object.create(t.prototype),o.prototype.constructor=o,e(o,t)}module.exports=o,module.exports.default=module.exports,module.exports.__esModule=!0;
},{"./setPrototypeOf.js":"Jibl"}],"gLtL":[function(require,module,exports) {
function r(r,t){var e,n=null;try{e=JSON.parse(r,t)}catch(u){n=u}return[n,e]}module.exports=r;
},{}],"vQ4V":[function(require,module,exports) {
function e(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return a[e];var n,p=String(e);return(n=r[p.toLowerCase()])?n:(n=o[p.toLowerCase()])||(1===p.length?p.charCodeAt(0):void 0)}e.isEventKey=function(e,t){if(e&&"object"==typeof e){var a=e.which||e.keyCode||e.charCode;if(null==a)return!1;if("string"==typeof t){var n;if(n=r[t.toLowerCase()])return n===a;if(n=o[t.toLowerCase()])return n===a}else if("number"==typeof t)return t===a;return!1}},exports=module.exports=e;var r=exports.code=exports.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},o=exports.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(t=97;t<123;t++)r[String.fromCharCode(t)]=t-32;for(var t=48;t<58;t++)r[t-48]=t;for(t=1;t<13;t++)r["f"+t]=t+111;for(t=0;t<10;t++)r["numpad "+t]=t+96;var a=exports.names=exports.title={};for(t in r)a[r[t]]=t;for(var n in o)r[n]=o[n];
},{}],"TfiX":[function(require,module,exports) {
module.exports=t;var o=Object.prototype.toString;function t(t){if(!t)return!1;var n=o.call(t);return"[object Function]"===n||"function"==typeof t&&"[object RegExp]"!==n||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}
},{}],"kVm4":[function(require,module,exports) {
"use strict";var e=require("global/window"),t=require("@babel/runtime/helpers/extends"),r=require("is-function"),n=function(e){var t={};return e?(e.trim().split("\n").forEach(function(e){var r=e.indexOf(":"),n=e.slice(0,r).trim().toLowerCase(),o=e.slice(r+1).trim();void 0===t[n]?t[n]=o:Array.isArray(t[n])?t[n].push(o):t[n]=[t[n],o]}),t):t};function o(e,t){for(var r=0;r<e.length;r++)t(e[r])}function s(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function u(e,n,o){var s=e;return r(n)?(o=n,"string"==typeof e&&(s={uri:e})):s=t({},n,{uri:e}),s.callback=o,s}function a(e,t,r){return i(t=u(e,t,r))}function i(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,r=function(r,n,o){t||(t=!0,e.callback(r,n,o))};function o(){var e=void 0;if(e=l.response?l.response:l.responseText||c(l),q)try{e=JSON.parse(e)}catch(t){}return e}function u(e){return clearTimeout(f),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,r(e,v)}function i(){if(!d){var t;clearTimeout(f),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var s=v,u=null;return 0!==t?(s={body:o(),statusCode:t,method:h,headers:{},url:m,rawRequest:l},l.getAllResponseHeaders&&(s.headers=n(l.getAllResponseHeaders()))):u=new Error("Internal XMLHttpRequest Error"),r(u,s,s.body)}}var p,d,l=e.xhr||null;l||(l=e.cors||e.useXDR?new a.XDomainRequest:new a.XMLHttpRequest);var f,m=l.url=e.uri||e.url,h=l.method=e.method||"GET",y=e.body||e.data,w=l.headers=e.headers||{},R=!!e.sync,q=!1,v={body:void 0,headers:{},statusCode:0,method:h,url:m,rawRequest:l};if("json"in e&&!1!==e.json&&(q=!0,w.accept||w.Accept||(w.Accept="application/json"),"GET"!==h&&"HEAD"!==h&&(w["content-type"]||w["Content-Type"]||(w["Content-Type"]="application/json"),y=JSON.stringify(!0===e.json?y:e.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(i,0)},l.onload=i,l.onerror=u,l.onprogress=function(){},l.onabort=function(){d=!0},l.ontimeout=u,l.open(h,m,!R,e.username,e.password),R||(l.withCredentials=!!e.withCredentials),!R&&e.timeout>0&&(f=setTimeout(function(){if(!d){d=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",u(e)}},e.timeout)),l.setRequestHeader)for(p in w)w.hasOwnProperty(p)&&l.setRequestHeader(p,w[p]);else if(e.headers&&!s(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(y||null),l}function c(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(r){}return null}function p(){}module.exports=a,module.exports.default=a,a.XMLHttpRequest=e.XMLHttpRequest||p,a.XDomainRequest="withCredentials"in new a.XMLHttpRequest?a.XMLHttpRequest:e.XDomainRequest,o(["get","put","post","patch","head","delete"],function(e){a["delete"===e?"del":e]=function(t,r,n){return(r=u(t,r,n)).method=e.toUpperCase(),i(r)}});
},{"global/window":"J3Xk","@babel/runtime/helpers/extends":"ea3I","is-function":"TfiX"}],"R6Ya":[function(require,module,exports) {
var t=require("global/document"),e=Object.create||function(){function t(){}return function(e){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return t.prototype=e,new t}}();function i(t,e){this.name="ParsingError",this.code=t.code,this.message=e||t.message}function r(t){function e(t,e,i,r){return 3600*(0|t)+60*(0|e)+(0|i)+(0|r)/1e3}var i=t.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return i?i[3]?e(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?e(i[1],i[2],0,i[4]):e(0,i[1],i[2],i[4]):null}function n(){this.values=e(null)}function o(t,e,i,r){var n=r?t.split(r):[t];for(var o in n)if("string"==typeof n[o]){var a=n[o].split(i);if(2===a.length)e(a[0],a[1])}}function a(t,e,a){var s=t;function c(){var e=r(t);if(null===e)throw new i(i.Errors.BadTimeStamp,"Malformed timestamp: "+s);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function h(){t=t.replace(/^\s+/,"")}if(h(),e.startTime=c(),h(),"--\x3e"!==t.substr(0,3))throw new i(i.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+s);t=t.substr(3),h(),e.endTime=c(),h(),function(t,e){var i=new n;o(t,function(t,e){switch(t){case"region":for(var r=a.length-1;r>=0;r--)if(a[r].id===e){i.set(t,a[r].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":var n=e.split(","),o=n[0];i.integer(t,o),i.percent(t,o)&&i.set("snapToLines",!1),i.alt(t,o,["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start","center","end"]);break;case"position":n=e.split(","),i.percent(t,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start","center","end"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start","center","end","left","right"])}},/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");try{e.line=i.get("line","auto")}catch(r){}e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100);try{e.align=i.get("align","center")}catch(r){e.align=i.get("align","middle")}try{e.position=i.get("position","auto")}catch(r){e.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},e.align)}e.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},e.align)}(t,e)}i.prototype=e(Error.prototype),i.prototype.constructor=i,i.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},n.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,i){for(var r=0;r<i.length;++r)if(e===i[r]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var s=t.createElement&&t.createElement("textarea"),c={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},h={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},l={v:"title",lang:"lang"},u={rt:"ruby"};function f(t,e){function i(){if(!e)return null;var t,i=e.match(/^([^<]*)(<[^>]*>?)?/);return t=i[1]?i[1]:i[2],e=e.substr(t.length),t}function n(t,e){return!u[e.localName]||u[e.localName]===t.localName}function o(e,i){var r=c[e];if(!r)return null;var n=t.document.createElement(r),o=l[e];return o&&i&&(n[o]=i.trim()),n}for(var a,f,p=t.document.createElement("div"),g=p,d=[];null!==(a=i());)if("<"!==a[0])g.appendChild(t.document.createTextNode((f=a,s.innerHTML=f,f=s.textContent,s.textContent="",f)));else{if("/"===a[1]){d.length&&d[d.length-1]===a.substr(2).replace(">","")&&(d.pop(),g=g.parentNode);continue}var v,m=r(a.substr(1,a.length-2));if(m){v=t.document.createProcessingInstruction("timestamp",m),g.appendChild(v);continue}var b=a.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!b)continue;if(!(v=o(b[1],b[3])))continue;if(!n(g,v))continue;if(b[2]){var y=b[2].split(".");y.forEach(function(t){var e=/^bg_/.test(t),i=e?t.slice(3):t;if(h.hasOwnProperty(i)){var r=e?"background-color":"color",n=h[i];v.style[r]=n}}),v.className=y.join(" ")}d.push(b[1]),g.appendChild(v),g=v}return p}var p=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function g(t){for(var e=0;e<p.length;e++){var i=p[e];if(t>=i[0]&&t<=i[1])return!0}return!1}function d(t){var e=[],i="";if(!t||!t.childNodes)return"ltr";function r(t,e){for(var i=e.childNodes.length-1;i>=0;i--)t.push(e.childNodes[i])}function n(t){if(!t||!t.length)return null;var e=t.pop(),i=e.textContent||e.innerText;if(i){var o=i.match(/^.*(\n|\r)/);return o?(t.length=0,o[0]):i}return"ruby"===e.tagName?n(t):e.childNodes?(r(t,e),n(t)):void 0}for(r(e,t);i=n(e);)for(var o=0;o<i.length;o++)if(g(i.charCodeAt(o)))return"rtl";return"ltr"}function v(t){if("number"==typeof t.line&&(t.snapToLines||t.line>=0&&t.line<=100))return t.line;if(!t.track||!t.track.textTrackList||!t.track.textTrackList.mediaElement)return-1;for(var e=t.track,i=e.textTrackList,r=0,n=0;n<i.length&&i[n]!==e;n++)"showing"===i[n].mode&&r++;return-1*++r}function m(){}function b(t,e,i){m.call(this),this.cue=e,this.cueDiv=f(t,e.text);var r={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===e.vertical?"horizontal-tb":"lr"===e.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(r,this.cueDiv),this.div=t.document.createElement("div"),r={direction:d(this.cueDiv),writingMode:""===e.vertical?"horizontal-tb":"lr"===e.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===e.align?"center":e.align,font:i.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(r),this.div.appendChild(this.cueDiv);var n=0;switch(e.positionAlign){case"start":n=e.position;break;case"center":n=e.position-e.size/2;break;case"end":n=e.position-e.size}""===e.vertical?this.applyStyles({left:this.formatStyle(n,"%"),width:this.formatStyle(e.size,"%")}):this.applyStyles({top:this.formatStyle(n,"%"),height:this.formatStyle(e.size,"%")}),this.move=function(t){this.applyStyles({top:this.formatStyle(t.top,"px"),bottom:this.formatStyle(t.bottom,"px"),left:this.formatStyle(t.left,"px"),right:this.formatStyle(t.right,"px"),height:this.formatStyle(t.height,"px"),width:this.formatStyle(t.width,"px")})}}function y(t){var e,i,r,n;if(t.div){i=t.div.offsetHeight,r=t.div.offsetWidth,n=t.div.offsetTop;var o=(o=t.div.childNodes)&&(o=o[0])&&o.getClientRects&&o.getClientRects();t=t.div.getBoundingClientRect(),e=o?Math.max(o[0]&&o[0].height||0,t.height/o.length):0}this.left=t.left,this.right=t.right,this.top=t.top||n,this.height=t.height||i,this.bottom=t.bottom||n+(t.height||i),this.width=t.width||r,this.lineHeight=void 0!==e?e:t.lineHeight}function w(t,e,i,r){var n=new y(e),o=e.cue,a=v(o),s=[];if(o.snapToLines){var c;switch(o.vertical){case"":s=["+y","-y"],c="height";break;case"rl":s=["+x","-x"],c="width";break;case"lr":s=["-x","+x"],c="width"}var h=n.lineHeight,l=h*Math.round(a),u=i[c]+h,f=s[0];Math.abs(l)>u&&(l=l<0?-1:1,l*=Math.ceil(u/h)*h),a<0&&(l+=""===o.vertical?i.height:i.width,s=s.reverse()),n.move(f,l)}else{var p=n.lineHeight/i.height*100;switch(o.lineAlign){case"center":a-=p/2;break;case"end":a-=p}switch(o.vertical){case"":e.applyStyles({top:e.formatStyle(a,"%")});break;case"rl":e.applyStyles({left:e.formatStyle(a,"%")});break;case"lr":e.applyStyles({right:e.formatStyle(a,"%")})}s=["+y","-x","+x","-y"],n=new y(e)}var g=function(t,e){for(var n,o=new y(t),a=1,s=0;s<e.length;s++){for(;t.overlapsOppositeAxis(i,e[s])||t.within(i)&&t.overlapsAny(r);)t.move(e[s]);if(t.within(i))return t;var c=t.intersectPercentage(i);a>c&&(n=new y(t),a=c),t=new y(o)}return n||o}(n,s);e.move(g.toCSSCompatValues(i))}function T(){}m.prototype.applyStyles=function(t,e){for(var i in e=e||this.div,t)t.hasOwnProperty(i)&&(e.style[i]=t[i])},m.prototype.formatStyle=function(t,e){return 0===t?0:t+e},b.prototype=e(m.prototype),b.prototype.constructor=b,y.prototype.move=function(t,e){switch(e=void 0!==e?e:this.lineHeight,t){case"+x":this.left+=e,this.right+=e;break;case"-x":this.left-=e,this.right-=e;break;case"+y":this.top+=e,this.bottom+=e;break;case"-y":this.top-=e,this.bottom-=e}},y.prototype.overlaps=function(t){return this.left<t.right&&this.right>t.left&&this.top<t.bottom&&this.bottom>t.top},y.prototype.overlapsAny=function(t){for(var e=0;e<t.length;e++)if(this.overlaps(t[e]))return!0;return!1},y.prototype.within=function(t){return this.top>=t.top&&this.bottom<=t.bottom&&this.left>=t.left&&this.right<=t.right},y.prototype.overlapsOppositeAxis=function(t,e){switch(e){case"+x":return this.left<t.left;case"-x":return this.right>t.right;case"+y":return this.top<t.top;case"-y":return this.bottom>t.bottom}},y.prototype.intersectPercentage=function(t){return Math.max(0,Math.min(this.right,t.right)-Math.max(this.left,t.left))*Math.max(0,Math.min(this.bottom,t.bottom)-Math.max(this.top,t.top))/(this.height*this.width)},y.prototype.toCSSCompatValues=function(t){return{top:this.top-t.top,bottom:t.bottom-this.bottom,left:this.left-t.left,right:t.right-this.right,height:this.height,width:this.width}},y.getSimpleBoxPosition=function(t){var e=t.div?t.div.offsetHeight:t.tagName?t.offsetHeight:0,i=t.div?t.div.offsetWidth:t.tagName?t.offsetWidth:0,r=t.div?t.div.offsetTop:t.tagName?t.offsetTop:0;return{left:(t=t.div?t.div.getBoundingClientRect():t.tagName?t.getBoundingClientRect():t).left,right:t.right,top:t.top||r,height:t.height||e,bottom:t.bottom||r+(t.height||e),width:t.width||i}},T.StringDecoder=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}},T.convertCueToDOMTree=function(t,e){return t&&e?f(t,e):null};var x=.05,E="sans-serif",S="1.5%";T.processCues=function(t,e,i){if(!t||!e||!i)return null;for(;i.firstChild;)i.removeChild(i.firstChild);var r=t.document.createElement("div");if(r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",r.style.margin=S,i.appendChild(r),function(t){for(var e=0;e<t.length;e++)if(t[e].hasBeenReset||!t[e].displayState)return!0;return!1}(e)){var n=[],o=y.getSimpleBoxPosition(r),a={font:Math.round(o.height*x*100)/100+"px "+E};!function(){for(var i,s,c=0;c<e.length;c++)s=e[c],i=new b(t,s,a),r.appendChild(i.div),w(t,i,o,n),s.displayState=i.div,n.push(y.getSimpleBoxPosition(i))}()}else for(var s=0;s<e.length;s++)r.appendChild(e[s].displayState)},T.Parser=function(t,e,i){i||(i=e,e={}),e||(e={}),this.window=t,this.vttjs=e,this.state="INITIAL",this.buffer="",this.decoder=i||new TextDecoder("utf8"),this.regionList=[]},T.Parser.prototype={reportOrThrowError:function(t){if(!(t instanceof i))throw t;this.onparsingerror&&this.onparsingerror(t)},parse:function(t){var e=this;function s(){for(var t=e.buffer,i=0;i<t.length&&"\r"!==t[i]&&"\n"!==t[i];)++i;var r=t.substr(0,i);return"\r"===t[i]&&++i,"\n"===t[i]&&++i,e.buffer=t.substr(i),r}function c(t){t.match(/X-TIMESTAMP-MAP/)?o(t,function(t,i){switch(t){case"X-TIMESTAMP-MAP":a=i,s=new n,o(a,function(t,e){switch(t){case"MPEGT":s.integer(t+"S",e);break;case"LOCA":s.set(t+"L",r(e))}},/[^\d]:/,/,/),e.ontimestampmap&&e.ontimestampmap({MPEGTS:s.get("MPEGTS"),LOCAL:s.get("LOCAL")})}var a,s},/=/):o(t,function(t,i){switch(t){case"Region":!function(t){var i=new n;if(o(t,function(t,e){switch(t){case"id":i.set(t,e);break;case"width":i.percent(t,e);break;case"lines":i.integer(t,e);break;case"regionanchor":case"viewportanchor":var r=e.split(",");if(2!==r.length)break;var o=new n;if(o.percent("x",r[0]),o.percent("y",r[1]),!o.has("x")||!o.has("y"))break;i.set(t+"X",o.get("x")),i.set(t+"Y",o.get("y"));break;case"scroll":i.alt(t,e,["up"])}},/=/,/\s/),i.has("id")){var r=new(e.vttjs.VTTRegion||e.window.VTTRegion);r.width=i.get("width",100),r.lines=i.get("lines",3),r.regionAnchorX=i.get("regionanchorX",0),r.regionAnchorY=i.get("regionanchorY",100),r.viewportAnchorX=i.get("viewportanchorX",0),r.viewportAnchorY=i.get("viewportanchorY",100),r.scroll=i.get("scroll",""),e.onregion&&e.onregion(r),e.regionList.push({id:i.get("id"),region:r})}}(i)}},/:/)}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var h;if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var l=(h=s()).match(/^WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new i(i.Errors.BadSignature);e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:h=s(),e.state){case"HEADER":/:/.test(h)?c(h):h||(e.state="ID");continue;case"NOTE":h||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(h)){e.state="NOTE";break}if(!h)continue;e.cue=new(e.vttjs.VTTCue||e.window.VTTCue)(0,0,"");try{e.cue.align="center"}catch(p){e.cue.align="middle"}if(e.state="CUE",-1===h.indexOf("--\x3e")){e.cue.id=h;continue}case"CUE":try{a(h,e.cue,e.regionList)}catch(p){e.reportOrThrowError(p),e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var f=-1!==h.indexOf("--\x3e");if(!h||f&&(u=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+="\n"),e.cue.text+=h.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":h||(e.state="ID");continue}}}catch(p){e.reportOrThrowError(p),"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new i(i.Errors.BadSignature)}catch(t){this.reportOrThrowError(t)}return this.onflush&&this.onflush(),this}},module.exports=T;
},{"global/document":"DnRs"}],"QoeU":[function(require,module,exports) {
var e="auto",t={"":1,lr:1,rl:1},n={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function i(e){return"string"==typeof e&&(!!t[e.toLowerCase()]&&e.toLowerCase())}function r(e){return"string"==typeof e&&(!!n[e.toLowerCase()]&&e.toLowerCase())}function s(t,n,s){this.hasBeenReset=!1;var o="",a=!1,u=t,l=n,f=s,c=null,h="",g=!0,m="auto",w="start",b="auto",d="auto",p=100,v="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return o},set:function(e){o=""+e}},pauseOnExit:{enumerable:!0,get:function(){return a},set:function(e){a=!!e}},startTime:{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return c},set:function(e){c=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return h},set:function(e){var t=i(e);if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");h=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return m},set:function(t){if("number"!=typeof t&&t!==e)throw new SyntaxError("Line: an invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return w},set:function(e){var t=r(e);t?(w=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return d},set:function(e){var t=r(e);t?(d=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return p},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");p=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return v},set:function(e){var t=r(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");v=t,this.hasBeenReset=!0}}}),this.displayState=void 0}s.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},module.exports=s;
},{}],"kI9a":[function(require,module,exports) {
var e={"":!0,up:!0};function n(n){return"string"==typeof n&&(!!e[n.toLowerCase()]&&n.toLowerCase())}function r(e){return"number"==typeof e&&e>=0&&e<=100}function t(){var e=100,t=3,o=0,i=100,u=0,c=100,f="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(n){if(!r(n))throw new Error("Width must be between 0 and 100.");e=n}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return i},set:function(e){if(!r(e))throw new Error("RegionAnchorX must be between 0 and 100.");i=e}},regionAnchorX:{enumerable:!0,get:function(){return o},set:function(e){if(!r(e))throw new Error("RegionAnchorY must be between 0 and 100.");o=e}},viewportAnchorY:{enumerable:!0,get:function(){return c},set:function(e){if(!r(e))throw new Error("ViewportAnchorY must be between 0 and 100.");c=e}},viewportAnchorX:{enumerable:!0,get:function(){return u},set:function(e){if(!r(e))throw new Error("ViewportAnchorX must be between 0 and 100.");u=e}},scroll:{enumerable:!0,get:function(){return f},set:function(e){var r=n(e);!1===r?console.warn("Scroll: an invalid or illegal string was specified."):f=r}}})}module.exports=t;
},{}],"kRPZ":[function(require,module,exports) {
var e=require("global/window"),T=module.exports={WebVTT:require("./vtt.js"),VTTCue:require("./vttcue.js"),VTTRegion:require("./vttregion.js")};e.vttjs=T,e.WebVTT=T.WebVTT;var i=T.VTTCue,r=T.VTTRegion,u=e.VTTCue,V=e.VTTRegion;T.shim=function(){e.VTTCue=i,e.VTTRegion=r},T.restore=function(){e.VTTCue=u,e.VTTRegion=V},e.VTTCue||T.shim();
},{"global/window":"J3Xk","./vtt.js":"R6Ya","./vttcue.js":"QoeU","./vttregion.js":"kI9a"}],"v5KI":[function(require,module,exports) {
function e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"XsAw":[function(require,module,exports) {
var e=require("./setPrototypeOf.js"),o=require("./isNativeReflectConstruct.js");function t(u,l,r){return o()?(module.exports=t=Reflect.construct,module.exports.default=module.exports,module.exports.__esModule=!0):(module.exports=t=function(o,t,u){var l=[null];l.push.apply(l,t);var r=new(Function.bind.apply(o,l));return u&&e(r,u.prototype),r},module.exports.default=module.exports,module.exports.__esModule=!0),t.apply(null,arguments)}module.exports=t,module.exports.default=module.exports,module.exports.__esModule=!0;
},{"./setPrototypeOf.js":"Jibl","./isNativeReflectConstruct.js":"v5KI"}],"qngw":[function(require,module,exports) {
var e=require("./setPrototypeOf.js");function o(o,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),t&&e(o,t)}module.exports=o,module.exports.default=module.exports,module.exports.__esModule=!0;
},{"./setPrototypeOf.js":"Jibl"}],"byHd":[function(require,module,exports) {
var define;
var r;!function(t){var e=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,a=/^([^\/?#]*)([^]*)$/,o=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,p={buildAbsoluteURL:function(r,t,e){if(e=e||{},r=r.trim(),!(t=t.trim())){if(!e.alwaysNormalize)return r;var o=p.parseURL(r);if(!o)throw new Error("Error trying to parse base URL.");return o.path=p.normalizePath(o.path),p.buildURLFromParts(o)}var n=p.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return e.alwaysNormalize?(n.path=p.normalizePath(n.path),p.buildURLFromParts(n)):t;var i=p.parseURL(r);if(!i)throw new Error("Error trying to parse base URL.");if(!i.netLoc&&i.path&&"/"!==i.path[0]){var s=a.exec(i.path);i.netLoc=s[1],i.path=s[2]}i.netLoc&&!i.path&&(i.path="/");var h={scheme:i.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(h.netLoc=i.netLoc,"/"!==n.path[0]))if(n.path){var l=i.path,u=l.substring(0,l.lastIndexOf("/")+1)+n.path;h.path=p.normalizePath(u)}else h.path=i.path,n.params||(h.params=i.params,n.query||(h.query=i.query));return null===h.path&&(h.path=e.alwaysNormalize?p.normalizePath(n.path):n.path),p.buildURLFromParts(h)},parseURL:function(r){var t=e.exec(r);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(r){for(r=r.split("").reverse().join("").replace(o,"");r.length!==(r=r.replace(n,"")).length;);return r.split("").reverse().join("")},buildURLFromParts:function(r){return r.scheme+r.netLoc+r.path+r.params+r.query+r.fragment}};"object"==typeof exports&&"object"==typeof module?module.exports=p:"function"==typeof r&&r.amd?r([],function(){return p}):"object"==typeof exports?exports.URLToolkit=p:t.URLToolkit=p}(this);
},{}],"mSEf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("url-toolkit")),t=l(require("global/window"));function l(e){return e&&e.__esModule?e:{default:e}}var o="http://example.com",u=function(l,u){if(/^[a-z]+:/i.test(u))return u;/^data:/.test(l)&&(l=t.default.location&&t.default.location.href||"");var a="function"==typeof t.default.URL,r=/^\/\//.test(l),f=!t.default.location&&!/\/\//i.test(l);if(a?l=new t.default.URL(l,t.default.location||o):/\/\//i.test(l)||(l=e.default.buildAbsoluteURL(t.default.location&&t.default.location.href||"",l)),a){var i=new URL(u,l);return f?i.href.slice(o.length):r?i.href.slice(i.protocol.length):i.href}return e.default.buildAbsoluteURL(l,u)},a=u;exports.default=a;
},{"url-toolkit":"byHd","global/window":"J3Xk"}],"ztXA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var s=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(s,1),s>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var s=e.length,i=0;i<s;++i)e[i].call(this,arguments[1]);else for(var n=Array.prototype.slice.call(arguments,1),r=e.length,l=0;l<r;++l)e[l].apply(this,n)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",function(e){t.push(e)})},t}();exports.default=t;
},{}],"FRly":[function(require,module,exports) {
"use strict";exports.byteLength=u,exports.toByteArray=i,exports.fromByteArray=d;for(var r=[],t=[],e="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=n.length;o<a;++o)r[o]=n[o],t[n.charCodeAt(o)]=o;function h(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=r.indexOf("=");return-1===e&&(e=t),[e,e===t?0:4-e%4]}function u(r){var t=h(r),e=t[0],n=t[1];return 3*(e+n)/4-n}function c(r,t,e){return 3*(t+e)/4-e}function i(r){var n,o,a=h(r),u=a[0],i=a[1],f=new e(c(r,u,i)),A=0,d=i>0?u-4:u;for(o=0;o<d;o+=4)n=t[r.charCodeAt(o)]<<18|t[r.charCodeAt(o+1)]<<12|t[r.charCodeAt(o+2)]<<6|t[r.charCodeAt(o+3)],f[A++]=n>>16&255,f[A++]=n>>8&255,f[A++]=255&n;return 2===i&&(n=t[r.charCodeAt(o)]<<2|t[r.charCodeAt(o+1)]>>4,f[A++]=255&n),1===i&&(n=t[r.charCodeAt(o)]<<10|t[r.charCodeAt(o+1)]<<4|t[r.charCodeAt(o+2)]>>2,f[A++]=n>>8&255,f[A++]=255&n),f}function f(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function A(r,t,e){for(var n,o=[],a=t;a<e;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(255&r[a+2]),o.push(f(n));return o.join("")}function d(t){for(var e,n=t.length,o=n%3,a=[],h=0,u=n-o;h<u;h+=16383)a.push(A(t,h,h+16383>u?u:h+16383));return 1===o?(e=t[n-1],a.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],a.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),a.join("")}t["-".charCodeAt(0)]=62,t["_".charCodeAt(0)]=63;
},{}],"Quj6":[function(require,module,exports) {
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),(o+=p+N>=1?n/f:n*Math.pow(2,1-N))*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],"aqZJ":[function(require,module,exports) {
var r={}.toString;module.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)};
},{}],"aMB2":[function(require,module,exports) {

var global = arguments[3];
var t=arguments[3],r=require("base64-js"),e=require("ieee754"),n=require("isarray");function i(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(r){return!1}}function o(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(t,r){if(o()<r)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r)).__proto__=f.prototype:(null===t&&(t=new f(r)),t.length=r),t}function f(t,r,e){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(t,r,e);if("number"==typeof t){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return s(this,t,r,e)}function s(t,r,e,n){if("number"==typeof r)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?g(t,r,e,n):"string"==typeof r?l(t,r,e):y(t,r)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function a(t,r,e,n){return h(r),r<=0?u(t,r):void 0!==e?"string"==typeof n?u(t,r).fill(e,n):u(t,r).fill(e):u(t,r)}function c(t,r){if(h(r),t=u(t,r<0?0:0|w(r)),!f.TYPED_ARRAY_SUPPORT)for(var e=0;e<r;++e)t[e]=0;return t}function l(t,r,e){if("string"==typeof e&&""!==e||(e="utf8"),!f.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(r,e),i=(t=u(t,n)).write(r,e);return i!==n&&(t=t.slice(0,i)),t}function p(t,r){var e=r.length<0?0:0|w(r.length);t=u(t,e);for(var n=0;n<e;n+=1)t[n]=255&r[n];return t}function g(t,r,e,n){if(r.byteLength,e<0||r.byteLength<e)throw new RangeError("'offset' is out of bounds");if(r.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");return r=void 0===e&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,e):new Uint8Array(r,e,n),f.TYPED_ARRAY_SUPPORT?(t=r).__proto__=f.prototype:t=p(t,r),t}function y(t,r){if(f.isBuffer(r)){var e=0|w(r.length);return 0===(t=u(t,e)).length?t:(r.copy(t,0,0,e),t)}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||W(r.length)?u(t,0):p(t,r);if("Buffer"===r.type&&n(r.data))return p(t,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function w(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function d(t){return+t!=t&&(t=0),f.alloc(+t)}function v(t,r){if(f.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var e=t.length;if(0===e)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return $(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return K(t).length;default:if(n)return $(t).length;r=(""+r).toLowerCase(),n=!0}}function E(t,r,e){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if((e>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return x(this,r,e);case"utf8":case"utf-8":return Y(this,r,e);case"ascii":return L(this,r,e);case"latin1":case"binary":return D(this,r,e);case"base64":return S(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,r,e);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,r,e){var n=t[r];t[r]=t[e],t[e]=n}function R(t,r,e,n,i){if(0===t.length)return-1;if("string"==typeof e?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=i?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(i)return-1;e=t.length-1}else if(e<0){if(!i)return-1;e=0}if("string"==typeof r&&(r=f.from(r,n)),f.isBuffer(r))return 0===r.length?-1:_(t,r,e,n,i);if("number"==typeof r)return r&=255,f.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,e):Uint8Array.prototype.lastIndexOf.call(t,r,e):_(t,[r],e,n,i);throw new TypeError("val must be string, number or Buffer")}function _(t,r,e,n,i){var o,u=1,f=t.length,s=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return-1;u=2,f/=2,s/=2,e/=2}function h(t,r){return 1===u?t[r]:t.readUInt16BE(r*u)}if(i){var a=-1;for(o=e;o<f;o++)if(h(t,o)===h(r,-1===a?0:o-a)){if(-1===a&&(a=o),o-a+1===s)return a*u}else-1!==a&&(o-=o-a),a=-1}else for(e+s>f&&(e=f-s),o=e;o>=0;o--){for(var c=!0,l=0;l<s;l++)if(h(t,o+l)!==h(r,l)){c=!1;break}if(c)return o}return-1}function A(t,r,e,n){e=Number(e)||0;var i=t.length-e;n?(n=Number(n))>i&&(n=i):n=i;var o=r.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var u=0;u<n;++u){var f=parseInt(r.substr(2*u,2),16);if(isNaN(f))return u;t[e+u]=f}return u}function m(t,r,e,n){return Q($(r,t.length-e),t,e,n)}function P(t,r,e,n){return Q(G(r),t,e,n)}function T(t,r,e,n){return P(t,r,e,n)}function B(t,r,e,n){return Q(K(r),t,e,n)}function U(t,r,e,n){return Q(H(r,t.length-e),t,e,n)}function S(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function Y(t,r,e){e=Math.min(t.length,e);for(var n=[],i=r;i<e;){var o,u,f,s,h=t[i],a=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=e)switch(c){case 1:h<128&&(a=h);break;case 2:128==(192&(o=t[i+1]))&&(s=(31&h)<<6|63&o)>127&&(a=s);break;case 3:o=t[i+1],u=t[i+2],128==(192&o)&&128==(192&u)&&(s=(15&h)<<12|(63&o)<<6|63&u)>2047&&(s<55296||s>57343)&&(a=s);break;case 4:o=t[i+1],u=t[i+2],f=t[i+3],128==(192&o)&&128==(192&u)&&128==(192&f)&&(s=(15&h)<<18|(63&o)<<12|(63&u)<<6|63&f)>65535&&s<1114112&&(a=s)}null===a?(a=65533,c=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=c}return O(n)}exports.Buffer=f,exports.SlowBuffer=d,exports.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),exports.kMaxLength=o(),f.poolSize=8192,f._augment=function(t){return t.__proto__=f.prototype,t},f.from=function(t,r,e){return s(null,t,r,e)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(t,r,e){return a(null,t,r,e)},f.allocUnsafe=function(t){return c(null,t)},f.allocUnsafeSlow=function(t){return c(null,t)},f.isBuffer=function(t){return!(null==t||!t._isBuffer)},f.compare=function(t,r){if(!f.isBuffer(t)||!f.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var e=t.length,n=r.length,i=0,o=Math.min(e,n);i<o;++i)if(t[i]!==r[i]){e=t[i],n=r[i];break}return e<n?-1:n<e?1:0},f.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(t,r){if(!n(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return f.alloc(0);var e;if(void 0===r)for(r=0,e=0;e<t.length;++e)r+=t[e].length;var i=f.allocUnsafe(r),o=0;for(e=0;e<t.length;++e){var u=t[e];if(!f.isBuffer(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(i,o),o+=u.length}return i},f.byteLength=v,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)b(this,r,r+1);return this},f.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)b(this,r,r+3),b(this,r+1,r+2);return this},f.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)b(this,r,r+7),b(this,r+1,r+6),b(this,r+2,r+5),b(this,r+3,r+4);return this},f.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Y(this,0,t):E.apply(this,arguments)},f.prototype.equals=function(t){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===f.compare(this,t)},f.prototype.inspect=function(){var t="",r=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},f.prototype.compare=function(t,r,e,n,i){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===e&&(e=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),r<0||e>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&r>=e)return 0;if(n>=i)return-1;if(r>=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),u=(e>>>=0)-(r>>>=0),s=Math.min(o,u),h=this.slice(n,i),a=t.slice(r,e),c=0;c<s;++c)if(h[c]!==a[c]){o=h[c],u=a[c];break}return o<u?-1:u<o?1:0},f.prototype.includes=function(t,r,e){return-1!==this.indexOf(t,r,e)},f.prototype.indexOf=function(t,r,e){return R(this,t,r,e,!0)},f.prototype.lastIndexOf=function(t,r,e){return R(this,t,r,e,!1)},f.prototype.write=function(t,r,e,n){if(void 0===r)n="utf8",e=this.length,r=0;else if(void 0===e&&"string"==typeof r)n=r,e=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(e)?(e|=0,void 0===n&&(n="utf8")):(n=e,e=void 0)}var i=this.length-r;if((void 0===e||e>i)&&(e=i),t.length>0&&(e<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return A(this,t,r,e);case"utf8":case"utf-8":return m(this,t,r,e);case"ascii":return P(this,t,r,e);case"latin1":case"binary":return T(this,t,r,e);case"base64":return B(this,t,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,r,e);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function O(t){var r=t.length;if(r<=I)return String.fromCharCode.apply(String,t);for(var e="",n=0;n<r;)e+=String.fromCharCode.apply(String,t.slice(n,n+=I));return e}function L(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(127&t[i]);return n}function D(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(t[i]);return n}function x(t,r,e){var n=t.length;(!r||r<0)&&(r=0),(!e||e<0||e>n)&&(e=n);for(var i="",o=r;o<e;++o)i+=Z(t[o]);return i}function C(t,r,e){for(var n=t.slice(r,e),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function M(t,r,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+r>e)throw new RangeError("Trying to access beyond buffer length")}function k(t,r,e,n,i,o){if(!f.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<o)throw new RangeError('"value" argument is out of bounds');if(e+n>t.length)throw new RangeError("Index out of range")}function N(t,r,e,n){r<0&&(r=65535+r+1);for(var i=0,o=Math.min(t.length-e,2);i<o;++i)t[e+i]=(r&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function z(t,r,e,n){r<0&&(r=4294967295+r+1);for(var i=0,o=Math.min(t.length-e,4);i<o;++i)t[e+i]=r>>>8*(n?i:3-i)&255}function F(t,r,e,n,i,o){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function j(t,r,n,i,o){return o||F(t,r,n,4,3.4028234663852886e38,-3.4028234663852886e38),e.write(t,r,n,i,23,4),n+4}function q(t,r,n,i,o){return o||F(t,r,n,8,1.7976931348623157e308,-1.7976931348623157e308),e.write(t,r,n,i,52,8),n+8}f.prototype.slice=function(t,r){var e,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t),f.TYPED_ARRAY_SUPPORT)(e=this.subarray(t,r)).__proto__=f.prototype;else{var i=r-t;e=new f(i,void 0);for(var o=0;o<i;++o)e[o]=this[o+t]}return e},f.prototype.readUIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n},f.prototype.readUIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t+--r],i=1;r>0&&(i*=256);)n+=this[t+--r]*i;return n},f.prototype.readUInt8=function(t,r){return r||M(t,1,this.length),this[t]},f.prototype.readUInt16LE=function(t,r){return r||M(t,2,this.length),this[t]|this[t+1]<<8},f.prototype.readUInt16BE=function(t,r){return r||M(t,2,this.length),this[t]<<8|this[t+1]},f.prototype.readUInt32LE=function(t,r){return r||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},f.prototype.readUInt32BE=function(t,r){return r||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},f.prototype.readIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*r)),n},f.prototype.readIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=r,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*r)),o},f.prototype.readInt8=function(t,r){return r||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},f.prototype.readInt16LE=function(t,r){r||M(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt16BE=function(t,r){r||M(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt32LE=function(t,r){return r||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},f.prototype.readInt32BE=function(t,r){return r||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},f.prototype.readFloatLE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!0,23,4)},f.prototype.readFloatBE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!1,23,4)},f.prototype.readDoubleLE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!0,52,8)},f.prototype.readDoubleBE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!1,52,8)},f.prototype.writeUIntLE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=1,o=0;for(this[r]=255&t;++o<e&&(i*=256);)this[r+o]=t/i&255;return r+e},f.prototype.writeUIntBE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=e-1,o=1;for(this[r+i]=255&t;--i>=0&&(o*=256);)this[r+i]=t/o&255;return r+e},f.prototype.writeUInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,255,0),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1},f.prototype.writeUInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeUInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeUInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):z(this,t,r,!0),r+4},f.prototype.writeUInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeIntLE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=0,u=1,f=0;for(this[r]=255&t;++o<e&&(u*=256);)t<0&&0===f&&0!==this[r+o-1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeIntBE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=e-1,u=1,f=0;for(this[r+o]=255&t;--o>=0&&(u*=256);)t<0&&0===f&&0!==this[r+o+1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,127,-128),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=255&t,r+1},f.prototype.writeInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):z(this,t,r,!0),r+4},f.prototype.writeInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeFloatLE=function(t,r,e){return j(this,t,r,!0,e)},f.prototype.writeFloatBE=function(t,r,e){return j(this,t,r,!1,e)},f.prototype.writeDoubleLE=function(t,r,e){return q(this,t,r,!0,e)},f.prototype.writeDoubleBE=function(t,r,e){return q(this,t,r,!1,e)},f.prototype.copy=function(t,r,e,n){if(e||(e=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<e&&(n=e),n===e)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-e&&(n=t.length-r+e);var i,o=n-e;if(this===t&&e<r&&r<n)for(i=o-1;i>=0;--i)t[i+r]=this[i+e];else if(o<1e3||!f.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+r]=this[i+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+o),r);return o},f.prototype.fill=function(t,r,e,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,e=this.length):"string"==typeof e&&(n=e,e=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<e)throw new RangeError("Out of range index");if(e<=r)return this;var o;if(r>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0),"number"==typeof t)for(o=r;o<e;++o)this[o]=t;else{var u=f.isBuffer(t)?t:$(new f(t,n).toString()),s=u.length;for(o=0;o<e-r;++o)this[o+r]=u[o%s]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function X(t){if((t=J(t).replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function J(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Z(t){return t<16?"0"+t.toString(16):t.toString(16)}function $(t,r){var e;r=r||1/0;for(var n=t.length,i=null,o=[],u=0;u<n;++u){if((e=t.charCodeAt(u))>55295&&e<57344){if(!i){if(e>56319){(r-=3)>-1&&o.push(239,191,189);continue}if(u+1===n){(r-=3)>-1&&o.push(239,191,189);continue}i=e;continue}if(e<56320){(r-=3)>-1&&o.push(239,191,189),i=e;continue}e=65536+(i-55296<<10|e-56320)}else i&&(r-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((r-=1)<0)break;o.push(e)}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,63&e|128)}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return o}function G(t){for(var r=[],e=0;e<t.length;++e)r.push(255&t.charCodeAt(e));return r}function H(t,r){for(var e,n,i,o=[],u=0;u<t.length&&!((r-=2)<0);++u)n=(e=t.charCodeAt(u))>>8,i=e%256,o.push(i),o.push(n);return o}function K(t){return r.toByteArray(X(t))}function Q(t,r,e,n){for(var i=0;i<n&&!(i+e>=r.length||i>=t.length);++i)r[i+e]=t[i];return i}function W(t){return t!=t}
},{"base64-js":"FRly","ieee754":"Quj6","isarray":"aqZJ","buffer":"aMB2"}],"Nwqs":[function(require,module,exports) {
var Buffer = require("buffer").Buffer;
var e=require("buffer").Buffer;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var r=t(require("global/window"));function t(e){return e&&e.__esModule?e:{default:e}}var n=function(t){return r.default.atob?r.default.atob(t):e.from(t,"base64").toString("binary")};function u(e){for(var r=n(e),t=new Uint8Array(r.length),u=0;u<r.length;u++)t[u]=r.charCodeAt(u);return t}
},{"global/window":"J3Xk","buffer":"aMB2"}],"HWpm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Parser=exports.ParseStream=exports.LineStream=void 0;var t=s(require("@babel/runtime/helpers/inheritsLoose")),e=s(require("@videojs/vhs-utils/es/stream.js")),i=s(require("@babel/runtime/helpers/extends")),r=s(require("@babel/runtime/helpers/assertThisInitialized")),a=s(require("@videojs/vhs-utils/es/decode-b64-to-uint8-array.js"));function s(t){return t&&t.__esModule?t:{default:t}}var n=function(e){function i(){var t;return(t=e.call(this)||this).buffer="",t}return(0,t.default)(i,e),i.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},i}(e.default);exports.LineStream=n;var u=String.fromCharCode(9),o=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),i={};return e[1]&&(i.length=parseInt(e[1],10)),e[2]&&(i.offset=parseInt(e[2],10)),i},g=function(){return new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')},f=function(t){for(var e,i=t.split(g()),r={},a=i.length;a--;)""!==i[a]&&((e=/([^=]*)=(.*)/.exec(i[a]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),r[e[0]]=e[1]);return r},p=function(e){function r(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}(0,t.default)(r,e);var a=r.prototype;return a.push=function(t){var e,r,a=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce(function(e,i){var r=i(t);return r===t?e:e.concat([r])},[t]).forEach(function(t){for(var s=0;s<a.customParsers.length;s++)if(a.customParsers[s].call(a,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))a.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return r={type:"tag",tagType:"inf"},e[1]&&(r.duration=parseFloat(e[1])),e[2]&&(r.title=e[2]),void a.trigger("data",r);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"targetduration"},e[1]&&(r.duration=parseInt(e[1],10)),void a.trigger("data",r);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"version"},e[1]&&(r.version=parseInt(e[1],10)),void a.trigger("data",r);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"media-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void a.trigger("data",r);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void a.trigger("data",r);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return r={type:"tag",tagType:"playlist-type"},e[1]&&(r.playlistType=e[1]),void a.trigger("data",r);if(e=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t))return r=(0,i.default)(o(e[1]),{type:"tag",tagType:"byterange"}),void a.trigger("data",r);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return r={type:"tag",tagType:"allow-cache"},e[1]&&(r.allowed=!/NO/.test(e[1])),void a.trigger("data",r);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"map"},e[1]){var n=f(e[1]);n.URI&&(r.uri=n.URI),n.BYTERANGE&&(r.byterange=o(n.BYTERANGE))}a.trigger("data",r)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"stream-inf"},e[1]){if(r.attributes=f(e[1]),r.attributes.RESOLUTION){var g=r.attributes.RESOLUTION.split("x"),p={};g[0]&&(p.width=parseInt(g[0],10)),g[1]&&(p.height=parseInt(g[1],10)),r.attributes.RESOLUTION=p}r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes["PROGRAM-ID"]&&(r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10))}a.trigger("data",r)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return r={type:"tag",tagType:"media"},e[1]&&(r.attributes=f(e[1])),void a.trigger("data",r);if(e=/^#EXT-X-ENDLIST/.exec(t))a.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))a.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return r={type:"tag",tagType:"program-date-time"},e[1]&&(r.dateTimeString=e[1],r.dateTimeObject=new Date(e[1])),void a.trigger("data",r);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return r={type:"tag",tagType:"key"},e[1]&&(r.attributes=f(e[1]),r.attributes.IV&&("0x"===r.attributes.IV.substring(0,2).toLowerCase()&&(r.attributes.IV=r.attributes.IV.substring(2)),r.attributes.IV=r.attributes.IV.match(/.{8}/g),r.attributes.IV[0]=parseInt(r.attributes.IV[0],16),r.attributes.IV[1]=parseInt(r.attributes.IV[1],16),r.attributes.IV[2]=parseInt(r.attributes.IV[2],16),r.attributes.IV[3]=parseInt(r.attributes.IV[3],16),r.attributes.IV=new Uint32Array(r.attributes.IV))),void a.trigger("data",r);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return r={type:"tag",tagType:"start"},e[1]&&(r.attributes=f(e[1]),r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]),r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)),void a.trigger("data",r);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out-cont"},e[1]?r.data=e[1]:r.data="",void a.trigger("data",r);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out"},e[1]?r.data=e[1]:r.data="",void a.trigger("data",r);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-in"},e[1]?r.data=e[1]:r.data="",void a.trigger("data",r);if((e=/^#EXT-X-SKIP:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"skip"}).attributes=f(e[1]),r.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(r.attributes["SKIPPED-SEGMENTS"]=parseInt(r.attributes["SKIPPED-SEGMENTS"],10)),r.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(r.attributes["RECENTLY-REMOVED-DATERANGES"]=r.attributes["RECENTLY-REMOVED-DATERANGES"].split(u)),void a.trigger("data",r);if((e=/^#EXT-X-PART:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"part"}).attributes=f(e[1]),["DURATION"].forEach(function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))}),["INDEPENDENT","GAP"].forEach(function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))}),r.attributes.hasOwnProperty("BYTERANGE")&&(r.attributes.byterange=o(r.attributes.BYTERANGE)),void a.trigger("data",r);if((e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"server-control"}).attributes=f(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))}),void a.trigger("data",r);if((e=/^#EXT-X-PART-INF:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"part-inf"}).attributes=f(e[1]),["PART-TARGET"].forEach(function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))}),void a.trigger("data",r);if((e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"preload-hint"}).attributes=f(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(t){if(r.attributes.hasOwnProperty(t)){r.attributes[t]=parseInt(r.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";r.attributes.byterange=r.attributes.byterange||{},r.attributes.byterange[e]=r.attributes[t],delete r.attributes[t]}}),void a.trigger("data",r);if((e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"rendition-report"}).attributes=f(e[1]),["LAST-MSN","LAST-PART"].forEach(function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseInt(r.attributes[t],10))}),void a.trigger("data",r);a.trigger("data",{type:"tag",data:t.slice(4)})}}}else a.trigger("data",{type:"comment",text:t.slice(1)})}):this.trigger("data",{type:"uri",uri:t}))},a.addParser=function(t){var e=this,i=t.expression,r=t.customType,a=t.dataParser,s=t.segment;"function"!=typeof a&&(a=function(t){return t}),this.customParsers.push(function(t){if(i.exec(t))return e.trigger("data",{type:"custom",data:a(t),customType:r,segment:s}),!0})},a.addTagMapper=function(t){var e=t.expression,i=t.map;this.tagMappers.push(function(t){return e.test(t)?i(t):t})},r}(e.default);exports.ParseStream=p;var d=function(t){return t.toLowerCase().replace(/-(\w)/g,function(t){return t[1].toUpperCase()})},c=function(t){var e={};return Object.keys(t).forEach(function(i){e[d(i)]=t[i]}),e},E=function(t){var e=t.serverControl,i=t.targetDuration,r=t.partTargetDuration;if(e){var a="#EXT-X-SERVER-CONTROL",s="holdBack",n="partHoldBack",u=i&&3*i,o=r&&2*r;i&&!e.hasOwnProperty(s)&&(e[s]=u,this.trigger("info",{message:a+" defaulting HOLD-BACK to targetDuration * 3 ("+u+")."})),u&&e[s]<u&&(this.trigger("warn",{message:a+" clamping HOLD-BACK ("+e[s]+") to targetDuration * 3 ("+u+")"}),e[s]=u),r&&!e.hasOwnProperty(n)&&(e[n]=3*r,this.trigger("info",{message:a+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[n]+")."})),r&&e[n]<o&&(this.trigger("warn",{message:a+" clamping PART-HOLD-BACK ("+e[n]+") to partTargetDuration * 2 ("+o+")."}),e[n]=o)}},T=function(e){function s(){var t;(t=e.call(this)||this).lineStream=new n,t.parseStream=new p,t.lineStream.pipe(t.parseStream);var s,u,o=(0,r.default)(t),g=[],f={},d=!1,T={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},h=0;t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var b=0,m=0;return t.on("end",function(){f.uri||!f.parts&&!f.preloadHints||(!f.map&&s&&(f.map=s),!f.key&&u&&(f.key=u),f.timeline||"number"!=typeof h||(f.timeline=h),t.manifest.preloadSegment=f)}),t.parseStream.on("data",function(t){var e,r;({tag:function(){({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(f.byterange=e,e.length=t.length,"offset"in t||(t.offset=b)),"offset"in t&&(f.byterange=e,e.offset=t.offset),b=e.offset+e.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(f.duration=t.duration),0===t.duration&&(f.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=g},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("com.apple.streamingkeydelivery"===t.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:t.attributes});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:(0,a.default)(t.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),u={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(u.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else u=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,h=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){s={},t.uri&&(s.uri=t.uri),t.byterange&&(s.byterange=t.byterange),u&&(s.key=u)},"stream-inf":function(){this.manifest.playlists=g,this.manifest.mediaGroups=this.manifest.mediaGroups||T,t.attributes?(f.attributes||(f.attributes={}),(0,i.default)(f.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||T,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var i=this.manifest.mediaGroups[t.attributes.TYPE];i[t.attributes["GROUP-ID"]]=i[t.attributes["GROUP-ID"]]||{},e=i[t.attributes["GROUP-ID"]],(r={default:/yes/i.test(t.attributes.DEFAULT)}).default?r.autoselect=!0:r.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(r.language=t.attributes.LANGUAGE),t.attributes.URI&&(r.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(r.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(r.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(r.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=r}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){h+=1,f.discontinuity=!0,this.manifest.discontinuityStarts.push(g.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),f.dateTimeString=t.dateTimeString,f.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,E.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){f.cueOut=t.data},"cue-out-cont":function(){f.cueOutCont=t.data},"cue-in":function(){f.cueIn=t.data},skip:function(){this.manifest.skip=c(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;d=!0;var i=this.manifest.segments.length,r=c(t.attributes);f.parts=f.parts||[],f.parts.push(r),r.byterange&&(r.byterange.hasOwnProperty("offset")||(r.byterange.offset=m),m=r.byterange.offset+r.byterange.length);var a=f.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+a+" for segment #"+i,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(t,i){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+i+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var e=this.manifest.serverControl=c(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),E.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,i=c(t.attributes),r=i.type&&"PART"===i.type;f.preloadHints=f.preloadHints||[],f.preloadHints.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=r?m:0,r&&(m=i.byterange.offset+i.byterange.length)));var a=f.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+a+" for segment #"+e,t.attributes,["TYPE","URI"]),i.type)for(var s=0;s<f.preloadHints.length-1;s++){var n=f.preloadHints[s];n.type&&(n.type===i.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+a+" for segment #"+e+" has the same TYPE "+i.type+" as preload hint #"+s}))}},"rendition-report":function(){var e=c(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var i=this.manifest.renditionReports.length-1,r=["LAST-MSN","URI"];d&&r.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+i,t.attributes,r)},"part-inf":function(){this.manifest.partInf=c(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),E.call(this,this.manifest)}}[t.tagType]||function(){}).call(o)},uri:function(){f.uri=t.uri,g.push(f),!this.manifest.targetDuration||"duration"in f||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),f.duration=this.manifest.targetDuration),u&&(f.key=u),f.timeline=h,s&&(f.map=s),m=0,f={}},comment:function(){},custom:function(){t.segment?(f.custom=f.custom||{},f.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(o)}),t}(0,t.default)(s,e);var u=s.prototype;return u.warnOnMissingAttributes_=function(t,e,i){var r=[];i.forEach(function(t){e.hasOwnProperty(t)||r.push(t)}),r.length&&this.trigger("warn",{message:t+" lacks required attribute(s): "+r.join(", ")})},u.push=function(t){this.lineStream.push(t)},u.end=function(){this.lineStream.push("\n"),this.trigger("end")},u.addParser=function(t){this.parseStream.addParser(t)},u.addTagMapper=function(t){this.parseStream.addTagMapper(t)},s}(e.default);exports.Parser=T;
},{"@babel/runtime/helpers/inheritsLoose":"tere","@videojs/vhs-utils/es/stream.js":"ztXA","@babel/runtime/helpers/extends":"ea3I","@babel/runtime/helpers/assertThisInitialized":"VmQe","@videojs/vhs-utils/es/decode-b64-to-uint8-array.js":"Nwqs"}],"lloA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_VIDEO_CODEC=exports.DEFAULT_AUDIO_CODEC=exports.muxerSupportsCodec=exports.browserSupportsCodec=exports.getMimeForCodec=exports.isTextCodec=exports.isAudioCodec=exports.isVideoCodec=exports.codecsFromDefault=exports.parseCodecs=exports.mapLegacyAvcCodecs=exports.translateLegacyCodecs=exports.translateLegacyCodec=void 0;var e=r(require("global/window"));function r(e){return e&&e.__esModule?e:{default:e}}var t={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},o=["video","audio","text"],a=["Video","Audio","Text"],s=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,r,t){return"avc1."+("00"+Number(r).toString(16)).slice(-2)+"00"+("00"+Number(t).toString(16)).slice(-2)}):e};exports.translateLegacyCodec=s;var i=function(e){return e.map(s)};exports.translateLegacyCodecs=i;var u=function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e){return i([e])[0]})};exports.mapLegacyAvcCodecs=u;var p=function(e){void 0===e&&(e="");var r=e.split(","),a=[];return r.forEach(function(e){var r;e=e.trim(),o.forEach(function(o){var s=t[o].exec(e.toLowerCase());if(s&&!(s.length<=1)){r=o;var i=e.substring(0,s[1].length),u=e.replace(i,"");a.push({type:i,details:u,mediaType:o})}}),r||a.push({type:e,details:"",mediaType:"unknown"})}),a};exports.parseCodecs=p;var n=function(e,r){if(!e.mediaGroups.AUDIO||!r)return null;var t=e.mediaGroups.AUDIO[r];if(!t)return null;for(var o in t){var a=t[o];if(a.default&&a.playlists)return p(a.playlists[0].attributes.CODECS)}return null};exports.codecsFromDefault=n;var c=function(e){return void 0===e&&(e=""),t.video.test(e.trim().toLowerCase())};exports.isVideoCodec=c;var d=function(e){return void 0===e&&(e=""),t.audio.test(e.trim().toLowerCase())};exports.isAudioCodec=d;var v=function(e){return void 0===e&&(e=""),t.text.test(e.trim().toLowerCase())};exports.isTextCodec=v;var l=function(e){if(e&&"string"==typeof e){var r=e.toLowerCase().split(",").map(function(e){return s(e.trim())}),o="video";1===r.length&&d(r[0])?o="audio":1===r.length&&v(r[0])&&(o="application");var a="mp4";return r.every(function(e){return t.mp4.test(e)})?a="mp4":r.every(function(e){return t.webm.test(e)})?a="webm":r.every(function(e){return t.ogg.test(e)})&&(a="ogg"),o+"/"+a+';codecs="'+e+'"'}};exports.getMimeForCodec=l;var m=function(r){return void 0===r&&(r=""),e.default.MediaSource&&e.default.MediaSource.isTypeSupported&&e.default.MediaSource.isTypeSupported(l(r))||!1};exports.browserSupportsCodec=m;var f=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every(function(e){e=e.trim();for(var r=0;r<a.length;r++){var o=a[r];if(t["muxer"+o].test(e))return!0}return!1})};exports.muxerSupportsCodec=f;var x="mp4a.40.2";exports.DEFAULT_AUDIO_CODEC=x;var C="avc1.4d400d";exports.DEFAULT_VIDEO_CODEC=C;
},{"global/window":"J3Xk"}],"nJMU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.simpleTypeFromSourceType=void 0;var e=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,o=/^application\/dash\+xml/i,p=function(p){return e.test(p)?"hls":o.test(p)?"dash":"application/vnd.videojs.vhs+json"===p?"vhs-json":null};exports.simpleTypeFromSourceType=p;
},{}],"vsF8":[function(require,module,exports) {
exports.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"};
},{}],"oaSi":[function(require,module,exports) {
var e=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,t=new RegExp("[\\-\\.0-9"+e.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),r=new RegExp("^"+e.source+t.source+"*(?::"+e.source+t.source+"*)?$"),a=0,n=1,s=2,i=3,c=4,u=5,o=6,l=7;function f(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,f)}function m(){}function h(e,t,r,a,n){function s(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function i(t){if(t>E){var r=e.substring(E,t).replace(/&#?\w+;/g,s);m&&c(E),a.characters(r,0,t-E),E=t}}function c(t,r){for(;t>=o&&(r=l.exec(e));)u=r.index,o=u+r[0].length,m.lineNumber++;m.columnNumber=t-u+1}for(var u=0,o=0,l=/.*(?:\r\n?|\n)|.*$/g,m=a.locator,h=[{currentNSMap:t}],x={},E=0;;){try{var k=e.indexOf("<",E);if(k<0){if(!e.substr(E).match(/^\s*$/)){var D=a.doc,C=D.createTextNode(e.substr(E));D.appendChild(C),a.currentElement=C}return}switch(k>E&&i(k),e.charAt(k+1)){case"/":var A=e.indexOf(">",k+3),T=e.substring(k+2,A),M=h.pop();A<0?(T=e.substring(k+2).replace(/[\s<].*/,""),n.error("end tag name: "+T+" is not complete:"+M.tagName),A=k+1+T.length):T.match(/\s</)&&(T=T.replace(/[\s<].*/,""),n.error("end tag name: "+T+" maybe not complete"),A=k+1+T.length);var O=M.localNSMap,S=M.tagName==T;if(S||M.tagName&&M.tagName.toLowerCase()==T.toLowerCase()){if(a.endElement(M.uri,M.localName,T),O)for(var $ in O)a.endPrefixMapping($);S||n.fatalError("end tag name: "+T+" is not match the current start tagName:"+M.tagName)}else h.push(M);A++;break;case"?":m&&c(k),A=N(e,k,a);break;case"!":m&&c(k),A=v(e,k,a,n);break;default:m&&c(k);var y=new F,q=h[h.length-1].currentNSMap,I=(A=g(e,k,y,q,s,n),y.length);if(!y.closed&&b(e,A,y.tagName,x)&&(y.closed=!0,r.nbsp||n.warning("unclosed xml attribute")),m&&I){for(var L=d(m,{}),P=0;P<I;P++){var R=y[P];c(R.offset),R.locator=d(m,{})}a.locator=L,p(y,a,q)&&h.push(y),a.locator=m}else p(y,a,q)&&h.push(y);"http://www.w3.org/1999/xhtml"!==y.uri||y.closed?A++:A=w(e,A,y.tagName,s,a)}}catch(V){if(V instanceof f)throw V;n.error("element parse error: "+V),A=-1}A>E?E=A:i(Math.max(k,E)+1)}}function d(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function g(e,t,r,f,m,h){function d(e,t,a){e in r.attributeNames&&h.fatalError("Attribute "+e+" redefined"),r.addValue(e,t,a)}for(var g,p=++t,w=a;;){var b=e.charAt(p);switch(b){case"=":if(w===n)g=e.slice(t,p),w=i;else{if(w!==s)throw new Error("attribute equal must after attrName");w=i}break;case"'":case'"':if(w===i||w===n){if(w===n&&(h.warning('attribute value must after "="'),g=e.slice(t,p)),t=p+1,!((p=e.indexOf(b,t))>0))throw new Error("attribute value no end '"+b+"' match");d(g,x=e.slice(t,p).replace(/&#?\w+;/g,m),t-1),w=u}else{if(w!=c)throw new Error('attribute value must after "="');d(g,x=e.slice(t,p).replace(/&#?\w+;/g,m),t),h.warning('attribute "'+g+'" missed start quot('+b+")!!"),t=p+1,w=u}break;case"/":switch(w){case a:r.setTagName(e.slice(t,p));case u:case o:case l:w=l,r.closed=!0;case c:case n:case s:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return h.error("unexpected end of input"),w==a&&r.setTagName(e.slice(t,p)),p;case">":switch(w){case a:r.setTagName(e.slice(t,p));case u:case o:case l:break;case c:case n:"/"===(x=e.slice(t,p)).slice(-1)&&(r.closed=!0,x=x.slice(0,-1));case s:w===s&&(x=g),w==c?(h.warning('attribute "'+x+'" missed quot(")!'),d(g,x.replace(/&#?\w+;/g,m),t)):("http://www.w3.org/1999/xhtml"===f[""]&&x.match(/^(?:disabled|checked|selected)$/i)||h.warning('attribute "'+x+'" missed value!! "'+x+'" instead!!'),d(x,x,t));break;case i:throw new Error("attribute value missed!!")}return p;case"":b=" ";default:if(b<=" ")switch(w){case a:r.setTagName(e.slice(t,p)),w=o;break;case n:g=e.slice(t,p),w=s;break;case c:var x=e.slice(t,p).replace(/&#?\w+;/g,m);h.warning('attribute "'+x+'" missed quot(")!!'),d(g,x,t);case u:w=o}else switch(w){case s:r.tagName;"http://www.w3.org/1999/xhtml"===f[""]&&g.match(/^(?:disabled|checked|selected)$/i)||h.warning('attribute "'+g+'" missed value!! "'+g+'" instead2!!'),d(g,g,t),t=p,w=n;break;case u:h.warning('attribute space is required"'+g+'"!!');case o:w=n,t=p;break;case i:w=c,t=p;break;case l:throw new Error("elements closed character '/' and '>' must be connected to")}}p++}}function p(e,t,r){for(var a=e.tagName,n=null,s=e.length;s--;){var i=e[s],c=i.qName,u=i.value;if((m=c.indexOf(":"))>0)var o=i.prefix=c.slice(0,m),l=c.slice(m+1),f="xmlns"===o&&l;else l=c,o=null,f="xmlns"===c&&"";i.localName=l,!1!==f&&(null==n&&(n={},x(r,r={})),r[f]=n[f]=u,i.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(f,u))}for(s=e.length;s--;){(o=(i=e[s]).prefix)&&("xml"===o&&(i.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==o&&(i.uri=r[o||""]))}var m;(m=a.indexOf(":"))>0?(o=e.prefix=a.slice(0,m),l=e.localName=a.slice(m+1)):(o=null,l=e.localName=a);var h=e.uri=r[o||""];if(t.startElement(h,l,a,e),!e.closed)return e.currentNSMap=r,e.localNSMap=n,!0;if(t.endElement(h,l,a),n)for(o in n)t.endPrefixMapping(o)}function w(e,t,r,a,n){if(/^(?:script|textarea)$/i.test(r)){var s=e.indexOf("</"+r+">",t),i=e.substring(t+1,s);if(/[&<]/.test(i))return/^script$/i.test(r)?(n.characters(i,0,i.length),s):(i=i.replace(/&#?\w+;/g,a),n.characters(i,0,i.length),s)}return t+1}function b(e,t,r,a){var n=a[r];return null==n&&((n=e.lastIndexOf("</"+r+">"))<t&&(n=e.lastIndexOf("</"+r)),a[r]=n),n<t}function x(e,t){for(var r in e)t[r]=e[r]}function v(e,t,r,a){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(n=e.indexOf("--\x3e",t+4))>t?(r.comment(e,t+4,n-t-4),n+3):(a.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var n=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,n-t-9),r.endCDATA(),n+3}var s=E(e,t),i=s.length;if(i>1&&/!doctype/i.test(s[0][0])){var c=s[1][0],u=!1,o=!1;i>3&&(/^public$/i.test(s[2][0])?(u=s[3][0],o=i>4&&s[4][0]):/^system$/i.test(s[2][0])&&(o=s[3][0]));var l=s[i-1];return r.startDTD(c,u,o),r.endDTD(),l.index+l[0].length}}return-1}function N(e,t,r){var a=e.indexOf("?>",t);if(a){var n=e.substring(t,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){n[0].length;return r.processingInstruction(n[1],n[2]),a+2}return-1}return-1}function F(){this.attributeNames={}}function E(e,t){var r,a=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=t,n.exec(e);r=n.exec(e);)if(a.push(r),r[1])return a}f.prototype=new Error,f.prototype.name=f.name,m.prototype={parse:function(e,t,r){var a=this.domBuilder;a.startDocument(),x(t,t={}),h(e,t,r,a,this.errorHandler),a.endDocument()}},F.prototype={setTagName:function(e){if(!r.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,a){if(!r.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:a}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},exports.XMLReader=m,exports.ParseError=f;
},{}],"yQMc":[function(require,module,exports) {
function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var n in e)t[n]=e[n]}function n(e,n){var r=e.prototype;if(!(r instanceof n)){var i=function(){};i.prototype=n.prototype,t(r,i=new i),e.prototype=r=i}r.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),r.constructor=e)}var r="http://www.w3.org/1999/xhtml",i={},o=i.ELEMENT_NODE=1,a=i.ATTRIBUTE_NODE=2,u=i.TEXT_NODE=3,s=i.CDATA_SECTION_NODE=4,l=i.ENTITY_REFERENCE_NODE=5,c=i.ENTITY_NODE=6,p=i.PROCESSING_INSTRUCTION_NODE=7,h=i.COMMENT_NODE=8,f=i.DOCUMENT_NODE=9,d=i.DOCUMENT_TYPE_NODE=10,m=i.DOCUMENT_FRAGMENT_NODE=11,N=i.NOTATION_NODE=12,g={},v={},w=g.INDEX_SIZE_ERR=(v[1]="Index size error",1),E=g.DOMSTRING_SIZE_ERR=(v[2]="DOMString size error",2),y=g.HIERARCHY_REQUEST_ERR=(v[3]="Hierarchy request error",3),b=g.WRONG_DOCUMENT_ERR=(v[4]="Wrong document",4),T=g.INVALID_CHARACTER_ERR=(v[5]="Invalid character",5),S=g.NO_DATA_ALLOWED_ERR=(v[6]="No data allowed",6),D=g.NO_MODIFICATION_ALLOWED_ERR=(v[7]="No modification allowed",7),_=g.NOT_FOUND_ERR=(v[8]="Not found",8),C=g.NOT_SUPPORTED_ERR=(v[9]="Not supported",9),I=g.INUSE_ATTRIBUTE_ERR=(v[10]="Attribute in use",10),x=g.INVALID_STATE_ERR=(v[11]="Invalid state",11),A=g.SYNTAX_ERR=(v[12]="Syntax error",12),R=g.INVALID_MODIFICATION_ERR=(v[13]="Invalid modification",13),O=g.NAMESPACE_ERR=(v[14]="Invalid namespace",14),U=g.INVALID_ACCESS_ERR=(v[15]="Invalid access",15);function M(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,v[e]),this.message=v[e],Error.captureStackTrace&&Error.captureStackTrace(this,M);return n.code=e,t&&(this.message=this.message+": "+t),n}function B(){}function P(e,t){this._node=e,this._refresh=t,L(this)}function L(e){var n=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=n){var r=e._refresh(e._node);ge(e,"length",r.length),t(r,e),e._inc=n}}function V(){}function k(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function F(e,t,n,r){if(r?t[k(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(r&&W(i,e,r),H(i,e,n))}}function j(e,t,n){var r=k(t,n);if(!(r>=0))throw M(_,new Error(e.tagName+"@"+n));for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var o=e.ownerDocument;o&&(W(o,e,n),n.ownerElement=null)}}function Y(e){if(this._features={},e)for(var t in e)this._features=e[t]}function $(){}function z(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function X(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(X(e,t))return!0}while(e=e.nextSibling)}function G(){}function H(e,t,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function W(e,t,n,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function q(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var i=t.firstChild,o=0;i;)r[o++]=i,i=i.nextSibling;r.length=o}}}function Z(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,q(e.ownerDocument,e),t}function Q(e,t,n){var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===m){var i=t.firstChild;if(null==i)return t;var o=t.lastChild}else i=o=t;var a=n?n.previousSibling:e.lastChild;i.previousSibling=a,o.nextSibling=n,a?a.nextSibling=i:e.firstChild=i,null==n?e.lastChild=o:n.previousSibling=o;do{i.parentNode=e}while(i!==o&&(i=i.nextSibling));return q(e.ownerDocument||e,e),t.nodeType==m&&(t.firstChild=t.lastChild=null),t}function J(e,t){var n=t.parentNode;if(n){var r=e.lastChild;n.removeChild(t);r=e.lastChild}r=e.lastChild;return t.parentNode=e,t.previousSibling=r,t.nextSibling=null,r?r.nextSibling=t:e.firstChild=t,e.lastChild=t,q(e.ownerDocument,e,t),t}function K(){this._nsMap={}}function ee(){}function te(){}function ne(){}function re(){}function ie(){}function oe(){}function ae(){}function ue(){}function se(){}function le(){}function ce(){}function pe(){}function he(e,t){var n=[],r=9==this.nodeType&&this.documentElement||this,i=r.prefix,o=r.namespaceURI;if(o&&null==i&&null==(i=r.lookupPrefix(o)))var a=[{namespace:o,prefix:null}];return de(this,n,e,t,a),n.join("")}function fe(e,t,n){var r=e.prefix||"",i=e.namespaceURI;if(!r&&!i)return!1;if("xml"===r&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var o=n.length;o--;){var a=n[o];if(a.prefix==r)return a.namespace!=i}return!0}function de(e,t,n,i,c){if(i){if(!(e=i(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case o:c||(c=[]);c.length;var N=e.attributes,g=N.length,v=e.firstChild,w=e.tagName;n=r===e.namespaceURI||n,t.push("<",w);for(var E=0;E<g;E++){"xmlns"==(y=N.item(E)).prefix?c.push({prefix:y.localName,namespace:y.value}):"xmlns"==y.nodeName&&c.push({prefix:"",namespace:y.value})}for(E=0;E<g;E++){var y;if(fe(y=N.item(E),n,c)){var b=y.prefix||"",T=y.namespaceURI,S=b?" xmlns:"+b:" xmlns";t.push(S,'="',T,'"'),c.push({prefix:b,namespace:T})}de(y,t,n,i,c)}if(fe(e,n,c)){b=e.prefix||"",T=e.namespaceURI,S=b?" xmlns:"+b:" xmlns";t.push(S,'="',T,'"'),c.push({prefix:b,namespace:T})}if(v||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(w)){if(t.push(">"),n&&/^script$/i.test(w))for(;v;)v.data?t.push(v.data):de(v,t,n,i,c),v=v.nextSibling;else for(;v;)de(v,t,n,i,c),v=v.nextSibling;t.push("</",w,">")}else t.push("/>");return;case f:case m:for(v=e.firstChild;v;)de(v,t,n,i,c),v=v.nextSibling;return;case a:return t.push(" ",e.name,'="',e.value.replace(/[&"]/g,z),'"');case u:return t.push(e.data.replace(/[<&]/g,z).replace(/]]>/g,"]]&gt;"));case s:return t.push("<![CDATA[",e.data,"]]>");case h:return t.push("\x3c!--",e.data,"--\x3e");case d:var D=e.publicId,_=e.systemId;if(t.push("<!DOCTYPE ",e.name),D)t.push(" PUBLIC ",D),_&&"."!=_&&t.push(" ",_),t.push(">");else if(_&&"."!=_)t.push(" SYSTEM ",_,">");else{var C=e.internalSubset;C&&t.push(" [",C,"]"),t.push(">")}return;case p:return t.push("<?",e.target," ",e.data,"?>");case l:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function me(e,t,n){var r;switch(t.nodeType){case o:(r=t.cloneNode(!1)).ownerDocument=e;case m:break;case a:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var i=t.firstChild;i;)r.appendChild(me(e,i,n)),i=i.nextSibling;return r}function Ne(t,n,r){var i=new n.constructor;for(var u in n){var s=n[u];"object"!=e(s)&&s!=i[u]&&(i[u]=s)}switch(n.childNodes&&(i.childNodes=new B),i.ownerDocument=t,i.nodeType){case o:var l=n.attributes,c=i.attributes=new V,p=l.length;c._ownerElement=i;for(var h=0;h<p;h++)i.setAttributeNode(Ne(t,l.item(h),!0));break;case a:r=!0}if(r)for(var f=n.firstChild;f;)i.appendChild(Ne(t,f,r)),f=f.nextSibling;return i}function ge(e,t,n){e[t]=n}M.prototype=Error.prototype,t(g,M),B.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)de(this[r],n,e,t);return n.join("")}},P.prototype.item=function(e){return L(this),this[e]},n(P,B),V.prototype={length:0,item:B.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new M(I);var n=this.getNamedItem(e.nodeName);return F(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new M(I);return t=this.getNamedItemNS(e.namespaceURI,e.localName),F(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return j(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return j(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},Y.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var r=new G;if(r.implementation=this,r.childNodes=new B,r.doctype=n,n&&r.appendChild(n),t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},createDocumentType:function(e,t,n){var r=new oe;return r.name=e,r.nodeName=e,r.publicId=t,r.systemId=n,r}},$.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return Q(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return Z(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return Ne(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==u&&e.nodeType==u?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(n[r]==e)return r;t=t.nodeType==a?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==a?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},t(i,$),t(i,$.prototype),G.prototype={nodeName:"#document",nodeType:f,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==m){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return null==this.documentElement&&e.nodeType==o&&(this.documentElement=e),Q(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),Z(this,e)},importNode:function(e,t){return me(this,e,t)},getElementById:function(e){var t=null;return X(this.documentElement,function(n){if(n.nodeType==o&&n.getAttribute("id")==e)return t=n,!0}),t},getElementsByClassName:function(e){var t=new RegExp("(^|\\s)"+e+"(\\s|$)");return new P(this,function(e){var n=[];return X(e.documentElement,function(r){r!==e&&r.nodeType==o&&t.test(r.getAttribute("class"))&&n.push(r)}),n})},createElement:function(e){var t=new K;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new B,(t.attributes=new V)._ownerElement=t,t},createDocumentFragment:function(){var e=new le;return e.ownerDocument=this,e.childNodes=new B,e},createTextNode:function(e){var t=new ne;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new re;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new ie;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new ce;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new ee;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new se;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new K,r=t.split(":"),i=n.attributes=new V;return n.childNodes=new B,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new ee,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},n(G,$),K.prototype={nodeType:o,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===m?this.insertBefore(e,null):J(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new P(this,function(t){var n=[];return X(t,function(r){r===t||r.nodeType!=o||"*"!==e&&r.tagName!=e||n.push(r)}),n})},getElementsByTagNameNS:function(e,t){return new P(this,function(n){var r=[];return X(n,function(i){i===n||i.nodeType!==o||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||r.push(i)}),r})}},G.prototype.getElementsByTagName=K.prototype.getElementsByTagName,G.prototype.getElementsByTagNameNS=K.prototype.getElementsByTagNameNS,n(K,$),ee.prototype.nodeType=a,n(ee,$),te.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(v[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},n(te,$),ne.prototype={nodeName:"#text",nodeType:u,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},n(ne,te),re.prototype={nodeName:"#comment",nodeType:h},n(re,te),ie.prototype={nodeName:"#cdata-section",nodeType:s},n(ie,te),oe.prototype.nodeType=d,n(oe,$),ae.prototype.nodeType=N,n(ae,$),ue.prototype.nodeType=c,n(ue,$),se.prototype.nodeType=l,n(se,$),le.prototype.nodeName="#document-fragment",le.prototype.nodeType=m,n(le,$),ce.prototype.nodeType=p,n(ce,$),pe.prototype.serializeToString=function(e,t,n){return he.call(e,t,n)},$.prototype.toString=he;try{if(Object.defineProperty){var ve=function e(t){switch(t.nodeType){case o:case m:var n=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}};Object.defineProperty(P.prototype,"length",{get:function(){return L(this),this.$$length}}),Object.defineProperty($.prototype,"textContent",{get:function(){return ve(this)},set:function(e){switch(this.nodeType){case o:case m:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ge=function(e,t,n){e["$$"+t]=n}}}catch(we){}exports.Node=$,exports.DOMException=M,exports.DOMImplementation=Y,exports.XMLSerializer=pe;
},{}],"XFyj":[function(require,module,exports) {
function t(t){this.options=t||{locator:{}}}function e(t,e,r){if(!t){if(e instanceof n)return e;t=e}var i={},c=t instanceof Function;function a(e){var n=t[e];!n&&c&&(n=2==t.length?function(n){t(e,n)}:t),i[e]=n&&function(t){n("[xmldom "+e+"]\t"+t+o(r))}||function(){}}return r=r||{},a("warning"),a("error"),a("fatalError"),i}function n(){this.cdata=!1}function r(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function o(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function i(t,e,n){return"string"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+"":t}function c(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}t.prototype.parseFromString=function(t,r){var o=this.options,i=new s,c=o.domBuilder||new n,l=o.errorHandler,u=o.locator,m=o.xmlns||{},h=/\/x?html?$/.test(r),d=h?a.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return u&&c.setDocumentLocator(u),i.errorHandler=e(l,c,u),i.domBuilder=o.domBuilder||c,h&&(m[""]="http://www.w3.org/1999/xhtml"),m.xml=m.xml||"http://www.w3.org/XML/1998/namespace",t&&"string"==typeof t?i.parse(t,m,d):i.errorHandler.error("invalid doc source"),c.doc},n.prototype={startDocument:function(){this.doc=(new m).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,n,o){var i=this.doc,a=i.createElementNS(t,n||e),l=o.length;c(this,a),this.currentElement=a,this.locator&&r(this.locator,a);for(var s=0;s<l;s++){t=o.getURI(s);var u=o.getValue(s),m=(n=o.getQName(s),i.createAttributeNS(t,n));this.locator&&r(o.getLocator(s),m),m.value=m.nodeValue=u,a.setAttributeNode(m)}},endElement:function(t,e,n){var r=this.currentElement;r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var n=this.doc.createProcessingInstruction(t,e);this.locator&&r(this.locator,n),c(this,n)},ignorableWhitespace:function(t,e,n){},characters:function(t,e,n){if(t=i.apply(this,arguments)){if(this.cdata)var o=this.doc.createCDATASection(t);else o=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(o):/^\s*$/.test(t)&&this.doc.appendChild(o),this.locator&&r(this.locator,o)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=i.apply(this,arguments);var o=this.doc.createComment(t);this.locator&&r(this.locator,o),c(this,o)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var o=this.doc.implementation;if(o&&o.createDocumentType){var i=o.createDocumentType(t,e,n);this.locator&&r(this.locator,i),c(this,i)}},warning:function(t){console.warn("[xmldom warning]\t"+t,o(this.locator))},error:function(t){console.error("[xmldom error]\t"+t,o(this.locator))},fatalError:function(t){throw new u(t,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){n.prototype[t]=function(){return null}});var a=require("./entities"),l=require("./sax"),s=l.XMLReader,u=l.ParseError,m=exports.DOMImplementation=require("./dom").DOMImplementation;exports.XMLSerializer=require("./dom").XMLSerializer,exports.DOMParser=t,exports.__DOMHandler=n;
},{"./entities":"vsF8","./sax":"oaSi","./dom":"yQMc"}],"uf1v":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.toPlaylists=exports.toM3u8=exports.stringToMpdXml=exports.parseUTCTiming=exports.parse=exports.inheritAttributes=exports.generateSidxKey=exports.addSidxSegmentsToPlaylist=exports.VERSION=void 0;var e=i(require("@videojs/vhs-utils/es/resolve-url")),t=i(require("global/window")),r=i(require("@videojs/vhs-utils/es/decode-b64-to-uint8-array")),n=require("xmldom");function i(e){return e&&e.__esModule?e:{default:e}}var a="0.17.0",u=function(e){return!!e&&"object"==typeof e},o=function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.reduce(function(t,r){return"object"!=typeof r?t:(Object.keys(r).forEach(function(n){Array.isArray(t[n])&&Array.isArray(r[n])?t[n]=t[n].concat(r[n]):u(t[n])&&u(r[n])?t[n]=e(t[n],r[n]):t[n]=r[n]}),t)},{})},s=function(e){return Object.keys(e).map(function(t){return e[t]})},c=function(e,t){for(var r=[],n=e;n<t;n++)r.push(n);return r},d=function(e){return e.reduce(function(e,t){return e.concat(t)},[])},l=function(e){if(!e.length)return[];for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t},m=function(e,t){return e.reduce(function(e,r,n){return r[t]&&e.push(n),e},[])},f={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"},p=function(t){var r=t.baseUrl,n=void 0===r?"":r,i=t.source,a=void 0===i?"":i,u=t.range,o=void 0===u?"":u,s=t.indexRange,c=void 0===s?"":s,d={uri:a,resolvedUri:(0,e.default)(n||"",a)};if(o||c){var l=(o||c).split("-"),m=parseInt(l[0],10),f=parseInt(l[1],10);d.byterange={length:f-m+1,offset:m}}return d},v=function(e){var t=e.offset+e.length-1;return e.offset+"-"+t},g=function(e){return e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e},h={static:function(e){var t=e.duration,r=e.timescale,n=void 0===r?1:r,i=e.sourceDuration,a=g(e.endNumber);return{start:0,end:"number"==typeof a?a:Math.ceil(i/(t/n))}},dynamic:function(e){var t=e.NOW,r=e.clientOffset,n=e.availabilityStartTime,i=e.timescale,a=void 0===i?1:i,u=e.duration,o=e.start,s=void 0===o?0:o,c=e.minimumUpdatePeriod,d=void 0===c?0:c,l=e.timeShiftBufferDepth,m=void 0===l?1/0:l,f=g(e.endNumber),p=(t+r)/1e3,v=n+s,h=p+d-v,b=Math.ceil(h*a/u),I=Math.floor((p-v-m)*a/u),D=Math.floor((p-v)*a/u);return{start:Math.max(0,I),end:"number"==typeof f?f:Math.min(b,D)}}},b=function(e){return function(t,r){var n=e.duration,i=e.timescale,a=void 0===i?1:i,u=e.periodIndex,o=e.startNumber;return{number:(void 0===o?1:o)+t,duration:n/a,timeline:u,time:r*n}}},I=function(e){var t=e.type,r=void 0===t?"static":t,n=e.duration,i=e.timescale,a=void 0===i?1:i,u=e.sourceDuration,o=h[r](e),s=o.start,d=o.end,l=c(s,d).map(b(e));if("static"===r){var m=l.length-1;l[m].duration=u-n/a*m}return l},D=function(e){var t=e.baseUrl,r=e.initialization,n=void 0===r?{}:r,i=e.sourceDuration,a=e.indexRange,u=void 0===a?"":a,o=e.duration;if(!t)throw new Error(f.NO_BASE_URL);var s=p({baseUrl:t,source:n.sourceURL,range:n.range}),c=p({baseUrl:t,source:t,indexRange:u});if(c.map=s,o){var d=I(e);d.length&&(c.duration=d[0].duration,c.timeline=d[0].timeline)}else i&&(c.duration=i,c.timeline=0);return c.number=0,[c]},E=function(e,t,r){for(var n=e.sidx.map?e.sidx.map:null,i=e.sidx.duration,a=e.timeline||0,u=e.sidx.byterange,o=u.offset+u.length,s=t.timescale,c=t.references.filter(function(e){return 1!==e.referenceType}),d=[],l=o+t.firstOffset,m=0;m<c.length;m++){var f=t.references[m],p=f.referencedSize,v=f.subsegmentDuration,g=D({baseUrl:r,timescale:s,timeline:a,periodIndex:a,duration:v,sourceDuration:i,indexRange:l+"-"+(l+p-1)})[0];n&&(g.map=n),d.push(g),l+=p}return e.segments=d,e};exports.addSidxSegmentsToPlaylist=E;var y=function(e){return e&&e.uri+"-"+v(e.byterange)};exports.generateSidxKey=y;var S=function(e){return s(e.reduce(function(e,t){var r,n=t.attributes.id+(t.attributes.lang||"");e[n]?(t.segments[0]&&(t.segments[0].discontinuity=!0),(r=e[n].segments).push.apply(r,t.segments),t.attributes.contentProtection&&(e[n].attributes.contentProtection=t.attributes.contentProtection)):e[n]=t;return e},{})).map(function(e){return e.discontinuityStarts=m(e.segments,"discontinuity"),e})},T=function(e,t){var r=y(e.sidx),n=r&&t[r]&&t[r].sidx;return n&&E(e,n,e.sidx.resolvedUri),e},U=function(e,t){if(void 0===t&&(t={}),!Object.keys(t).length)return e;for(var r in e)e[r]=T(e[r],t);return e},N=function(e,t){var r,n=e.attributes,i=e.segments,a=e.sidx,u={attributes:(r={NAME:n.id,BANDWIDTH:n.bandwidth,CODECS:n.codecs},r["PROGRAM-ID"]=1,r),uri:"",endList:"static"===(n.type||"static"),timeline:n.periodIndex,resolvedUri:"",targetDuration:n.duration,segments:i,mediaSequence:i.length?i[0].number:1};return n.contentProtection&&(u.contentProtection=n.contentProtection),a&&(u.sidx=a),t&&(u.attributes.AUDIO="audio",u.attributes.SUBTITLES="subs"),u},O=function(e){var t,r=e.attributes,n=e.segments;void 0===n&&(n=[{uri:r.baseUrl,timeline:r.periodIndex,resolvedUri:r.baseUrl||"",duration:r.sourceDuration,number:0}],r.duration=r.sourceDuration);var i=((t={NAME:r.id,BANDWIDTH:r.bandwidth})["PROGRAM-ID"]=1,t);return r.codecs&&(i.CODECS=r.codecs),{attributes:i,uri:"",endList:"static"===(r.type||"static"),timeline:r.periodIndex,resolvedUri:r.baseUrl||"",targetDuration:r.duration,segments:n,mediaSequence:n.length?n[0].number:1}},x=function(e,t,r){var n;void 0===t&&(t={}),void 0===r&&(r=!1);var i=e.reduce(function(e,i){var a=i.attributes.role&&i.attributes.role.value||"",u=i.attributes.lang||"",o=i.attributes.label||"main";if(u&&!i.attributes.label){var s=a?" ("+a+")":"";o=""+i.attributes.lang+s}e[o]||(e[o]={language:u,autoselect:!0,default:"main"===a,playlists:[],uri:""});var c=T(N(i,r),t);return e[o].playlists.push(c),void 0===n&&"main"===a&&((n=i).default=!0),e},{});n||(i[Object.keys(i)[0]].default=!0);return i},M=function(e,t){return void 0===t&&(t={}),e.reduce(function(e,r){var n=r.attributes.lang||"text";return e[n]||(e[n]={language:n,default:!1,autoselect:!1,playlists:[],uri:""}),e[n].playlists.push(T(O(r),t)),e},{})},R=function(e){return e.reduce(function(e,t){return t?(t.forEach(function(t){var r=t.channel,n=t.language;e[n]={autoselect:!1,default:!1,instreamId:r,language:n},t.hasOwnProperty("aspectRatio")&&(e[n].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[n].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[n]["3D"]=t["3D"])}),e):e},{})},P=function(e){var t,r=e.attributes,n=e.segments,i=e.sidx,a={attributes:(t={NAME:r.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:r.width,height:r.height},CODECS:r.codecs,BANDWIDTH:r.bandwidth},t["PROGRAM-ID"]=1,t),uri:"",endList:"static"===(r.type||"static"),timeline:r.periodIndex,resolvedUri:"",targetDuration:r.duration,segments:n,mediaSequence:n.length?n[0].number:1};return r.contentProtection&&(a.contentProtection=r.contentProtection),i&&(a.sidx=i),a},_=function(e){var t=e.attributes;return"video/mp4"===t.mimeType||"video/webm"===t.mimeType||"video"===t.contentType},A=function(e){var t=e.attributes;return"audio/mp4"===t.mimeType||"audio/webm"===t.mimeType||"audio"===t.contentType},L=function(e){var t=e.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType},w=function(e,t,r){var n;if(void 0===r&&(r={}),!e.length)return{};var i=e[0].attributes,a=i.sourceDuration,u=i.type,o=void 0===u?"static":u,s=i.suggestedPresentationDelay,c=i.minimumUpdatePeriod,d=S(e.filter(_)).map(P),l=S(e.filter(A)),m=e.filter(L),f=e.map(function(e){return e.attributes.captionServices}).filter(Boolean),p={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(n={AUDIO:{},VIDEO:{}},n["CLOSED-CAPTIONS"]={},n.SUBTITLES={},n),uri:"",duration:a,playlists:U(d,r)};c>=0&&(p.minimumUpdatePeriod=1e3*c),t&&(p.locations=t),"dynamic"===o&&(p.suggestedPresentationDelay=s);var v=0===p.playlists.length;return l.length&&(p.mediaGroups.AUDIO.audio=x(l,r,v)),m.length&&(p.mediaGroups.SUBTITLES.subs=M(m,r)),f.length&&(p.mediaGroups["CLOSED-CAPTIONS"].cc=R(f)),p};exports.toM3u8=w;var C=function(e,t,r){var n=e.NOW,i=e.clientOffset,a=e.availabilityStartTime,u=e.timescale,o=void 0===u?1:u,s=e.start,c=void 0===s?0:s,d=e.minimumUpdatePeriod,l=(n+i)/1e3+(void 0===d?0:d)-(a+c);return Math.ceil((l*o-t)/r)},B=function(e,t){for(var r=e.type,n=void 0===r?"static":r,i=e.minimumUpdatePeriod,a=void 0===i?0:i,u=e.media,o=void 0===u?"":u,s=e.sourceDuration,c=e.timescale,d=void 0===c?1:c,l=e.startNumber,m=void 0===l?1:l,f=e.periodIndex,p=[],v=-1,g=0;g<t.length;g++){var h=t[g],b=h.d,I=h.r||0,D=h.t||0;v<0&&(v=D),D&&D>v&&(v=D);var E=void 0;if(I<0){var y=g+1;E=y===t.length?"dynamic"===n&&a>0&&o.indexOf("$Number$")>0?C(e,v,b):(s*d-v)/b:(t[y].t-v)/b}else E=I+1;for(var S=m+p.length+E,T=m+p.length;T<S;)p.push({number:T,duration:b/d,time:v,timeline:f}),v+=b,T++}return p},F=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,G=function(e){return function(t,r,n,i){if("$$"===t)return"$";if(void 0===e[r])return t;var a=""+e[r];return"RepresentationID"===r?a:(i=n?parseInt(i,10):1,a.length>=i?a:""+new Array(i-a.length+1).join("0")+a)}},H=function(e,t){return e.replace(F,G(t))},j=function(e,t){return e.duration||t?e.duration?I(e):B(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodIndex}]},z=function(t,r){var n={RepresentationID:t.id,Bandwidth:t.bandwidth||0},i=t.initialization,a=void 0===i?{sourceURL:"",range:""}:i,u=p({baseUrl:t.baseUrl,source:H(a.sourceURL,n),range:a.range});return j(t,r).map(function(r){n.Number=r.number,n.Time=r.time;var i=H(t.media||"",n),a={uri:i,timeline:r.timeline,duration:r.duration,resolvedUri:(0,e.default)(t.baseUrl||"",i),map:u,number:r.number};return t.presentationTimeOffset&&(a.presentationTimeOffset=t.presentationTimeOffset),a})},V=function(e,t){var r=e.baseUrl,n=e.initialization,i=void 0===n?{}:n,a=p({baseUrl:r,source:i.sourceURL,range:i.range}),u=p({baseUrl:r,source:t.media,range:t.mediaRange});return u.map=a,u},k=function(e,t){var r=e.duration,n=e.segmentUrls,i=void 0===n?[]:n;if(!r&&!t||r&&t)throw new Error(f.SEGMENT_TIME_UNSPECIFIED);var a,u=i.map(function(t){return V(e,t)});return r&&(a=I(e)),t&&(a=B(e,t)),a.map(function(e,t){if(u[t]){var r=u[t];return r.timeline=e.timeline,r.duration=e.duration,r.number=e.number,r}}).filter(function(e){return e})},$=function(e){var t,r,n=e.attributes,i=e.segmentInfo;i.template?(r=z,t=o(n,i.template),i.template.presentationTimeOffset&&(t.presentationTimeOffset=i.template.presentationTimeOffset/i.template.timescale)):i.base?(r=D,t=o(n,i.base)):i.list&&(r=k,t=o(n,i.list));var a={attributes:n};if(!r)return a;var u=r(t,i.timeline);if(t.duration){var s=t,c=s.duration,d=s.timescale,l=void 0===d?1:d;t.duration=c/l}else u.length?t.duration=u.reduce(function(e,t){return Math.max(e,Math.ceil(t.duration))},0):t.duration=0;return a.attributes=t,a.segments=u,i.base&&t.indexRange&&(a.sidx=u[0],a.segments=[]),a},q=function(e){return e.map($)};exports.toPlaylists=q;var W=function(e,t){return l(e.childNodes).filter(function(e){return e.tagName===t})},X=function(e){return e.textContent.trim()},Y=function(e){var t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;var r=t.slice(1),n=r[0],i=r[1],a=r[2],u=r[3],o=r[4],s=r[5];return 31536e3*parseFloat(n||0)+2592e3*parseFloat(i||0)+86400*parseFloat(a||0)+3600*parseFloat(u||0)+60*parseFloat(o||0)+parseFloat(s||0)},K=function(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),Date.parse(e)},Z={mediaPresentationDuration:function(e){return Y(e)},availabilityStartTime:function(e){return K(e)/1e3},minimumUpdatePeriod:function(e){return Y(e)},suggestedPresentationDelay:function(e){return Y(e)},type:function(e){return e},timeShiftBufferDepth:function(e){return Y(e)},start:function(e){return Y(e)},width:function(e){return parseInt(e,10)},height:function(e){return parseInt(e,10)},bandwidth:function(e){return parseInt(e,10)},startNumber:function(e){return parseInt(e,10)},timescale:function(e){return parseInt(e,10)},presentationTimeOffset:function(e){return parseInt(e,10)},duration:function(e){var t=parseInt(e,10);return isNaN(t)?Y(e):t},d:function(e){return parseInt(e,10)},t:function(e){return parseInt(e,10)},r:function(e){return parseInt(e,10)},DEFAULT:function(e){return e}},J=function(e){return e&&e.attributes?l(e.attributes).reduce(function(e,t){var r=Z[t.name]||Z.DEFAULT;return e[t.name]=r(t.value),e},{}):{}},Q={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},ee=function(t,r){return r.length?d(t.map(function(t){return r.map(function(r){return(0,e.default)(t,X(r))})})):t},te=function(e){var t=W(e,"SegmentTemplate")[0],r=W(e,"SegmentList")[0],n=r&&W(r,"SegmentURL").map(function(e){return o({tag:"SegmentURL"},J(e))}),i=W(e,"SegmentBase")[0],a=r||t,u=a&&W(a,"SegmentTimeline")[0],s=r||i||t,c=s&&W(s,"Initialization")[0],d=t&&J(t);d&&c?d.initialization=c&&J(c):d&&d.initialization&&(d.initialization={sourceURL:d.initialization});var l={template:d,timeline:u&&W(u,"S").map(function(e){return J(e)}),list:r&&o(J(r),{segmentUrls:n,initialization:J(c)}),base:i&&o(J(i),{initialization:J(c)})};return Object.keys(l).forEach(function(e){l[e]||delete l[e]}),l},re=function(e,t,r){return function(n){var i=W(n,"BaseURL"),a=ee(t,i),u=o(e,J(n)),s=te(n);return a.map(function(e){return{segmentInfo:o(r,s),attributes:o(u,{baseUrl:e})}})}},ne=function(e){return e.reduce(function(e,t){var n=J(t),i=Q[n.schemeIdUri];if(i){e[i]={attributes:n};var a=W(t,"cenc:pssh")[0];if(a){var u=X(a),o=u&&(0,r.default)(u);e[i].pssh=o}}return e},{})},ie=function(e){return"urn:scte:dash:cc:cea-608:2015"===e.schemeIdUri?e.value.split(";").map(function(e){var t,r;if(r=e,/^CC\d=/.test(e)){var n=e.split("=");t=n[0],r=n[1]}else/^CC\d$/.test(e)&&(t=e);return{channel:t,language:r}}):"urn:scte:dash:cc:cea-708:2015"===e.schemeIdUri?e.value.split(";").map(function(e){var t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){var r=e.split("="),n=r[0],i=r[1],a=void 0===i?"":i;t.channel=n,t.language=e,a.split(",").forEach(function(e){var r=e.split(":"),n=r[0],i=r[1];"lang"===n?t.language=i:"er"===n?t.easyReader=Number(i):"war"===n?t.aspectRatio=Number(i):"3D"===n&&(t["3D"]=Number(i))})}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t}):void 0},ae=function(e,t,r){return function(n){var i=J(n),a=ee(t,W(n,"BaseURL")),u=W(n,"Role")[0],s={role:J(u)},c=o(e,i,s),l=W(n,"Accessibility")[0],m=ie(J(l));m&&(c=o(c,{captionServices:m}));var f=W(n,"Label")[0];if(f&&f.childNodes.length){var p=f.childNodes[0].nodeValue.trim();c=o(c,{label:p})}var v=ne(W(n,"ContentProtection"));Object.keys(v).length&&(c=o(c,{contentProtection:v}));var g=te(n),h=W(n,"Representation"),b=o(r,g);return d(h.map(re(c,a,b)))}},ue=function(e,r){return function(n,i){var a=ee(r,W(n,"BaseURL")),u=J(n),s=parseInt(u.id,10),c=t.default.isNaN(s)?i:s,l=o(e,{periodIndex:c}),m=W(n,"AdaptationSet"),f=te(n);return d(m.map(ae(l,a,f)))}},oe=function(e,t){void 0===t&&(t={});var r=t,n=r.manifestUri,i=void 0===n?"":n,a=r.NOW,u=void 0===a?Date.now():a,o=r.clientOffset,s=void 0===o?0:o,c=W(e,"Period");if(!c.length)throw new Error(f.INVALID_NUMBER_OF_PERIOD);var l=W(e,"Location"),m=J(e),p=ee([i],W(e,"BaseURL"));return m.sourceDuration=m.mediaPresentationDuration||0,m.NOW=u,m.clientOffset=s,l.length&&(m.locations=l.map(X)),{locations:m.locations,representationInfo:d(c.map(ue(m,p)))}};exports.inheritAttributes=oe;var se=function(e){if(""===e)throw new Error(f.DASH_EMPTY_MANIFEST);var t,r,i=new n.DOMParser;try{r=(t=i.parseFromString(e,"application/xml"))&&"MPD"===t.documentElement.tagName?t.documentElement:null}catch(a){}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(f.DASH_INVALID_XML);return r};exports.stringToMpdXml=se;var ce=function(e){var t=W(e,"UTCTiming")[0];if(!t)return null;var r=J(t);switch(r.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":r.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":r.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":r.method="DIRECT",r.value=Date.parse(r.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(f.UNSUPPORTED_UTC_TIMING_SCHEME)}return r},de=a;exports.VERSION=de;var le=function(e,t){void 0===t&&(t={});var r=oe(se(e),t),n=q(r.representationInfo);return w(n,r.locations,t.sidxMapping)};exports.parse=le;var me=function(e){return ce(se(e))};exports.parseUTCTiming=me;
},{"@videojs/vhs-utils/es/resolve-url":"mSEf","global/window":"J3Xk","@videojs/vhs-utils/es/decode-b64-to-uint8-array":"Nwqs","xmldom":"XFyj"}],"m1a4":[function(require,module,exports) {
var e=Math.pow(2,32),t=function(t){var n=new DataView(t.buffer,t.byteOffset,t.byteLength),r={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:n.getUint32(4),timescale:n.getUint32(8)},i=12;0===r.version?(r.earliestPresentationTime=n.getUint32(i),r.firstOffset=n.getUint32(i+4),i+=8):(r.earliestPresentationTime=n.getUint32(i)*e+n.getUint32(i+4),r.firstOffset=n.getUint32(i+8)*e+n.getUint32(i+12),i+=16),i+=2;var s=n.getUint16(i);for(i+=2;s>0;i+=12,s--)r.references.push({referenceType:(128&t[i])>>>7,referencedSize:2147483647&n.getUint32(i),subsegmentDuration:n.getUint32(i+4),startsWithSap:!!(128&t[i+8]),sapType:(112&t[i+8])>>>4,sapDeltaTime:268435455&n.getUint32(i+8)});return r};module.exports=t;
},{}],"SuA8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.reverseBytes=exports.sliceBytes=exports.bytesMatch=exports.concatTypedArrays=exports.stringToBytes=exports.bytesToString=exports.numberToBytes=exports.bytesToNumber=exports.IS_LITTLE_ENDIAN=exports.IS_BIG_ENDIAN=exports.ENDIANNESS=exports.toBinaryString=exports.toHexString=exports.toUint8=exports.isTypedArray=exports.padStart=exports.countBytes=exports.countBits=void 0;var r=t(require("global/window"));function t(r){return r&&r.__esModule?r:{default:r}}var e=function(r,t){for(var e="";t--;)e+=r;return e},n=function(r){return r.toString(2).length};exports.countBits=n;var o=function(r){return Math.ceil(n(r)/8)};exports.countBytes=o;var i=function(r,t,n){return void 0===n&&(n=" "),(e(n,t)+r.toString()).slice(-t)};exports.padStart=i;var a=function(r){return ArrayBuffer.isView(r)};exports.isTypedArray=a;var s=function(r){return r instanceof Uint8Array?r:(Array.isArray(r)||a(r)||r instanceof ArrayBuffer||(r="number"!=typeof r||"number"==typeof r&&r!=r?0:[r]),new Uint8Array(r&&r.buffer||r,r&&r.byteOffset||0,r&&r.byteLength||0))};exports.toUint8=s;var u=function(r){r=s(r);for(var t="",e=0;e<r.length;e++)t+=i(r[e].toString(16),2,"0");return t};exports.toHexString=u;var y=function(r){r=s(r);for(var t="",e=0;e<r.length;e++)t+=i(r[e].toString(2),8,"0");return t};exports.toBinaryString=y;var p=r.default.BigInt||Number,f=[p("0x1"),p("0x100"),p("0x10000"),p("0x1000000"),p("0x100000000"),p("0x10000000000"),p("0x1000000000000"),p("0x100000000000000"),p("0x10000000000000000")],c=function(){var r=new Uint16Array([65484]),t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);return 255===t[0]?"big":204===t[0]?"little":"unknown"}();exports.ENDIANNESS=c;var v="big"===c;exports.IS_BIG_ENDIAN=v;var l="little"===c;exports.IS_LITTLE_ENDIAN=l;var x=function(r,t){var e=void 0===t?{}:t,n=e.signed,o=void 0!==n&&n,i=e.le,a=void 0!==i&&i;r=s(r);var u=a?"reduce":"reduceRight",y=(r[u]?r[u]:Array.prototype[u]).call(r,function(t,e,n){var o=a?n:Math.abs(n+1-r.length);return t+p(e)*f[o]},p(0));if(o){var c=f[r.length]/p(2)-p(1);(y=p(y))>c&&(y-=c,y-=c,y-=p(2))}return Number(y)};exports.bytesToNumber=x;var g=function(r,t){var e=(void 0===t?{}:t).le,n=void 0!==e&&e;("bigint"!=typeof r&&"number"!=typeof r||"number"==typeof r&&r!=r)&&(r=0),r=p(r);for(var i=o(r),a=new Uint8Array(new ArrayBuffer(i)),s=0;s<i;s++){var u=n?s:Math.abs(s+1-a.length);a[u]=Number(r/f[s]&p(255)),r<0&&(a[u]=Math.abs(~a[u]),a[u]-=0===s?1:2)}return a};exports.numberToBytes=g;var b=function(r){if(!r)return"";r=Array.prototype.slice.call(r);var t=String.fromCharCode.apply(null,s(r));try{return decodeURIComponent(escape(t))}catch(e){}return t};exports.bytesToString=b;var A=function(r,t){if("string"!=typeof r&&r&&"function"==typeof r.toString&&(r=r.toString()),"string"!=typeof r)return new Uint8Array;t||(r=unescape(encodeURIComponent(r)));for(var e=new Uint8Array(r.length),n=0;n<r.length;n++)e[n]=r.charCodeAt(n);return e};exports.stringToBytes=A;var d=function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];if((t=t.filter(function(r){return r&&(r.byteLength||r.length)&&"string"!=typeof r})).length<=1)return s(t[0]);var n=t.reduce(function(r,t,e){return r+(t.byteLength||t.length)},0),o=new Uint8Array(n),i=0;return t.forEach(function(r){r=s(r),o.set(r,i),i+=r.byteLength}),o};exports.concatTypedArrays=d;var h=function(r,t,e){var n=void 0===e?{}:e,o=n.offset,i=void 0===o?0:o,a=n.mask,u=void 0===a?[]:a;r=s(r);var y=(t=s(t)).every?t.every:Array.prototype.every;return t.length&&r.length-i>=t.length&&y.call(t,function(t,e){return t===(u[e]?u[e]&r[i+e]:r[i+e])})};exports.bytesMatch=h;var S=function(r,t,e){return Uint8Array.prototype.slice?Uint8Array.prototype.slice.call(r,t,e):new Uint8Array(Array.prototype.slice.call(r,t,e))};exports.sliceBytes=S;var B=function(r){return r.reverse?r.reverse():Array.prototype.reverse.call(r)};exports.reverseBytes=B;
},{"global/window":"J3Xk"}],"dZcM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getId3Offset=exports.getId3Size=void 0;var e=require("./byte-helpers.js"),t=(0,e.toUint8)([73,68,51]),r=function(t,r){void 0===r&&(r=0);var o=(t=(0,e.toUint8)(t))[r+5],s=t[r+6]<<21|t[r+7]<<14|t[r+8]<<7|t[r+9];return(16&o)>>4?s+20:s+10};exports.getId3Size=r;var o=function o(s,i){return void 0===i&&(i=0),(s=(0,e.toUint8)(s)).length-i<10||!(0,e.bytesMatch)(s,t,{offset:i})?i:o(s,i+=r(s,i))};exports.getId3Offset=o;
},{"./byte-helpers.js":"SuA8"}],"xWLv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getHvcCodec=exports.getAvcCodec=exports.getAv1Codec=void 0;var r=require("./byte-helpers.js"),t=function(t){var e,o="",n=t[1]>>>3,a=31&t[1],i=t[2]>>>7,s=(64&t[2])>>6,v=(32&t[2])>>5,c=(16&t[2])>>4,g=(8&t[2])>>3,p=(4&t[2])>>2,u=3&t[2];return o+=n+"."+(0,r.padStart)(a,2,"0"),0===i?o+="M":1===i&&(o+="H"),e=2===n&&s?v?12:10:s?10:8,o+="."+(0,r.padStart)(e,2,"0"),o+="."+c,o+="."+g+p+u};exports.getAv1Codec=t;var e=function(t){return""+(0,r.toHexString)(t[1])+(0,r.toHexString)(252&t[2])+(0,r.toHexString)(t[3])};exports.getAvcCodec=e;var o=function(t){var e="",o=t[1]>>6,n=31&t[1],a=(32&t[1])>>5,i=t.subarray(2,6),s=t.subarray(6,12),v=t[12];1===o?e+="A":2===o?e+="B":3===o&&(e+="C"),e+=n+".";var c=parseInt((0,r.toBinaryString)(i).split("").reverse().join(""),2);c>255&&(c=parseInt((0,r.toBinaryString)(i),2)),e+=c.toString(16)+".",e+=0===a?"L":"H",e+=v;for(var g="",p=0;p<s.length;p++){var u=s[p];u&&(g&&(g+="."),g+=u.toString(16))}return g&&(e+="."+g),e};exports.getHvcCodec=o;
},{"./byte-helpers.js":"SuA8"}],"C4ST":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setOpusHead=exports.parseOpusHead=exports.OPUS_HEAD=void 0;var e=new Uint8Array([79,112,117,115,72,101,97,100]);exports.OPUS_HEAD=e;var n=function(e){var n=new DataView(e.buffer,e.byteOffset,e.byteLength),t=n.getUint8(0),a=0!==t,i={version:t,channels:n.getUint8(1),preSkip:n.getUint16(2,a),sampleRate:n.getUint32(4,a),outputGain:n.getUint16(8,a),channelMappingFamily:n.getUint8(10)};if(i.channelMappingFamily>0&&e.length>10){i.streamCount=n.getUint8(11),i.twoChannelStreamCount=n.getUint8(12),i.channelMapping=[];for(var r=0;r<i.channels;r++)i.channelMapping.push(n.getUint8(13+r))}return i};exports.parseOpusHead=n;var t=function(e){var n=e.channelMappingFamily<=0?11:12+e.channels,t=new DataView(new ArrayBuffer(n)),a=0!==e.version;return t.setUint8(0,e.version),t.setUint8(1,e.channels),t.setUint16(2,e.preSkip,a),t.setUint32(4,e.sampleRate,a),t.setUint16(8,e.outputGain,a),t.setUint8(10,e.channelMappingFamily),e.channelMappingFamily>0&&(t.setUint8(11,e.streamCount),e.channelMapping.foreach(function(e,n){t.setUint8(12+n,e)})),new Uint8Array(t.buffer)};exports.setOpusHead=t;
},{}],"UHI9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseMediaInfo=exports.parseTracks=exports.addSampleDescription=exports.buildFrameTable=exports.findNamedBox=exports.findBox=exports.parseDescriptors=void 0;var r,e=require("./byte-helpers.js"),t=require("./codec-helpers.js"),a=require("./opus-helpers.js"),s=function(r){return"string"==typeof r?(0,e.stringToBytes)(r):r},i=function(r){return Array.isArray(r)?r.map(function(r){return s(r)}):[s(r)]},n=function(t){t=(0,e.toUint8)(t);for(var a=[],s=0;t.length>s;){var i=t[s],n=0,o=0,u=t[++o];for(o++;128&u;)n=(127&u)<<7,u=t[o],o++;n+=127&u;for(var p=0;p<r.length;p++){var f=r[p],b=f.id,d=f.parser;if(i===b){a.push(d(t.subarray(o,o+n)));break}}s+=n+o}return a};exports.parseDescriptors=n,r=[{id:3,parser:function(r){var t={tag:3,id:r[0]<<8|r[1],flags:r[2],size:3,dependsOnEsId:0,ocrEsId:0,descriptors:[],url:""};if(128&t.flags&&(t.dependsOnEsId=r[t.size]<<8|r[t.size+1],t.size+=2),64&t.flags){var a=r[t.size];t.url=(0,e.bytesToString)(r.subarray(t.size+1,t.size+1+a)),t.size+=a}return 32&t.flags&&(t.ocrEsId=r[t.size]<<8|r[t.size+1],t.size+=2),t.descriptors=n(r.subarray(t.size))||[],t}},{id:4,parser:function(r){return{tag:4,oti:r[0],streamType:r[1],bufferSize:r[2]<<16|r[3]<<8|r[4],maxBitrate:r[5]<<24|r[6]<<16|r[7]<<8|r[8],avgBitrate:r[9]<<24|r[10]<<16|r[11]<<8|r[12],descriptors:n(r.subarray(13))}}},{id:5,parser:function(r){return{tag:5,bytes:r}}},{id:6,parser:function(r){return{tag:6,bytes:r}}}];var o=function r(t,a,s){void 0===s&&(s=!1),a=i(a),t=(0,e.toUint8)(t);var n=[];if(!a.length)return n;for(var o=0;o<t.length;){var u=(t[o]<<24|t[o+1]<<16|t[o+2]<<8|t[o+3])>>>0,p=t.subarray(o+4,o+8);if(0===u)break;var f=o+u;if(f>t.length){if(s)break;f=t.length}var b=t.subarray(o+8,f);(0,e.bytesMatch)(p,a[0])&&(1===a.length?n.push(b):n.push.apply(n,r(b,a.slice(1),s))),o=f}return n};exports.findBox=o;var u=function(r,t){if(!(t=s(t)).length)return r.subarray(r.length);for(var a=0;a<r.length;){if((0,e.bytesMatch)(r.subarray(a,a+t.length),t)){var i=(r[a-4]<<24|r[a-3]<<16|r[a-2]<<8|r[a-1])>>>0,n=i>1?a+i:r.byteLength;return r.subarray(a+4,n)}a++}return r.subarray(r.length)};exports.findNamedBox=u;var p=function(r,t,a){void 0===t&&(t=4),void 0===a&&(a=function(r){return(0,e.bytesToNumber)(r)});var s=[];if(!r||!r.length)return s;for(var i=(0,e.bytesToNumber)(r.subarray(4,8)),n=8;i;n+=t,i--)s.push(a(r.subarray(n,n+t)));return s},f=function(r,t){for(var a=p(o(r,["stss"])[0]),s=p(o(r,["stco"])[0]),i=p(o(r,["stts"])[0],8,function(r){return{sampleCount:(0,e.bytesToNumber)(r.subarray(0,4)),sampleDelta:(0,e.bytesToNumber)(r.subarray(4,8))}}),n=p(o(r,["stsc"])[0],12,function(r){return{firstChunk:(0,e.bytesToNumber)(r.subarray(0,4)),samplesPerChunk:(0,e.bytesToNumber)(r.subarray(4,8)),sampleDescriptionIndex:(0,e.bytesToNumber)(r.subarray(8,12))}}),u=o(r,["stsz"])[0],f=p(u&&u.length&&u.subarray(4)||null),b=[],d=0;d<s.length;d++){for(var l=void 0,v=0;v<n.length;v++){var y=n[v];if(d+1>=y.firstChunk&&(v+1>=n.length||d+1<n[v+1].firstChunk)){l=y.samplesPerChunk;break}}for(var c=s[d],h=0;h<l;h++){var m=f[b.length],g=!a.length;a.length&&-1!==a.indexOf(b.length+1)&&(g=!0);for(var x={keyframe:g,start:c,end:c+m},T=0;T<i.length;T++){var S=i[T],C=S.sampleCount,k=S.sampleDelta;if(b.length<=C){var N=b.length?b[b.length-1].timestamp:0;x.timestamp=N+k/t*1e3,x.duration=k;break}}b.push(x),c+=m}}return b};exports.buildFrameTable=f;var b=function(r,s){var i=(0,e.bytesToString)(s.subarray(0,4));if("video"===r.type?(r.info=r.info||{},r.info.width=s[28]<<8|s[29],r.info.height=s[30]<<8|s[31]):"audio"===r.type&&(r.info=r.info||{},r.info.channels=s[20]<<8|s[21],r.info.bitDepth=s[22]<<8|s[23],r.info.sampleRate=s[28]<<8|s[29]),"avc1"===i){var o=u(s,"avcC");i+="."+(0,t.getAvcCodec)(o),r.info.avcC=o}else if("hvc1"===i||"hev1"===i)i+="."+(0,t.getHvcCodec)(u(s,"hvcC"));else if("mp4a"===i||"mp4v"===i){var p=u(s,"esds"),f=n(p.subarray(4))[0],b=f&&f.descriptors.filter(function(r){return 4===r.tag})[0];b?(i+="."+(0,e.toHexString)(b.oti),64===b.oti?i+="."+(b.descriptors[0].bytes[0]>>3).toString():32===b.oti?i+="."+b.descriptors[0].bytes[4].toString():221===b.oti&&(i="vorbis")):"audio"===r.type?i+=".40.2":i+=".20.9"}else if("av01"===i)i+="."+(0,t.getAv1Codec)(u(s,"av1C"));else if("vp09"===i){var d=u(s,"vpcC"),l=d[0],v=d[1],y=d[2]>>4,c=(15&d[2])>>1,h=(15&d[2])>>3,m=d[3],g=d[4],x=d[5];i+="."+(0,e.padStart)(l,2,"0"),i+="."+(0,e.padStart)(v,2,"0"),i+="."+(0,e.padStart)(y,2,"0"),i+="."+(0,e.padStart)(c,2,"0"),i+="."+(0,e.padStart)(m,2,"0"),i+="."+(0,e.padStart)(g,2,"0"),i+="."+(0,e.padStart)(x,2,"0"),i+="."+(0,e.padStart)(h,2,"0")}else if("theo"===i)i="theora";else if("spex"===i)i="speex";else if(".mp3"===i)i="mp4a.40.34";else if("msVo"===i)i="vorbis";else if("Opus"===i){i="opus";var T=u(s,"dOps");r.info.opus=(0,a.parseOpusHead)(T),r.info.codecDelay=65e5}else i=i.toLowerCase();r.codec=i};exports.addSampleDescription=b;var d=function(r,t){void 0===t&&(t=!0),r=(0,e.toUint8)(r);var a=o(r,["moov","trak"],!0),s=[];return a.forEach(function(r){var a={bytes:r},i=o(r,["mdia"])[0],n=o(i,["hdlr"])[0],u=(0,e.bytesToString)(n.subarray(8,12));a.type="soun"===u?"audio":"vide"===u?"video":u;var p=o(r,["tkhd"])[0];if(p){var d=new DataView(p.buffer,p.byteOffset,p.byteLength),l=d.getUint8(0);a.number=0===l?d.getUint32(12):d.getUint32(20)}var v=o(i,["mdhd"])[0];if(v){var y=0===v[0]?12:20;a.timescale=(v[y]<<24|v[y+1]<<16|v[y+2]<<8|v[y+3])>>>0}for(var c=o(i,["minf","stbl"])[0],h=o(c,["stsd"])[0],m=(0,e.bytesToNumber)(h.subarray(4,8)),g=8;m--;){var x=(0,e.bytesToNumber)(h.subarray(g,g+4)),T=h.subarray(g+4,g+4+x);b(a,T),g+=4+x}t&&(a.frameTable=f(c,a.timescale)),s.push(a)}),s};exports.parseTracks=d;var l=function(r){var t=o(r,["moov","mvhd"],!0)[0];if(t&&t.length){var a={};return 1===t[0]?(a.timestampScale=(0,e.bytesToNumber)(t.subarray(20,24)),a.duration=(0,e.bytesToNumber)(t.subarray(24,32))):(a.timestampScale=(0,e.bytesToNumber)(t.subarray(12,16)),a.duration=(0,e.bytesToNumber)(t.subarray(16,20))),a.bytes=t,a}};exports.parseMediaInfo=l;
},{"./byte-helpers.js":"SuA8","./codec-helpers.js":"xWLv","./opus-helpers.js":"C4ST"}],"Am9f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseData=exports.parseTracks=exports.decodeBlock=exports.findEbml=exports.EBML_TAGS=void 0;var e=require("./byte-helpers"),t=require("./codec-helpers.js"),r={EBML:(0,e.toUint8)([26,69,223,163]),DocType:(0,e.toUint8)([66,130]),Segment:(0,e.toUint8)([24,83,128,103]),SegmentInfo:(0,e.toUint8)([21,73,169,102]),Tracks:(0,e.toUint8)([22,84,174,107]),Track:(0,e.toUint8)([174]),TrackNumber:(0,e.toUint8)([215]),DefaultDuration:(0,e.toUint8)([35,227,131]),TrackEntry:(0,e.toUint8)([174]),TrackType:(0,e.toUint8)([131]),FlagDefault:(0,e.toUint8)([136]),CodecID:(0,e.toUint8)([134]),CodecPrivate:(0,e.toUint8)([99,162]),VideoTrack:(0,e.toUint8)([224]),AudioTrack:(0,e.toUint8)([225]),Cluster:(0,e.toUint8)([31,67,182,117]),Timestamp:(0,e.toUint8)([231]),TimestampScale:(0,e.toUint8)([42,215,177]),BlockGroup:(0,e.toUint8)([160]),BlockDuration:(0,e.toUint8)([155]),Block:(0,e.toUint8)([161]),SimpleBlock:(0,e.toUint8)([163])};exports.EBML_TAGS=r;var a=[128,64,32,16,8,4,2,1],o=function(e){for(var t=1,r=0;r<a.length&&!(e&a[r]);r++)t++;return t},n=function(t,r,n,c){void 0===n&&(n=!0),void 0===c&&(c=!1);var i=o(t[r]),s=t.subarray(r,r+i);return n&&((s=Array.prototype.slice.call(t,r,r+i))[0]^=a[i-1]),{length:i,value:(0,e.bytesToNumber)(s,{signed:c}),bytes:s}},c=function t(r){return"string"==typeof r?r.match(/.{1,2}/g).map(function(e){return t(e)}):"number"==typeof r?(0,e.numberToBytes)(r):r},i=function(e){return Array.isArray(e)?e.map(function(e){return c(e)}):[c(e)]},s=function t(r,a,o){if(o>=a.length)return a.length;var c=n(a,o,!1);if((0,e.bytesMatch)(r.bytes,c.bytes))return o;var i=n(a,o+c.length);return t(r,a,o+i.length+i.value+c.length)},l=function t(r,a){a=i(a),r=(0,e.toUint8)(r);var o=[];if(!a.length)return o;for(var c=0;c<r.length;){var l=n(r,c,!1),u=n(r,c+l.length),p=c+l.length+u.length;127===u.value&&(u.value=s(l,r,p),u.value!==r.length&&(u.value-=p));var f=p+u.value>r.length?r.length:p+u.value,d=r.subarray(p,f);(0,e.bytesMatch)(a[0],l.bytes)&&(1===a.length?o.push(d):o=o.concat(t(d,a.slice(1)))),c+=l.length+u.length+d.length}return o};exports.findEbml=l;var u=function(t,a,o,c){var i;"group"===a&&((i=l(t,[r.BlockDuration])[0])&&(i=1/o*(i=(0,e.bytesToNumber)(i))*o/1e3),t=l(t,[r.Block])[0],a="block");var s=new DataView(t.buffer,t.byteOffset,t.byteLength),u=n(t,0),p=s.getInt16(u.length,!1),f=t[u.length+2],d=t.subarray(u.length+3),v=1/o*(c+p)*o/1e3,g={duration:i,trackNumber:u.value,keyframe:"simple"===a&&f>>7==1,invisible:(8&f)>>3==1,lacing:(6&f)>>1,discardable:"simple"===a&&1==(1&f),frames:[],pts:v,dts:v,timestamp:p};if(!g.lacing)return g.frames.push(d),g;var h=d[0]+1,m=[],b=1;if(2===g.lacing)for(var y=(d.length-b)/h,C=0;C<h;C++)m.push(y);if(1===g.lacing)for(var T=0;T<h-1;T++){var k=0;do{k+=d[b],b++}while(255===d[b-1]);m.push(k)}if(3===g.lacing)for(var A=0,S=0;S<h-1;S++){var U=0===S?n(d,b):n(d,b,!0,!0);A+=U.value,m.push(A),b+=U.length}return m.forEach(function(e){g.frames.push(d.subarray(b,b+e)),b+=e}),g};exports.decodeBlock=u;var p=function(e){for(var t=0,r={};t<e.length;){var a=127&e[t],o=e[t+1],n=void 0;n=1===o?e[t+2]:e.subarray(t+2,t+2+o),1===a?r.profile=n:2===a?r.level=n:3===a?r.bitDepth=n:4===a?r.chromaSubsampling=n:r[a]=n,t+=2+o}return r},f=function(a){a=(0,e.toUint8)(a);var o=[],n=l(a,[r.Segment,r.Tracks,r.Track]);return n.length||(n=l(a,[r.Tracks,r.Track])),n.length||(n=l(a,[r.Track])),n.length?(n.forEach(function(a){var n=l(a,r.TrackType)[0];if(n&&n.length){if(1===n[0])n="video";else if(2===n[0])n="audio";else{if(17!==n[0])return;n="subtitle"}var c={rawCodec:(0,e.bytesToString)(l(a,[r.CodecID])[0]),type:n,codecPrivate:l(a,[r.CodecPrivate])[0],number:(0,e.bytesToNumber)(l(a,[r.TrackNumber])[0]),defaultDuration:(0,e.bytesToNumber)(l(a,[r.DefaultDuration])[0]),default:l(a,[r.FlagDefault])[0],rawData:a},i="";if(/V_MPEG4\/ISO\/AVC/.test(c.rawCodec))i="avc1."+(0,t.getAvcCodec)(c.codecPrivate);else if(/V_MPEGH\/ISO\/HEVC/.test(c.rawCodec))i="hev1."+(0,t.getHvcCodec)(c.codecPrivate);else if(/V_MPEG4\/ISO\/ASP/.test(c.rawCodec))i=c.codecPrivate?"mp4v.20."+c.codecPrivate[4].toString():"mp4v.20.9";else if(/^V_THEORA/.test(c.rawCodec))i="theora";else if(/^V_VP8/.test(c.rawCodec))i="vp8";else if(/^V_VP9/.test(c.rawCodec))if(c.codecPrivate){var s=p(c.codecPrivate),u=s.profile,f=s.level,d=s.bitDepth,v=s.chromaSubsampling;i="vp09.",i+=(0,e.padStart)(u,2,"0")+".",i+=(0,e.padStart)(f,2,"0")+".",i+=(0,e.padStart)(d,2,"0")+".",i+=""+(0,e.padStart)(v,2,"0");var g=l(a,[224,[85,176],[85,177]])[0]||[],h=l(a,[224,[85,176],[85,185]])[0]||[],m=l(a,[224,[85,176],[85,186]])[0]||[],b=l(a,[224,[85,176],[85,187]])[0]||[];(g.length||h.length||m.length||b.length)&&(i+="."+(0,e.padStart)(b[0],2,"0"),i+="."+(0,e.padStart)(m[0],2,"0"),i+="."+(0,e.padStart)(g[0],2,"0"),i+="."+(0,e.padStart)(h[0],2,"0"))}else i="vp9";else/^V_AV1/.test(c.rawCodec)?i="av01."+(0,t.getAv1Codec)(c.codecPrivate):/A_ALAC/.test(c.rawCodec)?i="alac":/A_MPEG\/L2/.test(c.rawCodec)?i="mp2":/A_MPEG\/L3/.test(c.rawCodec)?i="mp3":/^A_AAC/.test(c.rawCodec)?i=c.codecPrivate?"mp4a.40."+(c.codecPrivate[0]>>>3).toString():"mp4a.40.2":/^A_AC3/.test(c.rawCodec)?i="ac-3":/^A_PCM/.test(c.rawCodec)?i="pcm":/^A_MS\/ACM/.test(c.rawCodec)?i="speex":/^A_EAC3/.test(c.rawCodec)?i="ec-3":/^A_VORBIS/.test(c.rawCodec)?i="vorbis":/^A_FLAC/.test(c.rawCodec)?i="flac":/^A_OPUS/.test(c.rawCodec)&&(i="opus");c.codec=i,o.push(c)}}),o.sort(function(e,t){return e.number-t.number})):o};exports.parseTracks=f;var d=function(t,a){var o=[],n=l(t,[r.Segment])[0],c=l(n,[r.SegmentInfo,r.TimestampScale])[0];c=c&&c.length?(0,e.bytesToNumber)(c):1e6;var i=l(n,[r.Cluster]);return a||(a=f(n)),i.forEach(function(t,a){var n=l(t,[r.SimpleBlock]).map(function(e){return{type:"simple",data:e}}),i=l(t,[r.BlockGroup]).map(function(e){return{type:"group",data:e}}),s=l(t,[r.Timestamp])[0]||0;s&&s.length&&(s=(0,e.bytesToNumber)(s)),n.concat(i).sort(function(e,t){return e.data.byteOffset-t.data.byteOffset}).forEach(function(e,t){var r=u(e.data,e.type,c,s);o.push(r)})}),{tracks:a,blocks:o}};exports.parseData=d;
},{"./byte-helpers":"SuA8","./codec-helpers.js":"xWLv"}],"mSd8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findH265Nal=exports.findH264Nal=exports.findNal=exports.discardEmulationPreventionBytes=exports.EMULATION_PREVENTION=exports.NAL_TYPE_TWO=exports.NAL_TYPE_ONE=void 0;var r=require("./byte-helpers.js"),t=(0,r.toUint8)([0,0,0,1]);exports.NAL_TYPE_ONE=t;var e=(0,r.toUint8)([0,0,1]);exports.NAL_TYPE_TWO=e;var n=(0,r.toUint8)([0,0,3]);exports.EMULATION_PREVENTION=n;var a=function(t){for(var e=[],a=1;a<t.length-2;)(0,r.bytesMatch)(t.subarray(a,a+3),n)&&(e.push(a+2),a++),a++;if(0===e.length)return t;var o=t.length-e.length,s=new Uint8Array(o),i=0;for(a=0;a<o;i++,a++)i===e[0]&&(i++,e.shift()),s[a]=t[i];return s};exports.discardEmulationPreventionBytes=a;var o=function(n,o,s,i){void 0===i&&(i=1/0),n=(0,r.toUint8)(n),s=[].concat(s);for(var u,f=0,v=0;f<n.length&&(v<i||u);){var p=void 0;if((0,r.bytesMatch)(n.subarray(f),t)?p=4:(0,r.bytesMatch)(n.subarray(f),e)&&(p=3),p){if(v++,u)return a(n.subarray(u,f));var N=void 0;"h264"===o?N=31&n[f+p]:"h265"===o&&(N=n[f+p]>>1&63),-1!==s.indexOf(N)&&(u=f+p),f+=p+("h264"===o?1:2)}else f++}return n.subarray(0,0)};exports.findNal=o;var s=function(r,t,e){return o(r,"h264",t,e)};exports.findH264Nal=s;var i=function(r,t,e){return o(r,"h265",t,e)};exports.findH265Nal=i;
},{"./byte-helpers.js":"SuA8"}],"sYbi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isLikelyFmp4MediaSegment=exports.detectContainerForBytes=exports.isLikely=void 0;var t=require("./byte-helpers.js"),e=require("./mp4-helpers.js"),n=require("./ebml-helpers.js"),r=require("./id3-helpers.js"),o=require("./nal-helpers.js"),f={webm:(0,t.toUint8)([119,101,98,109]),matroska:(0,t.toUint8)([109,97,116,114,111,115,107,97]),flac:(0,t.toUint8)([102,76,97,67]),ogg:(0,t.toUint8)([79,103,103,83]),ac3:(0,t.toUint8)([11,119]),riff:(0,t.toUint8)([82,73,70,70]),avi:(0,t.toUint8)([65,86,73]),wav:(0,t.toUint8)([87,65,86,69]),"3gp":(0,t.toUint8)([102,116,121,112,51,103]),mp4:(0,t.toUint8)([102,116,121,112]),fmp4:(0,t.toUint8)([115,116,121,112]),mov:(0,t.toUint8)([102,116,121,112,113,116]),moov:(0,t.toUint8)([109,111,111,118]),moof:(0,t.toUint8)([109,111,111,102])},i={aac:function(e){var n=(0,r.getId3Offset)(e);return(0,t.bytesMatch)(e,[255,16],{offset:n,mask:[255,22]})},mp3:function(e){var n=(0,r.getId3Offset)(e);return(0,t.bytesMatch)(e,[255,2],{offset:n,mask:[255,6]})},webm:function(e){var r=(0,n.findEbml)(e,[n.EBML_TAGS.EBML,n.EBML_TAGS.DocType])[0];return(0,t.bytesMatch)(r,f.webm)},mkv:function(e){var r=(0,n.findEbml)(e,[n.EBML_TAGS.EBML,n.EBML_TAGS.DocType])[0];return(0,t.bytesMatch)(r,f.matroska)},mp4:function(e){return!i["3gp"](e)&&!i.mov(e)&&(!(!(0,t.bytesMatch)(e,f.mp4,{offset:4})&&!(0,t.bytesMatch)(e,f.fmp4,{offset:4}))||(!(!(0,t.bytesMatch)(e,f.moof,{offset:4})&&!(0,t.bytesMatch)(e,f.moov,{offset:4}))||void 0))},mov:function(e){return(0,t.bytesMatch)(e,f.mov,{offset:4})},"3gp":function(e){return(0,t.bytesMatch)(e,f["3gp"],{offset:4})},ac3:function(e){var n=(0,r.getId3Offset)(e);return(0,t.bytesMatch)(e,f.ac3,{offset:n})},ts:function(t){if(t.length<189&&t.length>=1)return 71===t[0];for(var e=0;e+188<t.length&&e<188;){if(71===t[e]&&71===t[e+188])return!0;e+=1}return!1},flac:function(e){var n=(0,r.getId3Offset)(e);return(0,t.bytesMatch)(e,f.flac,{offset:n})},ogg:function(e){return(0,t.bytesMatch)(e,f.ogg)},avi:function(e){return(0,t.bytesMatch)(e,f.riff)&&(0,t.bytesMatch)(e,f.avi,{offset:8})},wav:function(e){return(0,t.bytesMatch)(e,f.riff)&&(0,t.bytesMatch)(e,f.wav,{offset:8})},h264:function(t){return(0,o.findH264Nal)(t,7,3).length},h265:function(t){return(0,o.findH265Nal)(t,[32,33],3).length}},s=Object.keys(i).filter(function(t){return"ts"!==t&&"h264"!==t&&"h265"!==t}).concat(["ts","h264","h265"]);s.forEach(function(e){var n=i[e];i[e]=function(e){return n((0,t.toUint8)(e))}});var a=i;exports.isLikely=a;var c=function(e){e=(0,t.toUint8)(e);for(var n=0;n<s.length;n++){var r=s[n];if(a[r](e))return r}return""};exports.detectContainerForBytes=c;var u=function(t){return(0,e.findBox)(t,["moof"]).length>0};exports.isLikelyFmp4MediaSegment=u;
},{"./byte-helpers.js":"SuA8","./mp4-helpers.js":"UHI9","./ebml-helpers.js":"Am9f","./id3-helpers.js":"dZcM","./nal-helpers.js":"mSd8"}],"Piyq":[function(require,module,exports) {
var o,n,e,u,s,t,T,r=9e4;o=function(o){return o*r},n=function(o,n){return o*n},e=function(o){return o/r},u=function(o,n){return o/n},s=function(n,e){return o(u(n,e))},t=function(o,u){return n(e(o),u)},T=function(o,n,u){return e(u?o:o-n)},module.exports={ONE_SECOND_IN_TS:r,secondsToVideoTs:o,secondsToAudioTs:n,videoTsToSeconds:e,audioTsToSeconds:u,audioTsToVideoTs:s,videoTsToAudioTs:t,metadataTsToSeconds:T};
},{}],"U3gU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=b(require("global/window")),t=b(require("global/document")),i=b(require("@babel/runtime/helpers/extends")),n=b(require("@babel/runtime/helpers/assertThisInitialized")),r=b(require("@babel/runtime/helpers/inheritsLoose")),a=b(require("safe-json-parse/tuple")),s=b(require("keycode")),o=b(require("@videojs/xhr")),l=b(require("videojs-vtt.js")),u=b(require("@babel/runtime/helpers/construct")),d=b(require("@babel/runtime/helpers/inherits")),c=b(require("@videojs/vhs-utils/es/resolve-url.js")),h=require("m3u8-parser"),p=require("@videojs/vhs-utils/es/codecs.js"),f=require("@videojs/vhs-utils/es/media-types.js"),m=require("mpd-parser"),g=b(require("mux.js/lib/tools/parse-sidx")),v=require("@videojs/vhs-utils/es/id3-helpers"),_=require("@videojs/vhs-utils/es/containers"),y=require("@videojs/vhs-utils/es/byte-helpers"),T=require("mux.js/lib/utils/clock");function b(e){return e&&e.__esModule?e:{default:e}}for(var S,k="7.14.3",C={prefixed:!0},E=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],w=E[0],I=0;I<E.length;I++)if(E[I][1]in t.default){S=E[I];break}if(S){for(var x=0;x<S.length;x++)C[w[x]]=S[x];C.prefixed=S[0]!==w[0]}var P=[],L=function(t,i){return function(n,r,a){var s=i.levels[r],o=new RegExp("^("+s+")$");if("log"!==n&&a.unshift(n.toUpperCase()+":"),a.unshift(t+":"),P){P.push([].concat(a));var l=P.length-1e3;P.splice(0,l>0?l:0)}if(e.default.console){var u=e.default.console[n];u||"debug"!==n||(u=e.default.console.info||e.default.console.log),u&&s&&o.test(n)&&u[Array.isArray(a)?"apply":"call"](e.default.console,a)}}};function A(e){var t,i="info",n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t("log",i,n)};return t=L(e,n),n.createLogger=function(t){return A(e+": "+t)},n.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:i},n.level=function(e){if("string"==typeof e){if(!n.levels.hasOwnProperty(e))throw new Error('"'+e+'" in not a valid log level');i=e}return i},(n.history=function(){return P?[].concat(P):[]}).filter=function(e){return(P||[]).filter(function(t){return new RegExp(".*"+e+".*").test(t[0])})},n.history.clear=function(){P&&(P.length=0)},n.history.disable=function(){null!==P&&(P.length=0,P=null)},n.history.enable=function(){null===P&&(P=[])},n.error=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t("error",i,n)},n.warn=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t("warn",i,n)},n.debug=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t("debug",i,n)},n}var O=A("VIDEOJS"),D=O.createLogger,M=Object.prototype.toString,R=function(e){return N(e)?Object.keys(e):[]};function U(e,t){R(e).forEach(function(i){return t(e[i],i)})}function B(e,t,i){return void 0===i&&(i=0),R(e).reduce(function(i,n){return t(i,e[n],n)},i)}function F(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Object.assign?i.default.apply(void 0,[e].concat(n)):(n.forEach(function(t){t&&U(t,function(t,i){e[i]=t})}),e)}function N(e){return!!e&&"object"==typeof e}function j(e){return N(e)&&"[object Object]"===M.call(e)&&e.constructor===Object}function H(t,i){if(!t||!i)return"";if("function"==typeof e.default.getComputedStyle){var n;try{n=e.default.getComputedStyle(t)}catch(r){return""}return n?n.getPropertyValue(i)||n[i]:""}return""}var q=e.default.navigator&&e.default.navigator.userAgent||"",V=/AppleWebKit\/([\d.]+)/i.exec(q),W=V?parseFloat(V.pop()):null,z=/iPod/i.test(q),G=function(){var e=q.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),K=/Android/i.test(q),Q=function(){var e=q.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),i=e[2]&&parseFloat(e[2]);return t&&i?parseFloat(e[1]+"."+e[2]):t||null}(),X=K&&Q<5&&W<537,Y=/Firefox/i.test(q),$=/Edg/i.test(q),J=!$&&(/Chrome/i.test(q)||/CriOS/i.test(q)),Z=function(){var e=q.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),ee=function(){var e=/MSIE\s(\d+)\.\d/.exec(q),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(q)&&/rv:11.0/.test(q)&&(t=11),t}(),te=/Safari/i.test(q)&&!J&&!K&&!$,ie=/Windows/i.test(q),ne=Boolean(he()&&("ontouchstart"in e.default||e.default.navigator.maxTouchPoints||e.default.DocumentTouch&&e.default.document instanceof e.default.DocumentTouch)),re=/iPad/i.test(q)||te&&ne&&!/iPhone/i.test(q),ae=/iPhone/i.test(q)&&!re,se=ae||re||z,oe=(te||se)&&!J,le=Object.freeze({__proto__:null,IS_IPOD:z,IOS_VERSION:G,IS_ANDROID:K,ANDROID_VERSION:Q,IS_NATIVE_ANDROID:X,IS_FIREFOX:Y,IS_EDGE:$,IS_CHROME:J,CHROME_VERSION:Z,IE_VERSION:ee,IS_SAFARI:te,IS_WINDOWS:ie,TOUCH_ENABLED:ne,IS_IPAD:re,IS_IPHONE:ae,IS_IOS:se,IS_ANY_SAFARI:oe});function ue(e){return"string"==typeof e&&Boolean(e.trim())}function de(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function ce(e){return new RegExp("(^|\\s)"+e+"($|\\s)")}function he(){return t.default===e.default.document}function pe(e){return N(e)&&1===e.nodeType}function fe(){try{return e.default.parent!==e.default.self}catch(t){return!0}}function me(e){return function(i,n){if(!ue(i))return t.default[e](null);ue(n)&&(n=t.default.querySelector(n));var r=pe(n)?n:t.default;return r[e]&&r[e](i)}}function ge(e,i,n,r){void 0===e&&(e="div"),void 0===i&&(i={}),void 0===n&&(n={});var a=t.default.createElement(e);return Object.getOwnPropertyNames(i).forEach(function(e){var t=i[e];-1!==e.indexOf("aria-")||"role"===e||"type"===e?(O.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set "+e+" to "+t+"."),a.setAttribute(e,t)):"textContent"===e?ve(a,t):a[e]===t&&"tabIndex"!==e||(a[e]=t)}),Object.getOwnPropertyNames(n).forEach(function(e){a.setAttribute(e,n[e])}),r&&Ue(a,r),a}function ve(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function _e(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function ye(e,t){return de(t),e.classList?e.classList.contains(t):ce(t).test(e.className)}function Te(e,t){return e.classList?e.classList.add(t):ye(e,t)||(e.className=(e.className+" "+t).trim()),e}function be(e,t){return e?(e.classList?e.classList.remove(t):(de(t),e.className=e.className.split(/\s+/).filter(function(e){return e!==t}).join(" ")),e):(O.warn("removeClass was called with an element that doesn't exist"),null)}function Se(e,t,i){var n=ye(e,t);if("function"==typeof i&&(i=i(e,t)),"boolean"!=typeof i&&(i=!n),i!==n)return i?Te(e,t):be(e,t),e}function ke(e,t){Object.getOwnPropertyNames(t).forEach(function(i){var n=t[i];null==n||!1===n?e.removeAttribute(i):e.setAttribute(i,!0===n?"":n)})}function Ce(e){var t={},i=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(e&&e.attributes&&e.attributes.length>0)for(var n=e.attributes,r=n.length-1;r>=0;r--){var a=n[r].name,s=n[r].value;"boolean"!=typeof e[a]&&-1===i.indexOf(","+a+",")||(s=null!==s),t[a]=s}return t}function Ee(e,t){return e.getAttribute(t)}function we(e,t,i){e.setAttribute(t,i)}function Ie(e,t){e.removeAttribute(t)}function xe(){t.default.body.focus(),t.default.onselectstart=function(){return!1}}function Pe(){t.default.onselectstart=function(){return!0}}function Le(e){if(e&&e.getBoundingClientRect&&e.parentNode){var t=e.getBoundingClientRect(),i={};return["bottom","height","left","right","top","width"].forEach(function(e){void 0!==t[e]&&(i[e]=t[e])}),i.height||(i.height=parseFloat(H(e,"height"))),i.width||(i.width=parseFloat(H(e,"width"))),i}}function Ae(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};for(var i=e.offsetWidth,n=e.offsetHeight,r=0,a=0;e.offsetParent&&e!==t.default[C.fullscreenElement];)r+=e.offsetLeft,a+=e.offsetTop,e=e.offsetParent;return{left:r,top:a,width:i,height:n}}function Oe(e,t){var i={x:0,y:0};if(se)for(var n=e;n&&"html"!==n.nodeName.toLowerCase();){var r=H(n,"transform");if(/^matrix/.test(r)){var a=r.slice(7,-1).split(/,\s/).map(Number);i.x+=a[4],i.y+=a[5]}else if(/^matrix3d/.test(r)){var s=r.slice(9,-1).split(/,\s/).map(Number);i.x+=s[12],i.y+=s[13]}n=n.parentNode}var o={},l=Ae(t.target),u=Ae(e),d=u.width,c=u.height,h=t.offsetY-(u.top-l.top),p=t.offsetX-(u.left-l.left);return t.changedTouches&&(p=t.changedTouches[0].pageX-u.left,h=t.changedTouches[0].pageY+u.top,se&&(p-=i.x,h-=i.y)),o.y=1-Math.max(0,Math.min(1,h/c)),o.x=Math.max(0,Math.min(1,p/d)),o}function De(e){return N(e)&&3===e.nodeType}function Me(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function Re(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(function(e){return"function"==typeof e&&(e=e()),pe(e)||De(e)?e:"string"==typeof e&&/\S/.test(e)?t.default.createTextNode(e):void 0}).filter(function(e){return e})}function Ue(e,t){return Re(t).forEach(function(t){return e.appendChild(t)}),e}function Be(e,t){return Ue(Me(e),t)}function Fe(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||("mouseup"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons))}var Ne,je=me("querySelector"),He=me("querySelectorAll"),qe=Object.freeze({__proto__:null,isReal:he,isEl:pe,isInFrame:fe,createEl:ge,textContent:ve,prependTo:_e,hasClass:ye,addClass:Te,removeClass:be,toggleClass:Se,setAttributes:ke,getAttributes:Ce,getAttribute:Ee,setAttribute:we,removeAttribute:Ie,blockTextSelection:xe,unblockTextSelection:Pe,getBoundingClientRect:Le,findPosition:Ae,getPointerPosition:Oe,isTextNode:De,emptyEl:Me,normalizeContent:Re,appendContent:Ue,insertContent:Be,isSingleLeftClick:Fe,$:je,$$:He}),Ve=!1,We=function(){if(!1!==Ne.options.autoSetup){var e=Array.prototype.slice.call(t.default.getElementsByTagName("video")),i=Array.prototype.slice.call(t.default.getElementsByTagName("audio")),n=Array.prototype.slice.call(t.default.getElementsByTagName("video-js")),r=e.concat(i,n);if(r&&r.length>0)for(var a=0,s=r.length;a<s;a++){var o=r[a];if(!o||!o.getAttribute){ze(1);break}void 0===o.player&&null!==o.getAttribute("data-setup")&&Ne(o)}else Ve||ze(1)}};function ze(t,i){he()&&(i&&(Ne=i),e.default.setTimeout(We,t))}function Ge(){Ve=!0,e.default.removeEventListener("load",Ge)}he()&&("complete"===t.default.readyState?Ge():e.default.addEventListener("load",Ge));var Ke,Qe=function(e){var i=t.default.createElement("style");return i.className=e,i},Xe=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t},Ye=3,$e=Ye;function Je(){return $e++}e.default.WeakMap||(Ke=function(){function t(){this.vdata="vdata"+Math.floor(e.default.performance&&e.default.performance.now()||Date.now()),this.data={}}var i=t.prototype;return i.set=function(e,t){var i=e[this.vdata]||Je();return e[this.vdata]||(e[this.vdata]=i),this.data[i]=t,this},i.get=function(e){var t=e[this.vdata];if(t)return this.data[t];O("We have no data for this element",e)},i.has=function(e){return e[this.vdata]in this.data},i.delete=function(e){var t=e[this.vdata];t&&(delete this.data[t],delete e[this.vdata])},t}());var Ze,et=e.default.WeakMap?new WeakMap:new Ke;function tt(e,t){if(et.has(e)){var i=et.get(e);0===i.handlers[t].length&&(delete i.handlers[t],e.removeEventListener?e.removeEventListener(t,i.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),0===Object.getOwnPropertyNames(i).length&&et.delete(e)}}function it(e,t,i,n){i.forEach(function(i){e(t,i,n)})}function nt(i){if(i.fixed_)return i;function n(){return!0}function r(){return!1}if(!i||!i.isPropagationStopped||!i.isImmediatePropagationStopped){var a=i||e.default.event;for(var s in i={},a)"layerX"!==s&&"layerY"!==s&&"keyLocation"!==s&&"webkitMovementX"!==s&&"webkitMovementY"!==s&&("returnValue"===s&&a.preventDefault||(i[s]=a[s]));if(i.target||(i.target=i.srcElement||t.default),i.relatedTarget||(i.relatedTarget=i.fromElement===i.target?i.toElement:i.fromElement),i.preventDefault=function(){a.preventDefault&&a.preventDefault(),i.returnValue=!1,a.returnValue=!1,i.defaultPrevented=!0},i.defaultPrevented=!1,i.stopPropagation=function(){a.stopPropagation&&a.stopPropagation(),i.cancelBubble=!0,a.cancelBubble=!0,i.isPropagationStopped=n},i.isPropagationStopped=r,i.stopImmediatePropagation=function(){a.stopImmediatePropagation&&a.stopImmediatePropagation(),i.isImmediatePropagationStopped=n,i.stopPropagation()},i.isImmediatePropagationStopped=r,null!==i.clientX&&void 0!==i.clientX){var o=t.default.documentElement,l=t.default.body;i.pageX=i.clientX+(o&&o.scrollLeft||l&&l.scrollLeft||0)-(o&&o.clientLeft||l&&l.clientLeft||0),i.pageY=i.clientY+(o&&o.scrollTop||l&&l.scrollTop||0)-(o&&o.clientTop||l&&l.clientTop||0)}i.which=i.charCode||i.keyCode,null!==i.button&&void 0!==i.button&&(i.button=1&i.button?0:4&i.button?1:2&i.button?2:0)}return i.fixed_=!0,i}var rt=function(){if("boolean"!=typeof Ze){Ze=!1;try{var t=Object.defineProperty({},"passive",{get:function(){Ze=!0}});e.default.addEventListener("test",null,t),e.default.removeEventListener("test",null,t)}catch(i){}}return Ze},at=["touchstart","touchmove"];function st(e,t,i){if(Array.isArray(t))return it(st,e,t,i);et.has(e)||et.set(e,{});var n=et.get(e);if(n.handlers||(n.handlers={}),n.handlers[t]||(n.handlers[t]=[]),i.guid||(i.guid=Je()),n.handlers[t].push(i),n.dispatcher||(n.disabled=!1,n.dispatcher=function(t,i){if(!n.disabled){t=nt(t);var r=n.handlers[t.type];if(r)for(var a=r.slice(0),s=0,o=a.length;s<o&&!t.isImmediatePropagationStopped();s++)try{a[s].call(e,t,i)}catch(l){O.error(l)}}}),1===n.handlers[t].length)if(e.addEventListener){var r=!1;rt()&&at.indexOf(t)>-1&&(r={passive:!0}),e.addEventListener(t,n.dispatcher,r)}else e.attachEvent&&e.attachEvent("on"+t,n.dispatcher)}function ot(e,t,i){if(et.has(e)){var n=et.get(e);if(n.handlers){if(Array.isArray(t))return it(ot,e,t,i);var r=function(e,t){n.handlers[t]=[],tt(e,t)};if(void 0!==t){var a=n.handlers[t];if(a)if(i){if(i.guid)for(var s=0;s<a.length;s++)a[s].guid===i.guid&&a.splice(s--,1);tt(e,t)}else r(e,t)}else for(var o in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},o)&&r(e,o)}}}function lt(e,t,i){var n=et.has(e)?et.get(e):{},r=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=nt(t),n.dispatcher&&n.dispatcher.call(e,t,i),r&&!t.isPropagationStopped()&&!0===t.bubbles)lt.call(null,r,t,i);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){et.has(t.target)||et.set(t.target,{});var a=et.get(t.target);t.target[t.type]&&(a.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),a.disabled=!1)}return!t.defaultPrevented}function ut(e,t,i){if(Array.isArray(t))return it(ut,e,t,i);var n=function n(){ot(e,t,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||Je(),st(e,t,n)}function dt(e,t,i){var n=function n(){ot(e,t,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||Je(),st(e,t,n)}var ct,ht=Object.freeze({__proto__:null,fixEvent:nt,on:st,off:ot,trigger:lt,one:ut,any:dt}),pt=30,ft=function(e,t,i){t.guid||(t.guid=Je());var n=t.bind(e);return n.guid=i?i+"_"+t.guid:t.guid,n},mt=function(t,i){var n=e.default.performance.now();return function(){var r=e.default.performance.now();r-n>=i&&(t.apply(void 0,arguments),n=r)}},gt=function(t,i,n,r){var a;void 0===r&&(r=e.default);var s=function(){var e=this,s=arguments,o=function(){a=null,o=null,n||t.apply(e,s)};!a&&n&&t.apply(e,s),r.clearTimeout(a),a=r.setTimeout(o,i)};return s.cancel=function(){r.clearTimeout(a),a=null},s},vt=function(){};vt.prototype.allowedEvents_={},vt.prototype.on=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},st(this,e,t),this.addEventListener=i},vt.prototype.addEventListener=vt.prototype.on,vt.prototype.off=function(e,t){ot(this,e,t)},vt.prototype.removeEventListener=vt.prototype.off,vt.prototype.one=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},ut(this,e,t),this.addEventListener=i},vt.prototype.any=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},dt(this,e,t),this.addEventListener=i},vt.prototype.trigger=function(e){var t=e.type||e;"string"==typeof e&&(e={type:t}),e=nt(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),lt(this,e)},vt.prototype.dispatchEvent=vt.prototype.trigger,vt.prototype.queueTrigger=function(t){var i=this;ct||(ct=new Map);var n=t.type||t,r=ct.get(this);r||(r=new Map,ct.set(this,r));var a=r.get(n);r.delete(n),e.default.clearTimeout(a);var s=e.default.setTimeout(function(){0===r.size&&(r=null,ct.delete(i)),i.trigger(t)},0);r.set(n,s)};var _t=function(e){return"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e},yt=function(e){return e instanceof vt||!!e.eventBusEl_&&["on","one","off","trigger"].every(function(t){return"function"==typeof e[t]})},Tt=function(e,t){yt(e)?t():(e.eventedCallbacks||(e.eventedCallbacks=[]),e.eventedCallbacks.push(t))},bt=function(e){return"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length},St=function(e,t,i){if(!e||!e.nodeName&&!yt(e))throw new Error("Invalid target for "+_t(t)+"#"+i+"; must be a DOM node or evented object.")},kt=function(e,t,i){if(!bt(e))throw new Error("Invalid event type for "+_t(t)+"#"+i+"; must be a non-empty string or array.")},Ct=function(e,t,i){if("function"!=typeof e)throw new Error("Invalid listener for "+_t(t)+"#"+i+"; must be a function.")},Et=function(e,t,i){var n,r,a,s=t.length<3||t[0]===e||t[0]===e.eventBusEl_;return s?(n=e.eventBusEl_,t.length>=3&&t.shift(),r=t[0],a=t[1]):(n=t[0],r=t[1],a=t[2]),St(n,e,i),kt(r,e,i),Ct(a,e,i),{isTargetingSelf:s,target:n,type:r,listener:a=ft(e,a)}},wt=function(e,t,i,n){St(e,e,t),e.nodeName?ht[t](e,i,n):e[t](i,n)},It={on:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=Et(this,i,"on"),a=r.isTargetingSelf,s=r.target,o=r.type,l=r.listener;if(wt(s,"on",o,l),!a){var u=function(){return e.off(s,o,l)};u.guid=l.guid;var d=function(){return e.off("dispose",u)};d.guid=l.guid,wt(this,"on","dispose",u),wt(s,"on","dispose",d)}},one:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=Et(this,i,"one"),a=r.isTargetingSelf,s=r.target,o=r.type,l=r.listener;if(a)wt(s,"one",o,l);else{var u=function t(){e.off(s,o,t);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];l.apply(null,n)};u.guid=l.guid,wt(s,"one",o,u)}},any:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=Et(this,i,"any"),a=r.isTargetingSelf,s=r.target,o=r.type,l=r.listener;if(a)wt(s,"any",o,l);else{var u=function t(){e.off(s,o,t);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];l.apply(null,n)};u.guid=l.guid,wt(s,"any",o,u)}},off:function(e,t,i){if(!e||bt(e))ot(this.eventBusEl_,e,t);else{var n=e,r=t;St(n,this,"off"),kt(r,this,"off"),Ct(i,this,"off"),i=ft(this,i),this.off("dispose",i),n.nodeName?(ot(n,r,i),ot(n,"dispose",i)):yt(n)&&(n.off(r,i),n.off("dispose",i))}},trigger:function(e,t){St(this.eventBusEl_,this,"trigger");var i=e&&"string"!=typeof e?e.type:e;if(!bt(i)){var n="Invalid event type for "+_t(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(!e)throw new Error(n);(this.log||O).error(n)}return lt(this.eventBusEl_,e,t)}};function xt(t,i){void 0===i&&(i={});var n=i.eventBusKey;if(n){if(!t[n].nodeName)throw new Error('The eventBusKey "'+n+'" does not refer to an element.');t.eventBusEl_=t[n]}else t.eventBusEl_=ge("span",{className:"vjs-event-bus"});return F(t,It),t.eventedCallbacks&&t.eventedCallbacks.forEach(function(e){e()}),t.on("dispose",function(){t.off(),e.default.setTimeout(function(){t.eventBusEl_=null},0)}),t}var Pt={state:{},setState:function(e){var t,i=this;return"function"==typeof e&&(e=e()),U(e,function(e,n){i.state[n]!==e&&((t=t||{})[n]={from:i.state[n],to:e}),i.state[n]=e}),t&&yt(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function Lt(e,t){return F(e,Pt),e.state=F({},e.state,t),"function"==typeof e.handleStateChanged&&yt(e)&&e.on("statechanged",e.handleStateChanged),e}var At=function(e){return"string"!=typeof e?e:e.replace(/./,function(e){return e.toLowerCase()})},Ot=function(e){return"string"!=typeof e?e:e.replace(/./,function(e){return e.toUpperCase()})},Dt=function(e,t){return Ot(e)===Ot(t)};function Mt(){for(var e={},t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i.forEach(function(t){t&&U(t,function(t,i){j(t)?(j(e[i])||(e[i]={}),e[i]=Mt(e[i],t)):e[i]=t})}),e}var Rt=function(){function e(){this.map_={}}var t=e.prototype;return t.has=function(e){return e in this.map_},t.delete=function(e){var t=this.has(e);return delete this.map_[e],t},t.set=function(e,t){return this.map_[e]=t,this},t.forEach=function(e,t){for(var i in this.map_)e.call(t,this.map_[i],i,this)},e}(),Ut=e.default.Map?e.default.Map:Rt,Bt=function(){function e(){this.set_={}}var t=e.prototype;return t.has=function(e){return e in this.set_},t.delete=function(e){var t=this.has(e);return delete this.set_[e],t},t.add=function(e){return this.set_[e]=1,this},t.forEach=function(e,t){for(var i in this.set_)e.call(t,i,i,this)},e}(),Ft=e.default.Set?e.default.Set:Bt,Nt=function(){function t(e,t,i){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Mt({},this.options_),t=this.options_=Mt(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){var n=e&&e.id&&e.id()||"no_player";this.id_=n+"_component_"+Je()}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),!1!==t.evented&&(xt(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Lt(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Ft,this.setIntervalIds_=new Ft,this.rafIds_=new Ft,this.namedRafs_=new Ut,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(i),!1!==t.reportTouchActivity&&this.enableTouchActivity()}var i=t.prototype;return i.dispose=function(){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),et.has(this.el_)&&et.delete(this.el_),this.el_=null),this.player_=null}},i.isDisposed=function(){return Boolean(this.isDisposed_)},i.player=function(){return this.player_},i.options=function(e){return e?(this.options_=Mt(this.options_,e),this.options_):this.options_},i.el=function(){return this.el_},i.createEl=function(e,t,i){return ge(e,t,i)},i.localize=function(e,t,i){void 0===i&&(i=e);var n=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),a=r&&r[n],s=n&&n.split("-")[0],o=r&&r[s],l=i;return a&&a[e]?l=a[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,i){var n=t[i-1],r=n;return void 0===n&&(r=e),r})),l},i.handleLanguagechange=function(){},i.contentEl=function(){return this.contentEl_||this.el_},i.id=function(){return this.id_},i.name=function(){return this.name_},i.children=function(){return this.children_},i.getChildById=function(e){return this.childIndex_[e]},i.getChild=function(e){if(e)return this.childNameIndex_[e]},i.getDescendant=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t=t.reduce(function(e,t){return e.concat(t)},[]);for(var n=this,r=0;r<t.length;r++)if(!(n=n.getChild(t[r]))||!n.getChild)return;return n},i.addChild=function(e,i,n){var r,a;if(void 0===i&&(i={}),void 0===n&&(n=this.children_.length),"string"==typeof e){a=Ot(e);var s=i.componentClass||a;i.name=a;var o=t.getComponent(s);if(!o)throw new Error("Component "+s+" does not exist");if("function"!=typeof o)return null;r=new o(this.player_||this,i)}else r=e;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,"function"==typeof r.id&&(this.childIndex_[r.id()]=r),(a=a||r.name&&Ot(r.name()))&&(this.childNameIndex_[a]=r,this.childNameIndex_[At(a)]=r),"function"==typeof r.el&&r.el()){var l=null;this.children_[n+1]&&(this.children_[n+1].el_?l=this.children_[n+1].el_:pe(this.children_[n+1])&&(l=this.children_[n+1])),this.contentEl().insertBefore(r.el(),l)}return r},i.removeChild=function(e){if("string"==typeof e&&(e=this.getChild(e)),e&&this.children_){for(var t=!1,i=this.children_.length-1;i>=0;i--)if(this.children_[i]===e){t=!0,this.children_.splice(i,1);break}if(t){e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[Ot(e.name())]=null,this.childNameIndex_[At(e.name())]=null;var n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}}},i.initChildren=function(){var e=this,i=this.options_.children;if(i){var n,r=this.options_,a=t.getComponent("Tech");(n=Array.isArray(i)?i:Object.keys(i)).concat(Object.keys(this.options_).filter(function(e){return!n.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(function(t){var n,r;return"string"==typeof t?r=i[n=t]||e.options_[n]||{}:(n=t.name,r=t),{name:n,opts:r}}).filter(function(e){var i=t.getComponent(e.opts.componentClass||Ot(e.name));return i&&!a.isTech(i)}).forEach(function(t){var i=t.name,n=t.opts;if(void 0!==r[i]&&(n=r[i]),!1!==n){!0===n&&(n={}),n.playerOptions=e.options_.playerOptions;var a=e.addChild(i,n);a&&(e[i]=a)}})}},i.buildCSSClass=function(){return""},i.ready=function(e,t){if(void 0===t&&(t=!1),e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))},i.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)},i.$=function(e,t){return je(e,t||this.contentEl())},i.$$=function(e,t){return He(e,t||this.contentEl())},i.hasClass=function(e){return ye(this.el_,e)},i.addClass=function(e){Te(this.el_,e)},i.removeClass=function(e){be(this.el_,e)},i.toggleClass=function(e,t){Se(this.el_,e,t)},i.show=function(){this.removeClass("vjs-hidden")},i.hide=function(){this.addClass("vjs-hidden")},i.lockShowing=function(){this.addClass("vjs-lock-showing")},i.unlockShowing=function(){this.removeClass("vjs-lock-showing")},i.getAttribute=function(e){return Ee(this.el_,e)},i.setAttribute=function(e,t){we(this.el_,e,t)},i.removeAttribute=function(e){Ie(this.el_,e)},i.width=function(e,t){return this.dimension("width",e,t)},i.height=function(e,t){return this.dimension("height",e,t)},i.dimensions=function(e,t){this.width(e,!0),this.height(t)},i.dimension=function(e,t,i){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(i||this.trigger("componentresize"));if(!this.el_)return 0;var n=this.el_.style[e],r=n.indexOf("px");return-1!==r?parseInt(n.slice(0,r),10):parseInt(this.el_["offset"+Ot(e)],10)},i.currentDimension=function(e){var t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=H(this.el_,e),0===(t=parseFloat(t))||isNaN(t)){var i="offset"+Ot(e);t=this.el_[i]}return t},i.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},i.currentWidth=function(){return this.currentDimension("width")},i.currentHeight=function(){return this.currentDimension("height")},i.focus=function(){this.el_.focus()},i.blur=function(){this.el_.blur()},i.handleKeyDown=function(e){this.player_&&(e.stopPropagation(),this.player_.handleKeyDown(e))},i.handleKeyPress=function(e){this.handleKeyDown(e)},i.emitTapEvents=function(){var t,i=0,n=null;this.on("touchstart",function(r){1===r.touches.length&&(n={pageX:r.touches[0].pageX,pageY:r.touches[0].pageY},i=e.default.performance.now(),t=!0)}),this.on("touchmove",function(e){if(e.touches.length>1)t=!1;else if(n){var i=e.touches[0].pageX-n.pageX,r=e.touches[0].pageY-n.pageY;Math.sqrt(i*i+r*r)>10&&(t=!1)}});var r=function(){t=!1};this.on("touchleave",r),this.on("touchcancel",r),this.on("touchend",function(r){(n=null,!0===t)&&(e.default.performance.now()-i<200&&(r.preventDefault(),this.trigger("tap")))})},i.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var e,t=ft(this.player(),this.player().reportUserActivity);this.on("touchstart",function(){t(),this.clearInterval(e),e=this.setInterval(t,250)});var i=function(i){t(),this.clearInterval(e)};this.on("touchmove",t),this.on("touchend",i),this.on("touchcancel",i)}},i.setTimeout=function(t,i){var n,r=this;return t=ft(this,t),this.clearTimersOnDispose_(),n=e.default.setTimeout(function(){r.setTimeoutIds_.has(n)&&r.setTimeoutIds_.delete(n),t()},i),this.setTimeoutIds_.add(n),n},i.clearTimeout=function(t){return this.setTimeoutIds_.has(t)&&(this.setTimeoutIds_.delete(t),e.default.clearTimeout(t)),t},i.setInterval=function(t,i){t=ft(this,t),this.clearTimersOnDispose_();var n=e.default.setInterval(t,i);return this.setIntervalIds_.add(n),n},i.clearInterval=function(t){return this.setIntervalIds_.has(t)&&(this.setIntervalIds_.delete(t),e.default.clearInterval(t)),t},i.requestAnimationFrame=function(t){var i,n=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),t=ft(this,t),i=e.default.requestAnimationFrame(function(){n.rafIds_.has(i)&&n.rafIds_.delete(i),t()}),this.rafIds_.add(i),i):this.setTimeout(t,1e3/60)},i.requestNamedAnimationFrame=function(e,t){var i=this;if(!this.namedRafs_.has(e)){this.clearTimersOnDispose_(),t=ft(this,t);var n=this.requestAnimationFrame(function(){t(),i.namedRafs_.has(e)&&i.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}},i.cancelNamedAnimationFrame=function(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))},i.cancelAnimationFrame=function(t){return this.supportsRaf_?(this.rafIds_.has(t)&&(this.rafIds_.delete(t),e.default.cancelAnimationFrame(t)),t):this.clearTimeout(t)},i.clearTimersOnDispose_=function(){var e=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(t){var i=t[0],n=t[1];e[i].forEach(function(t,i){return e[n](i)})}),e.clearingTimersOnDispose_=!1}))},t.registerComponent=function(e,i){if("string"!=typeof e||!e)throw new Error('Illegal component name, "'+e+'"; must be a non-empty string.');var n,r=t.getComponent("Tech"),a=r&&r.isTech(i),s=t===i||t.prototype.isPrototypeOf(i.prototype);if(a||!s)throw n=a?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error('Illegal component, "'+e+'"; '+n+".");e=Ot(e),t.components_||(t.components_={});var o=t.getComponent("Player");if("Player"===e&&o&&o.players){var l=o.players,u=Object.keys(l);if(l&&u.length>0&&u.map(function(e){return l[e]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return t.components_[e]=i,t.components_[At(e)]=i,i},t.getComponent=function(e){if(e&&t.components_)return t.components_[e]},t}();function jt(e,t,i){if("number"!=typeof t||t<0||t>i)throw new Error("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is non-numeric or out of bounds (0-"+i+").")}function Ht(e,t,i,n){return jt(e,n,i.length-1),i[n][t]}function qt(e){return void 0===e||0===e.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:Ht.bind(null,"start",0,e),end:Ht.bind(null,"end",1,e)}}function Vt(e,t){return Array.isArray(e)?qt(e):void 0===e||void 0===t?qt():qt([[e,t]])}function Wt(e,t){var i,n,r=0;if(!t)return 0;e&&e.length||(e=Vt(0,0));for(var a=0;a<e.length;a++)i=e.start(a),(n=e.end(a))>t&&(n=t),r+=n-i;return r/t}function zt(e){if(e instanceof zt)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:N(e)&&("number"==typeof e.code&&(this.code=e.code),F(this,e)),this.message||(this.message=zt.defaultMessages[this.code]||"")}Nt.prototype.supportsRaf_="function"==typeof e.default.requestAnimationFrame&&"function"==typeof e.default.cancelAnimationFrame,Nt.registerComponent("Component",Nt),zt.prototype.code=0,zt.prototype.message="",zt.prototype.status=null,zt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],zt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var Gt=0;Gt<zt.errorTypes.length;Gt++)zt[zt.errorTypes[Gt]]=Gt,zt.prototype[zt.errorTypes[Gt]]=Gt;function Kt(e){return null!=e&&"function"==typeof e.then}function Qt(e){Kt(e)&&e.then(null,function(e){})}var Xt=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(t,i,n){return e[i]&&(t[i]=e[i]),t},{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})},Yt=function(e){var t=e.$$("track"),i=Array.prototype.map.call(t,function(e){return e.track});return Array.prototype.map.call(t,function(e){var t=Xt(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===i.indexOf(e)}).map(Xt))},$t=function(e,t){return e.forEach(function(e){var i=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(function(e){return i.addCue(e)})}),t.textTracks()},Jt={textTracksToJson:Yt,jsonToTextTracks:$t,trackToJson_:Xt},Zt="vjs-modal-dialog",ei=function(i){function n(e,t){var n;return(n=i.call(this,e,t)||this).handleKeyDown_=function(e){return n.handleKeyDown(e)},n.close_=function(e){return n.close(e)},n.opened_=n.hasBeenOpened_=n.hasBeenFilled_=!1,n.closeable(!n.options_.uncloseable),n.content(n.options_.content),n.contentEl_=ge("div",{className:Zt+"-content"},{role:"document"}),n.descEl_=ge("p",{className:Zt+"-description vjs-control-text",id:n.el().getAttribute("aria-describedby")}),ve(n.descEl_,n.description()),n.el_.appendChild(n.descEl_),n.el_.appendChild(n.contentEl_),n}(0,r.default)(n,i);var a=n.prototype;return a.createEl=function(){return i.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},a.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,i.prototype.dispose.call(this)},a.buildCSSClass=function(){return Zt+" vjs-hidden "+i.prototype.buildCSSClass.call(this)},a.label=function(){return this.localize(this.options_.label||"Modal Window")},a.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},a.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},a.opened=function(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_},a.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},a.closeable=function(e){if("boolean"==typeof e){var t=this.closeable_=!!e,i=this.getChild("closeButton");if(t&&!i){var n=this.contentEl_;this.contentEl_=this.el_,i=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=n,this.on(i,"close",this.close_)}!t&&i&&(this.off(i,"close",this.close_),this.removeChild(i),i.dispose())}return this.closeable_},a.fill=function(){this.fillWith(this.content())},a.fillWith=function(e){var t=this.contentEl(),i=t.parentNode,n=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,i.removeChild(t),this.empty(),Be(t,e),this.trigger("modalfill"),n?i.insertBefore(t,n):i.appendChild(t);var r=this.getChild("closeButton");r&&i.appendChild(r.el_)},a.empty=function(){this.trigger("beforemodalempty"),Me(this.contentEl()),this.trigger("modalempty")},a.content=function(e){return void 0!==e&&(this.content_=e),this.content_},a.conditionalFocus_=function(){var e=t.default.activeElement,i=this.player_.el_;this.previouslyActiveEl_=null,(i.contains(e)||i===e)&&(this.previouslyActiveEl_=e,this.focus())},a.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},a.handleKeyDown=function(e){if(e.stopPropagation(),s.default.isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(s.default.isEventKey(e,"Tab")){for(var i,n=this.focusableEls_(),r=this.el_.querySelector(":focus"),a=0;a<n.length;a++)if(r===n[a]){i=a;break}t.default.activeElement===this.el_&&(i=0),e.shiftKey&&0===i?(n[n.length-1].focus(),e.preventDefault()):e.shiftKey||i!==n.length-1||(n[0].focus(),e.preventDefault())}},a.focusableEls_=function(){var t=this.el_.querySelectorAll("*");return Array.prototype.filter.call(t,function(t){return(t instanceof e.default.HTMLAnchorElement||t instanceof e.default.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof e.default.HTMLInputElement||t instanceof e.default.HTMLSelectElement||t instanceof e.default.HTMLTextAreaElement||t instanceof e.default.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof e.default.HTMLIFrameElement||t instanceof e.default.HTMLObjectElement||t instanceof e.default.HTMLEmbedElement||t.hasAttribute("tabindex")&&-1!==t.getAttribute("tabindex")||t.hasAttribute("contenteditable")})},n}(Nt);ei.prototype.options_={pauseOnOpen:!0,temporary:!0},Nt.registerComponent("ModalDialog",ei);var ti=function(e){function t(t){var i;void 0===t&&(t=[]),(i=e.call(this)||this).tracks_=[],Object.defineProperty((0,n.default)(i),"length",{get:function(){return this.tracks_.length}});for(var r=0;r<t.length;r++)i.addTrack(t[r]);return i}(0,r.default)(t,e);var i=t.prototype;return i.addTrack=function(e){var t=this,i=this.tracks_.length;""+i in this||Object.defineProperty(this,i,{get:function(){return this.tracks_[i]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=function(){t.trigger({track:e,type:"labelchange",target:t})},yt(e)&&e.addEventListener("labelchange",e.labelchange_)},i.removeTrack=function(e){for(var t,i=0,n=this.length;i<n;i++)if(this[i]===e){(t=this[i]).off&&t.off(),this.tracks_.splice(i,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})},i.getTrackById=function(e){for(var t=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===e){t=r;break}}return t},t}(vt);for(var ii in ti.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"},ti.prototype.allowedEvents_)ti.prototype["on"+ii]=null;var ni=function(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].enabled=!1)},ri=function(e){function t(t){var i;void 0===t&&(t=[]);for(var n=t.length-1;n>=0;n--)if(t[n].enabled){ni(t,t[n]);break}return(i=e.call(this,t)||this).changing_=!1,i}(0,r.default)(t,e);var i=t.prototype;return i.addTrack=function(t){var i=this;t.enabled&&ni(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.enabledChange_=function(){i.changing_||(i.changing_=!0,ni(i,t),i.changing_=!1,i.trigger("change"))},t.addEventListener("enabledchange",t.enabledChange_))},i.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.enabledChange_&&(t.removeEventListener("enabledchange",t.enabledChange_),t.enabledChange_=null)},t}(ti),ai=function(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].selected=!1)},si=function(e){function t(t){var i;void 0===t&&(t=[]);for(var r=t.length-1;r>=0;r--)if(t[r].selected){ai(t,t[r]);break}return(i=e.call(this,t)||this).changing_=!1,Object.defineProperty((0,n.default)(i),"selectedIndex",{get:function(){for(var e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set:function(){}}),i}(0,r.default)(t,e);var i=t.prototype;return i.addTrack=function(t){var i=this;t.selected&&ai(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.selectedChange_=function(){i.changing_||(i.changing_=!0,ai(i,t),i.changing_=!1,i.trigger("change"))},t.addEventListener("selectedchange",t.selectedChange_))},i.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.selectedChange_&&(t.removeEventListener("selectedchange",t.selectedChange_),t.selectedChange_=null)},t}(ti),oi=function(e){function t(){return e.apply(this,arguments)||this}(0,r.default)(t,e);var i=t.prototype;return i.addTrack=function(t){var i=this;e.prototype.addTrack.call(this,t),this.queueChange_||(this.queueChange_=function(){return i.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return i.trigger("selectedlanguagechange")}),t.addEventListener("modechange",this.queueChange_);-1===["metadata","chapters"].indexOf(t.kind)&&t.addEventListener("modechange",this.triggerSelectedlanguagechange_)},i.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&(this.queueChange_&&t.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&t.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},t}(ti),li=function(){function e(e){void 0===e&&(e=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var t=0,i=e.length;t<i;t++)this.addTrackElement_(e[t])}var t=e.prototype;return t.addTrackElement_=function(e){var t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)},t.getTrackElementByTrack_=function(e){for(var t,i=0,n=this.trackElements_.length;i<n;i++)if(e===this.trackElements_[i].track){t=this.trackElements_[i];break}return t},t.removeTrackElement_=function(e){for(var t=0,i=this.trackElements_.length;t<i;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}},e}(),ui=function(){function e(t){e.prototype.setCues_.call(this,t),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var t=e.prototype;return t.setCues_=function(e){var t=this.length||0,i=0,n=e.length;this.cues_=e,this.length_=e.length;var r=function(e){""+e in this||Object.defineProperty(this,""+e,{get:function(){return this.cues_[e]}})};if(t<n)for(i=t;i<n;i++)r.call(this,i)},t.getCueById=function(e){for(var t=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===e){t=r;break}}return t},e}(),di={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},ci={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},hi={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},pi={disabled:"disabled",hidden:"hidden",showing:"showing"},fi=function(e){function t(t){var i;void 0===t&&(t={}),i=e.call(this)||this;var r={id:t.id||"vjs_track_"+Je(),kind:t.kind||"",language:t.language||""},a=t.label||"",s=function(e){Object.defineProperty((0,n.default)(i),e,{get:function(){return r[e]},set:function(){}})};for(var o in r)s(o);return Object.defineProperty((0,n.default)(i),"label",{get:function(){return a},set:function(e){e!==a&&(a=e,this.trigger("labelchange"))}}),i}return(0,r.default)(t,e),t}(vt),mi=function(i){var n=["protocol","hostname","port","pathname","search","hash","host"],r=t.default.createElement("a");r.href=i;for(var a={},s=0;s<n.length;s++)a[n[s]]=r[n[s]];return"http:"===a.protocol&&(a.host=a.host.replace(/:80$/,"")),"https:"===a.protocol&&(a.host=a.host.replace(/:443$/,"")),a.protocol||(a.protocol=e.default.location.protocol),a.host||(a.host=e.default.location.host),a},gi=function(e){if(!e.match(/^https?:\/\//)){var i=t.default.createElement("a");i.href=e,e=i.href}return e},vi=function(e){if("string"==typeof e){var t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(e);if(t)return t.pop().toLowerCase()}return""},_i=function(t,i){void 0===i&&(i=e.default.location);var n=mi(t);return(":"===n.protocol?i.protocol:n.protocol)+n.host!==i.protocol+i.host},yi=Object.freeze({__proto__:null,parseUrl:mi,getAbsoluteURL:gi,getFileExtension:vi,isCrossOrigin:_i}),Ti=function(t,i){var n=new e.default.WebVTT.Parser(e.default,e.default.vttjs,e.default.WebVTT.StringDecoder()),r=[];n.oncue=function(e){i.addCue(e)},n.onparsingerror=function(e){r.push(e)},n.onflush=function(){i.trigger({type:"loadeddata",target:i})},n.parse(t),r.length>0&&(e.default.console&&e.default.console.groupCollapsed&&e.default.console.groupCollapsed("Text Track parsing errors for "+i.src),r.forEach(function(e){return O.error(e)}),e.default.console&&e.default.console.groupEnd&&e.default.console.groupEnd()),n.flush()},bi=function(t,i){var n={uri:t},r=_i(t);r&&(n.cors=r);var a="use-credentials"===i.tech_.crossOrigin();a&&(n.withCredentials=a),(0,o.default)(n,ft(this,function(t,n,r){if(t)return O.error(t,n);i.loaded_=!0,"function"!=typeof e.default.WebVTT?i.tech_&&i.tech_.any(["vttjsloaded","vttjserror"],function(e){if("vttjserror"!==e.type)return Ti(r,i);O.error("vttjs failed to load, stopping trying to process "+i.src)}):Ti(r,i)}))},Si=function(t){function i(e){var i;if(void 0===e&&(e={}),!e.tech)throw new Error("A tech was not provided.");var r=Mt(e,{kind:hi[e.kind]||"subtitles",language:e.language||e.srclang||""}),a=pi[r.mode]||"disabled",s=r.default;"metadata"!==r.kind&&"chapters"!==r.kind||(a="hidden"),(i=t.call(this,r)||this).tech_=r.tech,i.cues_=[],i.activeCues_=[],i.preload_=!1!==i.tech_.preloadTextTracks;var o=new ui(i.cues_),l=new ui(i.activeCues_),u=!1,d=ft((0,n.default)(i),function(){this.tech_.isReady_&&!this.tech_.isDisposed()&&(this.activeCues=this.activeCues,u&&(this.trigger("cuechange"),u=!1))});return i.tech_.one("dispose",function(){i.tech_.off("timeupdate",d)}),"disabled"!==a&&i.tech_.on("timeupdate",d),Object.defineProperties((0,n.default)(i),{default:{get:function(){return s},set:function(){}},mode:{get:function(){return a},set:function(e){pi[e]&&a!==e&&(a=e,this.preload_||"disabled"===a||0!==this.cues.length||bi(this.src,this),this.tech_.off("timeupdate",d),"disabled"!==a&&this.tech_.on("timeupdate",d),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?o:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return l;for(var e=this.tech_.currentTime(),t=[],i=0,n=this.cues.length;i<n;i++){var r=this.cues[i];r.startTime<=e&&r.endTime>=e?t.push(r):r.startTime===r.endTime&&r.startTime<=e&&r.startTime+.5>=e&&t.push(r)}if(u=!1,t.length!==this.activeCues_.length)u=!0;else for(var a=0;a<t.length;a++)-1===this.activeCues_.indexOf(t[a])&&(u=!0);return this.activeCues_=t,l.setCues_(this.activeCues_),l},set:function(){}}}),r.src?(i.src=r.src,i.preload_||(i.loaded_=!0),(i.preload_||"subtitles"!==r.kind&&"captions"!==r.kind)&&bi(i.src,(0,n.default)(i))):i.loaded_=!0,i}(0,r.default)(i,t);var a=i.prototype;return a.addCue=function(t){var i=t;if(e.default.vttjs&&!(t instanceof e.default.vttjs.VTTCue)){for(var n in i=new e.default.vttjs.VTTCue(t.startTime,t.endTime,t.text),t)n in i||(i[n]=t[n]);i.id=t.id,i.originalCue_=t}for(var r=this.tech_.textTracks(),a=0;a<r.length;a++)r[a]!==this&&r[a].removeCue(i);this.cues_.push(i),this.cues.setCues_(this.cues_)},a.removeCue=function(e){for(var t=this.cues_.length;t--;){var i=this.cues_[t];if(i===e||i.originalCue_&&i.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}},i}(fi);Si.prototype.allowedEvents_={cuechange:"cuechange"};var ki=function(e){function t(t){var i;void 0===t&&(t={});var r=Mt(t,{kind:ci[t.kind]||""});i=e.call(this,r)||this;var a=!1;return Object.defineProperty((0,n.default)(i),"enabled",{get:function(){return a},set:function(e){"boolean"==typeof e&&e!==a&&(a=e,this.trigger("enabledchange"))}}),r.enabled&&(i.enabled=r.enabled),i.loaded_=!0,i}return(0,r.default)(t,e),t}(fi),Ci=function(e){function t(t){var i;void 0===t&&(t={});var r=Mt(t,{kind:di[t.kind]||""});i=e.call(this,r)||this;var a=!1;return Object.defineProperty((0,n.default)(i),"selected",{get:function(){return a},set:function(e){"boolean"==typeof e&&e!==a&&(a=e,this.trigger("selectedchange"))}}),r.selected&&(i.selected=r.selected),i}return(0,r.default)(t,e),t}(fi),Ei=0,wi=1,Ii=2,xi=3,Pi=function(e){function t(t){var i,r;void 0===t&&(t={}),i=e.call(this)||this;var a=new Si(t);return i.kind=a.kind,i.src=a.src,i.srclang=a.language,i.label=a.label,i.default=a.default,Object.defineProperties((0,n.default)(i),{readyState:{get:function(){return r}},track:{get:function(){return a}}}),r=Ei,a.addEventListener("loadeddata",function(){r=Ii,i.trigger({type:"load",target:(0,n.default)(i)})}),i}return(0,r.default)(t,e),t}(vt);Pi.prototype.allowedEvents_={load:"load"},Pi.NONE=Ei,Pi.LOADING=wi,Pi.LOADED=Ii,Pi.ERROR=xi;var Li={audio:{ListClass:ri,TrackClass:ki,capitalName:"Audio"},video:{ListClass:si,TrackClass:Ci,capitalName:"Video"},text:{ListClass:oi,TrackClass:Si,capitalName:"Text"}};Object.keys(Li).forEach(function(e){Li[e].getterName=e+"Tracks",Li[e].privateName=e+"Tracks_"});var Ai={remoteText:{ListClass:oi,TrackClass:Si,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:li,TrackClass:Pi,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Oi=(0,i.default)({},Li,Ai);function Di(e,t,i,n,r){void 0===r&&(r={});var a=e.textTracks();r.kind=t,i&&(r.label=i),n&&(r.language=n),r.tech=e;var s=new Oi.text.TrackClass(r);return a.addTrack(s),s}Ai.names=Object.keys(Ai),Li.names=Object.keys(Li),Oi.names=[].concat(Ai.names).concat(Li.names);var Mi=function(i){function n(e,t){var n;return void 0===e&&(e={}),void 0===t&&(t=function(){}),e.reportTouchActivity=!1,(n=i.call(this,null,e,t)||this).onDurationChange_=function(e){return n.onDurationChange(e)},n.trackProgress_=function(e){return n.trackProgress(e)},n.trackCurrentTime_=function(e){return n.trackCurrentTime(e)},n.stopTrackingCurrentTime_=function(e){return n.stopTrackingCurrentTime(e)},n.disposeSourceHandler_=function(e){return n.disposeSourceHandler(e)},n.hasStarted_=!1,n.on("playing",function(){this.hasStarted_=!0}),n.on("loadstart",function(){this.hasStarted_=!1}),Oi.names.forEach(function(t){var i=Oi[t];e&&e[i.getterName]&&(n[i.privateName]=e[i.getterName])}),n.featuresProgressEvents||n.manualProgressOn(),n.featuresTimeupdateEvents||n.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(t){!1===e["native"+t+"Tracks"]&&(n["featuresNative"+t+"Tracks"]=!1)}),!1===e.nativeCaptions||!1===e.nativeTextTracks?n.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(n.featuresNativeTextTracks=!0),n.featuresNativeTextTracks||n.emulateTextTracks(),n.preloadTextTracks=!1!==e.preloadTextTracks,n.autoRemoteTextTracks_=new Oi.text.ListClass,n.initTrackListeners(),e.nativeControlsForTouch||n.emitTapEvents(),n.constructor&&(n.name_=n.constructor.name||"Unknown Tech"),n}(0,r.default)(n,i);var a=n.prototype;return a.triggerSourceset=function(e){var t=this;this.isReady_||this.one("ready",function(){return t.setTimeout(function(){return t.triggerSourceset(e)},1)}),this.trigger({src:e,type:"sourceset"})},a.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},a.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},a.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(ft(this,function(){var e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)},a.onDurationChange=function(e){this.duration_=this.duration()},a.buffered=function(){return Vt(0,0)},a.bufferedPercent=function(){return Wt(this.buffered(),this.duration_)},a.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},a.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},a.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},a.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},a.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},a.dispose=function(){this.clearTracks(Li.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),i.prototype.dispose.call(this)},a.clearTracks=function(e){var t=this;(e=[].concat(e)).forEach(function(e){for(var i=t[e+"Tracks"]()||[],n=i.length;n--;){var r=i[n];"text"===e&&t.removeRemoteTextTrack(r),i.removeTrack(r)}})},a.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],t=e.length;t--;){var i=e[t];this.removeRemoteTextTrack(i)}},a.reset=function(){},a.crossOrigin=function(){},a.setCrossOrigin=function(){},a.error=function(e){return void 0!==e&&(this.error_=new zt(e),this.trigger("error")),this.error_},a.played=function(){return this.hasStarted_?Vt(0,0):Vt()},a.play=function(){},a.setScrubbing=function(){},a.scrubbing=function(){},a.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},a.initTrackListeners=function(){var e=this;Li.names.forEach(function(t){var i=Li[t],n=function(){e.trigger(t+"trackchange")},r=e[i.getterName]();r.addEventListener("removetrack",n),r.addEventListener("addtrack",n),e.on("dispose",function(){r.removeEventListener("removetrack",n),r.removeEventListener("addtrack",n)})})},a.addWebVttScript_=function(){var i=this;if(!e.default.WebVTT)if(t.default.body.contains(this.el())){if(!this.options_["vtt.js"]&&j(l.default)&&Object.keys(l.default).length>0)return void this.trigger("vttjsloaded");var n=t.default.createElement("script");n.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",n.onload=function(){i.trigger("vttjsloaded")},n.onerror=function(){i.trigger("vttjserror")},this.on("dispose",function(){n.onload=null,n.onerror=null}),e.default.WebVTT=!0,this.el().parentNode.appendChild(n)}else this.ready(this.addWebVttScript_)},a.emulateTextTracks=function(){var e=this,t=this.textTracks(),i=this.remoteTextTracks(),n=function(e){return t.addTrack(e.track)},r=function(e){return t.removeTrack(e.track)};i.on("addtrack",n),i.on("removetrack",r),this.addWebVttScript_();var a=function(){return e.trigger("texttrackchange")},s=function(){a();for(var e=0;e<t.length;e++){var i=t[e];i.removeEventListener("cuechange",a),"showing"===i.mode&&i.addEventListener("cuechange",a)}};s(),t.addEventListener("change",s),t.addEventListener("addtrack",s),t.addEventListener("removetrack",s),this.on("dispose",function(){i.off("addtrack",n),i.off("removetrack",r),t.removeEventListener("change",s),t.removeEventListener("addtrack",s),t.removeEventListener("removetrack",s);for(var e=0;e<t.length;e++){t[e].removeEventListener("cuechange",a)}})},a.addTextTrack=function(e,t,i){if(!e)throw new Error("TextTrack kind is required but was not provided");return Di(this,e,t,i)},a.createRemoteTextTrack=function(e){var t=Mt(e,{tech:this});return new Ai.remoteTextEl.TrackClass(t)},a.addRemoteTextTrack=function(e,t){var i=this;void 0===e&&(e={});var n=this.createRemoteTextTrack(e);return!0!==t&&!1!==t&&(O.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),t=!0),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!0!==t&&this.ready(function(){return i.autoRemoteTextTracks_.addTrack(n.track)}),n},a.removeRemoteTextTrack=function(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},a.getVideoPlaybackQuality=function(){return{}},a.requestPictureInPicture=function(){var t=this.options_.Promise||e.default.Promise;if(t)return t.reject()},a.disablePictureInPicture=function(){return!0},a.setDisablePictureInPicture=function(){},a.setPoster=function(){},a.playsinline=function(){},a.setPlaysinline=function(){},a.overrideNativeAudioTracks=function(){},a.overrideNativeVideoTracks=function(){},a.canPlayType=function(){return""},n.canPlayType=function(){return""},n.canPlaySource=function(e,t){return n.canPlayType(e.type)},n.isTech=function(e){return e.prototype instanceof n||e instanceof n||e===n},n.registerTech=function(e,t){if(n.techs_||(n.techs_={}),!n.isTech(t))throw new Error("Tech "+e+" must be a Tech");if(!n.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!n.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=Ot(e),n.techs_[e]=t,n.techs_[At(e)]=t,"Tech"!==e&&n.defaultTechOrder_.push(e),t},n.getTech=function(t){if(t)return n.techs_&&n.techs_[t]?n.techs_[t]:(t=Ot(t),e.default&&e.default.videojs&&e.default.videojs[t]?(O.warn("The "+t+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),e.default.videojs[t]):void 0)},n}(Nt);Oi.names.forEach(function(e){var t=Oi[e];Mi.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),Mi.prototype.featuresVolumeControl=!0,Mi.prototype.featuresMuteControl=!0,Mi.prototype.featuresFullscreenResize=!1,Mi.prototype.featuresPlaybackRate=!1,Mi.prototype.featuresProgressEvents=!1,Mi.prototype.featuresSourceset=!1,Mi.prototype.featuresTimeupdateEvents=!1,Mi.prototype.featuresNativeTextTracks=!1,Mi.withSourceHandlers=function(e){e.registerSourceHandler=function(t,i){var n=e.sourceHandlers;n||(n=e.sourceHandlers=[]),void 0===i&&(i=n.length),n.splice(i,0,t)},e.canPlayType=function(t){for(var i,n=e.sourceHandlers||[],r=0;r<n.length;r++)if(i=n[r].canPlayType(t))return i;return""},e.selectSourceHandler=function(t,i){for(var n=e.sourceHandlers||[],r=0;r<n.length;r++)if(n[r].canHandleSource(t,i))return n[r];return null},e.canPlaySource=function(t,i){var n=e.selectSourceHandler(t,i);return n?n.canHandleSource(t,i):""};["seekable","seeking","duration"].forEach(function(e){var t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){var i=e.selectSourceHandler(t,this.options_);i||(e.nativeSourceHandler?i=e.nativeSourceHandler:O.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),i!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=i.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},Nt.registerComponent("Tech",Mi),Mi.registerTech("Tech",Mi),Mi.defaultTechOrder_=[];var Ri={},Ui={},Bi={};function Fi(e,t){Ri[e]=Ri[e]||[],Ri[e].push(t)}function Ni(e,t,i){e.setTimeout(function(){return $i(t,Ri[t.type],i,e)},1)}function ji(e,t){e.forEach(function(e){return e.setTech&&e.setTech(t)})}function Hi(e,t,i){return e.reduceRight(Ki(i),t[i]())}function qi(e,t,i,n){return t[i](e.reduce(Ki(i),n))}function Vi(e,t,i,n){void 0===n&&(n=null);var r="call"+Ot(i),a=e.reduce(Ki(r),n),s=a===Bi,o=s?null:t[i](a);return Qi(e,i,o,s),o}var Wi={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},zi={setCurrentTime:1,setMuted:1,setVolume:1},Gi={play:1,pause:1};function Ki(e){return function(t,i){return t===Bi?Bi:i[e]?i[e](t):t}}function Qi(e,t,i,n){for(var r=e.length-1;r>=0;r--){var a=e[r];a[t]&&a[t](n,i)}}function Xi(e){Ui[e.id()]=null}function Yi(e,t){var i=Ui[e.id()],n=null;if(null==i)return n=t(e),Ui[e.id()]=[[t,n]],n;for(var r=0;r<i.length;r++){var a=i[r],s=a[0],o=a[1];s===t&&(n=o)}return null===n&&(n=t(e),i.push([t,n])),n}function $i(e,t,i,n,r,a){void 0===e&&(e={}),void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===a&&(a=!1);var s=t,o=s[0],l=s.slice(1);if("string"==typeof o)$i(e,Ri[o],i,n,r,a);else if(o){var u=Yi(n,o);if(!u.setSource)return r.push(u),$i(e,l,i,n,r,a);u.setSource(F({},e),function(t,s){if(t)return $i(e,l,i,n,r,a);r.push(u),$i(s,e.type===s.type?l:Ri[s.type],i,n,r,a)})}else l.length?$i(e,l,i,n,r,a):a?i(e,r):$i(e,Ri["*"],i,n,r,!0)}var Ji={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Zi=function(e){void 0===e&&(e="");var t=vi(e);return Ji[t.toLowerCase()]||""},en=function(e,t){if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;var i=e.cache_.sources.filter(function(e){return e.src===t});if(i.length)return i[0].type;for(var n=e.$$("source"),r=0;r<n.length;r++){var a=n[r];if(a.type&&a.src&&a.src===t)return a.type}return Zi(t)},tn=function e(t){if(Array.isArray(t)){var i=[];t.forEach(function(t){t=e(t),Array.isArray(t)?i=i.concat(t):N(t)&&i.push(t)}),t=i}else t="string"==typeof t&&t.trim()?[nn({src:t})]:N(t)&&"string"==typeof t.src&&t.src&&t.src.trim()?[nn(t)]:[];return t};function nn(e){if(!e.type){var t=Zi(e.src);t&&(e.type=t)}return e}var rn=function(e){function t(t,i,n){var r,a=Mt({createEl:!1},i);if(r=e.call(this,t,a,n)||this,i.playerOptions.sources&&0!==i.playerOptions.sources.length)t.src(i.playerOptions.sources);else for(var s=0,o=i.playerOptions.techOrder;s<o.length;s++){var l=Ot(o[s]),u=Mi.getTech(l);if(l||(u=Nt.getComponent(l)),u&&u.isSupported()){t.loadTech_(l);break}}return r}return(0,r.default)(t,e),t}(Nt);Nt.registerComponent("MediaLoader",rn);var an=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).handleMouseOver_=function(e){return n.handleMouseOver(e)},n.handleMouseOut_=function(e){return n.handleMouseOut(e)},n.handleClick_=function(e){return n.handleClick(e)},n.handleKeyDown_=function(e){return n.handleKeyDown(e)},n.emitTapEvents(),n.enable(),n}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(t,i,n){void 0===t&&(t="div"),void 0===i&&(i={}),void 0===n&&(n={}),i=F({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass(),tabIndex:0},i),"button"===t&&O.error("Creating a ClickableComponent with an HTML element of "+t+" is not supported; use a Button instead."),n=F({role:"button"},n),this.tabIndex_=i.tabIndex;var r=e.prototype.createEl.call(this,t,i,n);return this.createControlTextEl(r),r},i.dispose=function(){this.controlTextEl_=null,e.prototype.dispose.call(this)},i.createControlTextEl=function(e){return this.controlTextEl_=ge("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},i.controlText=function(e,t){if(void 0===t&&(t=this.el()),void 0===e)return this.controlText_||"Need Text";var i=this.localize(e);this.controlText_=e,ve(this.controlTextEl_,i),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",i)},i.buildCSSClass=function(){return"vjs-control vjs-button "+e.prototype.buildCSSClass.call(this)},i.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},i.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},i.handleLanguagechange=function(){this.controlText(this.controlText_)},i.handleClick=function(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},i.handleKeyDown=function(t){s.default.isEventKey(t,"Space")||s.default.isEventKey(t,"Enter")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(Nt);Nt.registerComponent("ClickableComponent",an);var sn=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).update(),n.update_=function(e){return n.update(e)},t.on("posterchange",n.update_),n}(0,r.default)(t,e);var i=t.prototype;return i.dispose=function(){this.player().off("posterchange",this.update_),e.prototype.dispose.call(this)},i.createEl=function(){return ge("div",{className:"vjs-poster",tabIndex:-1})},i.update=function(e){var t=this.player().poster();this.setSrc(t),t?this.show():this.hide()},i.setSrc=function(e){var t="";e&&(t='url("'+e+'")'),this.el_.style.backgroundImage=t},i.handleClick=function(e){if(this.player_.controls()){var t=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;!this.player_.tech(!0)||(ee||$)&&t||this.player_.tech(!0).focus(),this.player_.paused()?Qt(this.player_.play()):this.player_.pause()}},t}(an);Nt.registerComponent("PosterImage",sn);var on="#222",ln="#ccc",un={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function dn(e,t){var i;if(4===e.length)i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");i=e.slice(1)}return"rgba("+parseInt(i.slice(0,2),16)+","+parseInt(i.slice(2,4),16)+","+parseInt(i.slice(4,6),16)+","+t+")"}function cn(e,t,i){try{e.style[t]=i}catch(n){return}}var hn=function(t){function i(i,r,a){var s;s=t.call(this,i,r,a)||this;var o=function(e){return s.updateDisplay(e)};return i.on("loadstart",function(e){return s.toggleDisplay(e)}),i.on("texttrackchange",o),i.on("loadedmetadata",function(e){return s.preselectTrack(e)}),i.ready(ft((0,n.default)(s),function(){if(i.tech_&&i.tech_.featuresNativeTextTracks)this.hide();else{i.on("fullscreenchange",o),i.on("playerresize",o),e.default.addEventListener("orientationchange",o),i.on("dispose",function(){return e.default.removeEventListener("orientationchange",o)});for(var t=this.options_.playerOptions.tracks||[],n=0;n<t.length;n++)this.player_.addRemoteTextTrack(t[n],!0);this.preselectTrack()}})),s}(0,r.default)(i,t);var a=i.prototype;return a.preselectTrack=function(){for(var e,t,i,n={captions:1,subtitles:1},r=this.player_.textTracks(),a=this.player_.cache_.selectedLanguage,s=0;s<r.length;s++){var o=r[s];a&&a.enabled&&a.language&&a.language===o.language&&o.kind in n?o.kind===a.kind?i=o:i||(i=o):a&&!a.enabled?(i=null,e=null,t=null):o.default&&("descriptions"!==o.kind||e?o.kind in n&&!t&&(t=o):e=o)}i?i.mode="showing":t?t.mode="showing":e&&(e.mode="showing")},a.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},a.createEl=function(){return t.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{"aria-live":"off","aria-atomic":"true"})},a.clearDisplay=function(){"function"==typeof e.default.WebVTT&&e.default.WebVTT.processCues(e.default,[],this.el_)},a.updateDisplay=function(){var e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){for(var i=[],n=0;n<e.length;++n){var r=e[n];"showing"===r.mode&&i.push(r)}this.updateForTrack(i)}else{for(var a=null,s=null,o=e.length;o--;){var l=e[o];"showing"===l.mode&&("descriptions"===l.kind?a=l:s=l)}s?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(s)):a&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(a))}},a.updateDisplayState=function(t){for(var i=this.player_.textTrackSettings.getValues(),n=t.activeCues,r=n.length;r--;){var a=n[r];if(a){var s=a.displayState;if(i.color&&(s.firstChild.style.color=i.color),i.textOpacity&&cn(s.firstChild,"color",dn(i.color||"#fff",i.textOpacity)),i.backgroundColor&&(s.firstChild.style.backgroundColor=i.backgroundColor),i.backgroundOpacity&&cn(s.firstChild,"backgroundColor",dn(i.backgroundColor||"#000",i.backgroundOpacity)),i.windowColor&&(i.windowOpacity?cn(s,"backgroundColor",dn(i.windowColor,i.windowOpacity)):s.style.backgroundColor=i.windowColor),i.edgeStyle&&("dropshadow"===i.edgeStyle?s.firstChild.style.textShadow="2px 2px 3px "+on+", 2px 2px 4px "+on+", 2px 2px 5px "+on:"raised"===i.edgeStyle?s.firstChild.style.textShadow="1px 1px "+on+", 2px 2px "+on+", 3px 3px "+on:"depressed"===i.edgeStyle?s.firstChild.style.textShadow="1px 1px "+ln+", 0 1px "+ln+", -1px -1px "+on+", 0 -1px "+on:"uniform"===i.edgeStyle&&(s.firstChild.style.textShadow="0 0 4px "+on+", 0 0 4px "+on+", 0 0 4px "+on+", 0 0 4px "+on)),i.fontPercent&&1!==i.fontPercent){var o=e.default.parseFloat(s.style.fontSize);s.style.fontSize=o*i.fontPercent+"px",s.style.height="auto",s.style.top="auto"}i.fontFamily&&"default"!==i.fontFamily&&("small-caps"===i.fontFamily?s.firstChild.style.fontVariant="small-caps":s.firstChild.style.fontFamily=un[i.fontFamily])}}},a.updateForTrack=function(t){if(Array.isArray(t)||(t=[t]),"function"==typeof e.default.WebVTT&&!t.every(function(e){return!e.activeCues})){for(var i=[],n=0;n<t.length;++n)for(var r=t[n],a=0;a<r.activeCues.length;++a)i.push(r.activeCues[a]);e.default.WebVTT.processCues(e.default,i,this.el_);for(var s=0;s<t.length;++s){for(var o=t[s],l=0;l<o.activeCues.length;++l){var u=o.activeCues[l].displayState;Te(u,"vjs-text-track-cue"),Te(u,"vjs-text-track-cue-"+(o.language?o.language:s))}this.player_.textTrackSettings&&this.updateDisplayState(o)}}},i}(Nt);Nt.registerComponent("TextTrackDisplay",hn);var pn=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.default)(t,e),t.prototype.createEl=function(){var t=this.player_.isAudio(),i=this.localize(t?"Audio Player":"Video Player"),n=ge("span",{className:"vjs-control-text",innerHTML:this.localize("{1} is loading.",[i])}),r=e.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(n),r},t}(Nt);Nt.registerComponent("LoadingSpinner",pn);var fn=function(e){function t(){return e.apply(this,arguments)||this}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(e,t,i){void 0===t&&(t={}),void 0===i&&(i={}),t=F({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass()},t),i=F({type:"button"},i);var n=Nt.prototype.createEl.call(this,"button",t,i);return this.createControlTextEl(n),n},i.addChild=function(e,t){void 0===t&&(t={});var i=this.constructor.name;return O.warn("Adding an actionable (user controllable) child to a Button ("+i+") is not supported; use a ClickableComponent instead."),Nt.prototype.addChild.call(this,e,t)},i.enable=function(){e.prototype.enable.call(this),this.el_.removeAttribute("disabled")},i.disable=function(){e.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},i.handleKeyDown=function(t){s.default.isEventKey(t,"Space")||s.default.isEventKey(t,"Enter")?t.stopPropagation():e.prototype.handleKeyDown.call(this,t)},t}(an);Nt.registerComponent("Button",fn);var mn=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).mouseused_=!1,n.on("mousedown",function(e){return n.handleMouseDown(e)}),n}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-big-play-button"},i.handleClick=function(e){var t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){var i=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;return Qt(t),void(!this.player_.tech(!0)||(ee||$)&&i||this.player_.tech(!0).focus())}var n=this.player_.getChild("controlBar"),r=n&&n.getChild("playToggle");if(r){var a=function(){return r.focus()};Kt(t)?t.then(a,function(){}):this.setTimeout(a,1)}else this.player_.tech(!0).focus()},i.handleKeyDown=function(t){this.mouseused_=!1,e.prototype.handleKeyDown.call(this,t)},i.handleMouseDown=function(e){this.mouseused_=!0},t}(fn);mn.prototype.controlText_="Play Video",Nt.registerComponent("BigPlayButton",mn);var gn=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).controlText(i&&i.controlText||n.localize("Close")),n}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-close-button "+e.prototype.buildCSSClass.call(this)},i.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},i.handleKeyDown=function(t){s.default.isEventKey(t,"Esc")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(fn);Nt.registerComponent("CloseButton",gn);var vn=function(e){function t(t,i){var n;return void 0===i&&(i={}),n=e.call(this,t,i)||this,i.replay=void 0===i.replay||i.replay,n.on(t,"play",function(e){return n.handlePlay(e)}),n.on(t,"pause",function(e){return n.handlePause(e)}),i.replay&&n.on(t,"ended",function(e){return n.handleEnded(e)}),n}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-play-control "+e.prototype.buildCSSClass.call(this)},i.handleClick=function(e){this.player_.paused()?Qt(this.player_.play()):this.player_.pause()},i.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},i.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},i.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},i.handleEnded=function(e){var t=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(e){return t.handleSeeked(e)})},t}(fn);vn.prototype.controlText_="Play",Nt.registerComponent("PlayToggle",vn);var _n=function(e,t){e=e<0?0:e;var i=Math.floor(e%60),n=Math.floor(e/60%60),r=Math.floor(e/3600),a=Math.floor(t/60%60),s=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=n=i="-"),(r=r>0||s>0?r+":":"")+(n=((r||a>=10)&&n<10?"0"+n:n)+":")+(i=i<10?"0"+i:i)},yn=_n;function Tn(e){yn=e}function bn(){yn=_n}function Sn(e,t){return void 0===t&&(t=e),yn(e,t)}var kn=function(e){function i(t,i){var n;return(n=e.call(this,t,i)||this).on(t,["timeupdate","ended"],function(e){return n.updateContent(e)}),n.updateTextNode_(),n}(0,r.default)(i,e);var n=i.prototype;return n.createEl=function(){var t=this.buildCSSClass(),i=e.prototype.createEl.call(this,"div",{className:t+" vjs-time-control vjs-control",innerHTML:'<span class="vjs-control-text" role="presentation">'+this.localize(this.labelText_)+" </span>"});return this.contentEl_=ge("span",{className:t+"-display"},{"aria-live":"off",role:"presentation"}),i.appendChild(this.contentEl_),i},n.dispose=function(){this.contentEl_=null,this.textNode_=null,e.prototype.dispose.call(this)},n.updateTextNode_=function(e){var i=this;void 0===e&&(e=0),e=Sn(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(i.contentEl_){var e=i.textNode_;e&&i.contentEl_.firstChild!==e&&(e=null,O.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),i.textNode_=t.default.createTextNode(i.formattedTime_),i.textNode_&&(e?i.contentEl_.replaceChild(i.textNode_,e):i.contentEl_.appendChild(i.textNode_))}}))},n.updateContent=function(e){},i}(Nt);kn.prototype.labelText_="Time",kn.prototype.controlText_="Time",Nt.registerComponent("TimeDisplay",kn);var Cn=function(e){function t(){return e.apply(this,arguments)||this}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-current-time"},i.updateContent=function(e){var t;t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)},t}(kn);Cn.prototype.labelText_="Current Time",Cn.prototype.controlText_="Current Time",Nt.registerComponent("CurrentTimeDisplay",Cn);var En=function(e){function t(t,i){var n,r=function(e){return n.updateContent(e)};return(n=e.call(this,t,i)||this).on(t,"durationchange",r),n.on(t,"loadstart",r),n.on(t,"loadedmetadata",r),n}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-duration"},i.updateContent=function(e){var t=this.player_.duration();this.updateTextNode_(t)},t}(kn);En.prototype.labelText_="Duration",En.prototype.controlText_="Duration",Nt.registerComponent("DurationDisplay",En);var wn=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.default)(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider",innerHTML:"<div><span>/</span></div>"},{"aria-hidden":!0})},t}(Nt);Nt.registerComponent("TimeDivider",wn);var In=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on(t,"durationchange",function(e){return n.updateContent(e)}),n}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-remaining-time"},i.createEl=function(){var t=e.prototype.createEl.call(this);return t.insertBefore(ge("span",{},{"aria-hidden":!0},"-"),this.contentEl_),t},i.updateContent=function(e){var t;"number"==typeof this.player_.duration()&&(t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t))},t}(kn);In.prototype.labelText_="Remaining Time",In.prototype.controlText_="Remaining Time",Nt.registerComponent("RemainingTimeDisplay",In);var xn=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).updateShowing(),n.on(n.player(),"durationchange",function(e){return n.updateShowing(e)}),n}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=ge("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+" </span>"+this.localize("LIVE")},{"aria-live":"off"}),t.appendChild(this.contentEl_),t},i.dispose=function(){this.contentEl_=null,e.prototype.dispose.call(this)},i.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},t}(Nt);Nt.registerComponent("LiveDisplay",xn);var Pn=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).updateLiveEdgeStatus(),n.player_.liveTracker&&(n.updateLiveEdgeStatusHandler_=function(e){return n.updateLiveEdgeStatus(e)},n.on(n.player_.liveTracker,"liveedgechange",n.updateLiveEdgeStatusHandler_)),n}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){var t=e.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=ge("span",{className:"vjs-seek-to-live-text",innerHTML:this.localize("LIVE")},{"aria-hidden":"true"}),t.appendChild(this.textEl_),t},i.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},i.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},i.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,e.prototype.dispose.call(this)},t}(fn);Pn.prototype.controlText_="Seek to live, currently playing live",Nt.registerComponent("SeekToLive",Pn);var Ln=function(e,t,i){return e=Number(e),Math.min(i,Math.max(t,isNaN(e)?t:e))},An=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).handleMouseDown_=function(e){return n.handleMouseDown(e)},n.handleMouseUp_=function(e){return n.handleMouseUp(e)},n.handleKeyDown_=function(e){return n.handleKeyDown(e)},n.handleClick_=function(e){return n.handleClick(e)},n.handleMouseMove_=function(e){return n.handleMouseMove(e)},n.update_=function(e){return n.update(e)},n.bar=n.getChild(n.options_.barName),n.vertical(!!n.options_.vertical),n.enable(),n}(0,r.default)(t,e);var i=t.prototype;return i.enabled=function(){return this.enabled_},i.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},i.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},i.createEl=function(t,i,n){return void 0===i&&(i={}),void 0===n&&(n={}),i.className=i.className+" vjs-slider",i=F({tabIndex:0},i),n=F({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},n),e.prototype.createEl.call(this,t,i,n)},i.handleMouseDown=function(e){var t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||J||e.preventDefault(),xe(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e)},i.handleMouseMove=function(e){},i.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;Pe(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.update()},i.update=function(){var e=this;if(this.el_&&this.bar){var t=this.getProgress();return t===this.progress_?t:(this.progress_=t,this.requestNamedAnimationFrame("Slider#update",function(){var i=e.vertical()?"height":"width";e.bar.el().style[i]=(100*t).toFixed(2)+"%"}),t)}},i.getProgress=function(){return Number(Ln(this.getPercent(),0,1).toFixed(4))},i.calculateDistance=function(e){var t=Oe(this.el_,e);return this.vertical()?t.y:t.x},i.handleKeyDown=function(t){s.default.isEventKey(t,"Left")||s.default.isEventKey(t,"Down")?(t.preventDefault(),t.stopPropagation(),this.stepBack()):s.default.isEventKey(t,"Right")||s.default.isEventKey(t,"Up")?(t.preventDefault(),t.stopPropagation(),this.stepForward()):e.prototype.handleKeyDown.call(this,t)},i.handleClick=function(e){e.stopPropagation(),e.preventDefault()},i.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},t}(Nt);Nt.registerComponent("Slider",An);var On=function(e,t){return Ln(e/t*100,0,100).toFixed(2)+"%"},Dn=function(e){function i(t,i){var n;return(n=e.call(this,t,i)||this).partEls_=[],n.on(t,"progress",function(e){return n.update(e)}),n}(0,r.default)(i,e);var n=i.prototype;return n.createEl=function(){var i=e.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),n=ge("span",{className:"vjs-control-text"}),r=ge("span",{textContent:this.localize("Loaded")}),a=t.default.createTextNode(": ");return this.percentageEl_=ge("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),i.appendChild(n),n.appendChild(r),n.appendChild(a),n.appendChild(this.percentageEl_),i},n.dispose=function(){this.partEls_=null,this.percentageEl_=null,e.prototype.dispose.call(this)},n.update=function(e){var t=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var e=t.player_.liveTracker,i=t.player_.buffered(),n=e&&e.isLive()?e.seekableEnd():t.player_.duration(),r=t.player_.bufferedEnd(),a=t.partEls_,s=On(r,n);t.percent_!==s&&(t.el_.style.width=s,ve(t.percentageEl_,s),t.percent_=s);for(var o=0;o<i.length;o++){var l=i.start(o),u=i.end(o),d=a[o];d||(d=t.el_.appendChild(ge()),a[o]=d),d.dataset.start===l&&d.dataset.end===u||(d.dataset.start=l,d.dataset.end=u,d.style.left=On(l,r),d.style.width=On(u-l,r))}for(var c=a.length;c>i.length;c--)t.el_.removeChild(a[c-1]);a.length=i.length})},i}(Nt);Nt.registerComponent("LoadProgressBar",Dn);var Mn=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).update=mt(ft((0,n.default)(r),r.update),pt),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},i.update=function(e,t,i){var n=Ae(this.el_),r=Le(this.player_.el()),a=e.width*t;if(r&&n){var s=e.left-r.left+a,o=e.width-a+(r.right-e.right),l=n.width/2;s<l?l+=l-s:o<l&&(l=o),l<0?l=0:l>n.width&&(l=n.width),l=Math.round(l),this.el_.style.right="-"+l+"px",this.write(i)}},i.write=function(e){ve(this.el_,e)},i.updateTime=function(e,t,i,n){var r=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var a,s=r.player_.duration();if(r.player_.liveTracker&&r.player_.liveTracker.isLive()){var o=r.player_.liveTracker.liveWindow(),l=o-t*o;a=(l<1?"":"-")+Sn(l,o)}else a=Sn(i,s);r.update(e,t,a),n&&n()})},t}(Nt);Nt.registerComponent("TimeTooltip",Mn);var Rn=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).update=mt(ft((0,n.default)(r),r.update),pt),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},i.update=function(e,t){var i=this.getChild("timeTooltip");if(i){var n=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();i.updateTime(e,t,n)}},t}(Nt);Rn.prototype.options_={children:[]},se||K||Rn.prototype.options_.children.push("timeTooltip"),Nt.registerComponent("PlayProgressBar",Rn);var Un=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).update=mt(ft((0,n.default)(r),r.update),pt),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},i.update=function(e,t){var i=this,n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,function(){i.el_.style.left=e.width*t+"px"})},t}(Nt);Un.prototype.options_={children:["timeTooltip"]},Nt.registerComponent("MouseTimeDisplay",Un);var Bn=5,Fn=12,Nn=function(e){function i(t,i){var n;return(n=e.call(this,t,i)||this).setEventHandlers_(),n}(0,r.default)(i,e);var n=i.prototype;return n.setEventHandlers_=function(){var e=this;this.update_=ft(this,this.update),this.update=mt(this.update_,pt),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(t){return e.enableInterval_(t)},this.disableIntervalHandler_=function(t){return e.disableInterval_(t)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in t.default&&"visibilityState"in t.default&&this.on(t.default,"visibilitychange",this.toggleVisibility_)},n.toggleVisibility_=function(e){"hidden"===t.default.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())},n.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,pt))},n.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},n.update=function(i){var n=this;if("hidden"!==t.default.visibilityState){var r=e.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var e=n.player_.ended()?n.player_.duration():n.getCurrentTime_(),t=n.player_.liveTracker,i=n.player_.duration();t&&t.isLive()&&(i=n.player_.liveTracker.liveCurrentTime()),n.percent_!==r&&(n.el_.setAttribute("aria-valuenow",(100*r).toFixed(2)),n.percent_=r),n.currentTime_===e&&n.duration_===i||(n.el_.setAttribute("aria-valuetext",n.localize("progress bar timing: currentTime={1} duration={2}",[Sn(e,i),Sn(i,i)],"{1} of {2}")),n.currentTime_=e,n.duration_=i),n.bar&&n.bar.update(Le(n.el()),n.getProgress())}),r}},n.userSeek_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)},n.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},n.getPercent=function(){var e,t=this.getCurrentTime_(),i=this.player_.liveTracker;return i&&i.isLive()?(e=(t-i.seekableStart())/i.liveWindow(),i.atLiveEdge()&&(e=1)):e=t/this.player_.duration(),e},n.handleMouseDown=function(t){Fe(t)&&(t.stopPropagation(),this.player_.scrubbing(!0),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),e.prototype.handleMouseDown.call(this,t))},n.handleMouseMove=function(e){if(Fe(e)){var t,i=this.calculateDistance(e),n=this.player_.liveTracker;if(n&&n.isLive()){if(i>=.99)return void n.seekToLiveEdge();var r=n.seekableStart(),a=n.liveCurrentTime();if((t=r+i*n.liveWindow())>=a&&(t=a),t<=r&&(t=r+.1),t===1/0)return}else(t=i*this.player_.duration())===this.player_.duration()&&(t-=.1);this.userSeek_(t)}},n.enable=function(){e.prototype.enable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.show()},n.disable=function(){e.prototype.disable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.hide()},n.handleMouseUp=function(t){e.prototype.handleMouseUp.call(this,t),t&&t.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Qt(this.player_.play()):this.update_()},n.stepForward=function(){this.userSeek_(this.player_.currentTime()+Bn)},n.stepBack=function(){this.userSeek_(this.player_.currentTime()-Bn)},n.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},n.handleKeyDown=function(t){var i=this.player_.liveTracker;if(s.default.isEventKey(t,"Space")||s.default.isEventKey(t,"Enter"))t.preventDefault(),t.stopPropagation(),this.handleAction(t);else if(s.default.isEventKey(t,"Home"))t.preventDefault(),t.stopPropagation(),this.userSeek_(0);else if(s.default.isEventKey(t,"End"))t.preventDefault(),t.stopPropagation(),i&&i.isLive()?this.userSeek_(i.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test((0,s.default)(t))){t.preventDefault(),t.stopPropagation();var n=10*(s.default.codes[(0,s.default)(t)]-s.default.codes[0])/100;i&&i.isLive()?this.userSeek_(i.seekableStart()+i.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else s.default.isEventKey(t,"PgDn")?(t.preventDefault(),t.stopPropagation(),this.userSeek_(this.player_.currentTime()-Bn*Fn)):s.default.isEventKey(t,"PgUp")?(t.preventDefault(),t.stopPropagation(),this.userSeek_(this.player_.currentTime()+Bn*Fn)):e.prototype.handleKeyDown.call(this,t)},n.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in t.default&&"visibilityState"in t.default&&this.off(t.default,"visibilitychange",this.toggleVisibility_),e.prototype.dispose.call(this)},i}(An);Nn.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},se||K||Nn.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),Nt.registerComponent("SeekBar",Nn);var jn=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).handleMouseMove=mt(ft((0,n.default)(r),r.handleMouseMove),pt),r.throttledHandleMouseSeek=mt(ft((0,n.default)(r),r.handleMouseSeek),pt),r.handleMouseUpHandler_=function(e){return r.handleMouseUp(e)},r.handleMouseDownHandler_=function(e){return r.handleMouseDown(e)},r.enable(),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},i.handleMouseMove=function(e){var t=this.getChild("seekBar");if(t){var i=t.getChild("playProgressBar"),n=t.getChild("mouseTimeDisplay");if(i||n){var r=t.el(),a=Ae(r),s=Oe(r,e).x;s=Ln(s,0,1),n&&n.update(a,s),i&&i.update(a,t.getProgress())}}},i.handleMouseSeek=function(e){var t=this.getChild("seekBar");t&&t.handleMouseMove(e)},i.enabled=function(){return this.enabled_},i.disable=function(){if(this.children().forEach(function(e){return e.disable&&e.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&Qt(this.player_.play())}},i.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},i.removeListenersAddedOnMousedownAndTouchstart=function(){var e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)},i.handleMouseDown=function(e){var t=this.el_.ownerDocument,i=this.getChild("seekBar");i&&i.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseUp=function(e){var t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()},t}(Nt);jn.prototype.options_={children:["seekBar"]},Nt.registerComponent("ProgressControl",jn);var Hn=function(e){function i(t,i){var n;return(n=e.call(this,t,i)||this).on(t,["enterpictureinpicture","leavepictureinpicture"],function(e){return n.handlePictureInPictureChange(e)}),n.on(t,["disablepictureinpicturechanged","loadedmetadata"],function(e){return n.handlePictureInPictureEnabledChange(e)}),n.disable(),n}(0,r.default)(i,e);var n=i.prototype;return n.buildCSSClass=function(){return"vjs-picture-in-picture-control "+e.prototype.buildCSSClass.call(this)},n.handlePictureInPictureEnabledChange=function(){t.default.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},n.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},n.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},i}(fn);Hn.prototype.controlText_="Picture-in-Picture",Nt.registerComponent("PictureInPictureToggle",Hn);var qn=function(e){function i(i,n){var r;return(r=e.call(this,i,n)||this).on(i,"fullscreenchange",function(e){return r.handleFullscreenChange(e)}),!1===t.default[i.fsApi_.fullscreenEnabled]&&r.disable(),r}(0,r.default)(i,e);var n=i.prototype;return n.buildCSSClass=function(){return"vjs-fullscreen-control "+e.prototype.buildCSSClass.call(this)},n.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},n.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},i}(fn);qn.prototype.controlText_="Fullscreen",Nt.registerComponent("FullscreenToggle",qn);var Vn=function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})},Wn=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.default)(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})},t}(Nt);Nt.registerComponent("VolumeLevel",Wn);var zn=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).update=mt(ft((0,n.default)(r),r.update),pt),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},i.update=function(e,t,i,n){if(!i){var r=Le(this.el_),a=Le(this.player_.el()),s=e.width*t;if(!a||!r)return;var o=e.left-a.left+s,l=e.width-s+(a.right-e.right),u=r.width/2;o<u?u+=u-o:l<u&&(u=l),u<0?u=0:u>r.width&&(u=r.width),this.el_.style.right="-"+u+"px"}this.write(n+"%")},i.write=function(e){ve(this.el_,e)},i.updateVolume=function(e,t,i,n,r){var a=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){a.update(e,t,i,n.toFixed(0)),r&&r()})},t}(Nt);Nt.registerComponent("VolumeLevelTooltip",zn);var Gn=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).update=mt(ft((0,n.default)(r),r.update),pt),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},i.update=function(e,t,i){var n=this,r=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,i,r,function(){i?n.el_.style.bottom=e.height*t+"px":n.el_.style.left=e.width*t+"px"})},t}(Nt);Gn.prototype.options_={children:["volumeLevelTooltip"]},Nt.registerComponent("MouseVolumeLevelDisplay",Gn);var Kn=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on("slideractive",function(e){return n.updateLastVolume_(e)}),n.on(t,"volumechange",function(e){return n.updateARIAAttributes(e)}),t.ready(function(){return n.updateARIAAttributes()}),n}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},i.handleMouseDown=function(t){Fe(t)&&e.prototype.handleMouseDown.call(this,t)},i.handleMouseMove=function(e){var t=this.getChild("mouseVolumeLevelDisplay");if(t){var i=this.el(),n=Le(i),r=this.vertical(),a=Oe(i,e);a=r?a.y:a.x,a=Ln(a,0,1),t.update(n,a,r)}Fe(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},i.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},i.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},i.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},i.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},i.updateARIAAttributes=function(e){var t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")},i.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},i.updateLastVolume_=function(){var e=this,t=this.player_.volume();this.one("sliderinactive",function(){0===e.player_.volume()&&e.player_.lastVolume_(t)})},t}(An);Kn.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},se||K||Kn.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),Kn.prototype.playerEvent="volumechange",Nt.registerComponent("VolumeBar",Kn);var Qn=function(e){function t(t,i){var r;return void 0===i&&(i={}),i.vertical=i.vertical||!1,(void 0===i.volumeBar||j(i.volumeBar))&&(i.volumeBar=i.volumeBar||{},i.volumeBar.vertical=i.vertical),r=e.call(this,t,i)||this,Vn((0,n.default)(r),t),r.throttledHandleMouseMove=mt(ft((0,n.default)(r),r.handleMouseMove),pt),r.handleMouseUpHandler_=function(e){return r.handleMouseUp(e)},r.on("mousedown",function(e){return r.handleMouseDown(e)}),r.on("touchstart",function(e){return r.handleMouseDown(e)}),r.on("mousemove",function(e){return r.handleMouseMove(e)}),r.on(r.volumeBar,["focus","slideractive"],function(){r.volumeBar.addClass("vjs-slider-active"),r.addClass("vjs-slider-active"),r.trigger("slideractive")}),r.on(r.volumeBar,["blur","sliderinactive"],function(){r.volumeBar.removeClass("vjs-slider-active"),r.removeClass("vjs-slider-active"),r.trigger("sliderinactive")}),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){var t="vjs-volume-horizontal";return this.options_.vertical&&(t="vjs-volume-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+t})},i.handleMouseDown=function(e){var t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseUp=function(e){var t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},t}(Nt);Qn.prototype.options_={children:["volumeBar"]},Nt.registerComponent("VolumeControl",Qn);var Xn=function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})},Yn=function(e){function t(t,i){var r;return r=e.call(this,t,i)||this,Xn((0,n.default)(r),t),r.on(t,["loadstart","volumechange"],function(e){return r.update(e)}),r}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-mute-control "+e.prototype.buildCSSClass.call(this)},i.handleClick=function(e){var t=this.player_.volume(),i=this.player_.lastVolume_();if(0===t){var n=i<.1?.1:i;this.player_.volume(n),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},i.update=function(e){this.updateIcon_(),this.updateControlText_()},i.updateIcon_=function(){var e=this.player_.volume(),t=3;se&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2);for(var i=0;i<4;i++)be(this.el_,"vjs-vol-"+i);Te(this.el_,"vjs-vol-"+t)},i.updateControlText_=function(){var e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)},t}(fn);Yn.prototype.controlText_="Mute",Nt.registerComponent("MuteToggle",Yn);var $n=function(e){function i(t,i){var n;return void 0===i&&(i={}),void 0!==i.inline?i.inline=i.inline:i.inline=!0,(void 0===i.volumeControl||j(i.volumeControl))&&(i.volumeControl=i.volumeControl||{},i.volumeControl.vertical=!i.inline),(n=e.call(this,t,i)||this).handleKeyPressHandler_=function(e){return n.handleKeyPress(e)},n.on(t,["loadstart"],function(e){return n.volumePanelState_(e)}),n.on(n.muteToggle,"keyup",function(e){return n.handleKeyPress(e)}),n.on(n.volumeControl,"keyup",function(e){return n.handleVolumeControlKeyUp(e)}),n.on("keydown",function(e){return n.handleKeyPress(e)}),n.on("mouseover",function(e){return n.handleMouseOver(e)}),n.on("mouseout",function(e){return n.handleMouseOut(e)}),n.on(n.volumeControl,["slideractive"],n.sliderActive_),n.on(n.volumeControl,["sliderinactive"],n.sliderInactive_),n}(0,r.default)(i,e);var n=i.prototype;return n.sliderActive_=function(){this.addClass("vjs-slider-active")},n.sliderInactive_=function(){this.removeClass("vjs-slider-active")},n.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},n.createEl=function(){var t="vjs-volume-panel-horizontal";return this.options_.inline||(t="vjs-volume-panel-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+t})},n.dispose=function(){this.handleMouseOut(),e.prototype.dispose.call(this)},n.handleVolumeControlKeyUp=function(e){s.default.isEventKey(e,"Esc")&&this.muteToggle.focus()},n.handleMouseOver=function(e){this.addClass("vjs-hover"),st(t.default,"keyup",this.handleKeyPressHandler_)},n.handleMouseOut=function(e){this.removeClass("vjs-hover"),ot(t.default,"keyup",this.handleKeyPressHandler_)},n.handleKeyPress=function(e){s.default.isEventKey(e,"Esc")&&this.handleMouseOut()},i}(Nt);$n.prototype.options_={children:["muteToggle","volumeControl"]},Nt.registerComponent("VolumePanel",$n);var Jn=function(e){function i(t,i){var n;return n=e.call(this,t,i)||this,i&&(n.menuButton_=i.menuButton),n.focusedChild_=-1,n.on("keydown",function(e){return n.handleKeyDown(e)}),n.boundHandleBlur_=function(e){return n.handleBlur(e)},n.boundHandleTapClick_=function(e){return n.handleTapClick(e)},n}(0,r.default)(i,e);var n=i.prototype;return n.addEventListenerForItem=function(e){e instanceof Nt&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))},n.removeEventListenerForItem=function(e){e instanceof Nt&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))},n.removeChild=function(t){"string"==typeof t&&(t=this.getChild(t)),this.removeEventListenerForItem(t),e.prototype.removeChild.call(this,t)},n.addItem=function(e){var t=this.addChild(e);t&&this.addEventListenerForItem(t)},n.createEl=function(){var t=this.options_.contentElType||"ul";this.contentEl_=ge(t,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var i=e.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return i.appendChild(this.contentEl_),st(i,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),i},n.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,e.prototype.dispose.call(this)},n.handleBlur=function(e){var i=e.relatedTarget||t.default.activeElement;if(!this.children().some(function(e){return e.el()===i})){var n=this.menuButton_;n&&n.buttonPressed_&&i!==n.el().firstChild&&n.unpressButton()}},n.handleTapClick=function(e){if(this.menuButton_){this.menuButton_.unpressButton();var t=this.children();if(!Array.isArray(t))return;var i=t.filter(function(t){return t.el()===e.target})[0];if(!i)return;"CaptionSettingsMenuItem"!==i.name()&&this.menuButton_.focus()}},n.handleKeyDown=function(e){s.default.isEventKey(e,"Left")||s.default.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(s.default.isEventKey(e,"Right")||s.default.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},n.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},n.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},n.focus=function(e){void 0===e&&(e=0);var t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())},i}(Nt);Nt.registerComponent("Menu",Jn);var Zn=function(e){function i(i,n){var r;void 0===n&&(n={}),(r=e.call(this,i,n)||this).menuButton_=new fn(i,n),r.menuButton_.controlText(r.controlText_),r.menuButton_.el_.setAttribute("aria-haspopup","true");var a=fn.prototype.buildCSSClass();r.menuButton_.el_.className=r.buildCSSClass()+" "+a,r.menuButton_.removeClass("vjs-control"),r.addChild(r.menuButton_),r.update(),r.enabled_=!0;var s=function(e){return r.handleClick(e)};return r.handleMenuKeyUp_=function(e){return r.handleMenuKeyUp(e)},r.on(r.menuButton_,"tap",s),r.on(r.menuButton_,"click",s),r.on(r.menuButton_,"keydown",function(e){return r.handleKeyDown(e)}),r.on(r.menuButton_,"mouseenter",function(){r.addClass("vjs-hover"),r.menu.show(),st(t.default,"keyup",r.handleMenuKeyUp_)}),r.on("mouseleave",function(e){return r.handleMouseLeave(e)}),r.on("keydown",function(e){return r.handleSubmenuKeyDown(e)}),r}(0,r.default)(i,e);var n=i.prototype;return n.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?this.hide():this.show()},n.createMenu=function(){var e=new Jn(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var t=ge("li",{className:"vjs-menu-title",innerHTML:Ot(this.options_.title),tabIndex:-1}),i=new Nt(this.player_,{el:t});e.addItem(i)}if(this.items=this.createItems(),this.items)for(var n=0;n<this.items.length;n++)e.addItem(this.items[n]);return e},n.createItems=function(){},n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},n.buildWrapperCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+fn.prototype.buildCSSClass()+" "+e.prototype.buildCSSClass.call(this)},n.buildCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+e.prototype.buildCSSClass.call(this)},n.controlText=function(e,t){return void 0===t&&(t=this.menuButton_.el()),this.menuButton_.controlText(e,t)},n.dispose=function(){this.handleMouseLeave(),e.prototype.dispose.call(this)},n.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},n.handleMouseLeave=function(e){this.removeClass("vjs-hover"),ot(t.default,"keyup",this.handleMenuKeyUp_)},n.focus=function(){this.menuButton_.focus()},n.blur=function(){this.menuButton_.blur()},n.handleKeyDown=function(e){s.default.isEventKey(e,"Esc")||s.default.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),s.default.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(s.default.isEventKey(e,"Up")||s.default.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},n.handleMenuKeyUp=function(e){(s.default.isEventKey(e,"Esc")||s.default.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")},n.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},n.handleSubmenuKeyDown=function(e){(s.default.isEventKey(e,"Esc")||s.default.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),s.default.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))},n.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),se&&fe())return;this.menu.focus()}},n.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},n.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},n.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},i}(Nt);Nt.registerComponent("MenuButton",Zn);var er=function(e){function t(t,i){var r,a=i.tracks;if((r=e.call(this,t,i)||this).items.length<=1&&r.hide(),!a)return(0,n.default)(r);var s=ft((0,n.default)(r),r.update);return a.addEventListener("removetrack",s),a.addEventListener("addtrack",s),a.addEventListener("labelchange",s),r.player_.on("ready",s),r.player_.on("dispose",function(){a.removeEventListener("removetrack",s),a.removeEventListener("addtrack",s),a.removeEventListener("labelchange",s)}),r}return(0,r.default)(t,e),t}(Zn);Nt.registerComponent("TrackButton",er);var tr=["Tab","Esc","Up","Down","Right","Left"],ir=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).selectable=i.selectable,n.isSelected_=i.selected||!1,n.multiSelectable=i.multiSelectable,n.selected(n.isSelected_),n.selectable?n.multiSelectable?n.el_.setAttribute("role","menuitemcheckbox"):n.el_.setAttribute("role","menuitemradio"):n.el_.setAttribute("role","menuitem"),n}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(t,i,n){return this.nonIconControl=!0,e.prototype.createEl.call(this,"li",F({className:"vjs-menu-item",innerHTML:'<span class="vjs-menu-item-text">'+this.localize(this.options_.label)+"</span>",tabIndex:-1},i),n)},i.handleKeyDown=function(t){tr.some(function(e){return s.default.isEventKey(t,e)})||e.prototype.handleKeyDown.call(this,t)},i.handleClick=function(e){this.selected(!0)},i.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},t}(an);Nt.registerComponent("MenuItem",ir);var nr=function(i){function a(r,a){var s,o=a.track,l=r.textTracks();a.label=o.label||o.language||"Unknown",a.selected="showing"===o.mode,(s=i.call(this,r,a)||this).track=o,s.kinds=(a.kinds||[a.kind||s.track.kind]).filter(Boolean);var u,d=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s.handleTracksChange.apply((0,n.default)(s),t)},c=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s.handleSelectedLanguageChange.apply((0,n.default)(s),t)};(r.on(["loadstart","texttrackchange"],d),l.addEventListener("change",d),l.addEventListener("selectedlanguagechange",c),s.on("dispose",function(){r.off(["loadstart","texttrackchange"],d),l.removeEventListener("change",d),l.removeEventListener("selectedlanguagechange",c)}),void 0===l.onchange)&&s.on(["tap","click"],function(){if("object"!=typeof e.default.Event)try{u=new e.default.Event("change")}catch(i){}u||(u=t.default.createEvent("Event")).initEvent("change",!0,!0),l.dispatchEvent(u)});return s.handleTracksChange(),s}(0,r.default)(a,i);var s=a.prototype;return s.handleClick=function(e){var t=this.track,n=this.player_.textTracks();if(i.prototype.handleClick.call(this,e),n)for(var r=0;r<n.length;r++){var a=n[r];-1!==this.kinds.indexOf(a.kind)&&(a===t?"showing"!==a.mode&&(a.mode="showing"):"disabled"!==a.mode&&(a.mode="disabled"))}},s.handleTracksChange=function(e){var t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)},s.handleSelectedLanguageChange=function(e){if("showing"===this.track.mode){var t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},s.dispose=function(){this.track=null,i.prototype.dispose.call(this)},a}(ir);Nt.registerComponent("TextTrackMenuItem",nr);var rr=function(e){function t(t,i){return i.track={player:t,kind:i.kind,kinds:i.kinds,default:!1,mode:"disabled"},i.kinds||(i.kinds=[i.kind]),i.label?i.track.label=i.label:i.track.label=i.kinds.join(" and ")+" off",i.selectable=!0,i.multiSelectable=!1,e.call(this,t,i)||this}(0,r.default)(t,e);var i=t.prototype;return i.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!0,n=0,r=t.length;n<r;n++){var a=t[n];if(this.options_.kinds.indexOf(a.kind)>-1&&"showing"===a.mode){i=!1;break}}i!==this.isSelected_&&this.selected(i)},i.handleSelectedLanguageChange=function(e){for(var t=this.player().textTracks(),i=!0,n=0,r=t.length;n<r;n++){var a=t[n];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&"showing"===a.mode){i=!1;break}}i&&(this.player_.cache_.selectedLanguage={enabled:!1})},t}(nr);Nt.registerComponent("OffTextTrackMenuItem",rr);var ar=function(e){function t(t,i){return void 0===i&&(i={}),i.tracks=t.textTracks(),e.call(this,t,i)||this}return(0,r.default)(t,e),t.prototype.createItems=function(e,t){var i;void 0===e&&(e=[]),void 0===t&&(t=nr),this.label_&&(i=this.label_+" off"),e.push(new rr(this.player_,{kinds:this.kinds_,kind:this.kind_,label:i})),this.hideThreshold_+=1;var n=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var r=0;r<n.length;r++){var a=n[r];if(this.kinds_.indexOf(a.kind)>-1){var s=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});s.addClass("vjs-"+a.kind+"-menu-item"),e.push(s)}}return e},t}(er);Nt.registerComponent("TextTrackButton",ar);var sr=function(e){function t(t,i){var r,a=i.track,s=i.cue,o=t.currentTime();return i.selectable=!0,i.multiSelectable=!1,i.label=s.text,i.selected=s.startTime<=o&&o<s.endTime,(r=e.call(this,t,i)||this).track=a,r.cue=s,a.addEventListener("cuechange",ft((0,n.default)(r),r.update)),r}(0,r.default)(t,e);var i=t.prototype;return i.handleClick=function(t){e.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},i.update=function(e){var t=this.cue,i=this.player_.currentTime();this.selected(t.startTime<=i&&i<t.endTime)},t}(ir);Nt.registerComponent("ChaptersTrackMenuItem",sr);var or=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildWrapperCSSClass.call(this)},i.update=function(t){this.track_&&(!t||"addtrack"!==t.type&&"removetrack"!==t.type)||this.setTrack(this.findChaptersTrack()),e.prototype.update.call(this)},i.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var i=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);i&&i.addEventListener("load",this.updateHandler_)}}},i.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],t=e.length-1;t>=0;t--){var i=e[t];if(i.kind===this.kind_)return i}},i.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(Ot(this.kind_))},i.createMenu=function(){return this.options_.title=this.getMenuCaption(),e.prototype.createMenu.call(this)},i.createItems=function(){var e=[];if(!this.track_)return e;var t=this.track_.cues;if(!t)return e;for(var i=0,n=t.length;i<n;i++){var r=t[i],a=new sr(this.player_,{track:this.track_,cue:r});e.push(a)}return e},t}(ar);or.prototype.kind_="chapters",or.prototype.controlText_="Chapters",Nt.registerComponent("ChaptersButton",or);var lr=function(e){function t(t,i,r){var a;a=e.call(this,t,i,r)||this;var s=t.textTracks(),o=ft((0,n.default)(a),a.handleTracksChange);return s.addEventListener("change",o),a.on("dispose",function(){s.removeEventListener("change",o)}),a}(0,r.default)(t,e);var i=t.prototype;return i.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!1,n=0,r=t.length;n<r;n++){var a=t[n];if(a.kind!==this.kind_&&"showing"===a.mode){i=!0;break}}i?this.disable():this.enable()},i.buildCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(ar);lr.prototype.kind_="descriptions",lr.prototype.controlText_="Descriptions",Nt.registerComponent("DescriptionsButton",lr);var ur=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(ar);ur.prototype.kind_="subtitles",ur.prototype.controlText_="Subtitles",Nt.registerComponent("SubtitlesButton",ur);var dr=function(e){function t(t,i){var n;return i.track={player:t,kind:i.kind,label:i.kind+" settings",selectable:!1,default:!1,mode:"disabled"},i.selectable=!1,i.name="CaptionSettingsMenuItem",(n=e.call(this,t,i)||this).addClass("vjs-texttrack-settings"),n.controlText(", opens "+i.kind+" settings dialog"),n}return(0,r.default)(t,e),t.prototype.handleClick=function(e){this.player().getChild("textTrackSettings").open()},t}(nr);Nt.registerComponent("CaptionSettingsMenuItem",dr);var cr=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-captions-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-captions-button "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new dr(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),e.prototype.createItems.call(this,t)},t}(ar);cr.prototype.kind_="captions",cr.prototype.controlText_="Captions",Nt.registerComponent("CaptionsButton",cr);var hr=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.default)(t,e),t.prototype.createEl=function(t,i,n){var r='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);return"captions"===this.options_.track.kind&&(r+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Captions")+"</span>\n      "),r+="</span>",e.prototype.createEl.call(this,t,F({innerHTML:r},i),n)},t}(nr);Nt.registerComponent("SubsCapsMenuItem",hr);var pr=function(e){function t(t,i){var n;return void 0===i&&(i={}),(n=e.call(this,t,i)||this).label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(n.player_.language_)>-1&&(n.label_="captions"),n.menuButton_.controlText(Ot(n.label_)),n}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new dr(this.player_,{kind:this.label_})),this.hideThreshold_+=1),t=e.prototype.createItems.call(this,t,hr)},t}(ar);pr.prototype.kinds_=["captions","subtitles"],pr.prototype.controlText_="Subtitles",Nt.registerComponent("SubsCapsButton",pr);var fr=function(e){function t(t,i){var r,a=i.track,s=t.audioTracks();i.label=a.label||a.language||"Unknown",i.selected=a.enabled,(r=e.call(this,t,i)||this).track=a,r.addClass("vjs-"+a.kind+"-menu-item");var o=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];r.handleTracksChange.apply((0,n.default)(r),t)};return s.addEventListener("change",o),r.on("dispose",function(){s.removeEventListener("change",o)}),r}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(t,i,n){var r='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);return"main-desc"===this.options_.track.kind&&(r+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Descriptions")+"</span>\n      "),r+="</span>",e.prototype.createEl.call(this,t,F({innerHTML:r},i),n)},i.handleClick=function(t){e.prototype.handleClick.call(this,t),this.track.enabled=!0},i.handleTracksChange=function(e){this.selected(this.track.enabled)},t}(ir);Nt.registerComponent("AudioTrackMenuItem",fr);var mr=function(e){function t(t,i){return void 0===i&&(i={}),i.tracks=t.audioTracks(),e.call(this,t,i)||this}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-audio-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-audio-button "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(e){void 0===e&&(e=[]),this.hideThreshold_=1;for(var t=this.player_.audioTracks(),i=0;i<t.length;i++){var n=t[i];e.push(new fr(this.player_,{track:n,selectable:!0,multiSelectable:!1}))}return e},t}(er);mr.prototype.controlText_="Audio Track",Nt.registerComponent("AudioTrackButton",mr);var gr=function(e){function t(t,i){var n,r=i.rate,a=parseFloat(r,10);return i.label=r,i.selected=a===t.playbackRate(),i.selectable=!0,i.multiSelectable=!1,(n=e.call(this,t,i)||this).label=r,n.rate=a,n.on(t,"ratechange",function(e){return n.update(e)}),n}(0,r.default)(t,e);var i=t.prototype;return i.handleClick=function(t){e.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},i.update=function(e){this.selected(this.player().playbackRate()===this.rate)},t}(ir);gr.prototype.contentElType="button",Nt.registerComponent("PlaybackRateMenuItem",gr);var vr=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).menuButton_.el_.setAttribute("aria-describedby",n.labelElId_),n.updateVisibility(),n.updateLabel(),n.on(t,"loadstart",function(e){return n.updateVisibility(e)}),n.on(t,"ratechange",function(e){return n.updateLabel(e)}),n.on(t,"playbackrateschange",function(e){return n.handlePlaybackRateschange(e)}),n}(0,r.default)(t,e);var i=t.prototype;return i.createEl=function(){var t=e.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=ge("div",{className:"vjs-playback-rate-value",id:this.labelElId_,innerHTML:"1x"}),t.appendChild(this.labelEl_),t},i.dispose=function(){this.labelEl_=null,e.prototype.dispose.call(this)},i.buildCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){for(var e=this.playbackRates(),t=[],i=e.length-1;i>=0;i--)t.push(new gr(this.player(),{rate:e[i]+"x"}));return t},i.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},i.handleClick=function(e){for(var t=this.player().playbackRate(),i=this.playbackRates(),n=i[0],r=0;r<i.length;r++)if(i[r]>t){n=i[r];break}this.player().playbackRate(n)},i.handlePlaybackRateschange=function(e){this.update()},i.playbackRates=function(){var e=this.player();return e.playbackRates&&e.playbackRates()||[]},i.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},i.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},i.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.innerHTML=this.player().playbackRate()+"x")},t}(Zn);vr.prototype.controlText_="Playback Rate",Nt.registerComponent("PlaybackRateMenuButton",vr);var _r=function(e){function t(){return e.apply(this,arguments)||this}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-spacer "+e.prototype.buildCSSClass.call(this)},i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})},t}(Nt);Nt.registerComponent("Spacer",_r);var yr=function(e){function t(){return e.apply(this,arguments)||this}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-custom-control-spacer "+e.prototype.buildCSSClass.call(this)},i.createEl=function(){var t=e.prototype.createEl.call(this,{className:this.buildCSSClass()});return t.innerHTML=" ",t},t}(_r);Nt.registerComponent("CustomControlSpacer",yr);var Tr=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.default)(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},t}(Nt);Tr.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in t.default&&Tr.prototype.options_.children.splice(Tr.prototype.options_.children.length-1,0,"pictureInPictureToggle"),Nt.registerComponent("ControlBar",Tr);var br=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on(t,"error",function(e){return n.open(e)}),n}(0,r.default)(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-error-display "+e.prototype.buildCSSClass.call(this)},i.content=function(){var e=this.player().error();return e?this.localize(e.message):""},t}(ei);br.prototype.options_=(0,i.default)({},ei.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),Nt.registerComponent("ErrorDisplay",br);var Sr="vjs-text-track-settings",kr=["#000","Black"],Cr=["#00F","Blue"],Er=["#0FF","Cyan"],wr=["#0F0","Green"],Ir=["#F0F","Magenta"],xr=["#F00","Red"],Pr=["#FFF","White"],Lr=["#FF0","Yellow"],Ar=["1","Opaque"],Or=["0.5","Semi-Transparent"],Dr=["0","Transparent"],Mr={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[kr,Pr,xr,wr,Cr,Lr,Ir,Er]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[Ar,Or,Dr]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Pr,kr,xr,wr,Cr,Lr,Ir,Er]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(e){return"1.00"===e?null:Number(e)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[Ar,Or]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[Dr,Or,Ar]}};function Rr(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}function Ur(e,t){return Rr(e.options[e.options.selectedIndex].value,t)}function Br(e,t,i){if(t)for(var n=0;n<e.options.length;n++)if(Rr(e.options[n].value,i)===t){e.selectedIndex=n;break}}Mr.windowColor.options=Mr.backgroundColor.options;var Fr=function(t){function i(e,i){var r;return i.temporary=!1,(r=t.call(this,e,i)||this).updateDisplay=r.updateDisplay.bind((0,n.default)(r)),r.fill(),r.hasBeenOpened_=r.hasBeenFilled_=!0,r.endDialog=ge("p",{className:"vjs-control-text",textContent:r.localize("End of dialog window.")}),r.el().appendChild(r.endDialog),r.setDefaults(),void 0===i.persistTextTrackSettings&&(r.options_.persistTextTrackSettings=r.options_.playerOptions.persistTextTrackSettings),r.on(r.$(".vjs-done-button"),"click",function(){r.saveSettings(),r.close()}),r.on(r.$(".vjs-default-button"),"click",function(){r.setDefaults(),r.updateDisplay()}),U(Mr,function(e){r.on(r.$(e.selector),"change",r.updateDisplay)}),r.options_.persistTextTrackSettings&&r.restoreSettings(),r}(0,r.default)(i,t);var a=i.prototype;return a.dispose=function(){this.endDialog=null,t.prototype.dispose.call(this)},a.createElSelect_=function(e,t,i){var n=this;void 0===t&&(t=""),void 0===i&&(i="label");var r=Mr[e],a=r.id.replace("%s",this.id_),s=[t,a].join(" ").trim();return["<"+i+' id="'+a+'" class="'+("label"===i?"vjs-label":"")+'">',this.localize(r.label),"</"+i+">",'<select aria-labelledby="'+s+'">'].concat(r.options.map(function(e){var t=a+"-"+e[1].replace(/\W+/g,"");return['<option id="'+t+'" value="'+e[0]+'" ','aria-labelledby="'+s+" "+t+'">',n.localize(e[1]),"</option>"].join("")})).concat("</select>").join("")},a.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},a.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},a.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},a.createElColors_=function(){return ge("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},a.createElFont_=function(){return ge("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},a.createElControls_=function(){var e=this.localize("restore all settings to the default values");return ge("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},a.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},a.label=function(){return this.localize("Caption Settings Dialog")},a.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},a.buildCSSClass=function(){return t.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},a.getValues=function(){var e=this;return B(Mr,function(t,i,n){var r=Ur(e.$(i.selector),i.parser);return void 0!==r&&(t[n]=r),t},{})},a.setValues=function(e){var t=this;U(Mr,function(i,n){Br(t.$(i.selector),e[n],i.parser)})},a.setDefaults=function(){var e=this;U(Mr,function(t){var i=t.hasOwnProperty("default")?t.default:0;e.$(t.selector).selectedIndex=i})},a.restoreSettings=function(){var t;try{t=JSON.parse(e.default.localStorage.getItem(Sr))}catch(i){O.warn(i)}t&&this.setValues(t)},a.saveSettings=function(){if(this.options_.persistTextTrackSettings){var t=this.getValues();try{Object.keys(t).length?e.default.localStorage.setItem(Sr,JSON.stringify(t)):e.default.localStorage.removeItem(Sr)}catch(i){O.warn(i)}}},a.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},a.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,t=e&&e.subsCapsButton,i=e&&e.captionsButton;t?t.focus():i&&i.focus()},i}(ei);Nt.registerComponent("TextTrackSettings",Fr);var Nr=function(t){function i(i,r){var a,s=r.ResizeObserver||e.default.ResizeObserver;null===r.ResizeObserver&&(s=!1);var o=Mt({createEl:!s,reportTouchActivity:!1},r);return(a=t.call(this,i,o)||this).ResizeObserver=r.ResizeObserver||e.default.ResizeObserver,a.loadListener_=null,a.resizeObserver_=null,a.debouncedHandler_=gt(function(){a.resizeHandler()},100,!1,(0,n.default)(a)),s?(a.resizeObserver_=new a.ResizeObserver(a.debouncedHandler_),a.resizeObserver_.observe(i.el())):(a.loadListener_=function(){if(a.el_&&a.el_.contentWindow){var e=a.debouncedHandler_,t=a.unloadListener_=function(){ot(this,"resize",e),ot(this,"unload",t),t=null};st(a.el_.contentWindow,"unload",t),st(a.el_.contentWindow,"resize",e)}},a.one("load",a.loadListener_)),a}(0,r.default)(i,t);var a=i.prototype;return a.createEl=function(){return t.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1},{"aria-hidden":"true"})},a.resizeHandler=function(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")},a.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,t.prototype.dispose.call(this)},i}(Nt);Nt.registerComponent("ResizeManager",Nr);var jr={trackingThreshold:30,liveTolerance:15},Hr=function(i){function n(e,n){var r,a=Mt(jr,n,{createEl:!1});return(r=i.call(this,e,a)||this).handleVisibilityChange_=function(e){return r.handleVisibilityChange(e)},r.trackLiveHandler_=function(){return r.trackLive_()},r.handlePlay_=function(e){return r.handlePlay(e)},r.handleFirstTimeupdate_=function(e){return r.handleFirstTimeupdate(e)},r.handleSeeked_=function(e){return r.handleSeeked(e)},r.seekToLiveEdge_=function(e){return r.seekToLiveEdge(e)},r.reset_(),r.on(r.player_,"durationchange",function(e){return r.handleDurationchange(e)}),r.one(r.player_,"canplay",function(){return r.toggleTracking()}),ee&&"hidden"in t.default&&"visibilityState"in t.default&&r.on(t.default,"visibilitychange",r.handleVisibilityChange_),r}(0,r.default)(n,i);var a=n.prototype;return a.handleVisibilityChange=function(){this.player_.duration()===1/0&&(t.default.hidden?this.stopTracking():this.startTracking())},a.trackLive_=function(){var t=this.player_.seekable();if(t&&t.length){var i=Number(e.default.performance.now().toFixed(4)),n=-1===this.lastTime_?0:(i-this.lastTime_)/1e3;this.lastTime_=i,this.pastSeekEnd_=this.pastSeekEnd()+n;var r=this.liveCurrentTime(),a=this.player_.currentTime(),s=this.player_.paused()||this.seekedBehindLive_||Math.abs(r-a)>this.options_.liveTolerance;this.timeupdateSeen_&&r!==1/0||(s=!1),s!==this.behindLiveEdge_&&(this.behindLiveEdge_=s,this.trigger("liveedgechange"))}},a.handleDurationchange=function(){this.toggleTracking()},a.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},a.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,pt),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},a.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},a.handleSeeked=function(){var e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()},a.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},a.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},a.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},a.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},a.seekableEnd=function(){for(var e=this.player_.seekable(),t=[],i=e?e.length:0;i--;)t.push(e.end(i));return t.length?t.sort()[t.length-1]:1/0},a.seekableStart=function(){for(var e=this.player_.seekable(),t=[],i=e?e.length:0;i--;)t.push(e.start(i));return t.length?t.sort()[0]:0},a.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()},a.isLive=function(){return this.isTracking()},a.atLiveEdge=function(){return!this.behindLiveEdge()},a.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},a.pastSeekEnd=function(){var e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_},a.behindLiveEdge=function(){return this.behindLiveEdge_},a.isTracking=function(){return"number"==typeof this.trackingInterval_},a.seekToLiveEdge=function(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},a.dispose=function(){this.off(t.default,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),i.prototype.dispose.call(this)},n}(Nt);Nt.registerComponent("LiveTracker",Hr);var qr,Vr=function(e){var t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;var i=e.$$("source"),n=[],r="";if(!i.length)return!1;for(var a=0;a<i.length;a++){var s=i[a].src;s&&-1===n.indexOf(s)&&n.push(s)}return!!n.length&&(1===n.length&&(r=n[0]),e.triggerSourceset(r),!0)},Wr=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(i){var n=t.default.createElement(this.nodeName.toLowerCase());n.innerHTML=i;for(var r=t.default.createDocumentFragment();n.childNodes.length;)r.appendChild(n.childNodes[0]);return this.innerText="",e.default.Element.prototype.appendChild.call(this,r),this.innerHTML}}),zr=function(e,t){for(var i={},n=0;n<e.length&&!((i=Object.getOwnPropertyDescriptor(e[n],t))&&i.set&&i.get);n++);return i.enumerable=!0,i.configurable=!0,i},Gr=function(t){return zr([t.el(),e.default.HTMLMediaElement.prototype,e.default.Element.prototype,Wr],"innerHTML")},Kr=function(e){var t=e.el();if(!t.resetSourceWatch_){var i={},n=Gr(e),r=function(i){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var s=i.apply(t,r);return Vr(e),s}};["append","appendChild","insertAdjacentHTML"].forEach(function(e){t[e]&&(i[e]=t[e],t[e]=r(i[e]))}),Object.defineProperty(t,"innerHTML",Mt(n,{set:r(n.set)})),t.resetSourceWatch_=function(){t.resetSourceWatch_=null,Object.keys(i).forEach(function(e){t[e]=i[e]}),Object.defineProperty(t,"innerHTML",n)},e.one("sourceset",t.resetSourceWatch_)}},Qr=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?gi(e.default.Element.prototype.getAttribute.call(this,"src")):""},set:function(t){return e.default.Element.prototype.setAttribute.call(this,"src",t),t}}),Xr=function(t){return zr([t.el(),e.default.HTMLMediaElement.prototype,Qr],"src")},Yr=function(e){if(e.featuresSourceset){var t=e.el();if(!t.resetSourceset_){var i=Xr(e),n=t.setAttribute,r=t.load;Object.defineProperty(t,"src",Mt(i,{set:function(n){var r=i.set.call(t,n);return e.triggerSourceset(t.src),r}})),t.setAttribute=function(i,r){var a=n.call(t,i,r);return/src/i.test(i)&&e.triggerSourceset(t.src),a},t.load=function(){var i=r.call(t);return Vr(e)||(e.triggerSourceset(""),Kr(e)),i},t.currentSrc?e.triggerSourceset(t.currentSrc):Vr(e)||Kr(e),t.resetSourceset_=function(){t.resetSourceset_=null,t.load=r,t.setAttribute=n,Object.defineProperty(t,"src",i),t.resetSourceWatch_&&t.resetSourceWatch_()}}}},$r=function(e,t,i,n){void 0===n&&(n=!0);var r=function(i){return Object.defineProperty(e,t,{value:i,enumerable:!0,writable:!0})},a={configurable:!0,enumerable:!0,get:function(){var e=i();return r(e),e}};return n&&(a.set=r),Object.defineProperty(e,t,a)},Jr=function(i){function n(e,t){var n;n=i.call(this,e,t)||this;var r=e.source,a=!1;if(r&&(n.el_.currentSrc!==r.src||e.tag&&3===e.tag.initNetworkState_)?n.setSource(r):n.handleLateInit_(n.el_),e.enableSourceset&&n.setupSourcesetHandling_(),n.isScrubbing_=!1,n.el_.hasChildNodes()){for(var s=n.el_.childNodes,o=s.length,l=[];o--;){var u=s[o];"track"===u.nodeName.toLowerCase()&&(n.featuresNativeTextTracks?(n.remoteTextTrackEls().addTrackElement_(u),n.remoteTextTracks().addTrack(u.track),n.textTracks().addTrack(u.track),a||n.el_.hasAttribute("crossorigin")||!_i(u.src)||(a=!0)):l.push(u))}for(var d=0;d<l.length;d++)n.el_.removeChild(l[d])}return n.proxyNativeTracks_(),n.featuresNativeTextTracks&&a&&O.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),n.restoreMetadataTracksInIOSNativePlayer_(),(ne||ae||X)&&!0===e.nativeControlsForTouch&&n.setControls(!0),n.proxyWebkitFullscreen_(),n.triggerReady(),n}(0,r.default)(n,i);var a=n.prototype;return a.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),n.disposeMediaElement(this.el_),this.options_=null,i.prototype.dispose.call(this)},a.setupSourcesetHandling_=function(){Yr(this)},a.restoreMetadataTracksInIOSNativePlayer_=function(){var e,t=this.textTracks(),i=function(){e=[];for(var i=0;i<t.length;i++){var n=t[i];"metadata"===n.kind&&e.push({track:n,storedMode:n.mode})}};i(),t.addEventListener("change",i),this.on("dispose",function(){return t.removeEventListener("change",i)});var n=function i(){for(var n=0;n<e.length;n++){var r=e[n];"disabled"===r.track.mode&&r.track.mode!==r.storedMode&&(r.track.mode=r.storedMode)}t.removeEventListener("change",i)};this.on("webkitbeginfullscreen",function(){t.removeEventListener("change",i),t.removeEventListener("change",n),t.addEventListener("change",n)}),this.on("webkitendfullscreen",function(){t.removeEventListener("change",i),t.addEventListener("change",i),t.removeEventListener("change",n)})},a.overrideNative_=function(e,t){var i=this;if(t===this["featuresNative"+e+"Tracks"]){var n=e.toLowerCase();this[n+"TracksListeners_"]&&Object.keys(this[n+"TracksListeners_"]).forEach(function(e){i.el()[n+"Tracks"].removeEventListener(e,i[n+"TracksListeners_"][e])}),this["featuresNative"+e+"Tracks"]=!t,this[n+"TracksListeners_"]=null,this.proxyNativeTracksForType_(n)}},a.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},a.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},a.proxyNativeTracksForType_=function(e){var t=this,i=Li[e],n=this.el()[i.getterName],r=this[i.getterName]();if(this["featuresNative"+i.capitalName+"Tracks"]&&n&&n.addEventListener){var a={change:function(i){var n={type:"change",target:r,currentTarget:r,srcElement:r};r.trigger(n),"text"===e&&t[Ai.remoteText.getterName]().trigger(n)},addtrack:function(e){r.addTrack(e.track)},removetrack:function(e){r.removeTrack(e.track)}},s=function(){for(var e=[],t=0;t<r.length;t++){for(var i=!1,a=0;a<n.length;a++)if(n[a]===r[t]){i=!0;break}i||e.push(r[t])}for(;e.length;)r.removeTrack(e.shift())};this[i.getterName+"Listeners_"]=a,Object.keys(a).forEach(function(e){var i=a[e];n.addEventListener(e,i),t.on("dispose",function(t){return n.removeEventListener(e,i)})}),this.on("loadstart",s),this.on("dispose",function(e){return t.off("loadstart",s)})}},a.proxyNativeTracks_=function(){var e=this;Li.names.forEach(function(t){e.proxyNativeTracksForType_(t)})},a.createEl=function(){var e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){var i=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(i,e),n.disposeMediaElement(e),e=i}else{e=t.default.createElement("video");var r=Mt({},this.options_.tag&&Ce(this.options_.tag));ne&&!0===this.options_.nativeControlsForTouch||delete r.controls,ke(e,F(r,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&we(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);for(var a=["loop","muted","playsinline","autoplay"],s=0;s<a.length;s++){var o=a[s],l=this.options_[o];void 0!==l&&(l?we(e,o,o):Ie(e,o),e[o]=l)}return e},a.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var t=!1,i=function(){t=!0};this.on("loadstart",i);var n=function(){t||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready(function(){this.off("loadstart",i),this.off("loadedmetadata",n),t||this.trigger("loadstart")})}var r=["loadstart"];r.push("loadedmetadata"),e.readyState>=2&&r.push("loadeddata"),e.readyState>=3&&r.push("canplay"),e.readyState>=4&&r.push("canplaythrough"),this.ready(function(){r.forEach(function(e){this.trigger(e)},this)})}},a.setScrubbing=function(e){this.isScrubbing_=e},a.scrubbing=function(){return this.isScrubbing_},a.setCurrentTime=function(e){try{this.isScrubbing_&&this.el_.fastSeek&&oe?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){O(t,"Video is not ready. (Video.js)")}},a.duration=function(){var e=this;if(this.el_.duration===1/0&&K&&J&&0===this.el_.currentTime){return this.on("timeupdate",function t(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",t))}),NaN}return this.el_.duration||NaN},a.width=function(){return this.el_.offsetWidth},a.height=function(){return this.el_.offsetHeight},a.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var t=function(){this.trigger("fullscreenchange",{isFullscreen:!1})},i=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",t),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",i),this.on("dispose",function(){e.off("webkitbeginfullscreen",i),e.off("webkitendfullscreen",t)})}},a.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var t=e.default.navigator&&e.default.navigator.userAgent||"";if(/Android/.test(t)||!/Chrome|Mac OS X 10.5/.test(t))return!0}return!1},a.enterFullScreen=function(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)Qt(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},a.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))},a.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},a.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},a.reset=function(){n.resetMediaElement(this.el_)},a.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},a.setControls=function(e){this.el_.controls=!!e},a.addTextTrack=function(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):i.prototype.addTextTrack.call(this,e,t,n)},a.createRemoteTextTrack=function(e){if(!this.featuresNativeTextTracks)return i.prototype.createRemoteTextTrack.call(this,e);var n=t.default.createElement("track");return e.kind&&(n.kind=e.kind),e.label&&(n.label=e.label),(e.language||e.srclang)&&(n.srclang=e.language||e.srclang),e.default&&(n.default=e.default),e.id&&(n.id=e.id),e.src&&(n.src=e.src),n},a.addRemoteTextTrack=function(e,t){var n=i.prototype.addRemoteTextTrack.call(this,e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n},a.removeRemoteTextTrack=function(e){if(i.prototype.removeRemoteTextTrack.call(this,e),this.featuresNativeTextTracks)for(var t=this.$$("track"),n=t.length;n--;)e!==t[n]&&e!==t[n].track||this.el().removeChild(t[n])},a.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var t={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(t.droppedVideoFrames=this.el().webkitDroppedFrameCount,t.totalVideoFrames=this.el().webkitDecodedFrameCount),e.default.performance&&"function"==typeof e.default.performance.now?t.creationTime=e.default.performance.now():e.default.performance&&e.default.performance.timing&&"number"==typeof e.default.performance.timing.navigationStart&&(t.creationTime=e.default.Date.now()-e.default.performance.timing.navigationStart),t},n}(Mi);$r(Jr,"TEST_VID",function(){if(he()){var e=t.default.createElement("video"),i=t.default.createElement("track");return i.kind="captions",i.srclang="en",i.label="English",e.appendChild(i),e}}),Jr.isSupported=function(){try{Jr.TEST_VID.volume=.5}catch(e){return!1}return!(!Jr.TEST_VID||!Jr.TEST_VID.canPlayType)},Jr.canPlayType=function(e){return Jr.TEST_VID.canPlayType(e)},Jr.canPlaySource=function(e,t){return Jr.canPlayType(e.type)},Jr.canControlVolume=function(){try{var e=Jr.TEST_VID.volume;return Jr.TEST_VID.volume=e/2+.1,e!==Jr.TEST_VID.volume}catch(t){return!1}},Jr.canMuteVolume=function(){try{var e=Jr.TEST_VID.muted;return Jr.TEST_VID.muted=!e,Jr.TEST_VID.muted?we(Jr.TEST_VID,"muted","muted"):Ie(Jr.TEST_VID,"muted","muted"),e!==Jr.TEST_VID.muted}catch(t){return!1}},Jr.canControlPlaybackRate=function(){if(K&&J&&Z<58)return!1;try{var e=Jr.TEST_VID.playbackRate;return Jr.TEST_VID.playbackRate=e/2+.1,e!==Jr.TEST_VID.playbackRate}catch(t){return!1}},Jr.canOverrideAttributes=function(){try{var e=function(){};Object.defineProperty(t.default.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(t.default.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(t.default.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(t.default.createElement("audio"),"innerHTML",{get:e,set:e})}catch(i){return!1}return!0},Jr.supportsNativeTextTracks=function(){return oe||se&&J},Jr.supportsNativeVideoTracks=function(){return!(!Jr.TEST_VID||!Jr.TEST_VID.videoTracks)},Jr.supportsNativeAudioTracks=function(){return!(!Jr.TEST_VID||!Jr.TEST_VID.audioTracks)},Jr.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresVolumeControl","canControlVolume"],["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(e){var t=e[0],i=e[1];$r(Jr.prototype,t,function(){return Jr[i]()},!0)}),Jr.prototype.movingMediaElementInDOM=!se,Jr.prototype.featuresFullscreenResize=!0,Jr.prototype.featuresProgressEvents=!0,Jr.prototype.featuresTimeupdateEvents=!0,Jr.patchCanPlayType=function(){Q>=4&&!Y&&!J&&(qr=Jr.TEST_VID&&Jr.TEST_VID.constructor.prototype.canPlayType,Jr.TEST_VID.constructor.prototype.canPlayType=function(e){return e&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(e)?"maybe":qr.call(this,e)})},Jr.unpatchCanPlayType=function(){var e=Jr.TEST_VID.constructor.prototype.canPlayType;return qr&&(Jr.TEST_VID.constructor.prototype.canPlayType=qr),e},Jr.patchCanPlayType(),Jr.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},Jr.resetMediaElement=function(e){if(e){for(var t=e.querySelectorAll("source"),i=t.length;i--;)e.removeChild(t[i]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(e){Jr.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){Jr.prototype["set"+Ot(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(e){Jr.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(e){Jr.prototype["set"+Ot(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){Jr.prototype[e]=function(){return this.el_[e]()}}),Mi.withSourceHandlers(Jr),Jr.nativeSourceHandler={},Jr.nativeSourceHandler.canPlayType=function(e){try{return Jr.TEST_VID.canPlayType(e)}catch(t){return""}},Jr.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return Jr.nativeSourceHandler.canPlayType(e.type);if(e.src){var i=vi(e.src);return Jr.nativeSourceHandler.canPlayType("video/"+i)}return""},Jr.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},Jr.nativeSourceHandler.dispose=function(){},Jr.registerSourceHandler(Jr.nativeSourceHandler),Mi.registerTech("Html5",Jr);var Zr=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],ea={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},ta=["tiny","xsmall","small","medium","large","xlarge","huge"],ia={};ta.forEach(function(e){var t="x"===e.charAt(0)?"x-"+e.substring(1):e;ia[e]="vjs-layout-"+t});var na={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},ra=function(i){function o(e,r,a){var s;if(e.id=e.id||r.id||"vjs_video_"+Je(),(r=F(o.getTagSettings(e),r)).initChildren=!1,r.createEl=!1,r.evented=!1,r.reportTouchActivity=!1,!r.language)if("function"==typeof e.closest){var l=e.closest("[lang]");l&&l.getAttribute&&(r.language=l.getAttribute("lang"))}else for(var u=e;u&&1===u.nodeType;){if(Ce(u).hasOwnProperty("lang")){r.language=u.getAttribute("lang");break}u=u.parentNode}if((s=i.call(this,null,r,a)||this).boundDocumentFullscreenChange_=function(e){return s.documentFullscreenChange_(e)},s.boundFullWindowOnEscKey_=function(e){return s.fullWindowOnEscKey(e)},s.boundUpdateStyleEl_=function(e){return s.updateStyleEl_(e)},s.boundApplyInitTime_=function(e){return s.applyInitTime_(e)},s.boundUpdateCurrentBreakpoint_=function(e){return s.updateCurrentBreakpoint_(e)},s.boundHandleTechClick_=function(e){return s.handleTechClick_(e)},s.boundHandleTechDoubleClick_=function(e){return s.handleTechDoubleClick_(e)},s.boundHandleTechTouchStart_=function(e){return s.handleTechTouchStart_(e)},s.boundHandleTechTouchMove_=function(e){return s.handleTechTouchMove_(e)},s.boundHandleTechTouchEnd_=function(e){return s.handleTechTouchEnd_(e)},s.boundHandleTechTap_=function(e){return s.handleTechTap_(e)},s.isFullscreen_=!1,s.log=D(s.id_),s.fsApi_=C,s.isPosterFromTech_=!1,s.queuedCallbacks_=[],s.isReady_=!1,s.hasStarted_=!1,s.userActive_=!1,s.debugEnabled_=!1,!s.options_||!s.options_.techOrder||!s.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(s.tag=e,s.tagAttributes=e&&Ce(e),s.language(s.options_.language),r.languages){var d={};Object.getOwnPropertyNames(r.languages).forEach(function(e){d[e.toLowerCase()]=r.languages[e]}),s.languages_=d}else s.languages_=o.prototype.options_.languages;s.resetCache_(),s.poster_=r.poster||"",s.controls_=!!r.controls,e.controls=!1,e.removeAttribute("controls"),s.changingSrc_=!1,s.playCallbacks_=[],s.playTerminatedQueue_=[],e.hasAttribute("autoplay")?s.autoplay(!0):s.autoplay(s.options_.autoplay),r.plugins&&Object.keys(r.plugins).forEach(function(e){if("function"!=typeof s[e])throw new Error('plugin "'+e+'" does not exist')}),s.scrubbing_=!1,s.el_=s.createEl(),xt((0,n.default)(s),{eventBusKey:"el_"}),s.fsApi_.requestFullscreen&&(st(t.default,s.fsApi_.fullscreenchange,s.boundDocumentFullscreenChange_),s.on(s.fsApi_.fullscreenchange,s.boundDocumentFullscreenChange_)),s.fluid_&&s.on(["playerreset","resize"],s.boundUpdateStyleEl_);var c=Mt(s.options_);r.plugins&&Object.keys(r.plugins).forEach(function(e){s[e](r.plugins[e])}),r.debug&&s.debug(!0),s.options_.playerOptions=c,s.middleware_=[],s.playbackRates(r.playbackRates),s.initChildren(),s.isAudio("audio"===e.nodeName.toLowerCase()),s.controls()?s.addClass("vjs-controls-enabled"):s.addClass("vjs-controls-disabled"),s.el_.setAttribute("role","region"),s.isAudio()?s.el_.setAttribute("aria-label",s.localize("Audio Player")):s.el_.setAttribute("aria-label",s.localize("Video Player")),s.isAudio()&&s.addClass("vjs-audio"),s.flexNotSupported_()&&s.addClass("vjs-no-flex"),ne&&s.addClass("vjs-touch-enabled"),se||s.addClass("vjs-workinghover"),o.players[s.id_]=(0,n.default)(s);var h=k.split(".")[0];return s.addClass("vjs-v"+h),s.userActive(!0),s.reportUserActivity(),s.one("play",function(e){return s.listenForUserActivity_(e)}),s.on("stageclick",function(e){return s.handleStageClick_(e)}),s.on("keydown",function(e){return s.handleKeyDown(e)}),s.on("languagechange",function(e){return s.handleLanguagechange(e)}),s.breakpoints(s.options_.breakpoints),s.responsive(s.options_.responsive),s}(0,r.default)(o,i);var l=o.prototype;return l.dispose=function(){var e=this;this.trigger("dispose"),this.off("dispose"),ot(t.default,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),ot(t.default,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),o.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),Xi(this),Oi.names.forEach(function(t){var i=Oi[t],n=e[i.getterName]();n&&n.off&&n.off()}),i.prototype.dispose.call(this)},l.createEl=function(){var n,r=this.tag,a=this.playerElIngest_=r.parentNode&&r.parentNode.hasAttribute&&r.parentNode.hasAttribute("data-vjs-player"),s="video-js"===this.tag.tagName.toLowerCase();a?n=this.el_=r.parentNode:s||(n=this.el_=i.prototype.createEl.call(this,"div"));var o=Ce(r);if(s){for(n=this.el_=r,r=this.tag=t.default.createElement("video");n.children.length;)r.appendChild(n.firstChild);ye(n,"video-js")||Te(n,"video-js"),n.appendChild(r),a=this.playerElIngest_=n,Object.keys(n).forEach(function(e){try{r[e]=n[e]}catch(t){}})}if(r.setAttribute("tabindex","-1"),o.tabindex="-1",(ee||J&&ie)&&(r.setAttribute("role","application"),o.role="application"),r.removeAttribute("width"),r.removeAttribute("height"),"width"in o&&delete o.width,"height"in o&&delete o.height,Object.getOwnPropertyNames(o).forEach(function(e){s&&"class"===e||n.setAttribute(e,o[e]),s&&r.setAttribute(e,o[e])}),r.playerId=r.id,r.id+="_html5_api",r.className="vjs-tech",r.player=n.player=this,this.addClass("vjs-paused"),!0!==e.default.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=Qe("vjs-styles-dimensions");var l=je(".vjs-styles-defaults"),u=je("head");u.insertBefore(this.styleEl_,l?l.nextSibling:u.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var d=r.getElementsByTagName("a"),c=0;c<d.length;c++){var h=d.item(c);Te(h,"vjs-hidden"),h.setAttribute("hidden","hidden")}return r.initNetworkState_=r.networkState,r.parentNode&&!a&&r.parentNode.insertBefore(n,r),_e(r,n),this.children_.unshift(r),this.el_.setAttribute("lang",this.language_),this.el_=n,n},l.crossOrigin=function(e){if(!e)return this.techGet_("crossOrigin");"anonymous"===e||"use-credentials"===e?this.techCall_("setCrossOrigin",e):O.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+e+'"')},l.width=function(e){return this.dimension("width",e)},l.height=function(e){return this.dimension("height",e)},l.dimension=function(e,t){var i=e+"_";if(void 0===t)return this[i]||0;if(""===t||"auto"===t)return this[i]=void 0,void this.updateStyleEl_();var n=parseFloat(t);isNaN(n)?O.error('Improper value "'+t+'" supplied for for '+e):(this[i]=n,this.updateStyleEl_())},l.fluid=function(e){var t=this;if(void 0===e)return!!this.fluid_;this.fluid_=!!e,yt(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),Tt(this,function(){t.on(["playerreset","resize"],t.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()},l.fill=function(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},l.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},l.updateStyleEl_=function(){if(!0!==e.default.VIDEOJS_NO_DYNAMIC_STYLE){var t,i,n,r=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),a=r[1]/r[0];t=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/a:this.videoWidth()||300,i=void 0!==this.height_?this.height_:t*a,n=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(n),Xe(this.styleEl_,"\n      ."+n+" {\n        width: "+t+"px;\n        height: "+i+"px;\n      }\n\n      ."+n+".vjs-fluid {\n        padding-top: "+100*a+"%;\n      }\n    ")}else{var s="number"==typeof this.width_?this.width_:this.options_.width,o="number"==typeof this.height_?this.height_:this.options_.height,l=this.tech_&&this.tech_.el();l&&(s>=0&&(l.width=s),o>=0&&(l.height=o))}},l.loadTech_=function(e,t){var i=this;this.tech_&&this.unloadTech_();var n=Ot(e),r=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==n&&this.tag&&(Mi.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;var a=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(a=!1);var s={source:t,autoplay:a,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+r+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};Oi.names.forEach(function(e){var t=Oi[e];s[t.getterName]=i[t.privateName]}),F(s,this.options_[n]),F(s,this.options_[r]),F(s,this.options_[e.toLowerCase()]),this.tag&&(s.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(s.startTime=this.cache_.currentTime);var o=Mi.getTech(e);if(!o)throw new Error("No Tech named '"+n+"' exists! '"+n+"' should be registered using videojs.registerTech()'");this.tech_=new o(s),this.tech_.ready(ft(this,this.handleTechReady_),!0),Jt.jsonToTextTracks(this.textTracksJson_||[],this.tech_),Zr.forEach(function(e){i.on(i.tech_,e,function(t){return i["handleTech"+Ot(e)+"_"](t)})}),Object.keys(ea).forEach(function(e){i.on(i.tech_,e,function(t){0===i.tech_.playbackRate()&&i.tech_.seeking()?i.queuedCallbacks_.push({callback:i["handleTech"+ea[e]+"_"].bind(i),event:t}):i["handleTech"+ea[e]+"_"](t)})}),this.on(this.tech_,"loadstart",function(e){return i.handleTechLoadStart_(e)}),this.on(this.tech_,"sourceset",function(e){return i.handleTechSourceset_(e)}),this.on(this.tech_,"waiting",function(e){return i.handleTechWaiting_(e)}),this.on(this.tech_,"ended",function(e){return i.handleTechEnded_(e)}),this.on(this.tech_,"seeking",function(e){return i.handleTechSeeking_(e)}),this.on(this.tech_,"play",function(e){return i.handleTechPlay_(e)}),this.on(this.tech_,"firstplay",function(e){return i.handleTechFirstPlay_(e)}),this.on(this.tech_,"pause",function(e){return i.handleTechPause_(e)}),this.on(this.tech_,"durationchange",function(e){return i.handleTechDurationChange_(e)}),this.on(this.tech_,"fullscreenchange",function(e,t){return i.handleTechFullscreenChange_(e,t)}),this.on(this.tech_,"fullscreenerror",function(e,t){return i.handleTechFullscreenError_(e,t)}),this.on(this.tech_,"enterpictureinpicture",function(e){return i.handleTechEnterPictureInPicture_(e)}),this.on(this.tech_,"leavepictureinpicture",function(e){return i.handleTechLeavePictureInPicture_(e)}),this.on(this.tech_,"error",function(e){return i.handleTechError_(e)}),this.on(this.tech_,"posterchange",function(e){return i.handleTechPosterChange_(e)}),this.on(this.tech_,"textdata",function(e){return i.handleTechTextData_(e)}),this.on(this.tech_,"ratechange",function(e){return i.handleTechRateChange_(e)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||_e(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},l.unloadTech_=function(){var e=this;Oi.names.forEach(function(t){var i=Oi[t];e[i.privateName]=e[i.getterName]()}),this.textTracksJson_=Jt.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},l.tech=function(e){return void 0===e&&O.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_},l.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"mouseup",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},l.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"mouseup",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},l.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},l.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())},l.manualAutoplay_=function(e){var t=this;if(this.tech_&&"string"==typeof e){var i,n=function(){var e=t.muted();t.muted(!0);var i=function(){t.muted(e)};t.playTerminatedQueue_.push(i);var n=t.play();if(Kt(n))return n.catch(function(e){throw i(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(e||""))})};if("any"!==e||this.muted()?i="muted"!==e||this.muted()?this.play():n():Kt(i=this.play())&&(i=i.catch(n)),Kt(i))return i.then(function(){t.trigger({type:"autoplay-success",autoplay:e})}).catch(function(){t.trigger({type:"autoplay-failure",autoplay:e})})}},l.updateSourceCaches_=function(e){void 0===e&&(e="");var t=e,i="";"string"!=typeof t&&(t=e.src,i=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!i&&(i=en(this,t)),this.cache_.source=Mt({},e,{src:t,type:i});for(var n=this.cache_.sources.filter(function(e){return e.src&&e.src===t}),r=[],a=this.$$("source"),s=[],o=0;o<a.length;o++){var l=Ce(a[o]);r.push(l),l.src&&l.src===t&&s.push(l.src)}s.length&&!n.length?this.cache_.sources=r:n.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t},l.handleTechSourceset_=function(e){var t=this;if(!this.changingSrc_){var i=function(e){return t.updateSourceCaches_(e)},n=this.currentSource().src,r=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==n)&&(i=function(){}),i(r),e.src||this.tech_.any(["sourceset","loadstart"],function(e){if("sourceset"!==e.type){var i=t.techGet("currentSrc");t.lastSource_.tech=i,t.updateSourceCaches_(i)}})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})},l.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},l.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},l.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},l.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var t=this.currentTime();this.on("timeupdate",function i(){t!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",i))})},l.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},l.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},l.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},l.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},l.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},l.handleTechFirstPlay_=function(){this.options_.starttime&&(O.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},l.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},l.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},l.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},l.handleTechClick_=function(e){Fe(e)&&this.controls_&&(this.paused()?Qt(this.play()):this.pause())},l.handleTechDoubleClick_=function(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(t){return t.contains(e.target)})||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},l.handleTechTap_=function(){this.userActive(!this.userActive())},l.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},l.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},l.handleTechTouchEnd_=function(e){e.cancelable&&e.preventDefault()},l.handleStageClick_=function(){this.reportUserActivity()},l.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},l.documentFullscreenChange_=function(e){var i=e.target.player;if(!i||i===this){var n=this.el(),r=t.default[this.fsApi_.fullscreenElement]===n;!r&&n.matches?r=n.matches(":"+this.fsApi_.fullscreen):!r&&n.msMatchesSelector&&(r=n.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(r)}},l.handleTechFullscreenChange_=function(e,t){t&&(t.nativeIOSFullscreen&&this.toggleClass("vjs-ios-native-fs"),this.isFullscreen(t.isFullscreen))},l.handleTechFullscreenError_=function(e,t){this.trigger("fullscreenerror",t)},l.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},l.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},l.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},l.handleTechError_=function(){var e=this.tech_.error();this.error(e)},l.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},l.getCache=function(){return this.cache_},l.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},l.techCall_=function(e,t){this.ready(function(){if(e in zi)return qi(this.middleware_,this.tech_,e,t);if(e in Gi)return Vi(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(i){throw O(i),i}},!0)},l.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in Wi)return Hi(this.middleware_,this.tech_,e);if(e in Gi)return Vi(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw O("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t),t;if("TypeError"===t.name)throw O("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t),this.tech_.isReady_=!1,t;throw O(t),t}}},l.play=function(){var t=this,i=this.options_.Promise||e.default.Promise;return i?new i(function(e){t.play_(e)}):this.play_()},l.play_=function(e){var t=this;void 0===e&&(e=Qt),this.playCallbacks_.push(e);var i=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!i)return this.waitToPlay_=function(e){t.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(i||!oe&&!se||this.load());var n=this.techGet_("play");null===n?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(n)},l.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})},l.runPlayCallbacks_=function(e){var t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})},l.pause=function(){this.techCall_("pause")},l.paused=function(){return!1!==this.techGet_("paused")},l.played=function(){return this.techGet_("played")||Vt(0,0)},l.scrubbing=function(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},l.currentTime=function(e){return void 0!==e?(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),void(this.cache_.initTime=0)):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},l.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},l.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))},l.remainingTime=function(){return this.duration()-this.currentTime()},l.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},l.buffered=function(){var e=this.techGet_("buffered");return e&&e.length||(e=Vt(0,0)),e},l.bufferedPercent=function(){return Wt(this.buffered(),this.duration())},l.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),i=e.end(e.length-1);return i>t&&(i=t),i},l.volume=function(e){var t;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)},l.muted=function(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)},l.defaultMuted=function(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},l.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},l.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},l.isFullscreen=function(e){if(void 0!==e){var t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_},l.requestFullscreen=function(t){var i=this.options_.Promise||e.default.Promise;if(i){var n=this;return new i(function(e,i){function r(){n.off("fullscreenerror",s),n.off("fullscreenchange",a)}function a(){r(),e()}function s(e,t){r(),i(t)}n.one("fullscreenchange",a),n.one("fullscreenerror",s);var o=n.requestFullscreenHelper_(t);o&&(o.then(r,r),o.then(e,i))})}return this.requestFullscreenHelper_()},l.requestFullscreenHelper_=function(e){var t,i=this;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){var n=this.el_[this.fsApi_.requestFullscreen](t);return n&&n.then(function(){return i.isFullscreen(!0)},function(){return i.isFullscreen(!1)}),n}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},l.exitFullscreen=function(){var t=this.options_.Promise||e.default.Promise;if(t){var i=this;return new t(function(e,t){function n(){i.off("fullscreenerror",a),i.off("fullscreenchange",r)}function r(){n(),e()}function a(e,i){n(),t(i)}i.one("fullscreenchange",r),i.one("fullscreenerror",a);var s=i.exitFullscreenHelper_();s&&(s.then(n,n),s.then(e,t))})}return this.exitFullscreenHelper_()},l.exitFullscreenHelper_=function(){var e=this;if(this.fsApi_.requestFullscreen){var i=t.default[this.fsApi_.exitFullscreen]();return i&&Qt(i.then(function(){return e.isFullscreen(!1)})),i}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},l.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=t.default.documentElement.style.overflow,st(t.default,"keydown",this.boundFullWindowOnEscKey_),t.default.documentElement.style.overflow="hidden",Te(t.default.body,"vjs-full-window"),this.trigger("enterFullWindow")},l.fullWindowOnEscKey=function(e){s.default.isEventKey(e,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},l.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,ot(t.default,"keydown",this.boundFullWindowOnEscKey_),t.default.documentElement.style.overflow=this.docOrigOverflow,be(t.default.body,"vjs-full-window"),this.trigger("exitFullWindow")},l.disablePictureInPicture=function(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")},l.isInPictureInPicture=function(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},l.requestPictureInPicture=function(){if("pictureInPictureEnabled"in t.default&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")},l.exitPictureInPicture=function(){if("pictureInPictureEnabled"in t.default)return t.default.exitPictureInPicture()},l.handleKeyDown=function(e){var t=this.options_.userActions;if(t&&t.hotkeys){(function(e){var t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;if("input"===t)return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type);return-1!==["textarea"].indexOf(t)})(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e))}},l.handleHotkeys=function(e){var i=this.options_.userActions?this.options_.userActions.hotkeys:{},n=i.fullscreenKey,r=void 0===n?function(e){return s.default.isEventKey(e,"f")}:n,a=i.muteKey,o=void 0===a?function(e){return s.default.isEventKey(e,"m")}:a,l=i.playPauseKey,u=void 0===l?function(e){return s.default.isEventKey(e,"k")||s.default.isEventKey(e,"Space")}:l;if(r.call(this,e)){e.preventDefault(),e.stopPropagation();var d=Nt.getComponent("FullscreenToggle");!1!==t.default[this.fsApi_.fullscreenEnabled]&&d.prototype.handleClick.call(this,e)}else if(o.call(this,e)){e.preventDefault(),e.stopPropagation(),Nt.getComponent("MuteToggle").prototype.handleClick.call(this,e)}else if(u.call(this,e)){e.preventDefault(),e.stopPropagation(),Nt.getComponent("PlayToggle").prototype.handleClick.call(this,e)}},l.canPlayType=function(e){for(var t,i=0,n=this.options_.techOrder;i<n.length;i++){var r=n[i],a=Mi.getTech(r);if(a||(a=Nt.getComponent(r)),a){if(a.isSupported()&&(t=a.canPlayType(e)))return t}else O.error('The "'+r+'" tech is undefined. Skipped browser support check for that tech.')}return""},l.selectSource=function(e){var t,i=this,n=this.options_.techOrder.map(function(e){return[e,Mi.getTech(e)]}).filter(function(e){var t=e[0],i=e[1];return i?i.isSupported():(O.error('The "'+t+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),r=function(e,t,i){var n;return e.some(function(e){return t.some(function(t){if(n=i(e,t))return!0})}),n},a=function(e,t){var n=e[0];if(e[1].canPlaySource(t,i.options_[n.toLowerCase()]))return{source:t,tech:n}};return(this.options_.sourceOrder?r(e,n,(t=a,function(e,i){return t(i,e)})):r(n,e,a))||!1},l.handleSrc_=function(e,t){var i=this;if(void 0===e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var n=tn(e);if(n.length){if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),Ni(this,n[0],function(e,r){if(i.middleware_=r,t||(i.cache_.sources=n),i.updateSourceCaches_(e),i.src_(e))return n.length>1?i.handleSrc_(n.slice(1)):(i.changingSrc_=!1,i.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0),void i.triggerReady());ji(r,i.tech_)}),this.options_.retryOnError&&n.length>1){var r=function(){i.error(null),i.handleSrc_(n.slice(1),!0)},a=function(){i.off("error",r)};this.one("error",r),this.one("playing",a),this.resetRetryOnError_=function(){i.off("error",r),i.off("playing",a)}}}else this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0)},l.src=function(e){return this.handleSrc_(e,!1)},l.src_=function(e){var t=this,i=this.selectSource([e]);return!i||(Dt(i.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(i.tech,i.source),this.tech_.ready(function(){t.changingSrc_=!1}),!1))},l.load=function(){this.techCall_("load")},l.reset=function(){var t=this,i=this.options_.Promise||e.default.Promise;this.paused()||!i?this.doReset_():Qt(this.play().then(function(){return t.doReset_()}))},l.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),yt(this)&&this.trigger("playerreset")},l.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},l.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar,t=e.durationDisplay,i=e.remainingTimeDisplay;t&&t.updateContent(),i&&i.updateContent()},l.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},l.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},l.currentSources=function(){var e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t},l.currentSource=function(){return this.cache_.source||{}},l.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},l.currentType=function(){return this.currentSource()&&this.currentSource().type||""},l.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")},l.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)},l.playsinline=function(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},l.loop=function(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")},l.poster=function(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},l.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},l.controls=function(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},l.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},l.error=function(e){if(void 0===e)return this.error_||null;if(this.options_.suppressNotSupportedError&&e&&4===e.code){var t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",function(){this.off(["click","touchstart"],t)})}if(null===e)return this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new zt(e),this.addClass("vjs-error"),O.error("(CODE:"+this.error_.code+" "+zt.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error")},l.reportUserActivity=function(e){this.userActivity_=!0},l.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},l.listenForUserActivity_=function(){var e,t,i,n=ft(this,this.reportUserActivity),r=function(t){n(),this.clearInterval(e)};this.on("mousedown",function(){n(),this.clearInterval(e),e=this.setInterval(n,250)}),this.on("mousemove",function(e){e.screenX===t&&e.screenY===i||(t=e.screenX,i=e.screenY,n())}),this.on("mouseup",r),this.on("mouseleave",r);var a,s=this.getChild("controlBar");!s||se||K||(s.on("mouseenter",function(e){this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout,this.player().options_.inactivityTimeout=0}),s.on("mouseleave",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",n),this.on("keyup",n),this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a);var e=this.options_.inactivityTimeout;e<=0||(a=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))}},250)},l.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)},l.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},l.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},l.addTextTrack=function(e,t,i){if(this.tech_)return this.tech_.addTextTrack(e,t,i)},l.addRemoteTextTrack=function(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)},l.removeRemoteTextTrack=function(e){void 0===e&&(e={});var t=e.track;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)},l.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},l.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},l.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},l.language=function(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),yt(this)&&this.trigger("languagechange"))},l.languages=function(){return Mt(o.prototype.options_.languages,this.languages_)},l.toJSON=function(){var e=Mt(this.options_),t=e.tracks;e.tracks=[];for(var i=0;i<t.length;i++){var n=t[i];(n=Mt(n)).player=void 0,e.tracks[i]=n}return e},l.createModal=function(e,t){var i=this;(t=t||{}).content=e||"";var n=new ei(this,t);return this.addChild(n),n.on("dispose",function(){i.removeChild(n)}),n.open(),n},l.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),t=this.currentWidth(),i=0;i<ta.length;i++){var n=ta[i];if(t<=this.breakpoints_[n]){if(e===n)return;e&&this.removeClass(ia[e]),this.addClass(ia[n]),this.breakpoint_=n;break}}},l.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)},l.breakpoints=function(e){return void 0===e?F(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=F({},na,e),this.updateCurrentBreakpoint_(),F(this.breakpoints_))},l.responsive=function(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0},l.currentBreakpoint=function(){return this.breakpoint_},l.currentBreakpointClass=function(){return ia[this.breakpoint_]||""},l.loadMedia=function(e,t){var i=this;if(e&&"object"==typeof e){this.reset(),this.cache_.media=Mt(e);var n=this.cache_.media,r=n.artwork,a=n.poster,s=n.src,o=n.textTracks;!r&&a&&(this.cache_.media.artwork=[{src:a,type:Zi(a)}]),s&&this.src(s),a&&this.poster(a),Array.isArray(o)&&o.forEach(function(e){return i.addRemoteTextTrack(e,!1)}),this.ready(t)}},l.getMedia=function(){if(!this.cache_.media){var e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(e){return{kind:e.kind,label:e.label,language:e.language,src:e.src}})};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:Zi(t.poster)}]),t}return Mt(this.cache_.media)},o.getTagSettings=function(e){var t={sources:[],tracks:[]},i=Ce(e),n=i["data-setup"];if(ye(e,"vjs-fill")&&(i.fill=!0),ye(e,"vjs-fluid")&&(i.fluid=!0),null!==n){var r=(0,a.default)(n||"{}"),s=r[0],o=r[1];s&&O.error(s),F(i,o)}if(F(t,i),e.hasChildNodes())for(var l=e.childNodes,u=0,d=l.length;u<d;u++){var c=l[u],h=c.nodeName.toLowerCase();"source"===h?t.sources.push(Ce(c)):"track"===h&&t.tracks.push(Ce(c))}return t},l.flexNotSupported_=function(){var e=t.default.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},l.debug=function(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},l.playbackRates=function(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every(function(e){return"number"==typeof e})&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))},o}(Nt);Oi.names.forEach(function(e){var t=Oi[e];ra.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),ra.prototype.crossorigin=ra.prototype.crossOrigin,ra.players={};var aa=e.default.navigator;ra.prototype.options_={techOrder:Mi.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:aa&&(aa.languages&&aa.languages[0]||aa.userLanguage||aa.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(e){ra.prototype[e]=function(){return this.techGet_(e)}}),Zr.forEach(function(e){ra.prototype["handleTech"+Ot(e)+"_"]=function(){return this.trigger(e)}}),Nt.registerComponent("Player",ra);var sa="plugin",oa="activePlugins_",la={},ua=function(e){return la.hasOwnProperty(e)},da=function(e){return ua(e)?la[e]:void 0},ca=function(e,t){e[oa]=e[oa]||{},e[oa][t]=!0},ha=function(e,t,i){var n=(i?"before":"")+"pluginsetup";e.trigger(n,t),e.trigger(n+":"+t.name,t)},pa=function(e,t){var i=function(){ha(this,{name:e,plugin:t,instance:null},!0);var i=t.apply(this,arguments);return ca(this,e),ha(this,{name:e,plugin:t,instance:i}),i};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i},fa=function(e,t){return t.prototype.name=e,function(){ha(this,{name:e,plugin:t,instance:null},!0);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];var a=(0,u.default)(t,[this].concat(n));return this[e]=function(){return a},ha(this,a.getEventHash()),a}},ma=function(){function e(t){if(this.constructor===e)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=t,this.log||(this.log=this.player.log.createLogger(this.name)),xt(this),delete this.trigger,Lt(this,this.constructor.defaultState),ca(t,this.name),this.dispose=this.dispose.bind(this),t.on("dispose",this.dispose)}var t=e.prototype;return t.version=function(){return this.constructor.VERSION},t.getEventHash=function(e){return void 0===e&&(e={}),e.name=this.name,e.plugin=this.constructor,e.instance=this,e},t.trigger=function(e,t){return void 0===t&&(t={}),lt(this.eventBusEl_,e,this.getEventHash(t))},t.handleStateChanged=function(e){},t.dispose=function(){var e=this.name,t=this.player;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[oa][e]=!1,this.player=this.state=null,t[e]=fa(e,la[e])},e.isBasic=function(t){var i="string"==typeof t?da(t):t;return"function"==typeof i&&!e.prototype.isPrototypeOf(i.prototype)},e.registerPlugin=function(t,i){if("string"!=typeof t)throw new Error('Illegal plugin name, "'+t+'", must be a string, was '+typeof t+".");if(ua(t))O.warn('A plugin named "'+t+'" already exists. You may want to avoid re-registering plugins!');else if(ra.prototype.hasOwnProperty(t))throw new Error('Illegal plugin name, "'+t+'", cannot share a name with an existing player method!');if("function"!=typeof i)throw new Error('Illegal plugin for "'+t+'", must be a function, was '+typeof i+".");return la[t]=i,t!==sa&&(e.isBasic(i)?ra.prototype[t]=pa(t,i):ra.prototype[t]=fa(t,i)),i},e.deregisterPlugin=function(e){if(e===sa)throw new Error("Cannot de-register base plugin.");ua(e)&&(delete la[e],delete ra.prototype[e])},e.getPlugins=function(e){var t;return void 0===e&&(e=Object.keys(la)),e.forEach(function(e){var i=da(e);i&&((t=t||{})[e]=i)}),t},e.getPluginVersion=function(e){var t=da(e);return t&&t.VERSION||""},e}();ma.getPlugin=da,ma.BASE_PLUGIN_NAME=sa,ma.registerPlugin(sa,ma),ra.prototype.usingPlugin=function(e){return!!this[oa]&&!0===this[oa][e]},ra.prototype.hasPlugin=function(e){return!!ua(e)};var ga=function(e,t){void 0===t&&(t={});var i=function(){e.apply(this,arguments)},n={};for(var r in"object"==typeof t?(t.constructor!==Object.prototype.constructor&&(i=t.constructor),n=t):"function"==typeof t&&(i=t),(0,d.default)(i,e),e&&(i.super_=e),n)n.hasOwnProperty(r)&&(i.prototype[r]=n[r]);return i},va=function(e){return 0===e.indexOf("#")?e.slice(1):e};function _a(e,t,i){var n=_a.getPlayer(e);if(n)return t&&O.warn('Player "'+e+'" is already initialised. Options will not be applied.'),i&&n.ready(i),n;var r="string"==typeof e?je("#"+va(e)):e;if(!pe(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");r.ownerDocument.defaultView&&r.ownerDocument.body.contains(r)||O.warn("The element supplied is not included in the DOM"),t=t||{},_a.hooks("beforesetup").forEach(function(e){var i=e(r,Mt(t));N(i)&&!Array.isArray(i)?t=Mt(t,i):O.error("please return an object in beforesetup hooks")});var a=Nt.getComponent("Player");return n=new a(r,t,i),_a.hooks("setup").forEach(function(e){return e(n)}),n}if(_a.hooks_={},_a.hooks=function(e,t){return _a.hooks_[e]=_a.hooks_[e]||[],t&&(_a.hooks_[e]=_a.hooks_[e].concat(t)),_a.hooks_[e]},_a.hook=function(e,t){_a.hooks(e,t)},_a.hookOnce=function(e,t){_a.hooks(e,[].concat(t).map(function(t){return function i(){return _a.removeHook(e,i),t.apply(void 0,arguments)}}))},_a.removeHook=function(e,t){var i=_a.hooks(e).indexOf(t);return!(i<=-1)&&(_a.hooks_[e]=_a.hooks_[e].slice(),_a.hooks_[e].splice(i,1),!0)},!0!==e.default.VIDEOJS_NO_DYNAMIC_STYLE&&he()){var ya=je(".vjs-styles-defaults");if(!ya){ya=Qe("vjs-styles-defaults");var Ta=je("head");Ta&&Ta.insertBefore(ya,Ta.firstChild),Xe(ya,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    ")}}ze(1,_a),_a.VERSION=k,_a.options=ra.prototype.options_,_a.getPlayers=function(){return ra.players},_a.getPlayer=function(e){var t,i=ra.players;if("string"==typeof e){var n=va(e),r=i[n];if(r)return r;t=je("#"+n)}else t=e;if(pe(t)){var a=t,s=a.player,o=a.playerId;if(s||i[o])return s||i[o]}},_a.getAllPlayers=function(){return Object.keys(ra.players).map(function(e){return ra.players[e]}).filter(Boolean)},_a.players=ra.players,_a.getComponent=Nt.getComponent,_a.registerComponent=function(e,t){Mi.isTech(t)&&O.warn("The "+e+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),Nt.registerComponent.call(Nt,e,t)},_a.getTech=Mi.getTech,_a.registerTech=Mi.registerTech,_a.use=Fi,Object.defineProperty(_a,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(_a.middleware,"TERMINATOR",{value:Bi,writeable:!1,enumerable:!0}),_a.browser=le,_a.TOUCH_ENABLED=ne,_a.extend=ga,_a.mergeOptions=Mt,_a.bind=ft,_a.registerPlugin=ma.registerPlugin,_a.deregisterPlugin=ma.deregisterPlugin,_a.plugin=function(e,t){return O.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),ma.registerPlugin(e,t)},_a.getPlugins=ma.getPlugins,_a.getPlugin=ma.getPlugin,_a.getPluginVersion=ma.getPluginVersion,_a.addLanguage=function(e,t){var i;return e=(""+e).toLowerCase(),_a.options.languages=Mt(_a.options.languages,((i={})[e]=t,i)),_a.options.languages[e]},_a.log=O,_a.createLogger=D,_a.createTimeRange=_a.createTimeRanges=Vt,_a.formatTime=Sn,_a.setFormatTime=Tn,_a.resetFormatTime=bn,_a.parseUrl=mi,_a.isCrossOrigin=_i,_a.EventTarget=vt,_a.on=st,_a.one=ut,_a.off=ot,_a.trigger=lt,_a.xhr=o.default,_a.TextTrack=Si,_a.AudioTrack=ki,_a.VideoTrack=Ci,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(e){_a[e]=function(){return O.warn("videojs."+e+"() is deprecated; use videojs.dom."+e+"() instead"),qe[e].apply(null,arguments)}}),_a.computedStyle=H,_a.dom=qe,_a.url=yi,_a.defineLazyProperty=$r,_a.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"});var ba=c.default,Sa=function(e,t,i){return e&&i&&i.responseURL&&t!==i.responseURL?i.responseURL:t},ka=function(e){return _a.log.debug?_a.log.debug.bind(_a,"VHS:",e+" >"):function(){}},Ca=1/30,Ea=3*Ca,wa=function(e,t){var i,n=[];if(e&&e.length)for(i=0;i<e.length;i++)t(e.start(i),e.end(i))&&n.push([e.start(i),e.end(i)]);return _a.createTimeRanges(n)},Ia=function(e,t){return wa(e,function(e,i){return e-Ea<=t&&i+Ea>=t})},xa=function(e,t){return wa(e,function(e){return e-Ca>=t})},Pa=function(e){if(e.length<2)return _a.createTimeRanges();for(var t=[],i=1;i<e.length;i++){var n=e.end(i-1),r=e.start(i);t.push([n,r])}return _a.createTimeRanges(t)},La=function(e,t){var i=null,n=null,r=0,a=[],s=[];if(!(e&&e.length&&t&&t.length))return _a.createTimeRange();for(var o=e.length;o--;)a.push({time:e.start(o),type:"start"}),a.push({time:e.end(o),type:"end"});for(o=t.length;o--;)a.push({time:t.start(o),type:"start"}),a.push({time:t.end(o),type:"end"});for(a.sort(function(e,t){return e.time-t.time}),o=0;o<a.length;o++)"start"===a[o].type?2===++r&&(i=a[o].time):"end"===a[o].type&&1===--r&&(n=a[o].time),null!==i&&null!==n&&(s.push([i,n]),i=null,n=null);return _a.createTimeRanges(s)},Aa=function(e){var t=[];if(!e||!e.length)return"";for(var i=0;i<e.length;i++)t.push(e.start(i)+" => "+e.end(i));return t.join(", ")},Oa=function(e,t,i){return void 0===i&&(i=1),((e.length?e.end(e.length-1):0)-t)/i},Da=function(e){for(var t=[],i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t},Ma=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(var i=0;i<e.length;i++)if(e.start(i)!==t.start(i)||e.end(i)!==t.end(i))return!0;return!1},Ra=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},Ua=_a.createTimeRange,Ba=function(e){return(e.segments||[]).reduce(function(e,t,i){return t.parts?t.parts.forEach(function(n,r){e.push({duration:n.duration,segmentIndex:i,partIndex:r,part:n,segment:t})}):e.push({duration:t.duration,segmentIndex:i,partIndex:null,segment:t,part:null}),e},[])},Fa=function(e){var t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},Na=function(e){var t=e.preloadSegment;if(t){var i=t.parts,n=(t.preloadHints||[]).reduce(function(e,t){return e+("PART"===t.type?1:0)},0);return n+=i&&i.length?i.length:0}},ja=function(e,t){if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;var i=Fa(t).length>0;return i&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:i&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},Ha=function(e,t){var i=0,n=t-e.mediaSequence,r=e.segments[n];if(r){if(void 0!==r.start)return{result:r.start,precise:!0};if(void 0!==r.end)return{result:r.end-r.duration,precise:!0}}for(;n--;){if(void 0!==(r=e.segments[n]).end)return{result:i+r.end,precise:!0};if(i+=r.duration,void 0!==r.start)return{result:i+r.start,precise:!0}}return{result:i,precise:!1}},qa=function(e,t){for(var i,n=0,r=t-e.mediaSequence;r<e.segments.length;r++){if(void 0!==(i=e.segments[r]).start)return{result:i.start-n,precise:!0};if(n+=i.duration,void 0!==i.end)return{result:i.end-n,precise:!0}}return{result:-1,precise:!1}},Va=function(e,t,i){if(void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;var n=Ha(e,t);if(n.precise)return n.result;var r=qa(e,t);return r.precise?r.result:n.result+i},Wa=function(t,i,n){if(!t)return 0;if("number"!=typeof n&&(n=0),void 0===i){if(t.totalDuration)return t.totalDuration;if(!t.endList)return e.default.Infinity}return Va(t,i,n)},za=function(e){var t=e.defaultDuration,i=e.durationList,n=e.startIndex,r=e.endIndex,a=0;if(n>r){var s=[r,n];n=s[0],r=s[1]}if(n<0){for(var o=n;o<Math.min(0,r);o++)a+=t;n=0}for(var l=n;l<r;l++)a+=i[l].duration;return a},Ga=function(e,t,i,n){if(!e||!e.segments)return null;if(e.endList)return Wa(e);if(null===t)return null;t=t||0;var r=Va(e,e.mediaSequence+e.segments.length,t);return i&&(r-=n="number"==typeof n?n:ja(null,e)),Math.max(0,r)},Ka=function(e,t,i){var n=t||0,r=Ga(e,t,!0,i);return null===r?Ua():Ua(n,r)},Qa=function(e){for(var t=e.playlist,i=e.currentTime,n=e.startingSegmentIndex,r=e.startingPartIndex,a=e.startTime,s=i-a,o=Ba(t),l=0,u=0;u<o.length;u++){var d=o[u];if(n===d.segmentIndex&&("number"!=typeof r||"number"!=typeof d.partIndex||r===d.partIndex)){l=u;break}}if(s<0){if(l>0)for(var c=l-1;c>=0;c--){var h=o[c];if((s+=h.duration)+Ca>0)return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:a-za({defaultDuration:t.targetDuration,durationList:o,startIndex:l,endIndex:c})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:i}}if(l<0){for(var p=l;p<0;p++)if((s-=t.targetDuration)<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:i};l=0}for(var f=l;f<o.length;f++){var m=o[f];if((s-=m.duration)-Ca<0)return{partIndex:m.partIndex,segmentIndex:m.segmentIndex,startTime:a+za({defaultDuration:t.targetDuration,durationList:o,startIndex:l,endIndex:f})}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:i}},Xa=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},Ya=function(e){return e.excludeUntil&&e.excludeUntil===1/0},$a=function(e){var t=Xa(e);return!e.disabled&&!t},Ja=function(e){return e.disabled},Za=function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},es=function(e,t){return t.attributes&&t.attributes[e]},ts=function(e,t,i,n){return void 0===n&&(n=0),es("BANDWIDTH",i)?(e*i.attributes.BANDWIDTH-8*n)/t:NaN},is=function(e,t){if(1===e.playlists.length)return!0;var i=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(function(e){return!!$a(e)&&(e.attributes.BANDWIDTH||0)<i}).length},ns=function(e,t){return!(!e&&!t||!e&&t||e&&!t)&&(e===t||(!(!e.id||!t.id||e.id!==t.id)||(!(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)||!(!e.uri||!t.uri||e.uri!==t.uri))))},rs=function(e,t){var i=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{},n=!1;for(var r in i){for(var a in i[r])if(n=t(i[r][a]))break;if(n)break}return!!n},as=function(e){if(!e||!e.playlists||!e.playlists.length)return rs(e,function(e){return e.playlists&&e.playlists.length||e.uri});for(var t=function(t){var i=e.playlists[t],n=i.attributes&&i.attributes.CODECS;return n&&n.split(",").every(function(e){return(0,p.isAudioCodec)(e)})?"continue":rs(e,function(e){return ns(i,e)})?"continue":{v:!1}},i=0;i<e.playlists.length;i++){var n=t(i);if("continue"!==n&&"object"==typeof n)return n.v}return!0},ss={liveEdgeDelay:ja,duration:Wa,seekable:Ka,getMediaInfoForTime:Qa,isEnabled:$a,isDisabled:Ja,isBlacklisted:Xa,isIncompatible:Ya,playlistEnd:Ga,isAes:Za,hasAttribute:es,estimateSegmentRequestTime:ts,isLowestEnabledRendition:is,isAudioOnly:as,playlistMatch:ns},os=_a.log,ls=function(e,t){return e+"-"+t},us=function(e){var t=e.onwarn,i=e.oninfo,n=e.manifestString,r=e.customTagParsers,a=void 0===r?[]:r,s=e.customTagMappers,o=void 0===s?[]:s,l=e.experimentalLLHLS,u=new h.Parser;t&&u.on("warn",t),i&&u.on("info",i),a.forEach(function(e){return u.addParser(e)}),o.forEach(function(e){return u.addTagMapper(e)}),u.push(n),u.end();var d=u.manifest;if(l||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(e){d.hasOwnProperty(e)&&delete d[e]}),d.segments&&d.segments.forEach(function(e){["parts","preloadHints"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})),!d.targetDuration){var c=10;d.segments&&d.segments.length&&(c=d.segments.reduce(function(e,t){return Math.max(e,t.duration)},0)),t&&t("manifest has no targetDuration defaulting to "+c),d.targetDuration=c}var p=Fa(d);if(p.length&&!d.partTargetDuration){var f=p.reduce(function(e,t){return Math.max(e,t.duration)},0);t&&(t("manifest has no partTargetDuration defaulting to "+f),os.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),d.partTargetDuration=f}return d},ds=function(e,t){e.mediaGroups&&["AUDIO","SUBTITLES"].forEach(function(i){if(e.mediaGroups[i])for(var n in e.mediaGroups[i])for(var r in e.mediaGroups[i][n]){var a=e.mediaGroups[i][n][r];t(a,i,n,r)}})},cs=function(e){var t=e.playlist,i=e.uri,n=e.id;t.id=n,t.playlistErrors_=0,i&&(t.uri=i),t.attributes=t.attributes||{}},hs=function(e){for(var t=e.playlists.length;t--;){var i=e.playlists[t];cs({playlist:i,id:ls(t,i.uri)}),i.resolvedUri=ba(e.uri,i.uri),e.playlists[i.id]=i,e.playlists[i.uri]=i,i.attributes.BANDWIDTH||os.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},ps=function(e){ds(e,function(t){t.uri&&(t.resolvedUri=ba(e.uri,t.uri))})},fs=function(t,i){var n=ls(0,i),r={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:e.default.location.href,resolvedUri:e.default.location.href,playlists:[{uri:i,id:n,resolvedUri:i,attributes:{}}]};return r.playlists[n]=r.playlists[0],r.playlists[i]=r.playlists[0],r},ms=function(e,t){e.uri=t;for(var n=0;n<e.playlists.length;n++)if(!e.playlists[n].uri){var r="placeholder-uri-"+n;e.playlists[n].uri=r}ds(e,function(t,n,r,a){var s="placeholder-uri-"+n+"-"+r+"-"+a;t.playlists&&t.playlists.length||(t.playlists=[(0,i.default)({},t)]),t.playlists.forEach(function(t,i){var n=ls(i,s);t.uri?t.resolvedUri=t.resolvedUri||ba(e.uri,t.uri):(t.uri=0===i?s:n,t.resolvedUri=t.uri),t.id=t.id||n,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t})}),hs(e),ps(e)},gs=_a.mergeOptions,vs=_a.EventTarget,_s=function(e,t){if(t.endList)return e;var i=[];if(t.serverControl&&t.serverControl.canBlockReload){var n=t.preloadSegment,r=t.mediaSequence+t.segments.length;if(n){var a=n.parts||[],s=Na(t)-1;s>-1&&s!==a.length-1&&i.push("_HLS_part="+s),(s>-1||a.length)&&r--}i.unshift("_HLS_msn="+r)}return t.serverControl&&t.serverControl.canSkipUntil&&i.unshift("_HLS_skip="+(t.serverControl.canSkipDateranges?"v2":"YES")),i.forEach(function(t,i){e+=""+(0===i?"?":"&")+t}),e},ys=function(e,t){if(!e)return t;var i=gs(e,t);if(e.preloadHints&&!t.preloadHints&&delete i.preloadHints,e.parts&&!t.parts)delete i.parts;else if(e.parts&&t.parts)for(var n=0;n<t.parts.length;n++)e.parts&&e.parts[n]&&(i.parts[n]=gs(e.parts[n],t.parts[n]));return!e.skipped&&t.skipped&&(i.skipped=!1),e.preload&&!t.preload&&(i.preload=!1),i},Ts=function(e,t,i){var n=e.slice(),r=t.slice();i=i||0;for(var a,s=[],o=0;o<r.length;o++){var l=n[o+i],u=r[o];l?(a=l.map||a,s.push(ys(l,u))):(a&&!u.map&&(u.map=a),s.push(u))}return s},bs=function(e,t){!e.resolvedUri&&e.uri&&(e.resolvedUri=ba(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=ba(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=ba(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=ba(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach(function(e){e.resolvedUri||(e.resolvedUri=ba(t,e.uri))}),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach(function(e){e.resolvedUri||(e.resolvedUri=ba(t,e.uri))})},Ss=function(e){var t=e.segments||[],i=e.preloadSegment;if(i&&i.parts&&i.parts.length){if(i.preloadHints)for(var n=0;n<i.preloadHints.length;n++)if("MAP"===i.preloadHints[n].type)return t;i.duration=e.targetDuration,i.preload=!0,t.push(i)}return t},ks=function(e,t){return e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence},Cs=function(e,t,i){void 0===i&&(i=ks);var n=gs(e,{}),r=n.playlists[t.id];if(!r)return null;if(i(r,t))return null;t.segments=Ss(t);var a=gs(r,t);if(a.preloadSegment&&!t.preloadSegment&&delete a.preloadSegment,r.segments){if(t.skip){t.segments=t.segments||[];for(var s=0;s<t.skip.skippedSegments;s++)t.segments.unshift({skipped:!0})}a.segments=Ts(r.segments,t.segments,t.mediaSequence-r.mediaSequence)}a.segments.forEach(function(e){bs(e,a.resolvedUri)});for(var o=0;o<n.playlists.length;o++)n.playlists[o].id===t.id&&(n.playlists[o]=a);return n.playlists[t.id]=a,n.playlists[t.uri]=a,ds(e,function(e,i,n,r){if(e.playlists)for(var a=0;a<e.playlists.length;a++)t.id===e.playlists[a].id&&(e.playlists[a]=t)}),n},Es=function(e,t){var i=e.segments[e.segments.length-1],n=i&&i.parts&&i.parts[i.parts.length-1],r=n&&n.duration||i&&i.duration;return t&&r?1e3*r:500*(e.partTargetDuration||e.targetDuration||10)},ws=function(t){function i(e,i,r){var a;if(void 0===r&&(r={}),a=t.call(this)||this,!e)throw new Error("A non-empty playlist URL or object is required");a.logger_=ka("PlaylistLoader");var s=r,o=s.withCredentials,l=void 0!==o&&o,u=s.handleManifestRedirects,d=void 0!==u&&u;a.src=e,a.vhs_=i,a.withCredentials=l,a.handleManifestRedirects=d;var c=i.options_;return a.customTagParsers=c&&c.customTagParsers||[],a.customTagMappers=c&&c.customTagMappers||[],a.experimentalLLHLS=c&&c.experimentalLLHLS||!1,a.state="HAVE_NOTHING",a.handleMediaupdatetimeout_=a.handleMediaupdatetimeout_.bind((0,n.default)(a)),a.on("mediaupdatetimeout",a.handleMediaupdatetimeout_),a}(0,r.default)(i,t);var a=i.prototype;return a.handleMediaupdatetimeout_=function(){var e=this;if("HAVE_METADATA"===this.state){var t=this.media(),i=ba(this.master.uri,t.uri);this.experimentalLLHLS&&(i=_s(i,t)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:i,withCredentials:this.withCredentials},function(t,i){if(e.request)return t?e.playlistRequestError(e.request,e.media(),"HAVE_METADATA"):void e.haveMetadata({playlistString:e.request.responseText,url:e.media().uri,id:e.media().id})})}},a.playlistRequestError=function(e,t,i){var n=t.uri,r=t.id;this.request=null,i&&(this.state=i),this.error={playlist:this.master.playlists[r],status:e.status,message:"HLS playlist request error at URL: "+n+".",responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")},a.parseManifest_=function(e){var t=this,i=e.url,n=e.manifestString;return us({onwarn:function(e){var n=e.message;return t.logger_("m3u8-parser warn for "+i+": "+n)},oninfo:function(e){var n=e.message;return t.logger_("m3u8-parser info for "+i+": "+n)},manifestString:n,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,experimentalLLHLS:this.experimentalLLHLS})},a.haveMetadata=function(t){var i=this,n=t.playlistString,r=t.playlistObject,a=t.url,s=t.id;this.request=null,this.state="HAVE_METADATA";var o=r||this.parseManifest_({url:a,manifestString:n});o.lastRequest=Date.now(),cs({playlist:o,uri:a,id:s});var l=Cs(this.master,o);this.targetDuration=o.partTargetDuration||o.targetDuration,l?(this.master=l,this.media_=this.master.playlists[s]):this.trigger("playlistunchanged"),this.media().endList||(e.default.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=e.default.setTimeout(function(){i.trigger("mediaupdatetimeout")},Es(this.media(),!!l))),this.trigger("loadedplaylist")},a.dispose=function(){this.trigger("dispose"),this.stopRequest(),e.default.clearTimeout(this.mediaUpdateTimeout),e.default.clearTimeout(this.finalRenditionTimeout),this.off()},a.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},a.media=function(t,i){var n=this;if(!t)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof t){if(!this.master.playlists[t])throw new Error("Unknown playlist URI: "+t);t=this.master.playlists[t]}if(e.default.clearTimeout(this.finalRenditionTimeout),i){var r=(t.partTargetDuration||t.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=e.default.setTimeout(this.media.bind(this,t,!1),r)}else{var a=this.state,s=!this.media_||t.id!==this.media_.id,o=this.master.playlists[t.id];if(o&&o.endList||t.endList&&t.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=t,void(s&&(this.trigger("mediachanging"),"HAVE_MASTER"===a?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(s){if(this.state="SWITCHING_MEDIA",this.request){if(t.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.request=this.vhs_.xhr({uri:t.resolvedUri,withCredentials:this.withCredentials},function(e,i){if(n.request){if(t.lastRequest=Date.now(),t.resolvedUri=Sa(n.handleManifestRedirects,t.resolvedUri,i),e)return n.playlistRequestError(n.request,t,a);n.haveMetadata({playlistString:i.responseText,url:t.uri,id:t.id}),"HAVE_MASTER"===a?n.trigger("loadedmetadata"):n.trigger("mediachange")}})}}},a.pause=function(){this.stopRequest(),e.default.clearTimeout(this.mediaUpdateTimeout),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")},a.load=function(t){var i=this;e.default.clearTimeout(this.mediaUpdateTimeout);var n=this.media();if(t){var r=n?(n.partTargetDuration||n.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=e.default.setTimeout(function(){return i.load()},r)}else this.started?n&&!n.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()},a.start=function(){var t=this;if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=e.default.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(function(){t.setupInitialPlaylist(t.src)},0);this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},function(e,i){if(t.request){if(t.request=null,e)return t.error={status:i.status,message:"HLS playlist request error at URL: "+t.src+".",responseText:i.responseText,code:2},"HAVE_NOTHING"===t.state&&(t.started=!1),t.trigger("error");t.src=Sa(t.handleManifestRedirects,t.src,i);var n=t.parseManifest_({manifestString:i.responseText,url:t.src});t.setupInitialPlaylist(n)}})},a.srcUri=function(){return"string"==typeof this.src?this.src:this.src.uri},a.setupInitialPlaylist=function(t){if(this.state="HAVE_MASTER",t.playlists)return this.master=t,ms(this.master,this.srcUri()),t.playlists.forEach(function(e){e.segments=Ss(e),e.segments.forEach(function(t){bs(t,e.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.master.playlists[0]));var i=this.srcUri()||e.default.location.href;this.master=fs(t,i),this.haveMetadata({playlistObject:t,url:i,id:this.master.playlists[0].id}),this.trigger("loadedmetadata")},i}(vs),Is=_a.xhr,xs=_a.mergeOptions,Ps=function(e,t,i,n){var r="arraybuffer"===e.responseType?e.response:e.responseText;!t&&r&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=r.byteLength||r.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),i.headers&&(e.responseHeaders=i.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===i.statusCode||206===i.statusCode||0===i.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(r||e.responseText)))),n(t,e)},Ls=function(){var e=function e(t,i){t=xs({timeout:45e3},t);var n=e.beforeRequest||_a.Vhs.xhr.beforeRequest;if(n&&"function"==typeof n){var r=n(t);r&&(t=r)}var a=(!0===_a.Vhs.xhr.original?Is:_a.Vhs.xhr)(t,function(e,t){return Ps(a,e,t,i)}),s=a.abort;return a.abort=function(){return a.aborted=!0,s.apply(a,arguments)},a.uri=t.uri,a.requestTime=Date.now(),a};return e.original=!0,e},As=function(e){var t=e.offset+e.length-1;return"bytes="+e.offset+"-"+t},Os=function(e){var t={};return e.byterange&&(t.Range=As(e.byterange)),t},Ds=function(e,t){return e.start(t)+"-"+e.end(t)},Ms=function(e,t){var i=e.toString(16);return"00".substring(0,2-i.length)+i+(t%2?" ":"")},Rs=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},Us=function(e){var t={};return Object.keys(e).forEach(function(i){var n=e[i];ArrayBuffer.isView(n)?t[i]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:t[i]=n}),t},Bs=function(e){var t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},Fs=function(e){return e.resolvedUri},Ns=function(e){for(var t=Array.prototype.slice.call(e),i="",n=0;n<t.length/16;n++)i+=t.slice(16*n,16*n+16).map(Ms).join("")+" "+t.slice(16*n,16*n+16).map(Rs).join("")+"\n";return i},js=function(e){var t=e.bytes;return Ns(t)},Hs=function(e){var t,i="";for(t=0;t<e.length;t++)i+=Ds(e,t)+" ";return i},qs=Object.freeze({__proto__:null,createTransferableMessage:Us,initSegmentId:Bs,segmentKeyId:Fs,hexDump:Ns,tagDump:js,textRanges:Hs}),Vs=.25,Ws=function(e,t){if(!t.dateTimeObject)return null;var i=t.videoTimingInfo.transmuxerPrependedSeconds,n=e-(t.videoTimingInfo.transmuxedPresentationStart+i);return new Date(t.dateTimeObject.getTime()+1e3*n)},zs=function(e){return e.transmuxedPresentationEnd-e.transmuxedPresentationStart-e.transmuxerPrependedSeconds},Gs=function(e,t){var i;try{i=new Date(e)}catch(l){return null}if(!t||!t.segments||0===t.segments.length)return null;var n=t.segments[0];if(i<n.dateTimeObject)return null;for(var r=0;r<t.segments.length-1;r++){if(n=t.segments[r],i<t.segments[r+1].dateTimeObject)break}var a=t.segments[t.segments.length-1],s=a.dateTimeObject,o=a.videoTimingInfo?zs(a.videoTimingInfo):a.duration+a.duration*Vs;return i>new Date(s.getTime()+1e3*o)?null:(i>s&&(n=a),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:ss.duration(t,t.mediaSequence+t.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},Ks=function(e,t){if(!t||!t.segments||0===t.segments.length)return null;for(var i,n=0,r=0;r<t.segments.length&&!(e<=(n=(i=t.segments[r]).videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:n+i.duration));r++);var a=t.segments[t.segments.length-1];if(a.videoTimingInfo&&a.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>n){if(e>n+a.duration*Vs)return null;i=a}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:n-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}},Qs=function(e,t){var i,n;try{i=new Date(e),n=new Date(t)}catch(a){}var r=i.getTime();return(n.getTime()-r)/1e3},Xs=function(e){if(!e.segments||0===e.segments.length)return!1;for(var t=0;t<e.segments.length;t++){if(!e.segments[t].dateTimeObject)return!1}return!0},Ys=function(e){var t=e.playlist,i=e.time,n=void 0===i?void 0:i,r=e.callback;if(!r)throw new Error("getProgramTime: callback must be provided");if(!t||void 0===n)return r({message:"getProgramTime: playlist and time must be provided"});var a=Ks(n,t);if(!a)return r({message:"valid programTime was not found"});if("estimate"===a.type)return r({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:a.estimatedStart});var s={mediaSeconds:n},o=Ws(n,a.segment);return o&&(s.programDateTime=o.toISOString()),r(null,s)},$s=function e(t){var i=t.programTime,n=t.playlist,r=t.retryCount,a=void 0===r?2:r,s=t.seekTo,o=t.pauseAfterSeek,l=void 0===o||o,u=t.tech,d=t.callback;if(!d)throw new Error("seekToProgramTime: callback must be provided");if(void 0===i||!n||!s)return d({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!n.endList&&!u.hasStarted_)return d({message:"player must be playing a live stream to start buffering"});if(!Xs(n))return d({message:"programDateTime tags must be provided in the manifest "+n.resolvedUri});var c=Gs(i,n);if(!c)return d({message:i+" was not found in the stream"});var h=c.segment,p=Qs(h.dateTimeObject,i);if("estimate"===c.type)return 0===a?d({message:i+" is not buffered yet. Try again"}):(s(c.estimatedStart+p),void u.one("seeked",function(){e({programTime:i,playlist:n,retryCount:a-1,seekTo:s,pauseAfterSeek:l,tech:u,callback:d})}));var f=h.start+p;u.one("seeked",function(){return d(null,u.currentTime())}),l&&u.pause(),s(f)},Js=function(e,t){if(4===e.readyState)return t()},Zs=function(e,t,i){var n,r=[],a=!1,s=function(e,t,n,r){return t.abort(),a=!0,i(e,t,n,r)},o=function(e,t){if(!a){if(e)return s(e,t,"",r);var i=t.responseText.substring(r&&r.byteLength||0,t.responseText.length);if(r=(0,y.concatTypedArrays)(r,(0,y.stringToBytes)(i,!0)),n=n||(0,v.getId3Offset)(r),r.length<10||n&&r.length<n+2)return Js(t,function(){return s(e,t,"",r)});var o=(0,_.detectContainerForBytes)(r);return"ts"===o&&r.length<188?Js(t,function(){return s(e,t,"",r)}):!o&&r.length<376?Js(t,function(){return s(e,t,"",r)}):s(null,t,o,r)}},l=t({uri:e,beforeSend:function(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",function(t){return t.total,t.loaded,Ps(e,null,{statusCode:e.status},o)})}},function(e,t){return Ps(l,e,t,o)});return l},eo=_a.EventTarget,to=_a.mergeOptions,io=function(e,t){if(!ks(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(var i=0;i<e.segments.length;i++){var n=e.segments[i],r=t.segments[i];if(n.uri!==r.uri)return!1;if(n.byterange||r.byterange){var a=n.byterange,s=r.byterange;if(a&&!s||!a&&s)return!1;if(a.offset!==s.offset||a.length!==s.length)return!1}}return!0},no=function(e){var t=e.masterXml,i=e.srcUrl,n=e.clientOffset,r=e.sidxMapping,a=(0,m.parse)(t,{manifestUri:i,clientOffset:n,sidxMapping:r});return ms(a,i),a},ro=function(e,t,i){for(var n=!0,r=to(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod}),a=0;a<t.playlists.length;a++){var s=t.playlists[a];if(s.sidx){var o=(0,m.generateSidxKey)(s.sidx);i&&i[o]&&i[o].sidx&&(0,m.addSidxSegmentsToPlaylist)(s,i[o].sidx,s.sidx.resolvedUri)}var l=Cs(r,s,io);l&&(r=l,n=!1)}return ds(t,function(e,t,i,a){if(e.playlists&&e.playlists.length){var s=e.playlists[0].id,o=Cs(r,e.playlists[0],io);o&&((r=o).mediaGroups[t][i][a].playlists[0]=r.playlists[s],n=!1)}}),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(n=!1),n?null:r},ao=function(e,t){return(Boolean(!e.map&&!t.map)||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length))&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length},so=function(e,t){var i={};for(var n in e){var r=e[n].sidx;if(r){var a=(0,m.generateSidxKey)(r);if(!t[a])break;var s=t[a].sidxInfo;ao(s,r)&&(i[a]=t[a])}}return i},oo=function(e,t){var i=so(e.playlists,t);return ds(e,function(e,n,r,a){if(e.playlists&&e.playlists.length){var s=e.playlists;i=to(i,so(s,t))}}),i},lo=function(t){function i(e,i,r,a){var s;void 0===r&&(r={}),(s=t.call(this)||this).masterPlaylistLoader_=a||(0,n.default)(s),a||(s.isMaster_=!0);var o=r,l=o.withCredentials,u=void 0!==l&&l,d=o.handleManifestRedirects,c=void 0!==d&&d;if(s.vhs_=i,s.withCredentials=u,s.handleManifestRedirects=c,!e)throw new Error("A non-empty playlist URL or object is required");return s.on("minimumUpdatePeriod",function(){s.refreshXml_()}),s.on("mediaupdatetimeout",function(){s.refreshMedia_(s.media().id)}),s.state="HAVE_NOTHING",s.loadedPlaylists_={},s.logger_=ka("DashPlaylistLoader"),s.isMaster_?(s.masterPlaylistLoader_.srcUrl=e,s.masterPlaylistLoader_.sidxMapping_={}):s.childPlaylist_=e,s}(0,r.default)(i,t);var a=i.prototype;return a.requestErrored_=function(e,t,i){return!this.request||(this.request=null,e?(this.error="object"!=typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2}:e,i&&(this.state=i),this.trigger("error"),!0):void 0)},a.addSidxSegments_=function(t,i,n){var r=this,a=t.sidx&&(0,m.generateSidxKey)(t.sidx);if(t.sidx&&a&&!this.masterPlaylistLoader_.sidxMapping_[a]){var s=Sa(this.handleManifestRedirects,t.sidx.resolvedUri),o=function(e,s){if(!r.requestErrored_(e,s,i)){var o,l=r.masterPlaylistLoader_.sidxMapping_;try{o=(0,g.default)((0,y.toUint8)(s.response).subarray(8))}catch(u){return void r.requestErrored_(u,s,i)}return l[a]={sidxInfo:t.sidx,sidx:o},(0,m.addSidxSegmentsToPlaylist)(t,o,t.sidx.resolvedUri),n(!0)}};this.request=Zs(s,this.vhs_.xhr,function(e,i,n,a){if(e)return o(e,i);if(!n||"mp4"!==n)return o({status:i.status,message:"Unsupported "+(n||"unknown")+" container type for sidx segment at URL: "+s,response:"",playlist:t,internal:!0,blacklistDuration:1/0,code:2},i);var l=t.sidx.byterange,u=l.offset,d=l.length;if(a.length>=d+u)return o(e,{response:a.subarray(u,u+d),status:i.status,uri:i.uri});r.request=r.vhs_.xhr({uri:s,responseType:"arraybuffer",headers:Os({byterange:t.sidx.byterange})},o)})}else this.mediaRequest_=e.default.setTimeout(function(){return n(!1)},0)},a.dispose=function(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},e.default.clearTimeout(this.minimumUpdatePeriodTimeout_),e.default.clearTimeout(this.mediaRequest_),e.default.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.off()},a.hasPendingRequest=function(){return this.request||this.mediaRequest_},a.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},a.media=function(e){var t=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var i=this.state;if("string"==typeof e){if(!this.masterPlaylistLoader_.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.masterPlaylistLoader_.master.playlists[e]}var n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),this.trigger("mediachange")));n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,i,function(n){t.haveMetadata({startingState:i,playlist:e})}))},a.haveMetadata=function(e){var t=e.startingState,i=e.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[i.id]=i,this.mediaRequest_=null,this.refreshMedia_(i.id),"HAVE_MASTER"===t?this.trigger("loadedmetadata"):this.trigger("mediachange")},a.pause=function(){this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),e.default.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMaster_&&(e.default.clearTimeout(this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_),this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)},a.load=function(t){var i=this;e.default.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;var n=this.media();if(t){var r=n?n.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=e.default.setTimeout(function(){return i.load()},r)}else this.started?n&&!n.endList?(this.isMaster_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()},a.start=function(){var t=this;this.started=!0,this.isMaster_?this.requestMaster_(function(e,i){t.haveMaster_(),t.hasPendingRequest()||t.media_||t.media(t.masterPlaylistLoader_.master.playlists[0])}):this.mediaRequest_=e.default.setTimeout(function(){return t.haveMaster_()},0)},a.requestMaster_=function(e){var t=this;this.request=this.vhs_.xhr({uri:this.masterPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},function(i,n){if(!t.requestErrored_(i,n)){var r=n.responseText!==t.masterPlaylistLoader_.masterXml_;return t.masterPlaylistLoader_.masterXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?t.masterLoaded_=Date.parse(n.responseHeaders.date):t.masterLoaded_=Date.now(),t.masterPlaylistLoader_.srcUrl=Sa(t.handleManifestRedirects,t.masterPlaylistLoader_.srcUrl,n),r?(t.handleMaster_(),void t.syncClientServerClock_(function(){return e(n,r)})):e(n,r)}"HAVE_NOTHING"===t.state&&(t.started=!1)})},a.syncClientServerClock_=function(e){var t=this,i=(0,m.parseUTCTiming)(this.masterPlaylistLoader_.masterXml_);return null===i?(this.masterPlaylistLoader_.clientOffset_=this.masterLoaded_-Date.now(),e()):"DIRECT"===i.method?(this.masterPlaylistLoader_.clientOffset_=i.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:ba(this.masterPlaylistLoader_.srcUrl,i.value),method:i.method,withCredentials:this.withCredentials},function(n,r){if(t.request){if(n)return t.masterPlaylistLoader_.clientOffset_=t.masterLoaded_-Date.now(),e();var a;a="HEAD"===i.method?r.responseHeaders&&r.responseHeaders.date?Date.parse(r.responseHeaders.date):t.masterLoaded_:Date.parse(r.responseText),t.masterPlaylistLoader_.clientOffset_=a-Date.now(),e()}}))},a.haveMaster_=function(){this.state="HAVE_MASTER",this.isMaster_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)},a.handleMaster_=function(){this.mediaRequest_=null;var e=no({masterXml:this.masterPlaylistLoader_.masterXml_,srcUrl:this.masterPlaylistLoader_.srcUrl,clientOffset:this.masterPlaylistLoader_.clientOffset_,sidxMapping:this.masterPlaylistLoader_.sidxMapping_}),t=this.masterPlaylistLoader_.master;t&&(e=ro(t,e,this.masterPlaylistLoader_.sidxMapping_)),this.masterPlaylistLoader_.master=e||t;var i=this.masterPlaylistLoader_.master.locations&&this.masterPlaylistLoader_.master.locations[0];return i&&i!==this.masterPlaylistLoader_.srcUrl&&(this.masterPlaylistLoader_.srcUrl=i),(!t||e&&e.minimumUpdatePeriod!==t.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),Boolean(e)},a.updateMinimumUpdatePeriodTimeout_=function(){var t=this.masterPlaylistLoader_;t.createMupOnMedia_&&(t.off("loadedmetadata",t.createMupOnMedia_),t.createMupOnMedia_=null),t.minimumUpdatePeriodTimeout_&&(e.default.clearTimeout(t.minimumUpdatePeriodTimeout_),t.minimumUpdatePeriodTimeout_=null);var i=t.master&&t.master.minimumUpdatePeriod;0===i&&(t.media()?i=1e3*t.media().targetDuration:(t.createMupOnMedia_=t.updateMinimumUpdatePeriodTimeout_,t.one("loadedmetadata",t.createMupOnMedia_))),"number"!=typeof i||i<=0?i<0&&this.logger_("found invalid minimumUpdatePeriod of "+i+", not setting a timeout"):this.createMUPTimeout_(i)},a.createMUPTimeout_=function(t){var i=this.masterPlaylistLoader_;i.minimumUpdatePeriodTimeout_=e.default.setTimeout(function(){i.minimumUpdatePeriodTimeout_=null,i.trigger("minimumUpdatePeriod"),i.createMUPTimeout_(t)},t)},a.refreshXml_=function(){var e=this;this.requestMaster_(function(t,i){i&&(e.media_&&(e.media_=e.masterPlaylistLoader_.master.playlists[e.media_.id]),e.masterPlaylistLoader_.sidxMapping_=oo(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.sidxMapping_),e.addSidxSegments_(e.media(),e.state,function(t){e.refreshMedia_(e.media().id)}))})},a.refreshMedia_=function(t){var i=this;if(!t)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMaster_&&this.handleMaster_();var n=this.masterPlaylistLoader_.master.playlists,r=!this.media_||this.media_!==n[t];if(r?this.media_=n[t]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){!function t(){i.media().endList||(i.mediaUpdateTimeout=e.default.setTimeout(function(){i.trigger("mediaupdatetimeout"),t()},Es(i.media(),Boolean(r))))}()}this.trigger("loadedplaylist")},i}(eo),uo={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30},co=function(e){for(var t=new Uint8Array(new ArrayBuffer(e.length)),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t.buffer},ho=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},po=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(i){var t=new BlobBuilder;return t.append(e),URL.createObjectURL(t.getBlob())}},fo=function(e){return function(){var t=po(e),i=ho(new Worker(t));i.objURL=t;var n=i.terminate;return i.on=i.addEventListener,i.off=i.removeEventListener,i.terminate=function(){return URL.revokeObjectURL(t),n.call(this)},i}},mo=function(e){return"var browserWorkerPolyFill = "+ho.toString()+";\nbrowserWorkerPolyFill(self);\n"+e},go=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},vo=mo(go(function(){var e=function(){this.init=function(){var e={};this.on=function(t,i){e[t]||(e[t]=[]),e[t]=e[t].concat(i)},this.off=function(t,i){var n;return!!e[t]&&(n=e[t].indexOf(i),e[t]=e[t].slice(),e[t].splice(n,1),n>-1)},this.trigger=function(t){var i,n,r,a;if(i=e[t])if(2===arguments.length)for(r=i.length,n=0;n<r;++n)i[n].call(this,arguments[1]);else{for(a=[],n=arguments.length,n=1;n<arguments.length;++n)a.push(arguments[n]);for(r=i.length,n=0;n<r;++n)i[n].apply(this,a)}},this.dispose=function(){e={}}}};e.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},e.prototype.push=function(e){this.trigger("data",e)},e.prototype.flush=function(e){this.trigger("done",e)},e.prototype.partialFlush=function(e){this.trigger("partialdone",e)},e.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},e.prototype.reset=function(e){this.trigger("reset",e)};var t,i,n,r,a,s,o,l,u,d,c,h,p,f,m,g,v,_,y,T,b,S,k,C,E,w,I,x,P,L,A,O,D,M,R,U,B,F,N,j,H=e,q=Math.pow(2,32)-1;!function(){var e;if(S={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in S)S.hasOwnProperty(e)&&(S[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);k=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),E=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),C=new Uint8Array([0,0,0,1]),w=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),I=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),x={video:w,audio:I},A=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),L=new Uint8Array([0,0,0,0,0,0,0,0]),O=new Uint8Array([0,0,0,0,0,0,0,0]),D=O,M=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R=O,P=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),t=function(e){var t,i,n=[],r=0;for(t=1;t<arguments.length;t++)n.push(arguments[t]);for(t=n.length;t--;)r+=n[t].byteLength;for(i=new Uint8Array(r+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(e,4),t=0,r=8;t<n.length;t++)i.set(n[t],r),r+=n[t].byteLength;return i},i=function(){return t(S.dinf,t(S.dref,A))},n=function(e){return t(S.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},m=function(e){return t(S.hdlr,x[e])},f=function(e){var i=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(i[12]=e.samplerate>>>24&255,i[13]=e.samplerate>>>16&255,i[14]=e.samplerate>>>8&255,i[15]=255&e.samplerate),t(S.mdhd,i)},p=function(e){return t(S.mdia,f(e),m(e.type),s(e))},a=function(e){return t(S.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},s=function(e){return t(S.minf,"video"===e.type?t(S.vmhd,P):t(S.smhd,L),i(),v(e))},o=function(e,i){for(var n=[],r=i.length;r--;)n[r]=y(i[r]);return t.apply(null,[S.moof,a(e)].concat(n))},l=function(e){for(var i=e.length,n=[];i--;)n[i]=c(e[i]);return t.apply(null,[S.moov,d(4294967295)].concat(n).concat(u(e)))},u=function(e){for(var i=e.length,n=[];i--;)n[i]=T(e[i]);return t.apply(null,[S.mvex].concat(n))},d=function(e){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t(S.mvhd,i)},g=function(e){var i,n,r=e.samples||[],a=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)i=r[n].flags,a[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return t(S.sdtp,a)},v=function(e){return t(S.stbl,_(e),t(S.stts,R),t(S.stsc,D),t(S.stsz,M),t(S.stco,O))},_=function(e){return t(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?U(e):B(e))},U=function(e){var i,n,r=e.sps||[],a=e.pps||[],s=[],o=[];for(i=0;i<r.length;i++)s.push((65280&r[i].byteLength)>>>8),s.push(255&r[i].byteLength),s=s.concat(Array.prototype.slice.call(r[i]));for(i=0;i<a.length;i++)o.push((65280&a[i].byteLength)>>>8),o.push(255&a[i].byteLength),o=o.concat(Array.prototype.slice.call(a[i]));if(n=[S.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t(S.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([r.length],s,[a.length],o))),t(S.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],u=e.sarRatio[1];n.push(t(S.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u])))}return t.apply(null,n)},B=function(e){return t(S.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),n(e))},h=function(e){var i=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return t(S.tkhd,i)},y=function(e){var i,n,r,a,s,o;return i=t(S.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),s=Math.floor(e.baseMediaDecodeTime/(q+1)),o=Math.floor(e.baseMediaDecodeTime%(q+1)),n=t(S.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),92,"audio"===e.type?(r=b(e,92),t(S.traf,i,n,r)):(a=g(e),r=b(e,a.length+92),t(S.traf,i,n,r,a))},c=function(e){return e.duration=e.duration||4294967295,t(S.trak,h(e),p(e))},T=function(e){var i=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(i[i.length-1]=0),t(S.trex,i)},j=function(e,t){var i=0,n=0,r=0,a=0;return e.length&&(void 0!==e[0].duration&&(i=1),void 0!==e[0].size&&(n=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(a=8)),[0,0,i|n|r|a,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},N=function(e,i){var n,r,a,s,o,l;for(i+=20+16*(s=e.samples||[]).length,a=j(s,i),(r=new Uint8Array(a.length+16*s.length)).set(a),n=a.length,l=0;l<s.length;l++)o=s[l],r[n++]=(4278190080&o.duration)>>>24,r[n++]=(16711680&o.duration)>>>16,r[n++]=(65280&o.duration)>>>8,r[n++]=255&o.duration,r[n++]=(4278190080&o.size)>>>24,r[n++]=(16711680&o.size)>>>16,r[n++]=(65280&o.size)>>>8,r[n++]=255&o.size,r[n++]=o.flags.isLeading<<2|o.flags.dependsOn,r[n++]=o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,r[n++]=61440&o.flags.degradationPriority,r[n++]=15&o.flags.degradationPriority,r[n++]=(4278190080&o.compositionTimeOffset)>>>24,r[n++]=(16711680&o.compositionTimeOffset)>>>16,r[n++]=(65280&o.compositionTimeOffset)>>>8,r[n++]=255&o.compositionTimeOffset;return t(S.trun,r)},F=function(e,i){var n,r,a,s,o,l;for(i+=20+8*(s=e.samples||[]).length,a=j(s,i),(n=new Uint8Array(a.length+8*s.length)).set(a),r=a.length,l=0;l<s.length;l++)o=s[l],n[r++]=(4278190080&o.duration)>>>24,n[r++]=(16711680&o.duration)>>>16,n[r++]=(65280&o.duration)>>>8,n[r++]=255&o.duration,n[r++]=(4278190080&o.size)>>>24,n[r++]=(16711680&o.size)>>>16,n[r++]=(65280&o.size)>>>8,n[r++]=255&o.size;return t(S.trun,n)},b=function(e,t){return"audio"===e.type?F(e,t):N(e,t)};r=function(){return t(S.ftyp,k,C,k,E)};var V,W,z,G,K,Q,X,Y,$=function(e){return t(S.mdat,e)},J=o,Z=function(e){var t,i=r(),n=l(e);return(t=new Uint8Array(i.byteLength+n.byteLength)).set(i),t.set(n,i.byteLength),t},ee=function(e,t){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=t,i.compositionTimeOffset=e.pts-e.dts,i.duration=e.duration,i.size=4*e.length,i.size+=e.byteLength,e.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},te=function(e){var t,i,n=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,n.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(i=e[t]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n),r},ie=function(e){var t,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)(i=e[t]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},ne=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},re=function(e,t){var i,n,r,a,s,o=t||0,l=[];for(i=0;i<e.length;i++)for(a=e[i],n=0;n<a.length;n++)s=a[n],o+=(r=ee(s,o)).size,l.push(r);return l},ae=function(e){var t,i,n,r,a,s,o=0,l=e.byteLength,u=e.nalCount,d=new Uint8Array(l+4*u),c=new DataView(d.buffer);for(t=0;t<e.length;t++)for(r=e[t],i=0;i<r.length;i++)for(a=r[i],n=0;n<a.length;n++)s=a[n],c.setUint32(o,s.data.byteLength),o+=4,d.set(s.data,o),o+=s.data.byteLength;return d},se=[33,16,5,32,164,27],oe=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],le=function(e){for(var t=[];e--;)t.push(0);return t},ue=function(){if(!V){var e={96000:[se,[227,64],le(154),[56]],88200:[se,[231],le(170),[56]],64000:[se,[248,192],le(240),[56]],48000:[se,[255,192],le(268),[55,148,128],le(54),[112]],44100:[se,[255,192],le(268),[55,163,128],le(84),[112]],32000:[se,[255,192],le(268),[55,234],le(226),[112]],24000:[se,[255,192],le(268),[55,255,128],le(268),[111,112],le(126),[224]],16000:[se,[255,192],le(268),[55,255,128],le(268),[111,255],le(269),[223,108],le(195),[1,192]],12000:[oe,le(268),[3,127,248],le(268),[6,255,240],le(268),[13,255,224],le(268),[27,253,128],le(259),[56]],11025:[oe,le(268),[3,127,248],le(268),[6,255,240],le(268),[13,255,224],le(268),[27,255,192],le(268),[55,175,128],le(108),[112]],8000:[oe,le(268),[3,121,16],le(47),[7]]};t=e,V=Object.keys(t).reduce(function(e,i){return e[i]=new Uint8Array(t[i].reduce(function(e,t){return e.concat(t)},[])),e},{})}var t;return V};Q=function(e,t){return W(K(e,t))},X=function(e,t){return z(G(e),t)},Y=function(e,t,i){return G(i?e:e-t)};var de=9e4,ce=W=function(e){return 9e4*e},he=(z=function(e,t){return e*t},G=function(e){return e/9e4}),pe=(K=function(e,t){return e/t},Q),fe=X,me=Y,ge=function(e,t,i,n){var r,a,s,o,l,u=0,d=0,c=0;if(t.length&&(r=pe(e.baseMediaDecodeTime,e.samplerate),a=Math.ceil(de/(e.samplerate/1024)),i&&n&&(u=r-Math.max(i,n),c=(d=Math.floor(u/a))*a),!(d<1||c>de/2))){for((s=ue()[e.samplerate])||(s=t[0].data),o=0;o<d;o++)l=t[0],t.splice(0,0,{data:s,dts:l.dts-a,pts:l.pts-a});return e.baseMediaDecodeTime-=Math.floor(fe(c,e.samplerate)),c}},ve=function(e,t,i){return t.minSegmentDts>=i?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=i&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},_e=function(e){var t,i,n=[];for(t=0;t<e.length;t++)i=e[t],n.push({size:i.data.byteLength,duration:1024});return n},ye=function(e){var t,i,n=0,r=new Uint8Array(function(e){var t,i=0;for(t=0;t<e.length;t++)i+=e[t].data.byteLength;return i}(e));for(t=0;t<e.length;t++)i=e[t],r.set(i.data,n),n+=i.data.byteLength;return r},Te=de,be=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},Se=function(e,t){var i,n=e.minSegmentDts;return t||(n-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=n,i=Math.max(0,i),"audio"===e.type&&(i*=e.samplerate/Te,i=Math.floor(i)),i},ke=function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},Ce=function(e){for(var t=0,i={payloadType:-1,payloadSize:0},n=0,r=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)n+=255,t++;for(n+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!i.payload&&4===n){if("GA94"===String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6])){i.payloadType=n,i.payloadSize=r,i.payload=e.subarray(t,t+r);break}i.payload=void 0}t+=r,n=0,r=0}return i},Ee=function(e){return 181!==e.payload[0]?null:49!=(e.payload[1]<<8|e.payload[2])?null:"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?null:3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},we=function(e,t){var i,n,r,a,s=[];if(!(64&t[0]))return s;for(n=31&t[0],i=0;i<n;i++)a={type:3&t[2+(r=3*i)],pts:e},4&t[r+2]&&(a.ccData=t[r+3]<<8|t[r+4],s.push(a));return s},Ie=function(e){for(var t,i,n=e.byteLength,r=[],a=1;a<n-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return e;t=n-r.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=e[s];return i},xe=4,Pe=function e(t){t=t||{},e.prototype.init.call(this),this.parse708captions_="boolean"!=typeof t.parse708captions||t.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Ne(0,0),new Ne(0,1),new Ne(1,0),new Ne(1,1)],this.parse708captions_&&(this.cc708Stream_=new Me),this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};(Pe.prototype=new H).push=function(e){var t,i,n;if("sei_rbsp"===e.nalUnitType&&(t=Ce(e.escapedRBSP)).payload&&t.payloadType===xe&&(i=Ee(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=we(e.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},Pe.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},Pe.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},Pe.prototype.flush=function(){return this.flushStream("flush")},Pe.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Pe.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},Pe.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},Pe.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},Pe.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},Pe.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)},Pe.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var Le={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Ae=function(e){return 32<=e&&e<=127||160<=e&&e<=255},Oe=function(e){this.windowNum=e,this.reset()};Oe.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Oe.prototype.getText=function(){return this.rows.join("\n")},Oe.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Oe.prototype.newLine=function(e){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Oe.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},Oe.prototype.addText=function(e){this.rows[this.rowIdx]+=e},Oe.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var De=function(e){this.serviceNum=e,this.text="",this.currentWindow=new Oe(-1),this.windows=[]};De.prototype.init=function(e,t){this.startPts=e;for(var i=0;i<8;i++)this.windows[i]=new Oe(i),"function"==typeof t&&(this.windows[i].beforeRowOverflow=t)},De.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]};var Me=function e(){e.prototype.init.call(this);var t=this;this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(t.new708Packet(),t.add708Bytes(e)):(null===t.current708Packet&&t.new708Packet(),t.add708Bytes(e))}};Me.prototype=new H,Me.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Me.prototype.add708Bytes=function(e){var t=e.ccData,i=t>>>8,n=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(i),this.current708Packet.data.push(n)},Me.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,i=null,n=null,r=0,a=t[r++];for(e.seq=a>>6,e.sizeCode=63&a;r<t.length;r++)n=31&(a=t[r++]),7===(i=a>>5)&&n>0&&(i=a=t[r++]),this.pushServiceBlock(i,r,n),n>0&&(r+=n-1)},Me.prototype.pushServiceBlock=function(e,t,i){var n,r=t,a=this.current708Packet.data,s=this.services[e];for(s||(s=this.initService(e,r));r<t+i&&r<a.length;r++)n=a[r],Ae(n)?r=this.handleText(r,s):16===n?r=this.extendedCommands(r,s):128<=n&&n<=135?r=this.setCurrentWindow(r,s):152<=n&&n<=159?r=this.defineWindow(r,s):136===n?r=this.clearWindows(r,s):140===n?r=this.deleteWindows(r,s):137===n?r=this.displayWindows(r,s):138===n?r=this.hideWindows(r,s):139===n?r=this.toggleWindows(r,s):151===n?r=this.setWindowAttributes(r,s):144===n?r=this.setPenAttributes(r,s):145===n?r=this.setPenColor(r,s):146===n?r=this.setPenLocation(r,s):143===n?s=this.reset(r,s):8===n?s.currentWindow.backspace():12===n?s.currentWindow.clearText():13===n?s.currentWindow.pendingNewLine=!0:14===n?s.currentWindow.clearText():141===n&&r++},Me.prototype.extendedCommands=function(e,t){var i=this.current708Packet.data[++e];return Ae(i)&&(e=this.handleText(e,t,!0)),e},Me.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},Me.prototype.initService=function(e,t){var i=this;return this.services[e]=new De(e),this.services[e].init(this.getPts(t),function(t){i.flushDisplayed(t,i.services[e])}),this.services[e]},Me.prototype.handleText=function(e,t,i){var n,r,a=this.current708Packet.data[e],s=(r=Le[n=(i?4096:0)|a]||n,4096&n&&n===r?"":String.fromCharCode(r)),o=t.currentWindow;return o.pendingNewLine&&!o.isEmpty()&&o.newLine(this.getPts(e)),o.pendingNewLine=!1,o.addText(s),e},Me.prototype.setCurrentWindow=function(e,t){var i=7&this.current708Packet.data[e];return t.setCurrentWindow(i),e},Me.prototype.defineWindow=function(e,t){var i=this.current708Packet.data,n=i[e],r=7&n;t.setCurrentWindow(r);var a=t.currentWindow;return n=i[++e],a.visible=(32&n)>>5,a.rowLock=(16&n)>>4,a.columnLock=(8&n)>>3,a.priority=7&n,n=i[++e],a.relativePositioning=(128&n)>>7,a.anchorVertical=127&n,n=i[++e],a.anchorHorizontal=n,n=i[++e],a.anchorPoint=(240&n)>>4,a.rowCount=15&n,n=i[++e],a.columnCount=63&n,n=i[++e],a.windowStyle=(56&n)>>3,a.penStyle=7&n,a.virtualRowCount=a.rowCount+1,e},Me.prototype.setWindowAttributes=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.winAttr;return n=i[++e],r.fillOpacity=(192&n)>>6,r.fillRed=(48&n)>>4,r.fillGreen=(12&n)>>2,r.fillBlue=3&n,n=i[++e],r.borderType=(192&n)>>6,r.borderRed=(48&n)>>4,r.borderGreen=(12&n)>>2,r.borderBlue=3&n,n=i[++e],r.borderType+=(128&n)>>5,r.wordWrap=(64&n)>>6,r.printDirection=(48&n)>>4,r.scrollDirection=(12&n)>>2,r.justify=3&n,n=i[++e],r.effectSpeed=(240&n)>>4,r.effectDirection=(12&n)>>2,r.displayEffect=3&n,e},Me.prototype.flushDisplayed=function(e,t){for(var i=[],n=0;n<8;n++)t.windows[n].visible&&!t.windows[n].isEmpty()&&i.push(t.windows[n].getText());t.endPts=e,t.text=i.join("\n\n"),this.pushCaption(t),t.startPts=e},Me.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},Me.prototype.displayWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible=1);return e},Me.prototype.hideWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible=0);return e},Me.prototype.toggleWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible^=1);return e},Me.prototype.clearWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&t.windows[r].clearText();return e},Me.prototype.deleteWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&t.windows[r].reset();return e},Me.prototype.setPenAttributes=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penAttr;return n=i[++e],r.textTag=(240&n)>>4,r.offset=(12&n)>>2,r.penSize=3&n,n=i[++e],r.italics=(128&n)>>7,r.underline=(64&n)>>6,r.edgeType=(56&n)>>3,r.fontStyle=7&n,e},Me.prototype.setPenColor=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penColor;return n=i[++e],r.fgOpacity=(192&n)>>6,r.fgRed=(48&n)>>4,r.fgGreen=(12&n)>>2,r.fgBlue=3&n,n=i[++e],r.bgOpacity=(192&n)>>6,r.bgRed=(48&n)>>4,r.bgGreen=(12&n)>>2,r.bgBlue=3&n,n=i[++e],r.edgeRed=(48&n)>>4,r.edgeGreen=(12&n)>>2,r.edgeBlue=3&n,e},Me.prototype.setPenLocation=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,n=i[++e],r.row=15&n,n=i[++e],r.column=63&n,e},Me.prototype.reset=function(e,t){var i=this.getPts(e);return this.flushDisplayed(i,t),this.initService(t.serviceNum,e)};var Re={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Ue=function(e){return null===e?"":(e=Re[e]||e,String.fromCharCode(e))},Be=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Fe=function(){for(var e=[],t=15;t--;)e.push("");return e},Ne=function e(t,i){e.prototype.init.call(this),this.field_=t||0,this.dataChannel_=i||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,i,n,r,a;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),n=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Fe();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Fe();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Fe()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(n,r))a=Ue((n=(3&n)<<8)|r),this[this.mode_](e.pts,a),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=Ue((n=(3&n)<<8)|r),this[this.mode_](e.pts,a),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&r)&&this.addFormatting(e.pts,["i"]),1==(1&r)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(n,r))this.column_+=3&r;else if(this.isPAC(n,r)){var s=Be.indexOf(7968&t);"rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(e.pts,s)),s!==this.row_&&(this.clearFormatting(e.pts),this.row_=s),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(n)&&(0===r&&(r=null),a=Ue(n),a+=Ue(r),this[this.mode_](e.pts,a),this.column_+=a.length)}else this.lastControlCode_=null}};Ne.prototype=new H,Ne.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e,t){try{return e.trim()}catch(i){return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+t+"."}),""}},this).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},Ne.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Fe(),this.nonDisplayed_=Fe(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Ne.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Ne.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Ne.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Ne.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Ne.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Ne.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Ne.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Ne.prototype.isNormalChar=function(e){return e>=32&&e<=127},Ne.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Fe(),this.displayed_=Fe()),void 0!==t&&t!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[t-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Ne.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,i)},Ne.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Ne.prototype.popOn=function(e,t){var i=this.nonDisplayed_[this.row_];i+=t,this.nonDisplayed_[this.row_]=i},Ne.prototype.rollUp=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i},Ne.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<15;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},Ne.prototype.paintOn=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i};var je={CaptionStream:Pe,Cea608Stream:Ne,Cea708Stream:Me},He={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},qe=function(e,t){var i=1;for(e>t&&(i=-1);Math.abs(t-e)>4294967296;)e+=8589934592*i;return e},Ve=function e(t){var i,n;e.prototype.init.call(this),this.type_=t||"shared",this.push=function(e){"shared"!==this.type_&&e.type!==this.type_||(void 0===n&&(n=e.dts),e.dts=qe(e.dts,n),e.pts=qe(e.pts,n),i=e.dts,this.trigger("data",e))},this.flush=function(){n=i,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,i=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Ve.prototype=new H;var We,ze=Ve,Ge=qe,Ke=function(e,t,i){var n,r="";for(n=t;n<i;n++)r+="%"+("00"+e[n].toString(16)).slice(-2);return r},Qe=function(e,t,i){return decodeURIComponent(Ke(e,t,i))},Xe=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Ye={TXXX:function(e){var t;if(3===e.data[0]){for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=Qe(e.data,1,t),e.value=Qe(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(3===e.data[0])for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=Qe(e.data,1,t),e.url=Qe(e.data,t+1,e.data.length);break}},PRIV:function(e){var t,i;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=(i=e.data,unescape(Ke(i,0,t)));break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}};(We=function(e){var t,i={descriptor:e&&e.descriptor},n=0,r=[],a=0;if(We.prototype.init.call(this),this.dispatchType=He.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(t=0;t<i.descriptor.length;t++)this.dispatchType+=("00"+i.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,i,s,o,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(a=0,r.length=0),0===r.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(r.push(e),a+=e.data.byteLength,1===r.length&&(n=Xe(e.data.subarray(6,10)),n+=10),!(a<n)){for(t={data:new Uint8Array(n),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<n;)t.data.set(r[0].data.subarray(0,n-l),l),l+=r[0].data.byteLength,a-=r[0].data.byteLength,r.shift();i=10,64&t.data[5]&&(i+=4,i+=Xe(t.data.subarray(10,14)),n-=Xe(t.data.subarray(16,20)));do{if((s=Xe(t.data.subarray(i+4,i+8)))<1)return void this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});if((o={id:String.fromCharCode(t.data[i],t.data[i+1],t.data[i+2],t.data[i+3]),data:t.data.subarray(i+10,i+s+10)}).key=o.id,Ye[o.id]&&(Ye[o.id](o),"com.apple.streaming.transportStreamTimestamp"===o.owner)){var u=o.data,d=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;d*=4,d+=3&u[7],o.timeStamp=d,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),i+=10,i+=s}while(i<n);this.trigger("data",t)}}}).prototype=new H;var $e,Je,Ze,et=We,tt=ze;($e=function(){var e=new Uint8Array(188),t=0;$e.prototype.init.call(this),this.push=function(i){var n,r=0,a=188;for(t?((n=new Uint8Array(i.byteLength+t)).set(e.subarray(0,t)),n.set(i,t),t=0):n=i;a<n.byteLength;)71!==n[r]||71!==n[a]?(r++,a++):(this.trigger("data",n.subarray(r,a)),r+=188,a+=188);r<n.byteLength&&(e.set(n.subarray(r),0),t=n.byteLength-r)},this.flush=function(){188===t&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}}).prototype=new H,(Je=function(){var e,t,i,n;Je.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,n){var r=0;n.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===n.type?t(e.subarray(r),n):i(e.subarray(r),n)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],n.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=n.pmtPid},i=function(e,t){var i,r;if(1&e[5]){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&e[1])<<8|e[2])-4,r=12+((15&e[10])<<8|e[11]);r<i;){var a=e[r],s=(31&e[r+1])<<8|e[r+2];a===He.H264_STREAM_TYPE&&null===n.programMapTable.video?n.programMapTable.video=s:a===He.ADTS_STREAM_TYPE&&null===n.programMapTable.audio?n.programMapTable.audio=s:a===He.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][s]=a),r+=5+((15&e[r+3])<<8|e[r+4])}t.programMapTable=n.programMapTable}},this.push=function(t){var i={},n=4;if(i.payloadUnitStartIndicator=!!(64&t[1]),i.pid=31&t[1],i.pid<<=8,i.pid|=t[2],(48&t[3])>>>4>1&&(n+=t[n]+1),0===i.pid)i.type="pat",e(t.subarray(n),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",e(t.subarray(n),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,n,i]):this.processPes_(t,n,i)},this.processPes_=function(e,t,i){i.pid===this.programMapTable.video?i.streamType=He.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=He.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=e.subarray(t),this.trigger("data",i)}}).prototype=new H,Je.STREAM_TYPES={h264:27,adts:15},(Ze=function(){var e,t=this,i=!1,n={data:[],size:0},r={data:[],size:0},a={data:[],size:0},s=function(e,i,n){var r,a,s=new Uint8Array(e.size),o={type:i},l=0,u=0;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)a=e.data[l],s.set(a.data,u),u+=a.data.byteLength;var d,c,h,p;c=o,p=(d=s)[0]<<16|d[1]<<8|d[2],c.data=new Uint8Array,1===p&&(c.packetLength=6+(d[4]<<8|d[5]),c.dataAlignmentIndicator=0!=(4&d[6]),192&(h=d[7])&&(c.pts=(14&d[9])<<27|(255&d[10])<<20|(254&d[11])<<12|(255&d[12])<<5|(254&d[13])>>>3,c.pts*=4,c.pts+=(6&d[13])>>>1,c.dts=c.pts,64&h&&(c.dts=(14&d[14])<<27|(255&d[15])<<20|(254&d[16])<<12|(255&d[17])<<5|(254&d[18])>>>3,c.dts*=4,c.dts+=(6&d[18])>>>1)),c.data=d.subarray(9+d[8])),r="video"===i||o.packetLength<=e.size,(n||r)&&(e.size=0,e.data.length=0),r&&t.trigger("data",o)}};Ze.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,t;switch(o.streamType){case He.H264_STREAM_TYPE:e=n,t="video";break;case He.ADTS_STREAM_TYPE:e=r,t="audio";break;case He.METADATA_STREAM_TYPE:e=a,t="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&s(e,t,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var n={type:"metadata",tracks:[]};null!==(e=o.programMapTable).video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),i=!0,t.trigger("data",n)}})[o.type]()},this.reset=function(){n.size=0,n.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){s(n,"video"),s(r,"audio"),s(a,"timed-metadata")},this.flush=function(){if(!i&&e){var n={type:"metadata",tracks:[]};null!==e.video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",n)}i=!1,this.flushStreams_(),this.trigger("done")}}).prototype=new H;var it={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:$e,TransportParseStream:Je,ElementaryStream:Ze,TimestampRolloverStream:tt,CaptionStream:je.CaptionStream,Cea608Stream:je.Cea608Stream,Cea708Stream:je.Cea708Stream,MetadataStream:et};for(var nt in He)He.hasOwnProperty(nt)&&(it[nt]=He[nt]);var rt,at=it,st=de,ot=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(rt=function(e){var t,i=0;rt.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:"adts skiping bytes "+e+" to "+t+" in frame "+i+" outside syncword"})},this.push=function(n){var r,a,s,o,l,u=0;if(e||(i=0),"audio"===n.type){var d;for(t&&t.length?(s=t,(t=new Uint8Array(s.byteLength+n.data.byteLength)).set(s),t.set(n.data,s.byteLength)):t=n.data;u+7<t.length;)if(255===t[u]&&240==(246&t[u+1])){if("number"==typeof d&&(this.skipWarn_(d,u),d=null),a=2*(1&~t[u+1]),r=(3&t[u+3])<<11|t[u+4]<<3|(224&t[u+5])>>5,l=(o=1024*(1+(3&t[u+6])))*st/ot[(60&t[u+2])>>>2],t.byteLength-u<r)break;this.trigger("data",{pts:n.pts+i*l,dts:n.dts+i*l,sampleCount:o,audioobjecttype:1+(t[u+2]>>>6&3),channelcount:(1&t[u+2])<<2|(192&t[u+3])>>>6,samplerate:ot[(60&t[u+2])>>>2],samplingfrequencyindex:(60&t[u+2])>>>2,samplesize:16,data:t.subarray(u+7+a,u+r)}),i++,u+=r}else"number"!=typeof d&&(d=u),u++;"number"==typeof d&&(this.skipWarn_(d,u),d=null),t=t.subarray(u)}},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}}).prototype=new H;var lt,ut,dt,ct=rt,ht=function(e){var t=e.byteLength,i=0,n=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+n},this.loadWord=function(){var r=e.byteLength-t,a=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");a.set(e.subarray(r,r+s)),i=new DataView(a.buffer).getUint32(0),n=8*s,t-=s},this.skipBits=function(e){var r;n>e?(i<<=e,n-=e):(e-=n,e-=8*(r=Math.floor(e/8)),t-=r,this.loadWord(),i<<=e,n-=e)},this.readBits=function(e){var r=Math.min(n,e),a=i>>>32-r;return(n-=r)>0?i<<=r:t>0&&this.loadWord(),(r=e-r)>0?a<<r|this.readBits(r):a},this.skipLeadingZeros=function(){var e;for(e=0;e<n;++e)if(0!=(i&2147483648>>>e))return i<<=e,n-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(ut=function(){var e,t,i=0;ut.prototype.init.call(this),this.push=function(n){var r;t?((r=new Uint8Array(t.byteLength+n.data.byteLength)).set(t),r.set(n.data,t.byteLength),t=r):t=n.data;for(var a=t.byteLength;i<a-3;i++)if(1===t[i+2]){e=i+5;break}for(;e<a;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}i+3!==e-2&&this.trigger("data",t.subarray(i+3,e-2));do{e++}while(1!==t[e]&&e<a);i=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(i+3,e-2)),i=e-2,e+=3;break;default:e+=3}t=t.subarray(i),e-=i,i=0},this.reset=function(){t=null,i=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(i+3)),t=null,i=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new H,dt={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(lt=function(){var e,t,i,n,r,a,s,o=new ut;lt.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,i=e.pts,n=e.dts,o.push(e))},o.on("data",function(s){var o={trackId:t,pts:i,dts:n,data:s,nalUnitTypeCode:31&s[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(s.subarray(1)),o.config=a(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),o.on("partialdone",function(){e.trigger("partialdone")}),o.on("reset",function(){e.trigger("reset")}),o.on("endedtimeline",function(){e.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},s=function(e,t){var i,n=8,r=8;for(i=0;i<e;i++)0!==r&&(r=(n+t.readExpGolomb()+256)%256),n=0===r?n:r},r=function(e){for(var t,i,n=e.byteLength,r=[],a=1;a<n-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return e;t=n-r.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=e[s];return i},a=function(e){var t,i,n,r,a,o,l,u,d,c,h,p,f=0,m=0,g=0,v=0,_=[1,1];if(i=(t=new ht(e)).readUnsignedByte(),r=t.readUnsignedByte(),n=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),dt[i]&&(3===(a=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(h=3!==a?8:12,p=0;p<h;p++)t.readBoolean()&&s(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),u=t.readUnsignedExpGolomb(),d=t.readUnsignedExpGolomb(),0===(c=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(f=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),v=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}_&&(_[0],_[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:r,width:16*(u+1)-2*f-2*m,height:(2-c)*(d+1)*16-2*g-2*v,sarRatio:_}}}).prototype=new H;var pt,ft={H264Stream:lt,NalByteStream:ut},mt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],gt=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return i=i>=0?i:0,(16&e[t+5])>>4?i+20:i+10},vt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},_t={isLikelyAacData:function(e){var t=function e(t,i){return t.length-i<10||t[i]!=="I".charCodeAt(0)||t[i+1]!=="D".charCodeAt(0)||t[i+2]!=="3".charCodeAt(0)?i:e(t,i+=gt(t,i))}(e,0);return e.length>=t+2&&255==(255&e[t])&&240==(240&e[t+1])&&16==(22&e[t+1])},parseId3TagSize:gt,parseAdtsSize:function(e,t){var i=(224&e[t+5])>>5,n=e[t+4]<<3;return 6144&e[t+3]|n|i},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&240==(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return mt[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,i,n;t=10,64&e[5]&&(t+=4,t+=vt(e.subarray(10,14)));do{if((i=vt(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){n=e.subarray(t+10,t+i+10);for(var r=0;r<n.byteLength;r++)if(0===n[r]){if("com.apple.streaming.transportStreamTimestamp"===unescape(function(e,t,i){var n,r="";for(n=t;n<i;n++)r+="%"+("00"+e[n].toString(16)).slice(-2);return r}(n,0,r))){var a=n.subarray(r+1),s=(1&a[3])<<30|a[4]<<22|a[5]<<14|a[6]<<6|a[7]>>>2;return s*=4,s+=3&a[7]}break}}t+=10,t+=i}while(t<e.byteLength);return null}};(pt=function(){var e=new Uint8Array,t=0;pt.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(i){var n,r,a,s,o=0,l=0;for(e.length?(s=e.length,(e=new Uint8Array(i.byteLength+s)).set(e.subarray(0,s)),e.set(i,s)):e=i;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255!=(255&e[l])||240!=(240&e[l+1]))l++;else{if(e.length-l<7)break;if(l+(o=_t.parseAdtsSize(e,l))>e.length)break;a={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",a),l+=o}else{if(e.length-l<10)break;if(l+(o=_t.parseId3TagSize(e,l))>e.length)break;r={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",r),l+=o}n=e.length-l,e=n>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new H;var yt,Tt,bt,St,kt=pt,Ct=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Et=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],wt=ft.H264Stream,It=_t.isLikelyAacData,xt=de,Pt=function(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},Lt=function(e,t,i,n,r,a){return{start:{dts:e,pts:e+(i-t)},end:{dts:e+(n-t),pts:e+(r-i)},prependedContentDuration:a,baseMediaDecodeTime:e}};(Tt=function(e,t){var i=[],n=0,r=0,a=0,s=1/0;t=t||{},Tt.prototype.init.call(this),this.push=function(t){ke(e,t),e&&Ct.forEach(function(i){e[i]=t[i]}),i.push(t)},this.setEarliestDts=function(e){r=e},this.setVideoBaseMediaDecodeTime=function(e){s=e},this.setAudioAppendStart=function(e){a=e},this.flush=function(){var o,l,u,d,c,h,p;0!==i.length?(o=ve(i,e,r),e.baseMediaDecodeTime=Se(e,t.keepOriginalTimestamps),p=ge(e,o,a,s),e.samples=_e(o),u=$(ye(o)),i=[],l=J(n,[e]),d=new Uint8Array(l.byteLength+u.byteLength),n++,d.set(l),d.set(u,l.byteLength),be(e),c=Math.ceil(1024*xt/e.samplerate),o.length&&(h=o.length*c,this.trigger("segmentTimingInfo",Lt(pe(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+h,o[0].pts+h,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+h})),this.trigger("data",{track:e,boxes:d}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){be(e),i=[],this.trigger("reset")}}).prototype=new H,(yt=function(e,t){var i,n,r=0,a=[],s=[];t=t||{},yt.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){ke(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.config,e.sps=[t.data],Et.forEach(function(t){e[t]=i[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.data,e.pps=[t.data]),a.push(t)},this.flush=function(){for(var i,n,o,l,u,d,c,h,p=0;a.length&&"access_unit_delimiter_rbsp"!==a[0].nalUnitType;)a.shift();if(0===a.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=te(a),(o=ie(i))[0][0].keyFrame||((n=this.getGopForFusion_(a[0],e))?(p=n.duration,o.unshift(n),o.byteLength+=n.byteLength,o.nalCount+=n.nalCount,o.pts=n.pts,o.dts=n.dts,o.duration+=n.duration):o=ne(o)),s.length){var f;if(!(f=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");be(e),o=f}ke(e,o),e.samples=re(o),u=$(ae(o)),e.baseMediaDecodeTime=Se(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),c=o[0],h=o[o.length-1],this.trigger("segmentTimingInfo",Lt(e.baseMediaDecodeTime,c.dts,c.pts,h.dts+h.duration,h.pts+h.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=J(r,[e]),d=new Uint8Array(l.byteLength+u.byteLength),r++,d.set(l),d.set(u,l.byteLength),this.trigger("data",{track:e,boxes:d}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),a=[],this.gopCache_.length=0,s.length=0,this.trigger("reset")},this.resetStream_=function(){be(e),i=void 0,n=void 0},this.getGopForFusion_=function(t){var i,n,r,a,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)r=(a=this.gopCache_[s]).gop,e.pps&&Pt(e.pps[0],a.pps[0])&&e.sps&&Pt(e.sps[0],a.sps[0])&&(r.dts<e.timelineStartInfo.dts||(i=t.dts-r.dts-r.duration)>=-1e4&&i<=45e3&&(!n||o>i)&&(n=a,o=i));return n?n.gop:null},this.alignGopsAtStart_=function(e){var t,i,n,r,a,o,l,u;for(a=e.byteLength,o=e.nalCount,l=e.duration,t=i=0;t<s.length&&i<e.length&&(n=s[t],r=e[i],n.pts!==r.pts);)r.pts>n.pts?t++:(i++,a-=r.byteLength,o-=r.nalCount,l-=r.duration);return 0===i?e:i===e.length?null:((u=e.slice(i)).byteLength=a,u.duration=l,u.nalCount=o,u.pts=u[0].pts,u.dts=u[0].dts,u)},this.alignGopsAtEnd_=function(e){var t,i,n,r,a,o,l;for(t=s.length-1,i=e.length-1,a=null,o=!1;t>=0&&i>=0;){if(n=s[t],r=e[i],n.pts===r.pts){o=!0;break}n.pts>r.pts?t--:(t===s.length-1&&(a=i),i--)}if(!o&&null===a)return null;if(0===(l=o?i:a))return e;var u=e.slice(l),d=u.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return u.byteLength=d.byteLength,u.duration=d.duration,u.nalCount=d.nalCount,u.pts=u[0].pts,u.dts=u[0].dts,u},this.alignGopsWith=function(e){s=e}}).prototype=new H,(St=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==(e=e||{}).remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"==typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,St.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}}).prototype=new H,St.prototype.flush=function(e){var t,i,n,r,a=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,Et.forEach(function(e){s.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Ct.forEach(function(e){s.info[e]=this.audioTrack[e]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,n=Z(this.pendingTracks),s.initSegment=new Uint8Array(n.byteLength),s.initSegment.set(n),s.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)s.data.set(this.pendingBoxes[r],a),a+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(t=this.pendingCaptions[r]).startTime=me(t.startPts,o,this.keepOriginalTimestamps),t.endTime=me(t.endPts,o,this.keepOriginalTimestamps),s.captionStreams[t.stream]=!0,s.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)(i=this.pendingMetadata[r]).cueTime=me(i.pts,o,this.keepOriginalTimestamps),s.metadata.push(i);for(s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),r=0;r<s.captions.length;r++)t=s.captions[r],this.trigger("caption",t);for(r=0;r<s.metadata.length;r++)i=s.metadata[r],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},St.prototype.setRemux=function(e){this.remuxTracks=e},(bt=function(e){var t,i,n=this,r=!0;bt.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new at.MetadataStream,r.aacStream=new kt,r.audioTimestampRolloverStream=new at.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new at.TimestampRolloverStream("timed-metadata"),r.adtsStream=new ct,r.coalesceStream=new St(e,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",function(e){r.aacStream.setTimestamp(e.timeStamp)}),r.aacStream.on("data",function(a){"timed-metadata"!==a.type&&"audio"!==a.type||r.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new Tt(i,e),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!t}))}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new at.MetadataStream,r.packetStream=new at.TransportPacketStream,r.parseStream=new at.TransportParseStream,r.elementaryStream=new at.ElementaryStream,r.timestampRolloverStream=new at.TimestampRolloverStream,r.adtsStream=new ct,r.h264Stream=new wt,r.captionStream=new at.CaptionStream(e),r.coalesceStream=new St(e,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(a){var s;if("metadata"===a.type){for(s=a.tracks.length;s--;)t||"video"!==a.tracks[s].type?i||"audio"!==a.tracks[s].type||((i=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime):(t=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime;t&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new yt(t,e),r.videoSegmentStream.on("log",n.getLogTrigger_("videoSegmentStream")),r.videoSegmentStream.on("timelineStartInfo",function(t){i&&!e.keepOriginalTimestamps&&(i.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts-n.baseMediaDecodeTime))}),r.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(e){i&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),r.videoSegmentStream.on("timingInfo",n.trigger.bind(n,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),i&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new Tt(i,e),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.audioSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"audioSegmentTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!t})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(e){e.dispatchType=r.metadataStream.dispatchType,n.trigger("id3Frame",e)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(n){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=n),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,be(i),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,be(t),r.captionStream.reset()),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var i=this.transmuxPipeline_;e.remux=t,i&&i.coalesceStream&&i.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(i){i.stream=e,t.trigger("log",i)}},this.push=function(e){if(r){var t=It(e);if(t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),this.transmuxPipeline_)for(var i=Object.keys(this.transmuxPipeline_),n=0;n<i.length;n++){var a=i[n];"headOfPipeline"!==a&&this.transmuxPipeline_[a].on&&this.transmuxPipeline_[a].on("log",this.getLogTrigger_(a))}r=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new H;var At,Ot,Dt,Mt={Transmuxer:bt,VideoSegmentStream:yt,AudioSegmentStream:Tt,AUDIO_PROPERTIES:Ct,VIDEO_PROPERTIES:Et,generateSegmentTimingInfo:Lt},Rt=function(e){return e>>>0},Ut=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},Bt=Rt,Ft=function e(t,i){var n,r,a,s,o,l=[];if(!i.length)return null;for(n=0;n<t.byteLength;)r=Bt(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3]),a=Ut(t.subarray(n+4,n+8)),s=r>1?n+r:t.byteLength,a===i[0]&&(1===i.length?l.push(t.subarray(n+8,s)):(o=e(t.subarray(n+8,s),i.slice(1))).length&&(l=l.concat(o))),n=s;return l},Nt=Rt,jt=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:Nt(e[4]<<24|e[5]<<16|e[6]<<8|e[7])};return 1===t.version&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=Nt(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),t},Ht=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},qt=function(e){var t,i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},n=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&i.flags[2],a=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],l=4&i.flags[1],u=8&i.flags[1],d=n.getUint32(4),c=8;for(r&&(i.dataOffset=n.getInt32(c),c+=4),a&&d&&(t={flags:Ht(e.subarray(c,c+4))},c+=4,s&&(t.duration=n.getUint32(c),c+=4),o&&(t.size=n.getUint32(c),c+=4),u&&(1===i.version?t.compositionTimeOffset=n.getInt32(c):t.compositionTimeOffset=n.getUint32(c),c+=4),i.samples.push(t),d--);d--;)t={},s&&(t.duration=n.getUint32(c),c+=4),o&&(t.size=n.getUint32(c),c+=4),l&&(t.flags=Ht(e.subarray(c,c+4)),c+=4),u&&(1===i.version?t.compositionTimeOffset=n.getInt32(c):t.compositionTimeOffset=n.getUint32(c),c+=4),i.samples.push(t);return i},Vt=function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:i.getUint32(4)},r=1&n.flags[2],a=2&n.flags[2],s=8&n.flags[2],o=16&n.flags[2],l=32&n.flags[2],u=65536&n.flags[0],d=131072&n.flags[0];return t=8,r&&(t+=4,n.baseDataOffset=i.getUint32(12),t+=4),a&&(n.sampleDescriptionIndex=i.getUint32(t),t+=4),s&&(n.defaultSampleDuration=i.getUint32(t),t+=4),o&&(n.defaultSampleSize=i.getUint32(t),t+=4),l&&(n.defaultSampleFlags=i.getUint32(t)),u&&(n.durationIsEmpty=!0),!r&&d&&(n.baseDataOffsetIsMoof=!0),n},Wt=Ie,zt=je.CaptionStream,Gt=function(e,t){for(var i=e,n=0;n<t.length;n++){var r=t[n];if(i<r.size)return r;i-=r.size}return null},Kt=function(e,t){var i=Ft(e,["moof","traf"]),n=Ft(e,["mdat"]),r={},a=[];return n.forEach(function(e,t){var n=i[t];a.push({mdat:e,traf:n})}),a.forEach(function(e){var i,n=e.mdat,a=e.traf,s=Ft(a,["tfhd"]),o=Vt(s[0]),l=o.trackId,u=Ft(a,["tfdt"]),d=u.length>0?jt(u[0]).baseMediaDecodeTime:0,c=Ft(a,["trun"]);t===l&&c.length>0&&(i=function(e,t,i){var n,r,a,s,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(r=0;r+4<e.length;r+=a)if(a=o.getUint32(r),r+=4,!(a<=0))switch(31&e[r]){case 6:var u=e.subarray(r+1,r+1+a),d=Gt(r,t);if(n={nalUnitType:"sei_rbsp",size:a,data:u,escapedRBSP:Wt(u),trackId:i},d)n.pts=d.pts,n.dts=d.dts,s=d;else{if(!s){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+r+" for trackId "+i+". See mux.js#223."});break}n.pts=s.pts,n.dts=s.dts}l.seiNals.push(n)}return l}(n,function(e,t,i){var n=t,r=i.defaultSampleDuration||0,a=i.defaultSampleSize||0,s=i.trackId,o=[];return e.forEach(function(e){var t=qt(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=a),e.trackId=s,e.dts=n,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),e.pts=n+e.compositionTimeOffset,n+=e.duration}),o=o.concat(t)}),o}(c,d,o),l),r[l]||(r[l]={seiNals:[],logs:[]}),r[l].seiNals=r[l].seiNals.concat(i.seiNals),r[l].logs=r[l].logs.concat(i.logs))}),r},Qt=function(){var e,t,i,n,r,a,s=!1;this.isInitialized=function(){return s},this.init=function(t){e=new zt,s=!0,a=!!t&&t.isPartial,e.on("data",function(e){e.startTime=e.startPts/n,e.endTime=e.endPts/n,r.captions.push(e),r.captionStreams[e.stream]=!0}),e.on("log",function(e){r.logs.push(e)})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length||i===e[0]&&n===t[i])},this.parse=function(e,a,s){var o;if(!this.isInitialized())return null;if(!a||!s)return null;if(this.isNewInit(a,s))i=a[0],n=s[i];else if(null===i||!n)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,a,s)}return(o=function(e,t,i){if(null===t)return null;var n=Kt(e,t)[t]||{};return{seiNals:n.seiNals,logs:n.logs,timescale:i}}(e,i,n))&&o.logs&&(r.logs=r.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):r.logs.length?{logs:r.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;a?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={},r.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],i=null,n=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Xt=Rt,Yt=function(e){return("00"+e.toString(16)).slice(-2)};At=function(e,t){var i,n,r;return i=Ft(t,["moof","traf"]),n=[].concat.apply([],i.map(function(t){return Ft(t,["tfhd"]).map(function(i){var n,r,a;return n=Xt(i[4]<<24|i[5]<<16|i[6]<<8|i[7]),r=e[n]||9e4,(a="number"!=typeof(a=Ft(t,["tfdt"]).map(function(e){var t,i;return t=e[0],i=Xt(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),1===t&&(i*=Math.pow(2,32),i+=Xt(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),i})[0])||isNaN(a)?1/0:a)/r})})),r=Math.min.apply(null,n),isFinite(r)?r:0},Ot=function(e){var t=Ft(e,["moov","trak"]),i=[];return t.forEach(function(e){var t,n,r={},a=Ft(e,["tkhd"])[0];a&&(n=(t=new DataView(a.buffer,a.byteOffset,a.byteLength)).getUint8(0),r.id=0===n?t.getUint32(12):t.getUint32(20));var s=Ft(e,["mdia","hdlr"])[0];if(s){var o=Ut(s.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var l=Ft(e,["mdia","minf","stbl","stsd"])[0];if(l){var u=l.subarray(8);r.codec=Ut(u.subarray(4,8));var d,c=Ft(u,[r.codec])[0];c&&(/^[a-z]vc[1-9]$/i.test(r.codec)?(d=c.subarray(78),"avcC"===Ut(d.subarray(4,8))&&d.length>11?(r.codec+=".",r.codec+=Yt(d[9]),r.codec+=Yt(d[10]),r.codec+=Yt(d[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)?(d=c.subarray(28),"esds"===Ut(d.subarray(4,8))&&d.length>20&&0!==d[19]?(r.codec+="."+Yt(d[19]),r.codec+="."+Yt(d[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"):r.codec=r.codec.toLowerCase())}var h=Ft(e,["mdia","mdhd"])[0];h&&(r.timescale=Dt(h)),i.push(r)}),i};var $t=At,Jt=Ot,Zt=(Dt=function(e){var t=0===e[0]?12:20;return Xt(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},function(e){var t=31&e[1];return t<<=8,t|=e[2]}),ei=function(e){return!!(64&e[1])},ti=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},ii=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},ni={parseType:function(e,t){var i=Zt(e);return 0===i?"pat":i===t?"pmt":t?"pes":null},parsePat:function(e){var t=ei(e),i=4+ti(e);return t&&(i+=e[i]+1),(31&e[i+10])<<8|e[i+11]},parsePmt:function(e){var t={},i=ei(e),n=4+ti(e);if(i&&(n+=e[n]+1),1&e[n+5]){var r;r=3+((15&e[n+1])<<8|e[n+2])-4;for(var a=12+((15&e[n+10])<<8|e[n+11]);a<r;){var s=n+a;t[(31&e[s+1])<<8|e[s+2]]=e[s],a+=5+((15&e[s+3])<<8|e[s+4])}return t}},parsePayloadUnitStartIndicator:ei,parsePesType:function(e,t){switch(t[Zt(e)]){case He.H264_STREAM_TYPE:return"video";case He.ADTS_STREAM_TYPE:return"audio";case He.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!ei(e))return null;var t=4+ti(e);if(t>=e.byteLength)return null;var i,n=null;return 192&(i=e[t+7])&&((n={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,n.pts*=4,n.pts+=(6&e[t+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,n.dts*=4,n.dts+=(6&e[t+18])>>>1)),n},videoPacketContainsKeyFrame:function(e){for(var t=4+ti(e),i=e.subarray(t),n=0,r=0,a=!1;r<i.byteLength-3;r++)if(1===i[r+2]){n=r+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}r+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===ii(31&i[r+3])&&(a=!0);do{n++}while(1!==i[n]&&n<i.length);r=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===ii(31&i[r+3])&&(a=!0),r=n-2,n+=3;break;default:n+=3}return i=i.subarray(r),n-=r,r=0,i&&i.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===ii(31&i[r+3])&&(a=!0),a}},ri=Ge,ai={};ai.ts=ni,ai.aac=_t;var si=de,oi=function(e,t,i){for(var n,r,a,s,o=0,l=188,u=!1;l<=e.byteLength;)if(71!==e[o]||71!==e[l]&&l!==e.byteLength)o++,l++;else{switch(n=e.subarray(o,l),ai.ts.parseType(n,t.pid)){case"pes":r=ai.ts.parsePesType(n,t.table),a=ai.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=ai.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),u=!0)}if(u)break;o+=188,l+=188}for(o=(l=e.byteLength)-188,u=!1;o>=0;)if(71!==e[o]||71!==e[l]&&l!==e.byteLength)o--,l--;else{switch(n=e.subarray(o,l),ai.ts.parseType(n,t.pid)){case"pes":r=ai.ts.parsePesType(n,t.table),a=ai.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=ai.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),u=!0)}if(u)break;o-=188,l-=188}},li=function(e,t,i){for(var n,r,a,s,o,l,u,d=0,c=188,h=!1,p={data:[],size:0};c<e.byteLength;)if(71!==e[d]||71!==e[c])d++,c++;else{switch(n=e.subarray(d,c),ai.ts.parseType(n,t.pid)){case"pes":if(r=ai.ts.parsePesType(n,t.table),a=ai.ts.parsePayloadUnitStartIndicator(n),"video"===r&&(a&&!h&&(s=ai.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),h=!0),!i.firstKeyFrame)){if(a&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)u=p.data.shift(),o.set(u,l),l+=u.byteLength;if(ai.ts.videoPacketContainsKeyFrame(o)){var f=ai.ts.parsePesTime(o);f?(i.firstKeyFrame=f,i.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(n),p.size+=n.byteLength}}if(h&&i.firstKeyFrame)break;d+=188,c+=188}for(d=(c=e.byteLength)-188,h=!1;d>=0;)if(71!==e[d]||71!==e[c])d--,c--;else{switch(n=e.subarray(d,c),ai.ts.parseType(n,t.pid)){case"pes":r=ai.ts.parsePesType(n,t.table),a=ai.ts.parsePayloadUnitStartIndicator(n),"video"===r&&a&&(s=ai.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),h=!0)}if(h)break;d-=188,c-=188}},ui=function(e){var t={pid:null,table:null},i={};for(var n in function(e,t){for(var i,n=0,r=188;r<e.byteLength;)if(71!==e[n]||71!==e[r])n++,r++;else{switch(i=e.subarray(n,r),ai.ts.parseType(i,t.pid)){case"pat":t.pid=ai.ts.parsePat(i);break;case"pmt":var a=ai.ts.parsePmt(i);t.table=t.table||{},Object.keys(a).forEach(function(e){t.table[e]=a[e]})}n+=188,r+=188}}(e,t),t.table){if(t.table.hasOwnProperty(n))switch(t.table[n]){case He.H264_STREAM_TYPE:i.video=[],li(e,t,i),0===i.video.length&&delete i.video;break;case He.ADTS_STREAM_TYPE:i.audio=[],oi(e,t,i),0===i.audio.length&&delete i.audio}}return i},di=function(e,t){var i;return(i=ai.aac.isLikelyAacData(e)?function(e){for(var t,i=!1,n=0,r=null,a=null,s=0,o=0;e.length-o>=3;){switch(ai.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){i=!0;break}if((s=ai.aac.parseId3TagSize(e,o))>e.length){i=!0;break}null===a&&(t=e.subarray(o,o+s),a=ai.aac.parseAacTimestamp(t)),o+=s;break;case"audio":if(e.length-o<7){i=!0;break}if((s=ai.aac.parseAdtsSize(e,o))>e.length){i=!0;break}null===r&&(t=e.subarray(o,o+s),r=ai.aac.parseSampleRate(t)),n++,o+=s;break;default:o++}if(i)return null}if(null===r||null===a)return null;var l=si/r;return{audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+1024*n*l,pts:a+1024*n*l}]}}(e):ui(e))&&(i.audio||i.video)?(function(e,t){if(e.audio&&e.audio.length){var i=t;(void 0===i||isNaN(i))&&(i=e.audio[0].dts),e.audio.forEach(function(e){e.dts=ri(e.dts,i),e.pts=ri(e.pts,i),e.dtsTime=e.dts/si,e.ptsTime=e.pts/si})}if(e.video&&e.video.length){var n=t;if((void 0===n||isNaN(n))&&(n=e.video[0].dts),e.video.forEach(function(e){e.dts=ri(e.dts,n),e.pts=ri(e.pts,n),e.dtsTime=e.dts/si,e.ptsTime=e.pts/si}),e.firstKeyFrame){var r=e.firstKeyFrame;r.dts=ri(r.dts,n),r.pts=ri(r.pts,n),r.dtsTime=r.dts/si,r.ptsTime=r.pts/si}}}(i,t),i):null},ci=function(){function e(e,t){this.options=t||{},this.self=e,this.init()}var t=e.prototype;return t.init=function(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new Mt.Transmuxer(this.options),function(e,t){t.on("data",function(t){var i=t.initSegment;t.initSegment={data:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength};var n=t.data;t.data=n.buffer,e.postMessage({action:"data",segment:t,byteOffset:n.byteOffset,byteLength:n.byteLength},[t.data])}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){var i={start:{decode:he(t.start.dts),presentation:he(t.start.pts)},end:{decode:he(t.end.dts),presentation:he(t.end.pts)},baseMediaDecodeTime:he(t.baseMediaDecodeTime)};t.prependedContentDuration&&(i.prependedContentDuration=he(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:i})}),t.on("audioSegmentTimingInfo",function(t){var i={start:{decode:he(t.start.dts),presentation:he(t.start.pts)},end:{decode:he(t.end.dts),presentation:he(t.end.pts)},baseMediaDecodeTime:he(t.baseMediaDecodeTime)};t.prependedContentDuration&&(i.prependedContentDuration=he(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:i})}),t.on("id3Frame",function(t){e.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){e.postMessage({action:"caption",caption:t})}),t.on("trackinfo",function(t){e.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:he(t.start),end:he(t.end)}})}),t.on("videoTimingInfo",function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:he(t.start),end:he(t.end)}})}),t.on("log",function(t){e.postMessage({action:"log",log:t})})}(this.self,this.transmuxer)},t.pushMp4Captions=function(e){this.captionParser||(this.captionParser=new Qt,this.captionParser.init());var t=new Uint8Array(e.data,e.byteOffset,e.byteLength),i=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:i&&i.captions||[],logs:i&&i.logs||[],data:t.buffer},[t.buffer])},t.probeMp4StartTime=function(e){var t=e.timescales,i=e.data,n=$t(t,i);this.self.postMessage({action:"probeMp4StartTime",startTime:n,data:i},[i.buffer])},t.probeMp4Tracks=function(e){var t=e.data,i=Jt(t);this.self.postMessage({action:"probeMp4Tracks",tracks:i,data:t},[t.buffer])},t.probeTs=function(e){var t=e.data,i=e.baseStartTime,n="number"!=typeof i||isNaN(i)?void 0:i*de,r=di(t,n),a=null;r&&((a={hasVideo:r.video&&2===r.video.length||!1,hasAudio:r.audio&&2===r.audio.length||!1}).hasVideo&&(a.videoStart=r.video[0].ptsTime),a.hasAudio&&(a.audioStart=r.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:a,data:t},[t.buffer])},t.clearAllMp4Captions=function(){this.captionParser&&this.captionParser.clearAllCaptions()},t.clearParsedMp4Captions=function(){this.captionParser&&this.captionParser.clearParsedCaptions()},t.push=function(e){var t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)},t.reset=function(){this.transmuxer.reset()},t.setTimestampOffset=function(e){var t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(ce(t)))},t.setAudioAppendStart=function(e){this.transmuxer.setAudioAppendStart(Math.ceil(ce(e.appendStart)))},t.setRemux=function(e){this.transmuxer.setRemux(e.remux)},t.flush=function(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})},t.endTimeline=function(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})},t.alignGopsWith=function(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())},e}();self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new ci(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new ci(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}})),_o=fo(vo),yo=function(e,t,i){var n=e.data.segment,r=n.type,a=n.initSegment,s=n.captions,o=n.captionStreams,l=n.metadata,u=n.videoFrameDtsTime,d=n.videoFramePtsTime;t.buffer.push({captions:s,captionStreams:o,metadata:l});var c=e.data.segment.boxes||{data:e.data.segment.data},h={type:r,data:new Uint8Array(c.data,c.data.byteOffset,c.data.byteLength),initSegment:new Uint8Array(a.data,a.byteOffset,a.byteLength)};void 0!==u&&(h.videoFrameDtsTime=u),void 0!==d&&(h.videoFramePtsTime=d),i(h)},To=function(e){var t=e.transmuxedData,i=e.callback;t.buffer=[],i(t)},bo=function(e,t){t.gopInfo=e.data.gopInfo},So=function(e){var t=e.transmuxer,i=e.bytes,n=e.audioAppendStart,r=e.gopsToAlignWith,a=e.remux,s=e.onData,o=e.onTrackInfo,l=e.onAudioTimingInfo,u=e.onVideoTimingInfo,d=e.onVideoSegmentTimingInfo,c=e.onAudioSegmentTimingInfo,h=e.onId3,p=e.onCaptions,f=e.onDone,m=e.onEndedTimeline,g=e.onTransmuxerLog,v=e.isEndOfTimeline,_={buffer:[]},y=v;if(t.onmessage=function(i){t.currentTransmux===e&&("data"===i.data.action&&yo(i,_,s),"trackinfo"===i.data.action&&o(i.data.trackInfo),"gopInfo"===i.data.action&&bo(i,_),"audioTimingInfo"===i.data.action&&l(i.data.audioTimingInfo),"videoTimingInfo"===i.data.action&&u(i.data.videoTimingInfo),"videoSegmentTimingInfo"===i.data.action&&d(i.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===i.data.action&&c(i.data.audioSegmentTimingInfo),"id3Frame"===i.data.action&&h([i.data.id3Frame],i.data.id3Frame.dispatchType),"caption"===i.data.action&&p(i.data.caption),"endedtimeline"===i.data.action&&(y=!1,m()),"log"===i.data.action&&g(i.data.log),"transmuxed"===i.data.type&&(y||(t.onmessage=null,To({transmuxedData:_,callback:f}),ko(t))))},n&&t.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),void 0!==a&&t.postMessage({action:"setRemux",remux:a}),i.byteLength){var T=i instanceof ArrayBuffer?i:i.buffer,b=i instanceof ArrayBuffer?0:i.byteOffset;t.postMessage({action:"push",data:T,byteOffset:b,byteLength:i.byteLength},[T])}v&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},ko=function(e){e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"==typeof e.currentTransmux?e.currentTransmux():So(e.currentTransmux))},Co=function(e,t){e.postMessage({action:t}),ko(e)},Eo=function(e,t){if(!t.currentTransmux)return t.currentTransmux=e,void Co(t,e);t.transmuxQueue.push(Co.bind(null,t,e))},wo=function(e){Eo("reset",e)},Io=function(e){Eo("endTimeline",e)},xo=function(e){if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void So(e);e.transmuxer.transmuxQueue.push(e)},Po=function(e){var t=new _o;t.currentTransmux=null,t.transmuxQueue=[];var i=t.terminate;return t.terminate=function(){return t.currentTransmux=null,t.transmuxQueue.length=0,i.call(t)},t.postMessage({action:"init",options:e}),t},Lo={reset:wo,endTimeline:Io,transmux:xo,createTransmuxer:Po},Ao=function(e){var t=e.transmuxer,n=e.endAction||e.action,r=e.callback,a=(0,i.default)({},e,{endAction:null,transmuxer:null,callback:null});if(t.addEventListener("message",function i(a){a.data.action===n&&(t.removeEventListener("message",i),a.data.data&&(a.data.data=new Uint8Array(a.data.data,e.byteOffset||0,e.byteLength||a.data.data.byteLength),e.data&&(e.data=a.data.data)),r(a.data))}),e.data){var s=e.data instanceof ArrayBuffer;a.byteOffset=s?0:e.data.byteOffset,a.byteLength=e.data.byteLength;var o=[s?e.data:e.data.buffer];t.postMessage(a,o)}else t.postMessage(a)},Oo={FAILURE:2,TIMEOUT:-101,ABORTED:-102},Do=function(e){e.forEach(function(e){e.abort()})},Mo=function(e){return{bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}},Ro=function(e){var t=e.target,i={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return i.bytesReceived=e.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i},Uo=function(e,t){return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:Oo.TIMEOUT,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:Oo.ABORTED,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:Oo.FAILURE,xhr:t}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:Oo.FAILURE,xhr:t}:null},Bo=function(e,t,i){return function(n,r){var a=r.response,s=Uo(n,r);if(s)return i(s,e);if(16!==a.byteLength)return i({status:r.status,message:"Invalid HLS key at URL: "+r.uri,code:Oo.FAILURE,xhr:r},e);for(var o=new DataView(a),l=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]),u=0;u<t.length;u++)t[u].bytes=l;return i(null,e)}},Fo=function(e,t){var i=(0,_.detectContainerForBytes)(e.map.bytes);if("mp4"!==i){var n=e.map.resolvedUri||e.map.uri;return t({internal:!0,message:"Found unsupported "+(i||"unknown")+" container for initialization segment at URL: "+n,code:Oo.FAILURE})}Ao({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:function(i){var n=i.tracks,r=i.data;return e.map.bytes=r,n.forEach(function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"==typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale))}),t(null)}})},No=function(e){var t=e.segment,i=e.finishProcessingFn;return function(e,n){var r=Uo(e,n);if(r)return i(r,t);var a=new Uint8Array(n.response);if(t.map.key)return t.map.encryptedBytes=a,i(null,t);t.map.bytes=a,Fo(t,function(e){if(e)return e.xhr=n,e.status=n.status,i(e,t);i(null,t)})}},jo=function(e){var t=e.segment,i=e.finishProcessingFn,n=e.responseType;return function(e,r){var a=Uo(e,r);if(a)return i(a,t);var s="arraybuffer"!==n&&r.responseText?co(r.responseText.substring(t.lastReachedChar||0)):r.response;return t.stats=Mo(r),t.key?t.encryptedBytes=new Uint8Array(s):t.bytes=new Uint8Array(s),i(null,t)}},Ho=function(e){var t=e.segment,i=e.bytes,n=e.trackInfoFn,r=e.timingInfoFn,a=e.videoSegmentTimingInfoFn,s=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,d=e.endedTimelineFn,c=e.dataFn,h=e.doneFn,p=e.onTransmuxerLog,f=t.map&&t.map.tracks||{},m=Boolean(f.audio&&f.video),g=r.bind(null,t,"audio","start"),v=r.bind(null,t,"audio","end"),_=r.bind(null,t,"video","start"),y=r.bind(null,t,"video","end");Ao({action:"probeTs",transmuxer:t.transmuxer,data:i,baseStartTime:t.baseStartTime,callback:function(e){t.bytes=i=e.data;var r=e.result;r&&(n(t,{hasAudio:r.hasAudio,hasVideo:r.hasVideo,isMuxed:m}),n=null,r.hasAudio&&!m&&g(r.audioStart),r.hasVideo&&_(r.videoStart),g=null,_=null),xo({bytes:i,transmuxer:t.transmuxer,audioAppendStart:t.audioAppendStart,gopsToAlignWith:t.gopsToAlignWith,remux:m,onData:function(e){e.type="combined"===e.type?"video":e.type,c(t,e)},onTrackInfo:function(e){n&&(m&&(e.isMuxed=!0),n(t,e))},onAudioTimingInfo:function(e){g&&void 0!==e.start&&(g(e.start),g=null),v&&void 0!==e.end&&v(e.end)},onVideoTimingInfo:function(e){_&&void 0!==e.start&&(_(e.start),_=null),y&&void 0!==e.end&&y(e.end)},onVideoSegmentTimingInfo:function(e){a(e)},onAudioSegmentTimingInfo:function(e){s(e)},onId3:function(e,i){o(t,e,i)},onCaptions:function(e){l(t,[e])},isEndOfTimeline:u,onEndedTimeline:function(){d()},onTransmuxerLog:p,onDone:function(e){h&&(e.type="combined"===e.type?"video":e.type,h(null,t,e))}})}})},qo=function(e){var t=e.segment,i=e.bytes,n=e.trackInfoFn,r=e.timingInfoFn,a=e.videoSegmentTimingInfoFn,s=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,d=e.endedTimelineFn,c=e.dataFn,h=e.doneFn,p=e.onTransmuxerLog,f=new Uint8Array(i);if((0,_.isLikelyFmp4MediaSegment)(f)){t.isFmp4=!0;var m=t.map.tracks,g={isFmp4:!0,hasVideo:!!m.video,hasAudio:!!m.audio};m.audio&&m.audio.codec&&"enca"!==m.audio.codec&&(g.audioCodec=m.audio.codec),m.video&&m.video.codec&&"encv"!==m.video.codec&&(g.videoCodec=m.video.codec),m.video&&m.audio&&(g.isMuxed=!0),n(t,g);var v=function(e){c(t,{data:f,type:g.hasAudio&&!g.isMuxed?"audio":"video"}),e&&e.length&&l(t,e),h(null,t,{})};Ao({action:"probeMp4StartTime",timescales:t.map.timescales,data:f,transmuxer:t.transmuxer,callback:function(e){var n=e.data,a=e.startTime;i=n.buffer,t.bytes=f=n,g.hasAudio&&!g.isMuxed&&r(t,"audio","start",a),g.hasVideo&&r(t,"video","start",a),m.video&&n.byteLength&&t.transmuxer?Ao({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:t.transmuxer,data:f,timescales:t.map.timescales,trackIds:[m.video.id],callback:function(e){i=e.data.buffer,t.bytes=f=e.data,e.logs.forEach(function(e){p(_a.mergeOptions(e,{stream:"mp4CaptionParser"}))}),v(e.captions)}}):v()}})}else if(t.transmuxer){if(void 0===t.container&&(t.container=(0,_.detectContainerForBytes)(f)),"ts"!==t.container&&"aac"!==t.container)return n(t,{hasAudio:!1,hasVideo:!1}),void h(null,t,{});Ho({segment:t,bytes:i,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:c,doneFn:h,onTransmuxerLog:p})}else h(null,t,{})},Vo=function(e,t){var i,n=e.id,r=e.key,a=e.encryptedBytes,s=e.decryptionWorker;s.addEventListener("message",function e(i){if(i.data.source===n){s.removeEventListener("message",e);var r=i.data.decrypted;t(new Uint8Array(r.bytes,r.byteOffset,r.byteLength))}}),i=r.bytes.slice?r.bytes.slice():new Uint32Array(Array.prototype.slice.call(r.bytes)),s.postMessage(Us({source:n,encrypted:a,key:i,iv:r.iv}),[a.buffer,i.buffer])},Wo=function(e){var t=e.decryptionWorker,i=e.segment,n=e.trackInfoFn,r=e.timingInfoFn,a=e.videoSegmentTimingInfoFn,s=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,d=e.endedTimelineFn,c=e.dataFn,h=e.doneFn,p=e.onTransmuxerLog;Vo({id:i.requestId,key:i.key,encryptedBytes:i.encryptedBytes,decryptionWorker:t},function(e){i.bytes=e,qo({segment:i,bytes:i.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:c,doneFn:h,onTransmuxerLog:p})})},zo=function(e){var t=e.activeXhrs,i=e.decryptionWorker,n=e.trackInfoFn,r=e.timingInfoFn,a=e.videoSegmentTimingInfoFn,s=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,d=e.endedTimelineFn,c=e.dataFn,h=e.doneFn,p=e.onTransmuxerLog,f=0,m=!1;return function(e,g){if(!m){if(e)return m=!0,Do(t),h(e,g);if((f+=1)===t.length){var v=function(){if(g.encryptedBytes)return Wo({decryptionWorker:i,segment:g,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:c,doneFn:h,onTransmuxerLog:p});qo({segment:g,bytes:g.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:c,doneFn:h,onTransmuxerLog:p})};if(g.endOfAllRequests=Date.now(),g.map&&g.map.encryptedBytes&&!g.map.bytes)return Vo({decryptionWorker:i,id:g.requestId+"-init",encryptedBytes:g.map.encryptedBytes,key:g.map.key},function(e){g.map.bytes=e,Fo(g,function(e){if(e)return Do(t),h(e,g);v()})});v()}}}},Go=function(e){var t=e.loadendState,i=e.abortFn;return function(e){e.target.aborted&&i&&!t.calledAbortFn&&(i(),t.calledAbortFn=!0)}},Ko=function(e){var t=e.segment,i=e.progressFn;return e.trackInfoFn,e.timingInfoFn,e.videoSegmentTimingInfoFn,e.audioSegmentTimingInfoFn,e.id3Fn,e.captionsFn,e.isEndOfTimeline,e.endedTimelineFn,e.dataFn,function(e){if(!e.target.aborted)return t.stats=_a.mergeOptions(t.stats,Ro(e)),!t.stats.firstBytesReceivedAt&&t.stats.bytesReceived&&(t.stats.firstBytesReceivedAt=Date.now()),i(e,t)}},Qo=function(e){var t=e.xhr,i=e.xhrOptions,n=e.decryptionWorker,r=e.segment,a=e.abortFn,s=e.progressFn,o=e.trackInfoFn,l=e.timingInfoFn,u=e.videoSegmentTimingInfoFn,d=e.audioSegmentTimingInfoFn,c=e.id3Fn,h=e.captionsFn,p=e.isEndOfTimeline,f=e.endedTimelineFn,m=e.dataFn,g=e.doneFn,v=e.onTransmuxerLog,_=[],y=zo({activeXhrs:_,decryptionWorker:n,trackInfoFn:o,timingInfoFn:l,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:c,captionsFn:h,isEndOfTimeline:p,endedTimelineFn:f,dataFn:m,doneFn:g,onTransmuxerLog:v});if(r.key&&!r.key.bytes){var T=[r.key];r.map&&!r.map.bytes&&r.map.key&&r.map.key.resolvedUri===r.key.resolvedUri&&T.push(r.map.key);var b=t(_a.mergeOptions(i,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),Bo(r,T,y));_.push(b)}if(r.map&&!r.map.bytes){if(r.map.key&&(!r.key||r.key.resolvedUri!==r.map.key.resolvedUri)){var S=t(_a.mergeOptions(i,{uri:r.map.key.resolvedUri,responseType:"arraybuffer"}),Bo(r,[r.map.key],y));_.push(S)}var k=t(_a.mergeOptions(i,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:Os(r.map)}),No({segment:r,finishProcessingFn:y}));_.push(k)}var C=_a.mergeOptions(i,{uri:r.part&&r.part.resolvedUri||r.resolvedUri,responseType:"arraybuffer",headers:Os(r)}),E=t(C,jo({segment:r,finishProcessingFn:y,responseType:C.responseType}));E.addEventListener("progress",Ko({segment:r,progressFn:s,trackInfoFn:o,timingInfoFn:l,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:c,captionsFn:h,isEndOfTimeline:p,endedTimelineFn:f,dataFn:m})),_.push(E);var w={};return _.forEach(function(e){e.addEventListener("loadend",Go({loadendState:w,abortFn:a}))}),function(){return Do(_)}},Xo=ka("CodecUtils"),Yo=function(e){var t=e.attributes||{};if(t.CODECS)return(0,p.parseCodecs)(t.CODECS)},$o=function(e,t){var i=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&i.AUDIO&&e.mediaGroups.AUDIO[i.AUDIO]},Jo=function(e,t){if(!$o(e,t))return!0;var i=t.attributes||{},n=e.mediaGroups.AUDIO[i.AUDIO];for(var r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1},Zo=function(e){var t={};return e.forEach(function(e){var i=e.mediaType,n=e.type,r=e.details;t[i]=t[i]||[],t[i].push((0,p.translateLegacyCodec)(""+n+r))}),Object.keys(t).forEach(function(e){if(t[e].length>1)return Xo("multiple "+e+" codecs found as attributes: "+t[e].join(", ")+". Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs."),void(t[e]=null);t[e]=t[e][0]}),t},el=function(e){var t=0;return e.audio&&t++,e.video&&t++,t},tl=function(e,t){var i=t.attributes||{},n=Zo(Yo(t)||[]);if($o(e,t)&&!n.audio&&!Jo(e,t)){var r=Zo((0,p.codecsFromDefault)(e,i.AUDIO)||[]);r.audio&&(n.audio=r.audio)}return n},il=ka("PlaylistSelector"),nl=function(e){if(e&&e.playlist){var t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})}},rl=function(t,i){if(!t)return"";var n=e.default.getComputedStyle(t);return n?n[i]:""},al=function(e,t){var i=e.slice();e.sort(function(e,n){var r=t(e,n);return 0===r?i.indexOf(e)-i.indexOf(n):r})},sl=function(t,i){var n,r;return t.attributes.BANDWIDTH&&(n=t.attributes.BANDWIDTH),n=n||e.default.Number.MAX_VALUE,i.attributes.BANDWIDTH&&(r=i.attributes.BANDWIDTH),n-(r=r||e.default.Number.MAX_VALUE)},ol=function(t,i){var n,r;return t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(n=t.attributes.RESOLUTION.width),n=n||e.default.Number.MAX_VALUE,i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width&&(r=i.attributes.RESOLUTION.width),n===(r=r||e.default.Number.MAX_VALUE)&&t.attributes.BANDWIDTH&&i.attributes.BANDWIDTH?t.attributes.BANDWIDTH-i.attributes.BANDWIDTH:n-r},ll=function(t,i,n,r,a,s){if(t){var o={bandwidth:i,width:n,height:r,limitRenditionByPlayerDimensions:a},l=t.playlists;ss.isAudioOnly(t)&&(l=s.getAudioTrackPlaylists_(),o.audioOnly=!0);var u=l.map(function(t){var i=t.attributes&&t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width,n=t.attributes&&t.attributes.RESOLUTION&&t.attributes.RESOLUTION.height;return{bandwidth:t.attributes&&t.attributes.BANDWIDTH||e.default.Number.MAX_VALUE,width:i,height:n,playlist:t}});al(u,function(e,t){return e.bandwidth-t.bandwidth});var d=(u=u.filter(function(e){return!ss.isIncompatible(e.playlist)})).filter(function(e){return ss.isEnabled(e.playlist)});d.length||(d=u.filter(function(e){return!ss.isDisabled(e.playlist)}));var c=d.filter(function(e){return e.bandwidth*uo.BANDWIDTH_VARIANCE<i}),h=c[c.length-1],p=c.filter(function(e){return e.bandwidth===h.bandwidth})[0];if(!1===a){var f=p||d[0]||u[0];if(f&&f.playlist){var m="sortedPlaylistReps";return p&&(m="bandwidthBestRep"),d[0]&&(m="enabledPlaylistReps"),il("choosing "+nl(f)+" using "+m+" with options",o),f.playlist}return il("could not choose a playlist with options",o),null}var g=c.filter(function(e){return e.width&&e.height});al(g,function(e,t){return e.width-t.width});var v=g.filter(function(e){return e.width===n&&e.height===r});h=v[v.length-1];var _,y,T,b=v.filter(function(e){return e.bandwidth===h.bandwidth})[0];b||(y=(_=g.filter(function(e){return e.width>n||e.height>r})).filter(function(e){return e.width===_[0].width&&e.height===_[0].height}),h=y[y.length-1],T=y.filter(function(e){return e.bandwidth===h.bandwidth})[0]);var S=T||b||p||d[0]||u[0];if(S&&S.playlist){var k="sortedPlaylistReps";return T?k="resolutionPlusOneRep":b?k="resolutionBestRep":p?k="bandwidthBestRep":d[0]&&(k="enabledPlaylistReps"),il("choosing "+nl(S)+" using "+k+" with options",o),S.playlist}return il("could not choose a playlist with options",o),null}},ul=function(){var t=this.useDevicePixelRatio&&e.default.devicePixelRatio||1;return ll(this.playlists.master,this.systemBandwidth,parseInt(rl(this.tech_.el(),"width"),10)*t,parseInt(rl(this.tech_.el(),"height"),10)*t,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)},dl=function(t){var i=-1,n=-1;if(t<0||t>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){var r=this.useDevicePixelRatio&&e.default.devicePixelRatio||1;return i<0&&(i=this.systemBandwidth,n=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==n&&(i=t*this.systemBandwidth+(1-t)*i,n=this.systemBandwidth),ll(this.playlists.master,i,parseInt(rl(this.tech_.el(),"width"),10)*r,parseInt(rl(this.tech_.el(),"height"),10)*r,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)}},cl=function(e){var t=e.master,i=e.currentTime,n=e.bandwidth,r=e.duration,a=e.segmentDuration,s=e.timeUntilRebuffer,o=e.currentTimeline,l=e.syncController,u=t.playlists.filter(function(e){return!ss.isIncompatible(e)}),d=u.filter(ss.isEnabled);d.length||(d=u.filter(function(e){return!ss.isDisabled(e)}));var c=d.filter(ss.hasAttribute.bind(null,"BANDWIDTH")).map(function(e){var t=l.getSyncPoint(e,r,o,i)?1:2;return{playlist:e,rebufferingImpact:ss.estimateSegmentRequestTime(a,n,e)*t-s}}),h=c.filter(function(e){return e.rebufferingImpact<=0});return al(h,function(e,t){return sl(t.playlist,e.playlist)}),h.length?h[0]:(al(c,function(e,t){return e.rebufferingImpact-t.rebufferingImpact}),c[0]||null)},hl=function(){var e=this,t=this.playlists.master.playlists.filter(ss.isEnabled);return al(t,function(e,t){return sl(e,t)}),t.filter(function(t){return!!tl(e.playlists.master,t).video})[0]||null},pl=function(e){var t,i=0;return e.bytes&&(t=new Uint8Array(e.bytes),e.segments.forEach(function(e){t.set(e,i),i+=e.byteLength})),t},fl=function(e,t,i){if(!e[i]){t.trigger({type:"usage",name:"vhs-608"}),t.trigger({type:"usage",name:"hls-608"});var n=i;/^cc708_/.test(i)&&(n="SERVICE"+i.split("_")[1]);var r=t.textTracks().getTrackById(n);if(r)e[i]=r;else{var a=i,s=i,o=!1,l=(t.options_.vhs&&t.options_.vhs.captionServices||{})[n];l&&(a=l.label,s=l.language,o=l.default),e[i]=t.addRemoteTextTrack({kind:"captions",id:n,default:o,label:a,language:s},!1).track}}},ml=function(t){var i=t.inbandTextTracks,n=t.captionArray,r=t.timestampOffset;if(n){var a=e.default.WebKitDataCue||e.default.VTTCue;n.forEach(function(e){var t=e.stream;i[t].addCue(new a(e.startTime+r,e.endTime+r,e.text))})}},gl=function(e){Object.defineProperties(e.frame,{id:{get:function(){return _a.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key}},value:{get:function(){return _a.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data}},privateData:{get:function(){return _a.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data}}})},vl=function(t){var i=t.inbandTextTracks,n=t.metadataArray,r=t.timestampOffset,a=t.videoDuration;if(n){var s=e.default.WebKitDataCue||e.default.VTTCue,o=i.metadataTrack_;if(o&&(n.forEach(function(t){var i=t.cueTime+r;!("number"!=typeof i||e.default.isNaN(i)||i<0)&&i<1/0&&t.frames.forEach(function(e){var t=new s(i,i,e.value||e.url||e.data||"");t.frame=e,t.value=e,gl(t),o.addCue(t)})}),o.cues&&o.cues.length)){for(var l=o.cues,u=[],d=0;d<l.length;d++)l[d]&&u.push(l[d]);var c=u.reduce(function(e,t){var i=e[t.startTime]||[];return i.push(t),e[t.startTime]=i,e},{}),h=Object.keys(c).sort(function(e,t){return Number(e)-Number(t)});h.forEach(function(e,t){var i=c[e],n=Number(h[t+1])||a;i.forEach(function(e){e.endTime=n})})}}},_l=function(e,t,i){e.metadataTrack_||(e.metadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,e.metadataTrack_.inBandMetadataTrackDispatchType=t)},yl=function(e,t,i){var n,r;if(i&&i.cues)for(n=i.cues.length;n--;)(r=i.cues[n]).startTime>=e&&r.endTime<=t&&i.removeCue(r)},Tl=function(e){var t=e.cues;if(t)for(var i=0;i<t.length;i++){for(var n=[],r=0,a=0;a<t.length;a++)t[i].startTime===t[a].startTime&&t[i].endTime===t[a].endTime&&t[i].text===t[a].text&&++r>1&&n.push(t[a]);n.length&&n.forEach(function(t){return e.removeCue(t)})}},bl=function(e,t,i){if(null==t||!e.length)return[];var n,r=Math.ceil((t-i+3)*T.ONE_SECOND_IN_TS);for(n=0;n<e.length&&!(e[n].pts>r);n++);return e.slice(n)},Sl=function(e,t,i){if(!t.length)return e;if(i)return t.slice();for(var n=t[0].pts,r=0;r<e.length&&!(e[r].pts>=n);r++);return e.slice(0,r).concat(t)},kl=function(e,t,i,n){for(var r=Math.ceil((t-n)*T.ONE_SECOND_IN_TS),a=Math.ceil((i-n)*T.ONE_SECOND_IN_TS),s=e.slice(),o=e.length;o--&&!(e[o].pts<=a););if(-1===o)return s;for(var l=o+1;l--&&!(e[l].pts<=r););return l=Math.max(l,0),s.splice(l,o-l+1),s},Cl=function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;var i=Object.keys(e).sort(),n=Object.keys(t).sort();if(i.length!==n.length)return!1;for(var r=0;r<i.length;r++){var a=i[r];if(a!==n[r])return!1;if(e[a]!==t[a])return!1}return!0},El=22,wl=function(e,t,i){t=t||[];for(var n=[],r=0,a=0;a<t.length;a++){var s=t[a];if(e===s.timeline&&(n.push(a),(r+=s.duration)>i))return a}return 0===n.length?0:n[n.length-1]},Il=1,xl=500,Pl=function(e){return"number"==typeof e&&isFinite(e)},Ll=1/60,Al=function(e,t,i){return"main"===e&&t&&i?i.hasAudio||i.hasVideo?t.hasVideo&&!i.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&i.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null},Ol=function(e,t,i){var n=t-uo.BACK_BUFFER_LENGTH;e.length&&(n=Math.max(n,e.start(0)));var r=t-i;return Math.min(r,n)},Dl=function(e){var t=e.startOfSegment,i=e.duration,n=e.segment,r=e.part,a=e.playlist,s=a.mediaSequence,o=a.id,l=a.segments,u=void 0===l?[]:l,d=e.mediaIndex,c=e.partIndex,h=e.timeline,p=u.length-1,f="mediaIndex/partIndex increment";e.getMediaInfoForTime?f="getMediaInfoForTime ("+e.getMediaInfoForTime+")":e.isSyncRequest&&(f="getSyncSegmentCandidate (isSyncRequest)");var m="number"==typeof c,g=e.segment.uri?"segment":"pre-segment",v=m?Na({preloadSegment:n})-1:0;return g+" ["+(s+d)+"/"+(s+p)+"]"+(m?" part ["+c+"/"+v+"]":"")+" segment start/end ["+n.start+" => "+n.end+"]"+(m?" part start/end ["+r.start+" => "+r.end+"]":"")+" startOfSegment ["+t+"] duration ["+i+"] timeline ["+h+"] selected by ["+f+"] playlist ["+o+"]"},Ml=function(e){return e+"TimingInfo"},Rl=function(e){var t=e.segmentTimeline,i=e.currentTimeline,n=e.startOfSegment,r=e.buffered;return e.overrideCheck||t!==i?t<i?n:r.length?r.end(r.length-1):n:null},Ul=function(e){var t=e.timelineChangeController,i=e.currentTimeline,n=e.segmentTimeline,r=e.loaderType,a=e.audioDisabled;if(i===n)return!1;if("audio"===r){var s=t.lastTimelineChange({type:"main"});return!s||s.to!==n}if("main"===r&&a){var o=t.pendingTimelineChange({type:"audio"});return!o||o.to!==n}return!1},Bl=function(e,t){var i=e&&"number"==typeof e.start&&"number"==typeof e.end?e.end-e.start:0,n=t&&"number"==typeof t.start&&"number"==typeof t.end?t.end-t.start:0;return Math.max(i,n)},Fl=function(e){var t=e.segmentDuration,i=e.maxDuration;return!!t&&Math.round(t)>i+Ca},Nl=function(e,t){if("hls"!==t)return null;var i=Bl(e.audioTimingInfo,e.videoTimingInfo);if(!i)return null;var n=e.playlist.targetDuration,r=Fl({segmentDuration:i,maxDuration:2*n}),a=Fl({segmentDuration:i,maxDuration:n}),s="Segment with index "+e.mediaIndex+" from playlist "+e.playlist.id+" has a duration of "+i+" when the reported duration is "+e.duration+" and the target duration is "+n+". For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1";return r||a?{severity:r?"warn":"info",message:s}:null},jl=function(t){function a(e,i){var r;if(r=t.call(this)||this,!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");return r.bandwidth=e.bandwidth,r.throughput={rate:0,count:0},r.roundTrip=NaN,r.resetStats_(),r.mediaIndex=null,r.partIndex=null,r.hasPlayed_=e.hasPlayed,r.currentTime_=e.currentTime,r.seekable_=e.seekable,r.seeking_=e.seeking,r.duration_=e.duration,r.mediaSource_=e.mediaSource,r.vhs_=e.vhs,r.loaderType_=e.loaderType,r.currentMediaInfo_=void 0,r.startingMediaInfo_=void 0,r.segmentMetadataTrack_=e.segmentMetadataTrack,r.goalBufferLength_=e.goalBufferLength,r.sourceType_=e.sourceType,r.sourceUpdater_=e.sourceUpdater,r.inbandTextTracks_=e.inbandTextTracks,r.state_="INIT",r.timelineChangeController_=e.timelineChangeController,r.shouldSaveSegmentTimingInfo_=!0,r.parse708captions_=e.parse708captions,r.checkBufferTimeout_=null,r.error_=void 0,r.currentTimeline_=-1,r.pendingSegment_=null,r.xhrOptions_=null,r.pendingSegments_=[],r.audioDisabled_=!1,r.isPendingTimestampOffset_=!1,r.gopBuffer_=[],r.timeMapping_=0,r.safeAppend_=_a.browser.IE_VERSION>=11,r.appendInitSegment_={audio:!0,video:!0},r.playlistOfLastInitSegment_={audio:null,video:null},r.callQueue_=[],r.loadQueue_=[],r.metadataQueue_={id3:[],caption:[]},r.waitingOnRemove_=!1,r.quotaExceededErrorRetryTimeout_=null,r.activeInitSegmentId_=null,r.initSegments_={},r.cacheEncryptionKeys_=e.cacheEncryptionKeys,r.keyCache_={},r.decrypter_=e.decrypter,r.syncController_=e.syncController,r.syncPoint_={segmentIndex:0,time:0},r.transmuxer_=r.createTransmuxer_(),r.triggerSyncInfoUpdate_=function(){return r.trigger("syncinfoupdate")},r.syncController_.on("syncinfoupdate",r.triggerSyncInfoUpdate_),r.mediaSource_.addEventListener("sourceopen",function(){r.isEndOfStream_()||(r.ended_=!1)}),r.fetchAtBuffer_=!1,r.logger_=ka("SegmentLoader["+r.loaderType_+"]"),Object.defineProperty((0,n.default)(r),"state",{get:function(){return this.state_},set:function(e){e!==this.state_&&(this.logger_(this.state_+" -> "+e),this.state_=e,this.trigger("statechange"))}}),r.sourceUpdater_.on("ready",function(){r.hasEnoughInfoToAppend_()&&r.processCallQueue_()}),"main"===r.loaderType_&&r.timelineChangeController_.on("pendingtimelinechange",function(){r.hasEnoughInfoToAppend_()&&r.processCallQueue_()}),"audio"===r.loaderType_&&r.timelineChangeController_.on("timelinechange",function(){r.hasEnoughInfoToLoad_()&&r.processLoadQueue_(),r.hasEnoughInfoToAppend_()&&r.processCallQueue_()}),r}(0,r.default)(a,t);var s=a.prototype;return s.createTransmuxer_=function(){return Lo.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_})},s.resetStats_=function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0},s.dispose=function(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&e.default.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()},s.setAudio=function(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())},s.abort=function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)},s.abort_=function(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,e.default.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null},s.checkForAbort_=function(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)},s.error=function(e){return void 0!==e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_},s.endOfStream=function(){this.ended_=!0,this.transmuxer_&&Lo.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")},s.buffered_=function(){var e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return _a.createTimeRanges();if("main"===this.loaderType_){var t=e.hasAudio,i=e.hasVideo,n=e.isMuxed;if(i&&t&&!this.audioDisabled_&&!n)return this.sourceUpdater_.buffered();if(i)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()},s.initSegmentForMap=function(e,t){if(void 0===t&&(t=!1),!e)return null;var i=Bs(e),n=this.initSegments_[i];return t&&!n&&e.bytes&&(this.initSegments_[i]=n={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),n||e},s.segmentKey=function(e,t){if(void 0===t&&(t=!1),!e)return null;var i=Fs(e),n=this.keyCache_[i];this.cacheEncryptionKeys_&&t&&!n&&e.bytes&&(this.keyCache_[i]=n={resolvedUri:e.resolvedUri,bytes:e.bytes});var r={resolvedUri:(n||e).resolvedUri};return n&&(r.bytes=n.bytes),r},s.couldBeginLoading_=function(){return this.playlist_&&!this.paused()},s.load=function(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))},s.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},s.playlist=function(e,t){if(void 0===t&&(t={}),e){var i=this.playlist_,n=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));var r=null;if(i&&(i.id?r=i.id:i.uri&&(r=i.uri)),this.logger_("playlist update ["+r+" => "+(e.id||e.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!i||i.uri!==e.uri)return null!==this.mediaIndex&&this.resyncLoader(),this.currentMediaInfo_=void 0,void this.trigger("playlistupdate");var a=e.mediaSequence-i.mediaSequence;if(this.logger_("live window shift ["+a+"]"),null!==this.mediaIndex)if(this.mediaIndex-=a,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{var s=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!s.parts||!s.parts.length||!s.parts[this.partIndex])){var o=this.mediaIndex;this.logger_("currently processing part (index "+this.partIndex+") no longer exists."),this.resetLoader(),this.mediaIndex=o}}n&&(n.mediaIndex-=a,n.mediaIndex<0?(n.mediaIndex=null,n.partIndex=null):(n.mediaIndex>=0&&(n.segment=e.segments[n.mediaIndex]),n.partIndex>=0&&n.segment.parts&&(n.part=n.segment.parts[n.partIndex]))),this.syncController_.saveExpiredSegmentInfo(i,e)}},s.pause=function(){this.checkBufferTimeout_&&(e.default.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)},s.paused=function(){return null===this.checkBufferTimeout_},s.resetEverything=function(e){this.ended_=!1,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"})},s.resetLoader=function(){this.fetchAtBuffer_=!1,this.resyncLoader()},s.resyncLoader=function(){this.transmuxer_&&Lo.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})},s.remove=function(e,t,i,n){if(void 0===i&&(i=function(){}),void 0===n&&(n=!1),t===1/0&&(t=this.duration_()),t<=e)this.logger_("skipping remove because end ${end} is <= start ${start}");else if(this.sourceUpdater_&&this.getMediaInfo_()){var r=1,a=function(){0===--r&&i()};for(var s in!n&&this.audioDisabled_||(r++,this.sourceUpdater_.removeAudio(e,t,a)),(n||"main"===this.loaderType_)&&(this.gopBuffer_=kl(this.gopBuffer_,e,t,this.timeMapping_),r++,this.sourceUpdater_.removeVideo(e,t,a)),this.inbandTextTracks_)yl(e,t,this.inbandTextTracks_[s]);yl(e,t,this.segmentMetadataTrack_),a()}else this.logger_("skipping remove because no source updater or starting media info")},s.monitorBuffer_=function(){this.checkBufferTimeout_&&e.default.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=e.default.setTimeout(this.monitorBufferTick_.bind(this),1)},s.monitorBufferTick_=function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&e.default.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=e.default.setTimeout(this.monitorBufferTick_.bind(this),xl)},s.fillBuffer_=function(){if(!this.sourceUpdater_.updating()){var e=this.chooseNextRequest_();e&&("number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}},s.isEndOfStream_=function(e,t,i){if(void 0===e&&(e=this.mediaIndex),void 0===t&&(t=this.playlist_),void 0===i&&(i=this.partIndex),!t||!this.mediaSource_)return!1;var n="number"==typeof e&&t.segments[e],r=e+1===t.segments.length,a=!n||!n.parts||i+1===n.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&r&&a},s.chooseNextRequest_=function(){var e=Ra(this.buffered_())||0,t=Math.max(0,e-this.currentTime_()),i=!this.hasPlayed_()&&t>=1,n=t>=this.goalBufferLength_(),r=this.playlist_.segments;if(!r.length||i||n)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_());var a={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(a.isSyncRequest)a.mediaIndex=wl(this.currentTimeline_,r,e);else if(null!==this.mediaIndex){var s=r[this.mediaIndex],o="number"==typeof this.partIndex?this.partIndex:-1;a.startOfSegment=s.end?s.end:e,s.parts&&s.parts[o+1]?(a.mediaIndex=this.mediaIndex,a.partIndex=o+1):a.mediaIndex=this.mediaIndex+1}else{var l=ss.getMediaInfoForTime({playlist:this.playlist_,currentTime:this.fetchAtBuffer_?e:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time}),u=l.segmentIndex,d=l.startTime,c=l.partIndex;a.getMediaInfoForTime=this.fetchAtBuffer_?"bufferedEnd":"currentTime",a.mediaIndex=u,a.startOfSegment=d,a.partIndex=c}var h=r[a.mediaIndex],p=h&&"number"==typeof a.partIndex&&h.parts&&h.parts[a.partIndex];if(!h||"number"==typeof a.partIndex&&!p)return null;"number"!=typeof a.partIndex&&h.parts&&(a.partIndex=0);var f=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return a.mediaIndex>=r.length-1&&f&&!this.seeking_()?null:this.generateSegmentInfo_(a)},s.generateSegmentInfo_=function(e){var t=e.playlist,i=e.mediaIndex,n=e.startOfSegment,r=e.isSyncRequest,a=e.partIndex,s=e.forceTimestampOffset,o=e.getMediaInfoForTime,l=t.segments[i],u="number"==typeof a&&l.parts[a],d={requestId:"segment-loader-"+Math.random(),uri:u&&u.resolvedUri||l.resolvedUri,mediaIndex:i,partIndex:u?a:null,isSyncRequest:r,startOfSegment:n,playlist:t,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:l.timeline,duration:u&&u.duration||l.duration,segment:l,part:u,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:o},c=void 0!==s?s:this.isPendingTimestampOffset_;d.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:l.timeline,currentTimeline:this.currentTimeline_,startOfSegment:n,buffered:this.buffered_(),overrideCheck:c});var h=Ra(this.sourceUpdater_.audioBuffered());return"number"==typeof h&&(d.audioAppendStart=h-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(d.gopsToAlignWith=bl(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),d},s.timestampOffsetForSegment_=function(e){return Rl(e)},s.earlyAbortWhenNeeded_=function(e){if(!this.vhs_.tech_.paused()&&this.xhrOptions_.timeout&&this.playlist_.attributes.BANDWIDTH&&!(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)){var t=this.currentTime_(),i=e.bandwidth,n=this.pendingSegment_.duration,r=ss.estimateSegmentRequestTime(n,i,this.playlist_,e.bytesReceived),a=Oa(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(!(r<=a)){var s=cl({master:this.vhs_.playlists.master,currentTime:t,bandwidth:i,duration:this.duration_(),segmentDuration:n,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(s){var o=r-a-s.rebufferingImpact,l=.5;a<=Ca&&(l=1),!s.playlist||s.playlist.uri===this.playlist_.uri||o<l||(this.bandwidth=s.playlist.attributes.BANDWIDTH*uo.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}}}},s.handleAbort_=function(e){this.logger_("Aborting "+Dl(e)),this.mediaRequestsAborted+=1},s.handleProgress_=function(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")},s.handleTrackInfo_=function(e,t){this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},Cl(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()&&this.processCallQueue_()))},s.handleTimingInfo_=function(e,t,i,n){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){var r=this.pendingSegment_,a=Ml(t);r[a]=r[a]||{},r[a][i]=n,this.logger_("timinginfo: "+t+" - "+i+" - "+n),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}},s.handleCaptions_=function(e,t){var i=this;if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId))if(0!==t.length)if(this.pendingSegment_.hasAppendedData_){var n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),r={};t.forEach(function(e){r[e.stream]=r[e.stream]||{startTime:1/0,captions:[],endTime:0};var t=r[e.stream];t.startTime=Math.min(t.startTime,e.startTime+n),t.endTime=Math.max(t.endTime,e.endTime+n),t.captions.push(e)}),Object.keys(r).forEach(function(e){var t=r[e],a=t.startTime,s=t.endTime,o=t.captions,l=i.inbandTextTracks_;i.logger_("adding cues from "+a+" -> "+s+" for "+e),fl(l,i.vhs_.tech_,e),yl(a,s,l[e]),ml({captionArray:o,inbandTextTracks:l,timestampOffset:n})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}else this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));else this.logger_("SegmentLoader received no captions from a caption event")},s.handleId3_=function(e,t,i){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId))if(this.pendingSegment_.hasAppendedData_){var n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();_l(this.inbandTextTracks_,i,this.vhs_.tech_),vl({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:n,videoDuration:this.duration_()})}else this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,i))},s.processMetadataQueue_=function(){this.metadataQueue_.id3.forEach(function(e){return e()}),this.metadataQueue_.caption.forEach(function(e){return e()}),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},s.processCallQueue_=function(){var e=this.callQueue_;this.callQueue_=[],e.forEach(function(e){return e()})},s.processLoadQueue_=function(){var e=this.loadQueue_;this.loadQueue_=[],e.forEach(function(e){return e()})},s.hasEnoughInfoToLoad_=function(){if("audio"!==this.loaderType_)return!0;var e=this.pendingSegment_;return!!e&&(!this.getCurrentMediaInfo_()||!Ul({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},s.getCurrentMediaInfo_=function(e){return void 0===e&&(e=this.pendingSegment_),e&&e.trackInfo||this.currentMediaInfo_},s.getMediaInfo_=function(e){return void 0===e&&(e=this.pendingSegment_),this.getCurrentMediaInfo_(e)||this.startingMediaInfo_},s.hasEnoughInfoToAppend_=function(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;var e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;var i=t.hasAudio,n=t.hasVideo,r=t.isMuxed;return!(n&&!e.videoTimingInfo)&&(!(i&&!this.audioDisabled_&&!r&&!e.audioTimingInfo)&&!Ul({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},s.handleData_=function(e,t){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId))if(!this.callQueue_.length&&this.hasEnoughInfoToAppend_()){var i=this.pendingSegment_;if(this.setTimeMapping_(i.timeline),this.updateMediaSecondsLoaded_(i.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),i.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),i.isFmp4=e.isFmp4,i.timingInfo=i.timingInfo||{},i.isFmp4)this.trigger("fmp4"),i.timingInfo.start=i[Ml(t.type)].start;else{var n,r=this.getCurrentMediaInfo_(),a="main"===this.loaderType_&&r&&r.hasVideo;a&&(n=i.videoTimingInfo.start),i.timingInfo.start=this.trueSegmentStart_({currentStart:i.timingInfo.start,playlist:i.playlist,mediaIndex:i.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:a,firstVideoFrameTimeForData:n,videoTimingInfo:i.videoTimingInfo,audioTimingInfo:i.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(i,t.type),this.updateSourceBufferTimestampOffset_(i),i.isSyncRequest){this.updateTimingInfoEnd_(i),this.syncController_.saveSegmentTimingInfo({segmentInfo:i,shouldSaveTimelineMapping:"main"===this.loaderType_});var s=this.chooseNextRequest_();if(s.mediaIndex!==i.mediaIndex||s.partIndex!==i.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}i.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(i,t)}}else this.callQueue_.push(this.handleData_.bind(this,e,t))},s.updateAppendInitSegmentStatus=function(e,t){"main"!==this.loaderType_||"number"!=typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)},s.getInitSegmentAndUpdateState_=function(e){var t=e.type,i=e.initSegment,n=e.map,r=e.playlist;if(n){var a=Bs(n);if(this.activeInitSegmentId_===a)return null;i=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=a}return i&&this.appendInitSegment_[t]?(this.playlistOfLastInitSegment_[t]=r,this.appendInitSegment_[t]=!1,this.activeInitSegmentId_=null,i):null},s.handleQuotaExceededError_=function(t,i){var n=this,r=t.segmentInfo,a=t.type,s=t.bytes,o=this.sourceUpdater_.audioBuffered(),l=this.sourceUpdater_.videoBuffered();o.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Da(o).join(", ")),l.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Da(l).join(", "));var u=o.length?o.start(0):0,d=o.length?o.end(o.length-1):0,c=l.length?l.start(0):0,h=l.length?l.end(l.length-1):0;if(d-u<=Il&&h-c<=Il)return this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: "+s.byteLength+", audio buffer: "+Da(o).join(", ")+", video buffer: "+Da(l).join(", ")+", "),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:r,type:a,bytes:s}));var p=this.currentTime_()-Il;this.logger_("On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to "+p),this.remove(0,p,function(){n.logger_("On QUOTA_EXCEEDED_ERR, retrying append in "+Il+"s"),n.waitingOnRemove_=!1,n.quotaExceededErrorRetryTimeout_=e.default.setTimeout(function(){n.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),n.quotaExceededErrorRetryTimeout_=null,n.processCallQueue_()},1e3*Il)},!0)},s.handleAppendError_=function(e,t){var i=e.segmentInfo,n=e.type,r=e.bytes;t&&(t.code!==El?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",t),this.error(n+" append of "+r.length+"b failed for segment #"+i.mediaIndex+" in playlist "+i.playlist.id),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:i,type:n,bytes:r}))},s.appendToSourceBuffer_=function(e){var t=e.segmentInfo,i=e.type,n=e.initSegment,r=e.data,a=e.bytes;if(!a){var s=[r],o=r.byteLength;n&&(s.unshift(n),o+=n.byteLength),a=pl({bytes:o,segments:s})}this.sourceUpdater_.appendBuffer({segmentInfo:t,type:i,bytes:a},this.handleAppendError_.bind(this,{segmentInfo:t,type:i,bytes:a}))},s.handleSegmentTimingInfo_=function(e,t,i){if(this.pendingSegment_&&t===this.pendingSegment_.requestId){var n=this.pendingSegment_.segment,r=e+"TimingInfo";n[r]||(n[r]={}),n[r].transmuxerPrependedSeconds=i.prependedContentDuration||0,n[r].transmuxedPresentationStart=i.start.presentation,n[r].transmuxedDecodeStart=i.start.decode,n[r].transmuxedPresentationEnd=i.end.presentation,n[r].transmuxedDecodeEnd=i.end.decode,n[r].baseMediaDecodeTime=i.baseMediaDecodeTime}},s.appendData_=function(e,t){var i=t.type,n=t.data;if(n&&n.byteLength&&("audio"!==i||!this.audioDisabled_)){var r=this.getInitSegmentAndUpdateState_({type:i,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:i,initSegment:r,data:n})}},s.loadSegment_=function(e){var t=this;this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.hasEnoughInfoToLoad_()?this.updateTransmuxerAndRequestSegment_(e):this.loadQueue_.push(function(){var n=(0,i.default)({},e,{forceTimestampOffset:!0});(0,i.default)(e,t.generateSegmentInfo_(n)),t.isPendingTimestampOffset_=!1,t.updateTransmuxerAndRequestSegment_(e)})},s.updateTransmuxerAndRequestSegment_=function(e){var t=this;this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));var i=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=null!==this.mediaIndex,a=e.timeline!==this.currentTimeline_&&e.timeline>0,s=n||r&&a;this.logger_("Requesting "+Dl(e)),i.map&&!i.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=Qo({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:i,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:s,endedTimelineFn:function(){t.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:function(i){var n=i.message,r=i.level,a=i.stream;t.logger_(Dl(e)+" logged from transmuxer stream "+a+" as a "+r+": "+n)}})},s.trimBackBuffer_=function(e){var t=Ol(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)},s.createSimplifiedSegmentObj_=function(e){var t=e.segment,i=e.part,n={resolvedUri:i?i.resolvedUri:t.resolvedUri,byterange:i?i.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},r=e.playlist.segments[e.mediaIndex-1];if(r&&r.timeline===t.timeline&&(r.videoTimingInfo?n.baseStartTime=r.videoTimingInfo.transmuxedDecodeEnd:r.audioTimingInfo&&(n.baseStartTime=r.audioTimingInfo.transmuxedDecodeEnd)),t.key){var a=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);n.key=this.segmentKey(t.key),n.key.iv=a}return t.map&&(n.map=this.initSegmentForMap(t.map)),n},s.saveTransferStats_=function(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)},s.saveBandwidthRelatedStats_=function(e,t){this.pendingSegment_.byteLength=t.bytesReceived,e<Ll?this.logger_("Ignoring segment's bandwidth because its duration of "+e+" is less than the min to record "+Ll):(this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime)},s.handleTimeout_=function(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate")},s.segmentRequestFinished_=function(e,t,i){if(this.callQueue_.length)this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,i));else if(this.saveTransferStats_(t.stats),this.pendingSegment_&&t.requestId===this.pendingSegment_.requestId){if(e){if(this.pendingSegment_=null,this.state="READY",e.code===Oo.ABORTED)return;return this.pause(),e.code===Oo.TIMEOUT?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}var n=this.pendingSegment_;this.saveBandwidthRelatedStats_(n.duration,t.stats),n.endOfAllRequests=t.endOfAllRequests,i.gopInfo&&(this.gopBuffer_=Sl(this.gopBuffer_,i.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(n)}},s.setTimeMapping_=function(e){var t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)},s.updateMediaSecondsLoaded_=function(e){"number"==typeof e.start&&"number"==typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration},s.shouldUpdateTransmuxerTimestampOffset_=function(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())},s.trueSegmentStart_=function(e){var t=e.currentStart,i=e.playlist,n=e.mediaIndex,r=e.firstVideoFrameTimeForData,a=e.currentVideoTimestampOffset,s=e.useVideoTimingInfo,o=e.videoTimingInfo,l=e.audioTimingInfo;if(void 0!==t)return t;if(!s)return l.start;var u=i.segments[n-1];return 0!==n&&u&&void 0!==u.start&&u.end===r+a?o.start:r},s.waitForAppendsToComplete_=function(e){var t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",blacklistDuration:1/0}),void this.trigger("error");var i=t.hasAudio,n=t.hasVideo,r=t.isMuxed,a="main"===this.loaderType_&&n,s=!this.audioDisabled_&&i&&!r;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!=typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);a&&e.waitingOnAppends++,s&&e.waitingOnAppends++,a&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),s&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))},s.checkAppendsDone_=function(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())},s.checkForIllegalMediaSwitch=function(e){var t=Al(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,blacklistDuration:1/0}),this.trigger("error"),!0)},s.updateSourceBufferTimestampOffset_=function(e){if(null!==e.timestampOffset&&"number"==typeof e.timingInfo.start&&!e.changedTimestampOffset&&"main"===this.loaderType_){var t=!1;e.timestampOffset-=e.timingInfo.start,e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}},s.updateTimingInfoEnd_=function(e){e.timingInfo=e.timingInfo||{};var t=this.getMediaInfo_(),i="main"===this.loaderType_&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;i&&(e.timingInfo.end="number"==typeof i.end?i.end:i.start+e.duration)},s.handleAppendsDone_=function(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});var t=Nl(e,this.sourceType_);if(t&&("warn"===t.severity?_a.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",!e.isSyncRequest||(this.trigger("syncinfoupdate"),e.hasAppendedData_)){this.logger_("Appended "+Dl(e)),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");var i=e.segment;if(i.end&&this.currentTime_()-i.end>3*e.playlist.targetDuration)this.resetEverything();else null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}else this.logger_("Throwing away un-appended sync request "+Dl(e))},s.recordThroughput_=function(e){if(e.duration<Ll)this.logger_("Ignoring segment's throughput because its duration of "+e.duration+" is less than the min to record "+Ll);else{var t=this.throughput.rate,i=Date.now()-e.endOfAllRequests+1,n=Math.floor(e.byteLength/i*8*1e3);this.throughput.rate+=(n-t)/++this.throughput.count}},s.addSegmentMetadataCue_=function(t){if(this.segmentMetadataTrack_){var i=t.segment,n=i.start,r=i.end;if(Pl(n)&&Pl(r)){yl(n,r,this.segmentMetadataTrack_);var a=e.default.WebKitDataCue||e.default.VTTCue,s={custom:i.custom,dateTimeObject:i.dateTimeObject,dateTimeString:i.dateTimeString,bandwidth:t.playlist.attributes.BANDWIDTH,resolution:t.playlist.attributes.RESOLUTION,codecs:t.playlist.attributes.CODECS,byteLength:t.byteLength,uri:t.uri,timeline:t.timeline,playlist:t.playlist.id,start:n,end:r},o=new a(n,r,JSON.stringify(s));o.value=s,this.segmentMetadataTrack_.addCue(o)}}},a}(_a.EventTarget);function Hl(){}var ql,Vl=function(e){return"string"!=typeof e?e:e.replace(/./,function(e){return e.toUpperCase()})},Wl=["video","audio"],zl=function(e,t){var i=t[e+"Buffer"];return i&&i.updating||t.queuePending[e]},Gl=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if("mediaSource"===n.type)return null;if(n.type===e)return i}return null},Kl=function e(t,i){if(0!==i.queue.length){var n=0,r=i.queue[n];if("mediaSource"!==r.type){if("mediaSource"!==t&&i.ready()&&"closed"!==i.mediaSource.readyState&&!zl(t,i)){if(r.type!==t){if(null===(n=Gl(t,i.queue)))return;r=i.queue[n]}return i.queue.splice(n,1),i.queuePending[t]=r,r.action(t,i),r.doneFn?void 0:(i.queuePending[t]=null,void e(t,i))}}else i.updating()||"closed"===i.mediaSource.readyState||(i.queue.shift(),r.action(i),r.doneFn&&r.doneFn(),e("audio",i),e("video",i))}},Ql=function(e,t){var i=t[e+"Buffer"],n=Vl(e);i&&(i.removeEventListener("updateend",t["on"+n+"UpdateEnd_"]),i.removeEventListener("error",t["on"+n+"Error_"]),t.codecs[e]=null,t[e+"Buffer"]=null)},Xl=function(e,t){return e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t)},Yl={appendBuffer:function(e,t,i){return function(n,r){var a=r[n+"Buffer"];if(Xl(r.mediaSource,a)){r.logger_("Appending segment "+t.mediaIndex+"'s "+e.length+" bytes to "+n+"Buffer");try{a.appendBuffer(e)}catch(s){r.logger_("Error with code "+s.code+" "+(s.code===El?"(QUOTA_EXCEEDED_ERR) ":"")+"when appending segment "+t.mediaIndex+" to "+n+"Buffer"),r.queuePending[n]=null,i(s)}}}},remove:function(e,t){return function(i,n){var r=n[i+"Buffer"];if(Xl(n.mediaSource,r)){n.logger_("Removing "+e+" to "+t+" from "+i+"Buffer");try{r.remove(e,t)}catch(a){n.logger_("Remove "+e+" to "+t+" from "+i+"Buffer failed")}}}},timestampOffset:function(e){return function(t,i){var n=i[t+"Buffer"];Xl(i.mediaSource,n)&&(i.logger_("Setting "+t+"timestampOffset to "+e),n.timestampOffset=e)}},callback:function(e){return function(t,i){e()}},endOfStream:function(e){return function(t){if("open"===t.mediaSource.readyState){t.logger_("Calling mediaSource endOfStream("+(e||"")+")");try{t.mediaSource.endOfStream(e)}catch(i){_a.log.warn("Failed to call media source endOfStream",i)}}}},duration:function(e){return function(t){t.logger_("Setting mediaSource duration to "+e);try{t.mediaSource.duration=e}catch(i){_a.log.warn("Failed to set media source duration",i)}}},abort:function(){return function(e,t){if("open"===t.mediaSource.readyState){var i=t[e+"Buffer"];if(Xl(t.mediaSource,i)){t.logger_("calling abort on "+e+"Buffer");try{i.abort()}catch(n){_a.log.warn("Failed to abort on "+e+"Buffer",n)}}}}},addSourceBuffer:function(e,t){return function(i){var n=Vl(e),r=(0,p.getMimeForCodec)(t);i.logger_("Adding "+e+"Buffer with codec "+t+" to mediaSource");var a=i.mediaSource.addSourceBuffer(r);a.addEventListener("updateend",i["on"+n+"UpdateEnd_"]),a.addEventListener("error",i["on"+n+"Error_"]),i.codecs[e]=t,i[e+"Buffer"]=a}},removeSourceBuffer:function(e){return function(t){var i=t[e+"Buffer"];if(Ql(e,t),Xl(t.mediaSource,i)){t.logger_("Removing "+e+"Buffer with codec "+t.codecs[e]+" from mediaSource");try{t.mediaSource.removeSourceBuffer(i)}catch(n){_a.log.warn("Failed to removeSourceBuffer "+e+"Buffer",n)}}}},changeType:function(e){return function(t,i){var n=i[t+"Buffer"],r=(0,p.getMimeForCodec)(e);Xl(i.mediaSource,n)&&i.codecs[t]!==e&&(i.logger_("changing "+t+"Buffer codec from "+i.codecs[t]+" to "+e),n.changeType(r),i.codecs[t]=e)}}},$l=function(e){var t=e.type,i=e.sourceUpdater,n=e.action,r=e.doneFn,a=e.name;i.queue.push({type:t,action:n,doneFn:r,name:a}),Kl(t,i)},Jl=function(e,t){return function(i){if(t.queuePending[e]){var n=t.queuePending[e].doneFn;t.queuePending[e]=null,n&&n(t[e+"Error_"])}Kl(e,t)}},Zl=function(t){function i(e){var i;return(i=t.call(this)||this).mediaSource=e,i.sourceopenListener_=function(){return Kl("mediaSource",(0,n.default)(i))},i.mediaSource.addEventListener("sourceopen",i.sourceopenListener_),i.logger_=ka("SourceUpdater"),i.audioTimestampOffset_=0,i.videoTimestampOffset_=0,i.queue=[],i.queuePending={audio:null,video:null},i.delayedAudioAppendQueue_=[],i.videoAppendQueued_=!1,i.codecs={},i.onVideoUpdateEnd_=Jl("video",(0,n.default)(i)),i.onAudioUpdateEnd_=Jl("audio",(0,n.default)(i)),i.onVideoError_=function(e){i.videoError_=e},i.onAudioError_=function(e){i.audioError_=e},i.createdSourceBuffers_=!1,i.initializedEme_=!1,i.triggeredReady_=!1,i}(0,r.default)(i,t);var a=i.prototype;return a.initializedEme=function(){this.initializedEme_=!0,this.triggerReady()},a.hasCreatedSourceBuffers=function(){return this.createdSourceBuffers_},a.hasInitializedAnyEme=function(){return this.initializedEme_},a.ready=function(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()},a.createSourceBuffers=function(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())},a.triggerReady=function(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))},a.addSourceBuffer=function(e,t){$l({type:"mediaSource",sourceUpdater:this,action:Yl.addSourceBuffer(e,t),name:"addSourceBuffer"})},a.abort=function(e){$l({type:e,sourceUpdater:this,action:Yl.abort(e),name:"abort"})},a.removeSourceBuffer=function(e){this.canRemoveSourceBuffer()?$l({type:"mediaSource",sourceUpdater:this,action:Yl.removeSourceBuffer(e),name:"removeSourceBuffer"}):_a.log.error("removeSourceBuffer is not supported!")},a.canRemoveSourceBuffer=function(){return!_a.browser.IE_VERSION&&!_a.browser.IS_FIREFOX&&e.default.MediaSource&&e.default.MediaSource.prototype&&"function"==typeof e.default.MediaSource.prototype.removeSourceBuffer},i.canChangeType=function(){return e.default.SourceBuffer&&e.default.SourceBuffer.prototype&&"function"==typeof e.default.SourceBuffer.prototype.changeType},a.canChangeType=function(){return this.constructor.canChangeType()},a.changeType=function(e,t){this.canChangeType()?$l({type:e,sourceUpdater:this,action:Yl.changeType(t),name:"changeType"}):_a.log.error("changeType is not supported!")},a.addOrChangeSourceBuffers=function(e){var t=this;if(!e||"object"!=typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(function(i){var n=e[i];if(!t.hasCreatedSourceBuffers())return t.addSourceBuffer(i,n);t.canChangeType()&&t.changeType(i,n)})},a.appendBuffer=function(e,t){var i=this,n=e.segmentInfo,r=e.type,a=e.bytes;if(this.processedAppend_=!0,"audio"===r&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_("delayed audio append of "+a.length+" until video append");var s=t;if($l({type:r,sourceUpdater:this,action:Yl.appendBuffer(a,n||{mediaIndex:-1},s),doneFn:t,name:"appendBuffer"}),"video"===r){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;var o=this.delayedAudioAppendQueue_.slice();this.logger_("queuing delayed audio "+o.length+" appendBuffers"),this.delayedAudioAppendQueue_.length=0,o.forEach(function(e){i.appendBuffer.apply(i,e)})}},a.audioBuffered=function(){return Xl(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:_a.createTimeRange()},a.videoBuffered=function(){return Xl(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:_a.createTimeRange()},a.buffered=function(){var e=Xl(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=Xl(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():La(this.audioBuffered(),this.videoBuffered())},a.setDuration=function(e,t){void 0===t&&(t=Hl),$l({type:"mediaSource",sourceUpdater:this,action:Yl.duration(e),name:"duration",doneFn:t})},a.endOfStream=function(e,t){void 0===e&&(e=null),void 0===t&&(t=Hl),"string"!=typeof e&&(e=void 0),$l({type:"mediaSource",sourceUpdater:this,action:Yl.endOfStream(e),name:"endOfStream",doneFn:t})},a.removeAudio=function(e,t,i){void 0===i&&(i=Hl),this.audioBuffered().length&&0!==this.audioBuffered().end(0)?$l({type:"audio",sourceUpdater:this,action:Yl.remove(e,t),doneFn:i,name:"remove"}):i()},a.removeVideo=function(e,t,i){void 0===i&&(i=Hl),this.videoBuffered().length&&0!==this.videoBuffered().end(0)?$l({type:"video",sourceUpdater:this,action:Yl.remove(e,t),doneFn:i,name:"remove"}):i()},a.updating=function(){return!(!zl("audio",this)&&!zl("video",this))},a.audioTimestampOffset=function(e){return void 0!==e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&($l({type:"audio",sourceUpdater:this,action:Yl.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_},a.videoTimestampOffset=function(e){return void 0!==e&&this.videoBuffer&&this.videoTimestampOffset!==e&&($l({type:"video",sourceUpdater:this,action:Yl.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_},a.audioQueueCallback=function(e){this.audioBuffer&&$l({type:"audio",sourceUpdater:this,action:Yl.callback(e),name:"callback"})},a.videoQueueCallback=function(e){this.videoBuffer&&$l({type:"video",sourceUpdater:this,action:Yl.callback(e),name:"callback"})},a.dispose=function(){var e=this;this.trigger("dispose"),Wl.forEach(function(t){e.abort(t),e.canRemoveSourceBuffer()?e.removeSourceBuffer(t):e[t+"QueueCallback"](function(){return Ql(t,e)})}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()},i}(_a.EventTarget),eu=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,e)))},tu=new Uint8Array("\n\n".split("").map(function(e){return e.charCodeAt(0)})),iu=function(t){function i(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,e,i)||this).mediaSource_=null,n.subtitlesTrack_=null,n.loaderType_="subtitle",n.featuresNativeTextTracks_=e.featuresNativeTextTracks,n.shouldSaveSegmentTimingInfo_=!1,n}(0,r.default)(i,t);var n=i.prototype;return n.createTransmuxer_=function(){return null},n.buffered_=function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return _a.createTimeRanges();var e=this.subtitlesTrack_.cues,t=e[0].startTime,i=e[e.length-1].startTime;return _a.createTimeRanges([[t,i]])},n.initSegmentForMap=function(e,t){if(void 0===t&&(t=!1),!e)return null;var i=Bs(e),n=this.initSegments_[i];if(t&&!n&&e.bytes){var r=tu.byteLength+e.bytes.byteLength,a=new Uint8Array(r);a.set(e.bytes),a.set(tu,e.bytes.byteLength),this.initSegments_[i]=n={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return n||e},n.couldBeginLoading_=function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()},n.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},n.track=function(e){return void 0===e?this.subtitlesTrack_:(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)},n.remove=function(e,t){yl(e,t,this.subtitlesTrack_)},n.fillBuffer_=function(){var e=this,t=this.chooseNextRequest_();if(t){if(null===this.syncController_.timestampOffsetForTimeline(t.timeline)){return this.syncController_.one("timestampoffset",function(){e.state="READY",e.paused()||e.monitorBuffer_()}),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(t)}},n.timestampOffsetForSegment_=function(){return null},n.chooseNextRequest_=function(){return this.skipEmptySegments_(t.prototype.chooseNextRequest_.call(this))},n.skipEmptySegments_=function(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e},n.stopForError=function(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")},n.segmentRequestFinished_=function(t,i,n){var r=this;if(this.subtitlesTrack_){if(this.saveTransferStats_(i.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(t)return t.code===Oo.TIMEOUT&&this.handleTimeout_(),t.code===Oo.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(t);var a=this.pendingSegment_;this.saveBandwidthRelatedStats_(a.duration,i.stats),this.state="APPENDING",this.trigger("appending");var s=a.segment;if(s.map&&(s.map.bytes=i.map.bytes),a.bytes=i.bytes,"function"!=typeof e.default.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var o,l=function(){r.subtitlesTrack_.tech_.off("vttjsloaded",o),r.stopForError({message:"Error loading vtt.js"})};return o=function(){r.subtitlesTrack_.tech_.off("vttjserror",l),r.segmentRequestFinished_(t,i,n)},this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",o),void this.subtitlesTrack_.tech_.one("vttjserror",l)}s.requested=!0;try{this.parseVTTCues_(a)}catch(u){return void this.stopForError({message:u.message})}if(this.updateTimeMapping_(a,this.syncController_.timelines[a.timeline],this.playlist_),a.cues.length?a.timingInfo={start:a.cues[0].startTime,end:a.cues[a.cues.length-1].endTime}:a.timingInfo={start:a.startOfSegment,end:a.startOfSegment+a.duration},a.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");a.byteLength=a.bytes.byteLength,this.mediaSecondsLoaded+=s.duration,a.cues.forEach(function(t){r.subtitlesTrack_.addCue(r.featuresNativeTextTracks_?new e.default.VTTCue(t.startTime,t.endTime,t.text):t)}),Tl(this.subtitlesTrack_),this.handleAppendsDone_()}else this.state="READY"},n.handleData_=function(){},n.updateTimingInfoEnd_=function(){},n.parseVTTCues_=function(t){var i,n=!1;"function"==typeof e.default.TextDecoder?i=new e.default.TextDecoder("utf8"):(i=e.default.WebVTT.StringDecoder(),n=!0);var r=new e.default.WebVTT.Parser(e.default,e.default.vttjs,i);if(t.cues=[],t.timestampmap={MPEGTS:0,LOCAL:0},r.oncue=t.cues.push.bind(t.cues),r.ontimestampmap=function(e){t.timestampmap=e},r.onparsingerror=function(e){_a.log.warn("Error encountered when parsing cues: "+e.message)},t.segment.map){var a=t.segment.map.bytes;n&&(a=eu(a)),r.parse(a)}var s=t.bytes;n&&(s=eu(s)),r.parse(s),r.flush()},n.updateTimeMapping_=function(e,t,i){var n=e.segment;if(t)if(e.cues.length){var r=e.timestampmap,a=r.MPEGTS/T.ONE_SECOND_IN_TS-r.LOCAL+t.mapping;if(e.cues.forEach(function(e){e.startTime+=a,e.endTime+=a}),!i.syncInfo){var s=e.cues[0].startTime,o=e.cues[e.cues.length-1].startTime;i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:Math.min(s,o-n.duration)}}}else n.empty=!0},i}(jl),nu=function(e,t){for(var i=e.cues,n=0;n<i.length;n++){var r=i[n];if(t>=r.adStartTime&&t<=r.adEndTime)return r}return null},ru=function(t,i,n){if(void 0===n&&(n=0),t.segments)for(var r,a=n,s=0;s<t.segments.length;s++){var o=t.segments[s];if(r||(r=nu(i,a+o.duration/2)),r){if("cueIn"in o){r.endTime=a,r.adEndTime=a,a+=o.duration,r=null;continue}if(a<r.endTime){a+=o.duration;continue}r.endTime+=o.duration}else if("cueOut"in o&&((r=new e.default.VTTCue(a,a+o.duration,o.cueOut)).adStartTime=a,r.adEndTime=a+parseFloat(o.cueOut),i.addCue(r)),"cueOutCont"in o){var l=o.cueOutCont.split("/").map(parseFloat),u=l[0],d=l[1];(r=new e.default.VTTCue(a,a+o.duration,"")).adStartTime=a-u,r.adEndTime=r.adStartTime+d,i.addCue(r)}a+=o.duration}},au=[{name:"VOD",run:function(e,t,i,n,r){if(i!==1/0){return{time:0,segmentIndex:0,partIndex:null}}return null}},{name:"ProgramDateTime",run:function(e,t,i,n,r){if(!Object.keys(e.timelineToDatetimeMappings).length)return null;var a=null,s=null,o=Ba(t);r=r||0;for(var l=0;l<o.length;l++){var u=o[t.endList||0===r?l:o.length-(l+1)],d=u.segment,c=e.timelineToDatetimeMappings[d.timeline];if(c&&d.dateTimeObject){var h=d.dateTimeObject.getTime()/1e3+c;if(d.parts&&"number"==typeof u.partIndex)for(var p=0;p<u.partIndex;p++)h+=d.parts[p].duration;var f=Math.abs(r-h);if(null!==s&&(0===f||s<f))break;s=f,a={time:h,segmentIndex:u.segmentIndex,partIndex:u.partIndex}}}return a}},{name:"Segment",run:function(e,t,i,n,r){var a=null,s=null;r=r||0;for(var o=Ba(t),l=0;l<o.length;l++){var u=o[t.endList||0===r?l:o.length-(l+1)],d=u.segment,c=u.part&&u.part.start||d&&d.start;if(d.timeline===n&&void 0!==c){var h=Math.abs(r-c);if(null!==s&&s<h)break;(!a||null===s||s>=h)&&(s=h,a={time:c,segmentIndex:u.segmentIndex,partIndex:u.partIndex})}}return a}},{name:"Discontinuity",run:function(e,t,i,n,r){var a=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length)for(var s=null,o=0;o<t.discontinuityStarts.length;o++){var l=t.discontinuityStarts[o],u=t.discontinuitySequence+o+1,d=e.discontinuities[u];if(d){var c=Math.abs(r-d.time);if(null!==s&&s<c)break;(!a||null===s||s>=c)&&(s=c,a={time:d.time,segmentIndex:l,partIndex:null})}}return a}},{name:"Playlist",run:function(e,t,i,n,r){return t.syncInfo?{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null}:null}}],su=function(e){function t(t){var i;return(i=e.call(this)||this).timelines=[],i.discontinuities=[],i.timelineToDatetimeMappings={},i.logger_=ka("SyncController"),i}(0,r.default)(t,e);var i=t.prototype;return i.getSyncPoint=function(e,t,i,n){var r=this.runStrategies_(e,t,i,n);return r.length?this.selectSyncPoint_(r,{key:"time",value:n}):null},i.getExpiredTime=function(e,t){if(!e||!e.segments)return null;var i=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!i.length)return null;var n=this.selectSyncPoint_(i,{key:"segmentIndex",value:0});return n.segmentIndex>0&&(n.time*=-1),Math.abs(n.time+za({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:n.segmentIndex,endIndex:0}))},i.runStrategies_=function(e,t,i,n){for(var r=[],a=0;a<au.length;a++){var s=au[a],o=s.run(this,e,t,i,n);o&&(o.strategy=s.name,r.push({strategy:s.name,syncPoint:o}))}return r},i.selectSyncPoint_=function(e,t){for(var i=e[0].syncPoint,n=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy,a=1;a<e.length;a++){var s=Math.abs(e[a].syncPoint[t.key]-t.value);s<n&&(n=s,i=e[a].syncPoint,r=e[a].strategy)}return this.logger_("syncPoint for ["+t.key+": "+t.value+"] chosen with strategy ["+r+"]: [time:"+i.time+", segmentIndex:"+i.segmentIndex+("number"==typeof i.partIndex?",partIndex:"+i.partIndex:"")+"]"),i},i.saveExpiredSegmentInfo=function(e,t){for(var i=t.mediaSequence-e.mediaSequence-1;i>=0;i--){var n=e.segments[i];if(n&&void 0!==n.start){t.syncInfo={mediaSequence:e.mediaSequence+i,time:n.start},this.logger_("playlist refresh sync: [time:"+t.syncInfo.time+", mediaSequence: "+t.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}},i.setDateTimeMappingForStart=function(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){var t=e.segments[0],i=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-i}},i.saveSegmentTimingInfo=function(e){var t=e.segmentInfo,i=e.shouldSaveTimelineMapping,n=this.calculateSegmentTimeMapping_(t,t.timingInfo,i),r=t.segment;n&&(this.saveDiscontinuitySyncInfo_(t),t.playlist.syncInfo||(t.playlist.syncInfo={mediaSequence:t.playlist.mediaSequence+t.mediaIndex,time:r.start}));var a=r.dateTimeObject;r.discontinuity&&i&&a&&(this.timelineToDatetimeMappings[r.timeline]=-a.getTime()/1e3)},i.timestampOffsetForTimeline=function(e){return void 0===this.timelines[e]?null:this.timelines[e].time},i.mappingForTimeline=function(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping},i.calculateSegmentTimeMapping_=function(e,t,i){var n,r,a=e.segment,s=e.part,o=this.timelines[e.timeline];if("number"==typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},i&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+e.timeline+": [time: "+o.time+"] [mapping: "+o.mapping+"]")),n=e.startOfSegment,r=t.end+o.mapping;else{if(!o)return!1;n=t.start+o.mapping,r=t.end+o.mapping}return s&&(s.start=n,s.end=r),(!a.start||n<a.start)&&(a.start=n),a.end=r,!0},i.saveDiscontinuitySyncInfo_=function(e){var t=e.playlist,i=e.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(var n=0;n<t.discontinuityStarts.length;n++){var r=t.discontinuityStarts[n],a=t.discontinuitySequence+n+1,s=r-e.mediaIndex,o=Math.abs(s);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>o){var l=void 0;l=s<0?i.start-za({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:r}):i.end+za({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:r}),this.discontinuities[a]={time:l,accuracy:o}}}},i.dispose=function(){this.trigger("dispose"),this.off()},t}(_a.EventTarget),ou=function(e){function t(){var t;return(t=e.call(this)||this).pendingTimelineChanges_={},t.lastTimelineChanges_={},t}(0,r.default)(t,e);var i=t.prototype;return i.clearPendingTimelineChange=function(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")},i.pendingTimelineChange=function(e){var t=e.type,i=e.from,n=e.to;return"number"==typeof i&&"number"==typeof n&&(this.pendingTimelineChanges_[t]={type:t,from:i,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[t]},i.lastTimelineChange=function(e){var t=e.type,i=e.from,n=e.to;return"number"==typeof i&&"number"==typeof n&&(this.lastTimelineChanges_[t]={type:t,from:i,to:n},delete this.pendingTimelineChanges_[t],this.trigger("timelinechange")),this.lastTimelineChanges_[t]},i.dispose=function(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()},t}(_a.EventTarget),lu=mo(go(function(){function e(e,t,i){return e(i={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&i.path)}},i.exports),i.exports}var t=e(function(e){function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e},e.exports.default=e.exports,e.exports.__esModule=!0}),i=e(function(e){function t(i,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(i,n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}),n=e(function(e){e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)},e.exports.default=e.exports,e.exports.__esModule=!0}),r=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(i,1),i>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,n=0;n<i;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),a=t.length,s=0;s<a;++s)t[s].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();var a=function(){var e,t,i,n,r,a,s,o,l=[[[],[],[],[],[]],[[],[],[],[],[]]],u=l[0],d=l[1],c=u[4],h=d[4],p=[],f=[];for(e=0;e<256;e++)f[(p[e]=e<<1^283*(e>>7))^e]=e;for(t=i=0;!c[t];t^=n||1,i=f[i]||1)for(a=(a=i^i<<1^i<<2^i<<3^i<<4)>>8^255&a^99,c[t]=a,h[a]=t,o=16843009*p[r=p[n=p[t]]]^65537*r^257*n^16843008*t,s=257*p[a]^16843008*a,e=0;e<4;e++)u[e][t]=s=s<<24^s>>>8,d[e][a]=o=o<<24^o>>>8;for(e=0;e<5;e++)u[e]=u[e].slice(0),d[e]=d[e].slice(0);return l},s=null,o=function(){function e(e){var t,i,n;s||(s=a()),this._tables=[[s[0][0].slice(),s[0][1].slice(),s[0][2].slice(),s[0][3].slice(),s[0][4].slice()],[s[1][0].slice(),s[1][1].slice(),s[1][2].slice(),s[1][3].slice(),s[1][4].slice()]];var r=this._tables[0][4],o=this._tables[1],l=e.length,u=1;if(4!==l&&6!==l&&8!==l)throw new Error("Invalid aes key size");var d=e.slice(0),c=[];for(this._key=[d,c],t=l;t<4*l+28;t++)n=d[t-1],(t%l==0||8===l&&t%l==4)&&(n=r[n>>>24]<<24^r[n>>16&255]<<16^r[n>>8&255]<<8^r[255&n],t%l==0&&(n=n<<8^n>>>24^u<<24,u=u<<1^283*(u>>7))),d[t]=d[t-l]^n;for(i=0;t;i++,t--)n=d[3&i?t:t-4],c[i]=t<=4||i<4?n:o[0][r[n>>>24]]^o[1][r[n>>16&255]]^o[2][r[n>>8&255]]^o[3][r[255&n]]}return e.prototype.decrypt=function(e,t,i,n,r,a){var s,o,l,u,d=this._key[1],c=e^d[0],h=n^d[1],p=i^d[2],f=t^d[3],m=d.length/4-2,g=4,v=this._tables[1],_=v[0],y=v[1],T=v[2],b=v[3],S=v[4];for(u=0;u<m;u++)s=_[c>>>24]^y[h>>16&255]^T[p>>8&255]^b[255&f]^d[g],o=_[h>>>24]^y[p>>16&255]^T[f>>8&255]^b[255&c]^d[g+1],l=_[p>>>24]^y[f>>16&255]^T[c>>8&255]^b[255&h]^d[g+2],f=_[f>>>24]^y[c>>16&255]^T[h>>8&255]^b[255&p]^d[g+3],g+=4,c=s,h=o,p=l;for(u=0;u<4;u++)r[(3&-u)+a]=S[c>>>24]<<24^S[h>>16&255]<<16^S[p>>8&255]<<8^S[255&f]^d[g++],s=c,c=h,h=p,p=f,f=s},e}(),l=function(e){function t(){var t;return(t=e.call(this,r)||this).jobs=[],t.delay=1,t.timeout_=null,t}n(t,e);var i=t.prototype;return i.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},i.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(r),u=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},d=function(){function e(t,i,n,r){var a=e.STEP,s=new Int32Array(t.buffer),o=new Uint8Array(t.byteLength),d=0;for(this.asyncStream_=new l,this.asyncStream_.push(this.decryptChunk_(s.subarray(d,d+a),i,n,o)),d=a;d<s.length;d+=a)n=new Uint32Array([u(s[d-4]),u(s[d-3]),u(s[d-2]),u(s[d-1])]),this.asyncStream_.push(this.decryptChunk_(s.subarray(d,d+a),i,n,o));this.asyncStream_.push(function(){var e;r(null,(e=o).subarray(0,e.byteLength-e[e.byteLength-1]))})}return e.prototype.decryptChunk_=function(e,t,i,n){return function(){var r=function(e,t,i){var n,r,a,s,l,d,c,h,p,f=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),m=new o(Array.prototype.slice.call(t)),g=new Uint8Array(e.byteLength),v=new Int32Array(g.buffer);for(n=i[0],r=i[1],a=i[2],s=i[3],p=0;p<f.length;p+=4)l=u(f[p]),d=u(f[p+1]),c=u(f[p+2]),h=u(f[p+3]),m.decrypt(l,d,c,h,v,p),v[p]=u(v[p]^n),v[p+1]=u(v[p+1]^r),v[p+2]=u(v[p+2]^a),v[p+3]=u(v[p+3]^s),n=l,r=d,a=c,s=h;return g}(e,t,i);n.set(r,e.byteOffset)}},t(e,null,[{key:"STEP",get:function(){return 32e3}}]),e}();self.onmessage=function(e){var t=e.data,i=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),n=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),r=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new d(i,n,r,function(e,i){var n,r;self.postMessage((n={source:t.source,decrypted:i},r={},Object.keys(n).forEach(function(e){var t=n[e];ArrayBuffer.isView(t)?r[e]={bytes:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}:r[e]=t}),r),[i.buffer])})}})),uu=fo(lu),du=function(e){var t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},cu=function(e,t){e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},hu=function(e,t){t.activePlaylistLoader=e,e.load()},pu=function(e,t){return function(){var i=t.segmentLoaders,n=i[e],r=i.main,a=t.mediaTypes[e],s=a.activeTrack(),o=a.getActiveGroup(),l=a.activePlaylistLoader,u=a.lastGroup_;o&&u&&o.id===u.id||(a.lastGroup_=o,a.lastTrack_=s,cu(n,a),o&&!o.isMasterPlaylist&&(o.playlistLoader?(n.resyncLoader(),hu(o.playlistLoader,a)):l&&r.resetEverything()))}},fu=function(e,t){return function(){var i=t.segmentLoaders[e];t.mediaTypes[e].lastGroup_=null,i.abort(),i.pause()}},mu=function(e,t){return function(){var i=t.masterPlaylistLoader,n=t.segmentLoaders,r=n[e],a=n.main,s=t.mediaTypes[e],o=s.activeTrack(),l=s.getActiveGroup(),u=s.activePlaylistLoader,d=s.lastTrack_;if((!d||!o||d.id!==o.id)&&(s.lastGroup_=l,s.lastTrack_=o,cu(r,s),l)){if(l.isMasterPlaylist){if(!o||!d||o.id===d.id)return;var c=t.vhs.masterPlaylistController_,h=c.selectPlaylist();if(c.media()===h)return;return s.logger_("track change. Switching master audio from "+d.id+" to "+o.id),i.pause(),a.resetEverything(),void c.fastQualityChange_(h)}if("AUDIO"===e){if(!l.playlistLoader)return a.setAudio(!0),void a.resetEverything();r.setAudio(!0),a.setAudio(!1)}u!==l.playlistLoader?(r.track&&r.track(o),r.resetEverything(),hu(l.playlistLoader,s)):hu(l.playlistLoader,s)}}},gu={AUDIO:function(e,t){return function(){var i=t.segmentLoaders[e],n=t.mediaTypes[e],r=t.blacklistCurrentPlaylist;cu(i,n);var a=n.activeTrack(),s=n.activeGroup(),o=(s.filter(function(e){return e.default})[0]||s[0]).id,l=n.tracks[o];if(a!==l){for(var u in _a.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),n.tracks)n.tracks[u].enabled=n.tracks[u]===l;n.onTrackChanged()}else r({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(e,t){return function(){var i=t.segmentLoaders[e],n=t.mediaTypes[e];_a.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),cu(i,n);var r=n.activeTrack();r&&(r.mode="disabled"),n.onTrackChanged()}}},vu={AUDIO:function(e,t,i){if(t){var n=i.tech,r=i.requestOptions,a=i.segmentLoaders[e];t.on("loadedmetadata",function(){var e=t.media();a.playlist(e,r),(!n.paused()||e.endList&&"none"!==n.preload())&&a.load()}),t.on("loadedplaylist",function(){a.playlist(t.media(),r),n.paused()||a.load()}),t.on("error",gu[e](e,i))}},SUBTITLES:function(e,t,i){var n=i.tech,r=i.requestOptions,a=i.segmentLoaders[e],s=i.mediaTypes[e];t.on("loadedmetadata",function(){var e=t.media();a.playlist(e,r),a.track(s.activeTrack()),(!n.paused()||e.endList&&"none"!==n.preload())&&a.load()}),t.on("loadedplaylist",function(){a.playlist(t.media(),r),n.paused()||a.load()}),t.on("error",gu[e](e,i))}},_u={AUDIO:function(e,t){var i=t.vhs,n=t.sourceType,r=t.segmentLoaders[e],a=t.requestOptions,s=t.master.mediaGroups,o=t.mediaTypes[e],l=o.groups,u=o.tracks,d=o.logger_,c=t.masterPlaylistLoader,h=as(c.master);for(var p in s[e]&&0!==Object.keys(s[e]).length||(s[e]={main:{default:{default:!0}}},h&&(s[e].main.default.playlists=c.master.playlists)),s[e])for(var f in l[p]||(l[p]=[]),s[e][p]){var m=s[e][p][f],g=void 0;if(h?(d("AUDIO group '"+p+"' label '"+f+"' is a master playlist"),m.isMasterPlaylist=!0,g=null):g="vhs-json"===n&&m.playlists?new ws(m.playlists[0],i,a):m.resolvedUri?new ws(m.resolvedUri,i,a):m.playlists&&"dash"===n?new lo(m.playlists[0],i,a,c):null,m=_a.mergeOptions({id:f,playlistLoader:g},m),vu[e](e,m.playlistLoader,t),l[p].push(m),void 0===u[f]){var v=new _a.AudioTrack({id:f,kind:du(m),enabled:!1,language:m.language,default:m.default,label:f});u[f]=v}}r.on("error",gu[e](e,t))},SUBTITLES:function(e,t){var i=t.tech,n=t.vhs,r=t.sourceType,a=t.segmentLoaders[e],s=t.requestOptions,o=t.master.mediaGroups,l=t.mediaTypes[e],u=l.groups,d=l.tracks,c=t.masterPlaylistLoader;for(var h in o[e])for(var p in u[h]||(u[h]=[]),o[e][h])if(!o[e][h][p].forced){var f=o[e][h][p],m=void 0;if("hls"===r)m=new ws(f.resolvedUri,n,s);else if("dash"===r){if(!f.playlists.filter(function(e){return e.excludeUntil!==1/0}).length)return;m=new lo(f.playlists[0],n,s,c)}else"vhs-json"===r&&(m=new ws(f.playlists?f.playlists[0]:f.resolvedUri,n,s));if(f=_a.mergeOptions({id:p,playlistLoader:m},f),vu[e](e,f.playlistLoader,t),u[h].push(f),void 0===d[p]){var g=i.addRemoteTextTrack({id:p,kind:"subtitles",default:f.default&&f.autoselect,language:f.language,label:p},!1).track;d[p]=g}}a.on("error",gu[e](e,t))},"CLOSED-CAPTIONS":function(e,t){var i=t.tech,n=t.master.mediaGroups,r=t.mediaTypes[e],a=r.groups,s=r.tracks;for(var o in n[e])for(var l in a[o]||(a[o]=[]),n[e][o]){var u=n[e][o][l];if(/^(?:CC|SERVICE)/.test(u.instreamId)){var d=i.options_.vhs&&i.options_.vhs.captionServices||{},c={label:l,language:u.language,instreamId:u.instreamId,default:u.default&&u.autoselect};if(d[c.instreamId]&&(c=_a.mergeOptions(c,d[c.instreamId])),void 0===c.default&&delete c.default,a[o].push(_a.mergeOptions({id:l},u)),void 0===s[l]){var h=i.addRemoteTextTrack({id:c.instreamId,kind:"captions",default:c.default,language:c.language,label:c.label},!1).track;s[l]=h}}}}},yu=function e(t,i){for(var n=0;n<t.length;n++){if(ns(i,t[n]))return!0;if(t[n].playlists&&e(t[n].playlists,i))return!0}return!1},Tu=function(e,t){return function(i){var n=t.masterPlaylistLoader,r=t.mediaTypes[e].groups,a=n.media();if(!a)return null;var s=null;a.attributes[e]&&(s=r[a.attributes[e]]);var o=Object.keys(r);if(!s)if("AUDIO"===e&&o.length>1&&as(t.master))for(var l=0;l<o.length;l++){var u=r[o[l]];if(yu(u,a)){s=u;break}}else r.main?s=r.main:1===o.length&&(s=r[o[0]]);return void 0===i?s:null!==i&&s&&s.filter(function(e){return e.id===i.id})[0]||null}},bu={AUDIO:function(e,t){return function(){var i=t.mediaTypes[e].tracks;for(var n in i)if(i[n].enabled)return i[n];return null}},SUBTITLES:function(e,t){return function(){var i=t.mediaTypes[e].tracks;for(var n in i)if("showing"===i[n].mode||"hidden"===i[n].mode)return i[n];return null}}},Su=function(e,t){var i=t.mediaTypes;return function(){var t=i[e].activeTrack();return t?i[e].activeGroup(t):null}},ku=function(e){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){_u[t](t,e)});var t=e.mediaTypes,i=e.masterPlaylistLoader,n=e.tech,r=e.vhs,a=e.segmentLoaders,s=a.AUDIO,o=a.main;["AUDIO","SUBTITLES"].forEach(function(i){t[i].activeGroup=Tu(i,e),t[i].activeTrack=bu[i](i,e),t[i].onGroupChanged=pu(i,e),t[i].onGroupChanging=fu(i,e),t[i].onTrackChanged=mu(i,e),t[i].getActiveGroup=Su(i,e)});var l=t.AUDIO.activeGroup();if(l){var u=(l.filter(function(e){return e.default})[0]||l[0]).id;t.AUDIO.tracks[u].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged(),t.AUDIO.getActiveGroup().playlistLoader?(o.setAudio(!1),s.setAudio(!0)):o.setAudio(!0)}i.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(e){return t[e].onGroupChanged()})}),i.on("mediachanging",function(){["AUDIO","SUBTITLES"].forEach(function(e){return t[e].onGroupChanging()})});var d=function(){t.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"}),n.trigger({type:"usage",name:"hls-audio-change"})};for(var c in n.audioTracks().addEventListener("change",d),n.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),r.on("dispose",function(){n.audioTracks().removeEventListener("change",d),n.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),n.clearTracks("audio"),t.AUDIO.tracks)n.audioTracks().addTrack(t.AUDIO.tracks[c])},Cu=function(){var e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Hl,activeTrack:Hl,getActiveGroup:Hl,onGroupChanged:Hl,onTrackChanged:Hl,lastTrack_:null,logger_:ka("MediaGroups["+t+"]")}}),e},Eu=120,wu=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],Iu=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},xu=function(e){var t=e.currentPlaylist,i=e.nextPlaylist,n=e.forwardBuffer,r=e.bufferLowWaterLine,a=e.bufferHighWaterLine,s=e.duration,o=e.experimentalBufferBasedABR,l=e.log;if(!i)return _a.log.warn("We received no playlist to switch to. Please check your stream."),!1;var u="allowing switch "+(t&&t.id||"null")+" -> "+i.id;if(!t||!t.endList)return l(u+" as current playlist "+(t?"is live":"is not set")),!0;if(i.id===t.id)return!1;var d=o?uo.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:uo.MAX_BUFFER_LOW_WATER_LINE;if(s<d)return l(u+" as duration < max low water line ("+s+" < "+d+")"),!0;var c=i.attributes.BANDWIDTH,h=t.attributes.BANDWIDTH;if(c<h&&(!o||n<a)){var p=u+" as next bandwidth < current bandwidth ("+c+" < "+h+")";return o&&(p+=" and forwardBuffer < bufferHighWaterLine ("+n+" < "+a+")"),l(p),!0}if((!o||c>h)&&n>=r){var f=u+" as forwardBuffer >= bufferLowWaterLine ("+n+" >= "+r+")";return o&&(f+=" and next bandwidth > current bandwidth ("+c+" > "+h+")"),l(f),!0}return l("not "+u+" as no switching criteria met"),!1},Pu=function(t){function i(i){var r;r=t.call(this)||this;var a=i.src,s=i.handleManifestRedirects,o=i.withCredentials,l=i.tech,u=i.bandwidth,d=i.externVhs,c=i.useCueTags,h=i.blacklistDuration,p=i.enableLowInitialPlaylist,f=i.sourceType,m=i.cacheEncryptionKeys,g=i.experimentalBufferBasedABR;if(!a)throw new Error("A non-empty playlist URL or JSON manifest string is required");var v=i.maxPlaylistRetries;null==v&&(v=1/0),ql=d,r.experimentalBufferBasedABR=Boolean(g),r.withCredentials=o,r.tech_=l,r.vhs_=l.vhs,r.sourceType_=f,r.useCueTags_=c,r.blacklistDuration=h,r.maxPlaylistRetries=v,r.enableLowInitialPlaylist=p,r.useCueTags_&&(r.cueTagsTrack_=r.tech_.addTextTrack("metadata","ad-cues"),r.cueTagsTrack_.inBandMetadataTrackDispatchType=""),r.requestOptions_={withCredentials:o,handleManifestRedirects:s,maxPlaylistRetries:v,timeout:null},r.on("error",r.pauseLoading),r.mediaTypes_=Cu(),r.mediaSource=new e.default.MediaSource,r.handleDurationChange_=r.handleDurationChange_.bind((0,n.default)(r)),r.handleSourceOpen_=r.handleSourceOpen_.bind((0,n.default)(r)),r.handleSourceEnded_=r.handleSourceEnded_.bind((0,n.default)(r)),r.mediaSource.addEventListener("durationchange",r.handleDurationChange_),r.mediaSource.addEventListener("sourceopen",r.handleSourceOpen_),r.mediaSource.addEventListener("sourceended",r.handleSourceEnded_),r.seekable_=_a.createTimeRanges(),r.hasPlayed_=!1,r.syncController_=new su(i),r.segmentMetadataTrack_=l.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,r.decrypter_=new uu,r.sourceUpdater_=new Zl(r.mediaSource),r.inbandTextTracks_={},r.timelineChangeController_=new ou;var _={vhs:r.vhs_,parse708captions:i.parse708captions,mediaSource:r.mediaSource,currentTime:r.tech_.currentTime.bind(r.tech_),seekable:function(){return r.seekable()},seeking:function(){return r.tech_.seeking()},duration:function(){return r.duration()},hasPlayed:function(){return r.hasPlayed_},goalBufferLength:function(){return r.goalBufferLength()},bandwidth:u,syncController:r.syncController_,decrypter:r.decrypter_,sourceType:r.sourceType_,inbandTextTracks:r.inbandTextTracks_,cacheEncryptionKeys:m,sourceUpdater:r.sourceUpdater_,timelineChangeController:r.timelineChangeController_};r.masterPlaylistLoader_="dash"===r.sourceType_?new lo(a,r.vhs_,r.requestOptions_):new ws(a,r.vhs_,r.requestOptions_),r.setupMasterPlaylistLoaderListeners_(),r.mainSegmentLoader_=new jl(_a.mergeOptions(_,{segmentMetadataTrack:r.segmentMetadataTrack_,loaderType:"main"}),i),r.audioSegmentLoader_=new jl(_a.mergeOptions(_,{loaderType:"audio"}),i),r.subtitleSegmentLoader_=new iu(_a.mergeOptions(_,{loaderType:"vtt",featuresNativeTextTracks:r.tech_.featuresNativeTextTracks}),i),r.setupSegmentLoaderListeners_(),r.experimentalBufferBasedABR&&(r.masterPlaylistLoader_.one("loadedplaylist",function(){return r.startABRTimer_()}),r.tech_.on("pause",function(){return r.stopABRTimer_()}),r.tech_.on("play",function(){return r.startABRTimer_()})),wu.forEach(function(e){r[e+"_"]=Iu.bind((0,n.default)(r),e)}),r.logger_=ka("MPC"),r.triggeredFmp4Usage=!1,"none"===r.tech_.preload()?(r.loadOnPlay_=function(){r.loadOnPlay_=null,r.masterPlaylistLoader_.load()},r.tech_.one("play",r.loadOnPlay_)):r.masterPlaylistLoader_.load(),r.timeToLoadedData__=-1,r.mainAppendsToLoadedData__=-1,r.audioAppendsToLoadedData__=-1;var y="none"===r.tech_.preload()?"play":"loadstart";return r.tech_.one(y,function(){var e=Date.now();r.tech_.one("loadeddata",function(){r.timeToLoadedData__=Date.now()-e,r.mainAppendsToLoadedData__=r.mainSegmentLoader_.mediaAppends,r.audioAppendsToLoadedData__=r.audioSegmentLoader_.mediaAppends})}),r}(0,r.default)(i,t);var a=i.prototype;return a.mainAppendsToLoadedData_=function(){return this.mainAppendsToLoadedData__},a.audioAppendsToLoadedData_=function(){return this.audioAppendsToLoadedData__},a.appendsToLoadedData_=function(){var e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t},a.timeToLoadedData_=function(){return this.timeToLoadedData__},a.checkABR_=function(){var e=this.selectPlaylist();this.shouldSwitchToMedia_(e)&&this.switchMedia_(e,"abr")},a.switchMedia_=function(e,t,i){var n=this.media(),r=n&&(n.id||n.uri),a=e.id||e.uri;r&&r!==a&&(this.logger_("switch media "+r+" -> "+a+" from "+t),this.tech_.trigger({type:"usage",name:"vhs-rendition-change-"+t})),this.masterPlaylistLoader_.media(e,i)},a.startABRTimer_=function(){var t=this;this.stopABRTimer_(),this.abrTimer_=e.default.setInterval(function(){return t.checkABR_()},250)},a.stopABRTimer_=function(){this.tech_.scrubbing&&this.tech_.scrubbing()||(e.default.clearInterval(this.abrTimer_),this.abrTimer_=null)},a.getAudioTrackPlaylists_=function(){var e=this.master();if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return e&&e.playlists||[];var t,i=e.mediaGroups.AUDIO,n=Object.keys(i);if(Object.keys(this.mediaTypes_.AUDIO.groups).length)t=this.mediaTypes_.AUDIO.activeTrack();else{var r=i.main||n.length&&i[n[0]];for(var a in r)if(r[a].default){t={label:a};break}}if(!t)return[];var s=[];for(var o in i)if(i[o][t.label]){var l=i[o][t.label];l.playlists?s.push.apply(s,l.playlists):s.push(l)}return s},a.setupMasterPlaylistLoaderListeners_=function(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var t=e.masterPlaylistLoader_.media(),i=1.5*t.targetDuration*1e3;is(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=i,t.endList&&"none"!==e.tech_.preload()&&(e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load()),ku({sourceType:e.sourceType_,segmentLoaders:{AUDIO:e.audioSegmentLoader_,SUBTITLES:e.subtitleSegmentLoader_,main:e.mainSegmentLoader_},tech:e.tech_,requestOptions:e.requestOptions_,masterPlaylistLoader:e.masterPlaylistLoader_,vhs:e.vhs_,master:e.master(),mediaTypes:e.mediaTypes_,blacklistCurrentPlaylist:e.blacklistCurrentPlaylist.bind(e)}),e.triggerPresenceUsage_(e.master(),t),e.setupFirstPlay(),!e.mediaTypes_.AUDIO.activePlaylistLoader||e.mediaTypes_.AUDIO.activePlaylistLoader.media()?e.trigger("selectedinitialmedia"):e.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){e.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){e.loadOnPlay_&&e.tech_.off("play",e.loadOnPlay_);var t=e.masterPlaylistLoader_.media();if(!t){var i;if(e.excludeUnsupportedVariants_(),e.enableLowInitialPlaylist&&(i=e.selectInitialPlaylist()),i||(i=e.selectPlaylist()),!i||!e.shouldSwitchToMedia_(i))return;if(e.initialMedia_=i,e.switchMedia_(e.initialMedia_,"initial"),!("vhs-json"===e.sourceType_&&e.initialMedia_.segments))return;t=e.initialMedia_}e.handleUpdatedMediaPlaylist(t)}),this.masterPlaylistLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){e.mainSegmentLoader_.abort(),e.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var t=e.masterPlaylistLoader_.media(),i=1.5*t.targetDuration*1e3;is(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=i,e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load(),e.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var t=e.masterPlaylistLoader_.media();"playlist-unchanged"!==t.lastExcludeReason_&&(e.stuckAtPlaylistEnd_(t)&&(e.blacklistCurrentPlaylist({message:"Playlist no longer updating.",reason:"playlist-unchanged"}),e.tech_.trigger("playliststuck")))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})},a.handleUpdatedMediaPlaylist=function(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())},a.triggerPresenceUsage_=function(e,t){var i=e.mediaGroups||{},n=!0,r=Object.keys(i.AUDIO);for(var a in i.AUDIO)for(var s in i.AUDIO[a]){i.AUDIO[a][s].uri||(n=!1)}n&&(this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),this.tech_.trigger({type:"usage",name:"hls-demuxed"})),Object.keys(i.SUBTITLES).length&&(this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),this.tech_.trigger({type:"usage",name:"hls-webvtt"})),ql.Playlist.isAes(t)&&(this.tech_.trigger({type:"usage",name:"vhs-aes"}),this.tech_.trigger({type:"usage",name:"hls-aes"})),r.length&&Object.keys(i.AUDIO[r[0]]).length>1&&(this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})),this.useCueTags_&&(this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"}),this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"}))},a.shouldSwitchToMedia_=function(e){var t=this.masterPlaylistLoader_.media(),i=this.tech_.buffered(),n=i.length?i.end(i.length-1)-this.tech_.currentTime():0,r=this.bufferLowWaterLine(),a=this.bufferHighWaterLine();return xu({currentPlaylist:t,nextPlaylist:e,forwardBuffer:n,bufferLowWaterLine:r,bufferHighWaterLine:a,duration:this.duration(),experimentalBufferBasedABR:this.experimentalBufferBasedABR,log:this.logger_})},a.setupSegmentLoaderListeners_=function(){var e=this;this.experimentalBufferBasedABR||(this.mainSegmentLoader_.on("bandwidthupdate",function(){var t=e.selectPlaylist();e.shouldSwitchToMedia_(t)&&e.switchMedia_(t,"bandwidthupdate"),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")})),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("appenderror",function(){e.error=e.mainSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"}),e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",function(){e.error=e.audioSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("ended",function(){e.logger_("main segment loader ended"),e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(t){e.experimentalBufferBasedABR||(e.delegateLoaders_("all",["abort"]),e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},Eu))});var t=function(){if(!e.sourceUpdater_.hasCreatedSourceBuffers())return e.tryToCreateSourceBuffers_();var t=e.getCodecsOrExclude_();t&&e.sourceUpdater_.addOrChangeSourceBuffers(t)};this.mainSegmentLoader_.on("trackinfo",t),this.audioSegmentLoader_.on("trackinfo",t),this.mainSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",function(){e.logger_("audioSegmentLoader ended"),e.onEndOfStream()})},a.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},a.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},a.smoothQualityChange_=function(e){void 0===e&&(e=this.selectPlaylist()),this.fastQualityChange_(e)},a.fastQualityChange_=function(e){var t=this;void 0===e&&(e=this.selectPlaylist()),e!==this.masterPlaylistLoader_.media()?(this.switchMedia_(e,"fast-quality"),this.mainSegmentLoader_.resetEverything(function(){_a.browser.IE_VERSION||_a.browser.IS_EDGE?t.tech_.setCurrentTime(t.tech_.currentTime()+.04):t.tech_.setCurrentTime(t.tech_.currentTime())})):this.logger_("skipping fastQualityChange because new media is same as old")},a.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();var e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}},a.setupFirstPlay=function(){var e=this,t=this.masterPlaylistLoader_.media();if(!t||this.tech_.paused()||this.hasPlayed_)return!1;if(!t.endList){var i=this.seekable();if(!i.length)return!1;if(_a.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){e.trigger("firstplay"),e.tech_.setCurrentTime(i.end(0)),e.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(i.end(0))}return this.hasPlayed_=!0,this.load(),!0},a.handleSourceOpen_=function(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){var e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,function(e){})}this.trigger("sourceopen")},a.handleSourceEnded_=function(){if(this.inbandTextTracks_.metadataTrack_){var e=this.inbandTextTracks_.metadataTrack_.cues;if(e&&e.length){var t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}}},a.handleDurationChange_=function(){this.tech_.trigger("durationchange")},a.onEndOfStream=function(){var e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){var t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())},a.stuckAtPlaylistEnd_=function(e){if(!this.seekable().length)return!1;var t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;var i=ql.Playlist.playlistEnd(e,t),n=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return i-n<=Ea;var a=r.end(r.length-1);return a-n<=Ea&&i-a<=Ea},a.blacklistCurrentPlaylist=function(e,t){void 0===e&&(e={});var i=e.playlist||this.masterPlaylistLoader_.media();if(t=t||e.blacklistDuration||this.blacklistDuration,!i)return this.error=e,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));i.playlistErrors_++;var n,r=this.masterPlaylistLoader_.master.playlists,a=r.filter($a),s=1===a.length&&a[0]===i;if(1===r.length&&t!==1/0)return _a.log.warn("Problem encountered with playlist "+i.id+". Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(s);if(s){var o=!1;r.forEach(function(e){if(e!==i){var t=e.excludeUntil;void 0!==t&&t!==1/0&&(o=!0,delete e.excludeUntil)}}),o&&(_a.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}n=i.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*t,i.excludeUntil=n,e.reason&&(i.lastExcludeReason_=e.reason),this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-blacklisted"}),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});var l=this.selectPlaylist();if(!l)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");var u=e.internal?this.logger_:_a.log.warn,d=e.message?" "+e.message:"";u((e.internal?"Internal problem":"Problem")+" encountered with playlist "+i.id+"."+d+" Switching to playlist "+l.id+"."),l.attributes.AUDIO!==i.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),l.attributes.SUBTITLES!==i.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);var c=l.targetDuration/2*1e3||5e3,h="number"==typeof l.lastRequest&&Date.now()-l.lastRequest<=c;return this.switchMedia_(l,"exclude",s||h)},a.pauseLoading=function(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()},a.delegateLoaders_=function(e,t){var i=this,n=[],r="all"===e;(r||"main"===e)&&n.push(this.masterPlaylistLoader_);var a=[];(r||"audio"===e)&&a.push("AUDIO"),(r||"subtitle"===e)&&(a.push("CLOSED-CAPTIONS"),a.push("SUBTITLES")),a.forEach(function(e){var t=i.mediaTypes_[e]&&i.mediaTypes_[e].activePlaylistLoader;t&&n.push(t)}),["main","audio","subtitle"].forEach(function(t){var r=i[t+"SegmentLoader_"];!r||e!==t&&"all"!==e||n.push(r)}),n.forEach(function(e){return t.forEach(function(t){"function"==typeof e[t]&&e[t]()})})},a.setCurrentTime=function(e){var t=Ia(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0},a.duration=function(){if(!this.masterPlaylistLoader_)return 0;var e=this.masterPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:ql.Playlist.duration(e):1/0:0},a.seekable=function(){return this.seekable_},a.onSyncInfoUpdate_=function(){var e;if(this.masterPlaylistLoader_){var t=this.masterPlaylistLoader_.media();if(t){var i=this.syncController_.getExpiredTime(t,this.duration());if(null!==i){var n=this.masterPlaylistLoader_.master,r=ql.Playlist.seekable(t,i,ql.Playlist.liveEdgeDelay(n,t));if(0!==r.length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(i=this.syncController_.getExpiredTime(t,this.duration())))return;if(0===(e=ql.Playlist.seekable(t,i,ql.Playlist.liveEdgeDelay(n,t))).length)return}var a,s;this.seekable_&&this.seekable_.length&&(a=this.seekable_.end(0),s=this.seekable_.start(0)),e?e.start(0)>r.end(0)||r.start(0)>e.end(0)?this.seekable_=r:this.seekable_=_a.createTimeRanges([[e.start(0)>r.start(0)?e.start(0):r.start(0),e.end(0)<r.end(0)?e.end(0):r.end(0)]]):this.seekable_=r,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===a&&this.seekable_.start(0)===s||(this.logger_("seekable updated ["+Aa(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},a.updateDuration=function(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){var t=this.seekable();if(!t.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<t.end(t.length-1))&&this.sourceUpdater_.setDuration(t.end(t.length-1))}else{var i=this.tech_.buffered(),n=ql.Playlist.duration(this.masterPlaylistLoader_.media());i.length>0&&(n=Math.max(n,i.end(i.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}},a.dispose=function(){var e=this;this.trigger("dispose"),this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(function(t){var i=e.mediaTypes_[t].groups;for(var n in i)i[n].forEach(function(e){e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()},a.master=function(){return this.masterPlaylistLoader_.master},a.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},a.areMediaTypesKnown_=function(){var e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),i=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!i)},a.getCodecsOrExclude_=function(){var e=this,t={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}};t.video=t.main;var i=tl(this.master(),this.media()),n={},r=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(t.main.hasVideo&&(n.video=i.video||t.main.videoCodec||p.DEFAULT_VIDEO_CODEC),t.main.isMuxed&&(n.video+=","+(i.audio||t.main.audioCodec||p.DEFAULT_AUDIO_CODEC)),(t.main.hasAudio&&!t.main.isMuxed||t.audio.hasAudio||r)&&(n.audio=i.audio||t.main.audioCodec||t.audio.audioCodec||p.DEFAULT_AUDIO_CODEC,t.audio.isFmp4=t.main.hasAudio&&!t.main.isMuxed?t.main.isFmp4:t.audio.isFmp4),n.audio||n.video){var a,s={};if(["video","audio"].forEach(function(e){if(n.hasOwnProperty(e)&&(r=t[e].isFmp4,o=n[e],!(r?(0,p.browserSupportsCodec)(o):(0,p.muxerSupportsCodec)(o)))){var i=t[e].isFmp4?"browser":"muxer";s[i]=s[i]||[],s[i].push(n[e]),"audio"===e&&(a=i)}var r,o}),r&&a&&this.media().attributes.AUDIO){var o=this.media().attributes.AUDIO;this.master().playlists.forEach(function(t){(t.attributes&&t.attributes.AUDIO)===o&&t!==e.media()&&(t.excludeUntil=1/0)}),this.logger_("excluding audio group "+o+" as "+a+' does not support codec(s): "'+n.audio+'"')}if(!Object.keys(s).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){var l=[];if(["video","audio"].forEach(function(t){var i=((0,p.parseCodecs)(e.sourceUpdater_.codecs[t]||"")[0]||{}).type,r=((0,p.parseCodecs)(n[t]||"")[0]||{}).type;i&&r&&i.toLowerCase()!==r.toLowerCase()&&l.push('"'+e.sourceUpdater_.codecs[t]+'" -> "'+n[t]+'"')}),l.length)return void this.blacklistCurrentPlaylist({playlist:this.media(),message:"Codec switching not supported: "+l.join(", ")+".",blacklistDuration:1/0,internal:!0})}return n}var u=Object.keys(s).reduce(function(e,t){return e&&(e+=", "),e+=t+' does not support codec(s): "'+s[t].join(",")+'"'},"")+".";this.blacklistCurrentPlaylist({playlist:this.media(),internal:!0,message:u,blacklistDuration:1/0})}else this.blacklistCurrentPlaylist({playlist:this.media(),message:"Could not determine codecs for playlist.",blacklistDuration:1/0})},a.tryToCreateSourceBuffers_=function(){if("open"===this.mediaSource.readyState&&!this.sourceUpdater_.hasCreatedSourceBuffers()&&this.areMediaTypesKnown_()){var e=this.getCodecsOrExclude_();if(e){this.sourceUpdater_.createSourceBuffers(e);var t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}}},a.excludeUnsupportedVariants_=function(){var e=this,t=this.master().playlists,i=[];Object.keys(t).forEach(function(n){var r=t[n];if(-1===i.indexOf(r.id)){i.push(r.id);var a=tl(e.master,r),s=[];!a.audio||(0,p.muxerSupportsCodec)(a.audio)||(0,p.browserSupportsCodec)(a.audio)||s.push("audio codec "+a.audio),!a.video||(0,p.muxerSupportsCodec)(a.video)||(0,p.browserSupportsCodec)(a.video)||s.push("video codec "+a.video),a.text&&"stpp.ttml.im1t"===a.text&&s.push("text codec "+a.text),s.length&&(r.excludeUntil=1/0,e.logger_("excluding "+r.id+" for unsupported: "+s.join(", ")))}})},a.excludeIncompatibleVariants_=function(e){var t=this,i=[],n=this.master().playlists,r=Zo((0,p.parseCodecs)(e)),a=el(r),s=r.video&&(0,p.parseCodecs)(r.video)[0]||null,o=r.audio&&(0,p.parseCodecs)(r.audio)[0]||null;Object.keys(n).forEach(function(e){var r=n[e];if(-1===i.indexOf(r.id)&&r.excludeUntil!==1/0){i.push(r.id);var l=[],u=tl(t.masterPlaylistLoader_.master,r),d=el(u);if(u.audio||u.video){if(d!==a&&l.push('codec count "'+d+'" !== "'+a+'"'),!t.sourceUpdater_.canChangeType()){var c=u.video&&(0,p.parseCodecs)(u.video)[0]||null,h=u.audio&&(0,p.parseCodecs)(u.audio)[0]||null;c&&s&&c.type.toLowerCase()!==s.type.toLowerCase()&&l.push('video codec "'+c.type+'" !== "'+s.type+'"'),h&&o&&h.type.toLowerCase()!==o.type.toLowerCase()&&l.push('audio codec "'+h.type+'" !== "'+o.type+'"')}l.length&&(r.excludeUntil=1/0,t.logger_("blacklisting "+r.id+": "+l.join(" && ")))}}})},a.updateAdCues_=function(e){var t=0,i=this.seekable();i.length&&(t=i.start(0)),ru(e,this.cueTagsTrack_,t)},a.goalBufferLength=function(){var e=this.tech_.currentTime(),t=uo.GOAL_BUFFER_LENGTH,i=uo.GOAL_BUFFER_LENGTH_RATE,n=Math.max(t,uo.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*i,n)},a.bufferLowWaterLine=function(){var e=this.tech_.currentTime(),t=uo.BUFFER_LOW_WATER_LINE,i=uo.BUFFER_LOW_WATER_LINE_RATE,n=Math.max(t,uo.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,uo.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*i,this.experimentalBufferBasedABR?r:n)},a.bufferHighWaterLine=function(){return uo.BUFFER_HIGH_WATER_LINE},i}(_a.EventTarget),Lu=function(e,t,i){return function(n){var r=e.master.playlists[t],a=Ya(r),s=$a(r);return void 0===n?s:(n?delete r.disabled:r.disabled=!0,n===s||a||(i(),n?e.trigger("renditionenabled"):e.trigger("renditiondisabled")),n)}},Au=function(e,t,i){var n=e.masterPlaylistController_,r=n[(e.options_.smoothQualityChange?"smooth":"fast")+"QualityChange_"].bind(n);if(t.attributes){var a=t.attributes.RESOLUTION;this.width=a&&a.width,this.height=a&&a.height,this.bandwidth=t.attributes.BANDWIDTH}this.codecs=tl(n.master(),t),this.playlist=t,this.id=i,this.enabled=Lu(e.playlists,t.id,r)},Ou=function(e){e.representations=function(){var t=e.masterPlaylistController_.master(),i=as(t)?e.masterPlaylistController_.getAudioTrackPlaylists_():t.playlists;return i?i.filter(function(e){return!Ya(e)}).map(function(t,i){return new Au(e,t,t.id)}):[]}},Du=["seeking","seeked","pause","playing","error"],Mu=function(e){var t=e.buffered,i=e.targetDuration,n=e.currentTime;return!!t.length&&(!(t.end(0)-t.start(0)<2*i)&&(!(n>t.start(0))&&t.start(0)-n<i))},Ru=function(){function t(t){var i=this;this.masterPlaylistController_=t.masterPlaylistController,this.tech_=t.tech,this.seekable=t.seekable,this.allowSeeksWithinUnsafeLiveWindow=t.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=t.liveRangeSafeTimeDelta,this.media=t.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=ka("PlaybackWatcher"),this.logger_("initialize");var n=function(){return i.monitorCurrentTime_()},r=function(){return i.monitorCurrentTime_()},a=function(){return i.techWaiting_()},s=function(){return i.cancelTimer_()},o=function(){return i.fixesBadSeeks_()},l=this.masterPlaylistController_,u=["main","subtitle","audio"],d={};u.forEach(function(e){d[e]={reset:function(){return i.resetSegmentDownloads_(e)},updateend:function(){return i.checkSegmentDownloads_(e)}},l[e+"SegmentLoader_"].on("appendsdone",d[e].updateend),l[e+"SegmentLoader_"].on("playlistupdate",d[e].reset),i.tech_.on(["seeked","seeking"],d[e].reset)}),this.tech_.on("seekablechanged",o),this.tech_.on("waiting",a),this.tech_.on(Du,s),this.tech_.on("canplay",r),this.tech_.one("play",n),this.dispose=function(){i.logger_("dispose"),i.tech_.off("seekablechanged",o),i.tech_.off("waiting",a),i.tech_.off(Du,s),i.tech_.off("canplay",r),i.tech_.off("play",n),u.forEach(function(e){l[e+"SegmentLoader_"].off("appendsdone",d[e].updateend),l[e+"SegmentLoader_"].off("playlistupdate",d[e].reset),i.tech_.off(["seeked","seeking"],d[e].reset)}),i.checkCurrentTimeTimeout_&&e.default.clearTimeout(i.checkCurrentTimeTimeout_),i.cancelTimer_()}}var i=t.prototype;return i.monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&e.default.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=e.default.setTimeout(this.monitorCurrentTime_.bind(this),250)},i.resetSegmentDownloads_=function(e){var t=this.masterPlaylistController_[e+"SegmentLoader_"];this[e+"StalledDownloads_"]>0&&this.logger_("resetting possible stalled download count for "+e+" loader"),this[e+"StalledDownloads_"]=0,this[e+"Buffered_"]=t.buffered_()},i.checkSegmentDownloads_=function(e){var t=this.masterPlaylistController_,i=t[e+"SegmentLoader_"],n=i.buffered_(),r=Ma(this[e+"Buffered_"],n);this[e+"Buffered_"]=n,r?this.resetSegmentDownloads_(e):(this[e+"StalledDownloads_"]++,this.logger_("found #"+this[e+"StalledDownloads_"]+" "+e+" appends that did not increase buffer (possible stalled download)",{playlistId:i.playlist_&&i.playlist_.id,buffered:Da(n)}),this[e+"StalledDownloads_"]<10||(this.logger_(e+" loader stalled download exclusion"),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:"vhs-"+e+"-download-exclusion"}),"subtitle"!==e&&t.blacklistCurrentPlaylist({message:"Excessive "+e+" segment downloading detected."},1/0)))},i.checkCurrentTime_=function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())return this.consecutiveUpdates=0,void(this.lastRecordedTime=this.tech_.currentTime());if(!this.tech_.paused()&&!this.tech_.seeking()){var e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+Ea>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}},i.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null},i.fixesBadSeeks_=function(){if(!this.tech_.seeking())return!1;var e,t=this.seekable(),i=this.tech_.currentTime();this.afterSeekableWindow_(t,i,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(e=t.end(t.length-1));if(this.beforeSeekableWindow_(t,i)){var n=t.start(0);e=n+(n===t.end(0)?0:Ea)}if(void 0!==e)return this.logger_("Trying to seek outside of seekable at time "+i+" with seekable range "+Aa(t)+". Seeking to "+e+"."),this.tech_.setCurrentTime(e),!0;var r=this.tech_.buffered();return!!Mu({buffered:r,targetDuration:this.media().targetDuration,currentTime:i})&&(e=r.start(0)+Ea,this.logger_("Buffered region starts ("+r.start(0)+")  just beyond seek point ("+i+"). Seeking to "+e+"."),this.tech_.setCurrentTime(e),!0)},i.waiting_=function(){if(!this.techWaiting_()){var e=this.tech_.currentTime(),t=this.tech_.buffered(),i=Ia(t,e);return i.length&&e+3<=i.end(0)?(this.cancelTimer_(),this.tech_.setCurrentTime(e),this.logger_("Stopped at "+e+" while inside a buffered region ["+i.start(0)+" -> "+i.end(0)+"]. Attempting to resume playback by seeking to the current time."),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"}),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})):void 0}},i.techWaiting_=function(){var e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_())return!0;if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(e,t)){var i=e.end(e.length-1);return this.logger_("Fell out of live window at time "+t+". Seeking to live point (seekable end) "+i),this.cancelTimer_(),this.tech_.setCurrentTime(i),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var n=this.tech_.vhs.masterPlaylistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.cancelTimer_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;var a=xa(r,t);if(a.length>0){var s=a.start(0)-t;return this.logger_("Stopped at "+t+", setting timer for "+s+", seeking to "+a.start(0)),this.cancelTimer_(),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*s,t),!0}return!1},i.afterSeekableWindow_=function(e,t,i,n){if(void 0===n&&(n=!1),!e.length)return!1;var r=e.end(e.length-1)+Ea;return!i.endList&&n&&(r=e.end(e.length-1)+3*i.targetDuration),t>r},i.beforeSeekableWindow_=function(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)},i.videoUnderflow_=function(e){var t=e.videoBuffered,i=e.audioBuffered,n=e.currentTime;if(t){var r;if(t.length&&i.length){var a=Ia(t,n-3),s=Ia(t,n),o=Ia(i,n);o.length&&!s.length&&a.length&&(r={start:a.end(0),end:o.end(0)})}else{xa(t,n).length||(r=this.gapFromVideoUnderflow_(t,n))}return!!r&&(this.logger_("Encountered a gap in video from "+r.start+" to "+r.end+". Seeking to current time "+n),!0)}},i.skipTheGap_=function(e){var t=this.tech_.buffered(),i=this.tech_.currentTime(),n=xa(t,i);this.cancelTimer_(),0!==n.length&&i===e&&(this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",e,"nextRange start:",n.start(0)),this.tech_.setCurrentTime(n.start(0)+Ca),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))},i.gapFromVideoUnderflow_=function(e,t){for(var i=Pa(e),n=0;n<i.length;n++){var r=i.start(n),a=i.end(n);if(t-r<4&&t-r>2)return{start:r,end:a}}return null},t}(),Uu={errorInterval:30,getSource:function(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},Bu=function e(t,i){var n=0,r=0,a=_a.mergeOptions(Uu,i);t.ready(function(){t.trigger({type:"usage",name:"vhs-error-reload-initialized"}),t.trigger({type:"usage",name:"hls-error-reload-initialized"})});var s=function(){r&&t.currentTime(r)},o=function(e){null!=e&&(r=t.duration()!==1/0&&t.currentTime()||0,t.one("loadedmetadata",s),t.src(e),t.trigger({type:"usage",name:"vhs-error-reload"}),t.trigger({type:"usage",name:"hls-error-reload"}),t.play())},l=function(){return Date.now()-n<1e3*a.errorInterval?(t.trigger({type:"usage",name:"vhs-error-reload-canceled"}),void t.trigger({type:"usage",name:"hls-error-reload-canceled"})):a.getSource&&"function"==typeof a.getSource?(n=Date.now(),a.getSource.call(t,o)):void _a.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")},u=function e(){t.off("loadedmetadata",s),t.off("error",l),t.off("dispose",e)};t.on("error",l),t.on("dispose",u),t.reloadSourceOnError=function(i){u(),e(t,i)}},Fu=function(e){Bu(this,e)},Nu="2.9.2",ju="5.12.2",Hu="0.17.0",qu="4.7.0",Vu="3.1.2",Wu={PlaylistLoader:ws,Playlist:ss,utils:qs,STANDARD_PLAYLIST_SELECTOR:ul,INITIAL_PLAYLIST_SELECTOR:hl,lastBandwidthSelector:ul,movingAverageBandwidthSelector:dl,comparePlaylistBandwidth:sl,comparePlaylistResolution:ol,xhr:Ls()};Object.keys(uo).forEach(function(e){Object.defineProperty(Wu,e,{get:function(){return _a.log.warn("using Vhs."+e+" is UNSAFE be sure you know what you are doing"),uo[e]},set:function(t){_a.log.warn("using Vhs."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof t||t<0?_a.log.warn("value of Vhs."+e+" must be greater than or equal to 0"):uo[e]=t}})});var zu="videojs-vhs",Gu=function(e,t){for(var i=t.media(),n=-1,r=0;r<e.length;r++)if(e[r].id===i.id){n=r;break}e.selectedIndex_=n,e.trigger({selectedIndex:n,type:"change"})},Ku=function(e,t){t.representations().forEach(function(t){e.addQualityLevel(t)}),Gu(e,t.playlists)};Wu.canPlaySource=function(){return _a.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Qu=function(e,t,i){if(!e)return e;var n={};t&&t.attributes&&t.attributes.CODECS&&(n=Zo((0,p.parseCodecs)(t.attributes.CODECS))),i&&i.attributes&&i.attributes.CODECS&&(n.audio=i.attributes.CODECS);var r=(0,p.getMimeForCodec)(n.video),a=(0,p.getMimeForCodec)(n.audio),s={};for(var o in e)s[o]={},a&&(s[o].audioContentType=a),r&&(s[o].videoContentType=r),t.contentProtection&&t.contentProtection[o]&&t.contentProtection[o].pssh&&(s[o].pssh=t.contentProtection[o].pssh),"string"==typeof e[o]&&(s[o].url=e[o]);return _a.mergeOptions(e,s)},Xu=function(e,t){return e.reduce(function(e,i){if(!i.contentProtection)return e;var n=t.reduce(function(e,t){var n=i.contentProtection[t];return n&&n.pssh&&(e[t]={pssh:n.pssh}),e},{});return Object.keys(n).length&&e.push(n),e},[])},Yu=function(e){var t=e.player,i=e.sourceKeySystems,n=e.audioMedia,r=e.mainPlaylists;if(!t.eme.initializeMediaKeys)return Promise.resolve();var a=n?r.concat([n]):r,s=Xu(a,Object.keys(i)),o=[],l=[];return s.forEach(function(e){l.push(new Promise(function(e,i){t.tech_.one("keysessioncreated",e)})),o.push(new Promise(function(i,n){t.eme.initializeMediaKeys({keySystems:e},function(e){e?n(e):i()})}))}),Promise.race([Promise.all(o),Promise.race(l)])},$u=function(e){var t=e.player,i=e.sourceKeySystems,n=e.media,r=e.audioMedia,a=Qu(i,n,r);return!!a&&(t.currentSource().keySystems=a,!(a&&!t.eme)||(_a.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1))},Ju=function(){if(!e.default.localStorage)return null;var t=e.default.localStorage.getItem(zu);if(!t)return null;try{return JSON.parse(t)}catch(i){return null}},Zu=function(t){if(!e.default.localStorage)return!1;var i=Ju();i=i?_a.mergeOptions(i,t):t;try{e.default.localStorage.setItem(zu,JSON.stringify(i))}catch(n){return!1}return i},ed=function(e){return 0===e.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(e.substring(e.indexOf(",")+1)):e};Wu.supportsNativeHls=function(){if(!t.default||!t.default.createElement)return!1;var e=t.default.createElement("video");if(!_a.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),Wu.supportsNativeDash=!!(t.default&&t.default.createElement&&_a.getTech("Html5").isSupported())&&/maybe|probably/i.test(t.default.createElement("video").canPlayType("application/dash+xml")),Wu.supportsTypeNatively=function(e){return"hls"===e?Wu.supportsNativeHls:"dash"===e&&Wu.supportsNativeDash},Wu.isSupported=function(){return _a.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var td=_a.getComponent("Component"),id=function(i){function a(e,r,a){var s;if(s=i.call(this,r,_a.mergeOptions(a.hls,a.vhs))||this,a.hls&&Object.keys(a.hls).length&&_a.log.warn("Using hls options is deprecated. Use vhs instead."),"number"==typeof a.initialBandwidth&&(s.options_.bandwidth=a.initialBandwidth),s.logger_=ka("VhsHandler"),r.options_&&r.options_.playerId){var o=_a(r.options_.playerId);o.hasOwnProperty("hls")||Object.defineProperty(o,"hls",{get:function(){return _a.log.warn("player.hls is deprecated. Use player.tech().vhs instead."),r.trigger({type:"usage",name:"hls-player-access"}),(0,n.default)(s)},configurable:!0}),o.hasOwnProperty("vhs")||Object.defineProperty(o,"vhs",{get:function(){return _a.log.warn("player.vhs is deprecated. Use player.tech().vhs instead."),r.trigger({type:"usage",name:"vhs-player-access"}),(0,n.default)(s)},configurable:!0}),o.hasOwnProperty("dash")||Object.defineProperty(o,"dash",{get:function(){return _a.log.warn("player.dash is deprecated. Use player.tech().vhs instead."),(0,n.default)(s)},configurable:!0}),s.player_=o}if(s.tech_=r,s.source_=e,s.stats={},s.ignoreNextSeekingEvent_=!1,s.setOptions_(),s.options_.overrideNative&&r.overrideNativeAudioTracks&&r.overrideNativeVideoTracks)r.overrideNativeAudioTracks(!0),r.overrideNativeVideoTracks(!0);else if(s.options_.overrideNative&&(r.featuresNativeVideoTracks||r.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return s.on(t.default,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(e){var i=t.default.fullscreenElement||t.default.webkitFullscreenElement||t.default.mozFullScreenElement||t.default.msFullscreenElement;i&&i.contains(s.tech_.el())?s.masterPlaylistController_.fastQualityChange_():s.masterPlaylistController_.checkABR_()}),s.on(s.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),s.on(s.tech_,"error",function(){this.tech_.error()&&this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),s.on(s.tech_,"play",s.play),s}(0,r.default)(a,i);var s=a.prototype;return s.setOptions_=function(){var e=this;if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=!1!==this.options_.handleManifestRedirects,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){var t=Ju();t&&t.bandwidth&&(this.options_.bandwidth=t.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),t&&t.throughput&&(this.options_.throughput=t.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=uo.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===uo.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","experimentalBufferBasedABR","liveRangeSafeTimeDelta","experimentalLLHLS"].forEach(function(t){void 0!==e.source_[t]&&(e.options_[t]=e.source_[t])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio},s.src=function(t,i){var n=this;if(t){this.setOptions_(),this.options_.src=ed(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=Wu,this.options_.sourceType=(0,f.simpleTypeFromSourceType)(i),this.options_.seekTo=function(e){n.tech_.setCurrentTime(e)},this.options_.smoothQualityChange&&_a.log.warn("smoothQualityChange is deprecated and will be removed in the next major version"),this.masterPlaylistController_=new Pu(this.options_);var r=_a.mergeOptions({liveRangeSafeTimeDelta:Ea},this.options_,{seekable:function(){return n.seekable()},media:function(){return n.masterPlaylistController_.media()},masterPlaylistController:this.masterPlaylistController_});this.playbackWatcher_=new Ru(r),this.masterPlaylistController_.on("error",function(){var e=_a.players[n.tech_.options_.playerId],t=n.masterPlaylistController_.error;"object"!=typeof t||t.code?"string"==typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)});var a=this.options_.experimentalBufferBasedABR?Wu.movingAverageBandwidthSelector(.55):Wu.STANDARD_PLAYLIST_SELECTOR;this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):a.bind(this),this.masterPlaylistController_.selectInitialPlaylist=Wu.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var e,t=1/(this.bandwidth||1);return e=this.throughput>0?1/this.throughput:0,Math.floor(1/(t+e))},set:function(){_a.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return n.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return n.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return n.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return n.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return n.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return n.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return n.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return n.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},mediaAppends:{get:function(){return n.masterPlaylistController_.mediaAppends_()||0},enumerable:!0},mainAppendsToLoadedData:{get:function(){return n.masterPlaylistController_.mainAppendsToLoadedData_()||0},enumerable:!0},audioAppendsToLoadedData:{get:function(){return n.masterPlaylistController_.audioAppendsToLoadedData_()||0},enumerable:!0},appendsToLoadedData:{get:function(){return n.masterPlaylistController_.appendsToLoadedData_()||0},enumerable:!0},timeToLoadedData:{get:function(){return n.masterPlaylistController_.timeToLoadedData_()||0},enumerable:!0},buffered:{get:function(){return Da(n.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return n.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return n.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return n.tech_.name_},enumerable:!0},duration:{get:function(){return n.tech_.duration()},enumerable:!0},master:{get:function(){return n.playlists.master},enumerable:!0},playerDimensions:{get:function(){return n.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return Da(n.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return n.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){n.options_.useBandwidthFromLocalStorage&&Zu({bandwidth:n.bandwidth,throughput:Math.round(n.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){Ou(n)}),this.masterPlaylistController_.sourceUpdater_.on("createdsourcebuffers",function(){n.setupEme_()}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=e.default.URL.createObjectURL(this.masterPlaylistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}},s.setupEme_=function(){var e=this,t=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,i=$u({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:t&&t.media()});11!==_a.browser.IE_VERSION&&i?(this.logger_("waiting for EME key session creation"),Yu({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:t&&t.media(),mainPlaylists:this.playlists.master.playlists}).then(function(){e.logger_("created EME key session"),e.masterPlaylistController_.sourceUpdater_.initializedEme()}).catch(function(t){e.logger_("error while creating EME key session",t),e.player_.error({message:"Failed to initialize media keys for EME",code:3})})):this.masterPlaylistController_.sourceUpdater_.initializedEme()},s.setupQualityLevels_=function(){var e=this,t=_a.players[this.tech_.options_.playerId];t&&t.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=t.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){Ku(e.qualityLevels_,e)}),this.playlists.on("mediachange",function(){Gu(e.qualityLevels_,e.playlists)}))},a.version=function(){return{"@videojs/http-streaming":Nu,"mux.js":ju,"mpd-parser":Hu,"m3u8-parser":qu,"aes-decrypter":Vu}},s.version=function(){return this.constructor.version()},s.canChangeType=function(){return Zl.canChangeType()},s.play=function(){this.masterPlaylistController_.play()},s.setCurrentTime=function(e){this.masterPlaylistController_.setCurrentTime(e)},s.duration=function(){return this.masterPlaylistController_.duration()},s.seekable=function(){return this.masterPlaylistController_.seekable()},s.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.tech_&&delete this.tech_.hls,this.mediaSourceUrl_&&e.default.URL.revokeObjectURL&&(e.default.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),i.prototype.dispose.call(this)},s.convertToProgramTime=function(e,t){return Ys({playlist:this.masterPlaylistController_.media(),time:e,callback:t})},s.seekToProgramTime=function(e,t,i,n){return void 0===i&&(i=!0),void 0===n&&(n=2),$s({programTime:e,playlist:this.masterPlaylistController_.media(),retryCount:n,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})},a}(td),nd={name:"videojs-http-streaming",VERSION:Nu,canHandleSource:function(e,t){void 0===t&&(t={});var i=_a.mergeOptions(_a.options,t);return nd.canPlayType(e.type,i)},handleSource:function(e,t,i){void 0===i&&(i={});var n=_a.mergeOptions(_a.options,i);return t.vhs=new id(e,t,n),_a.hasOwnProperty("hls")||Object.defineProperty(t,"hls",{get:function(){return _a.log.warn("player.tech().hls is deprecated. Use player.tech().vhs instead."),t.vhs},configurable:!0}),t.vhs.xhr=Ls(),t.vhs.src(e.src,e.type),t.vhs},canPlayType:function(e,t){void 0===t&&(t={});var i=_a.mergeOptions(_a.options,t).vhs.overrideNative,n=void 0===i?!_a.browser.IS_ANY_SAFARI:i,r=(0,f.simpleTypeFromSourceType)(e);return r&&(!Wu.supportsTypeNatively(r)||n)?"maybe":""}},rd=function(){return(0,p.browserSupportsCodec)("avc1.4d400d,mp4a.40.2")};rd()&&_a.getTech("Html5").registerSourceHandler(nd,0),_a.VhsHandler=id,Object.defineProperty(_a,"HlsHandler",{get:function(){return _a.log.warn("videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead."),id},configurable:!0}),_a.VhsSourceHandler=nd,Object.defineProperty(_a,"HlsSourceHandler",{get:function(){return _a.log.warn("videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead."),nd},configurable:!0}),_a.Vhs=Wu,Object.defineProperty(_a,"Hls",{get:function(){return _a.log.warn("videojs.Hls is deprecated. Use videojs.Vhs instead."),Wu},configurable:!0}),_a.use||(_a.registerComponent("Hls",Wu),_a.registerComponent("Vhs",Wu)),_a.options.vhs=_a.options.vhs||{},_a.options.hls=_a.options.hls||{},_a.registerPlugin?_a.registerPlugin("reloadSourceOnError",Fu):_a.plugin("reloadSourceOnError",Fu);var ad=_a;exports.default=ad;
},{"global/window":"J3Xk","global/document":"DnRs","@babel/runtime/helpers/extends":"ea3I","@babel/runtime/helpers/assertThisInitialized":"VmQe","@babel/runtime/helpers/inheritsLoose":"tere","safe-json-parse/tuple":"gLtL","keycode":"vQ4V","@videojs/xhr":"kVm4","videojs-vtt.js":"kRPZ","@babel/runtime/helpers/construct":"XsAw","@babel/runtime/helpers/inherits":"qngw","@videojs/vhs-utils/es/resolve-url.js":"mSEf","m3u8-parser":"HWpm","@videojs/vhs-utils/es/codecs.js":"lloA","@videojs/vhs-utils/es/media-types.js":"nJMU","mpd-parser":"uf1v","mux.js/lib/tools/parse-sidx":"m1a4","@videojs/vhs-utils/es/id3-helpers":"dZcM","@videojs/vhs-utils/es/containers":"sYbi","@videojs/vhs-utils/es/byte-helpers":"SuA8","mux.js/lib/utils/clock":"Piyq"}],"CvJj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=i,exports.__awaiter=c,exports.__generator=u,exports.__exportStar=l,exports.__values=s,exports.__read=p,exports.__spread=y,exports.__spreadArrays=h,exports.__spreadArray=d,exports.__await=_,exports.__asyncGenerator=v,exports.__asyncDelegator=b,exports.__asyncValues=w,exports.__makeTemplateObject=x,exports.__importStar=O,exports.__importDefault=g,exports.__classPrivateFieldGet=j,exports.__classPrivateFieldSet=P,exports.__createBinding=exports.__assign=void 0;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};function e(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,i=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,r,i):o(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i}function a(t,e){return function(r,n){e(r,n,t)}}function i(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{u(n.next(t))}catch(e){a(e)}}function c(t){try{u(n.throw(t))}catch(e){a(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,c)}u((n=n.apply(t,e||[])).next())})}function u(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(c){a=[6,c],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}exports.__assign=r;var f=Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]};function l(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||f(e,t,r)}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function h(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var a=arguments[e],i=0,c=a.length;i<c;i++,o++)n[o]=a[i];return n}function d(t,e,r){if(r||2===arguments.length)for(var n,o=0,a=e.length;o<a;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}function _(t){return this instanceof _?(this.v=t,this):new _(t)}function v(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||c(t,e)})})}function c(t,e){try{(r=o[t](e)).value instanceof _?Promise.resolve(r.value.v).then(u,f):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function u(t){c("next",t)}function f(t){c("throw",t)}function l(t,e){t(e),a.shift(),a.length&&c(a[0][0],a[0][1])}}function b(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){e[n]=t[n]?function(e){return(r=!r)?{value:_(t[n](e)),done:"return"===n}:o?o(e):e}:o}}function w(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof s?s(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function x(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}exports.__createBinding=f;var m=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function O(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&f(e,t,r);return m(e,t),e}function g(t){return t&&t.__esModule?t:{default:t}}function j(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)}function P(t,e,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(t,r):o?o.value=r:e.set(t,r),r}
},{}],"gYkb":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.areCookiesEnabled=T,exports.async=ee,exports.calculateBackoffMillis=le,exports.contains=F,exports.createMockUserToken=l,exports.createSubscribe=Y,exports.deepCopy=h,exports.deepEqual=H,exports.deepExtend=f,exports.errorPrefix=ne,exports.extractQuerystring=Q,exports.getGlobal=D,exports.getModularInstance=_e,exports.getUA=v,exports.isBrowser=y,exports.isBrowserExtension=x,exports.isElectron=E,exports.isEmpty=J,exports.isIE=A,exports.isIndexedDBAvailable=C,exports.isMobileCordova=b,exports.isNode=_,exports.isNodeSdk=m,exports.isReactNative=g,exports.isSafari=O,exports.isUWP=S,exports.jsonEval=I,exports.map=q,exports.ordinal=ve,exports.querystring=K,exports.querystringDecode=X,exports.safeGet=z,exports.stringify=P,exports.validateCallback=se,exports.validateContextObject=ae,exports.validateIndexedDBOpenable=w,exports.validateNamespace=ie,exports.validateArgCount=exports.stringToByteArray=exports.stringLength=exports.issuedAtTime=exports.isValidTimestamp=exports.isValidFormat=exports.isAdmin=exports.decode=exports.base64Encode=exports.base64Decode=exports.base64=exports.assertionError=exports.assert=exports.Sha1=exports.RANDOM_FACTOR=exports.MAX_VALUE_MILLIS=exports.FirebaseError=exports.ErrorFactory=exports.Deferred=exports.CONSTANTS=void 0;var r=require("tslib"),t={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};exports.CONSTANTS=t;var o=function(e,r){if(!e)throw n(r)};exports.assert=o;var n=function(e){return new Error("Firebase Database ("+t.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};exports.assertionError=n;var i=function(e){for(var r=[],t=0,o=0;o<e.length;o++){var n=e.charCodeAt(o);n<128?r[t++]=n:n<2048?(r[t++]=n>>6|192,r[t++]=63&n|128):55296==(64512&n)&&o+1<e.length&&56320==(64512&e.charCodeAt(o+1))?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++o)),r[t++]=n>>18|240,r[t++]=n>>12&63|128,r[t++]=n>>6&63|128,r[t++]=63&n|128):(r[t++]=n>>12|224,r[t++]=n>>6&63|128,r[t++]=63&n|128)}return r},s=function(e){for(var r=[],t=0,o=0;t<e.length;){var n=e[t++];if(n<128)r[o++]=String.fromCharCode(n);else if(n>191&&n<224){var i=e[t++];r[o++]=String.fromCharCode((31&n)<<6|63&i)}else if(n>239&&n<365){var s=((7&n)<<18|(63&(i=e[t++]))<<12|(63&(a=e[t++]))<<6|63&e[t++])-65536;r[o++]=String.fromCharCode(55296+(s>>10)),r[o++]=String.fromCharCode(56320+(1023&s))}else{i=e[t++];var a=e[t++];r[o++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return r.join("")},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,r){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var t=r?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[],n=0;n<e.length;n+=3){var i=e[n],s=n+1<e.length,a=s?e[n+1]:0,c=n+2<e.length,u=c?e[n+2]:0,h=i>>2,f=(3&i)<<4|a>>4,p=(15&a)<<2|u>>6,d=63&u;c||(d=64,s||(p=64)),o.push(t[h],t[f],t[p],t[d])}return o.join("")},encodeString:function(e,r){return this.HAS_NATIVE_SUPPORT&&!r?btoa(e):this.encodeByteArray(i(e),r)},decodeString:function(e,r){return this.HAS_NATIVE_SUPPORT&&!r?atob(e):s(this.decodeStringToByteArray(e,r))},decodeStringToByteArray:function(e,r){this.init_();for(var t=r?this.charToByteMapWebSafe_:this.charToByteMap_,o=[],n=0;n<e.length;){var i=t[e.charAt(n++)],s=n<e.length?t[e.charAt(n)]:0,a=++n<e.length?t[e.charAt(n)]:64,c=++n<e.length?t[e.charAt(n)]:64;if(++n,null==i||null==s||null==a||null==c)throw Error();var u=i<<2|s>>4;if(o.push(u),64!==a){var h=s<<4&240|a>>2;if(o.push(h),64!==c){var f=a<<6&192|c;o.push(f)}}}return o},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};exports.base64=a;var c=function(e){var r=i(e);return a.encodeByteArray(r,!0)};exports.base64Encode=c;var u=function(e){try{return a.decodeString(e,!0)}catch(r){console.error("base64Decode failed: ",r)}return null};function h(e){return f(void 0,e)}function f(e,r){if(!(r instanceof Object))return r;switch(r.constructor){case Date:return new Date(r.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return r}for(var t in r)r.hasOwnProperty(t)&&p(t)&&(e[t]=f(e[t],r[t]));return e}function p(e){return"__proto__"!==e}exports.base64Decode=u;var d=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(r,t){e.resolve=r,e.reject=t})}return e.prototype.wrapCallback=function(e){var r=this;return function(t,o){t?r.reject(t):r.resolve(o),"function"==typeof e&&(r.promise.catch(function(){}),1===e.length?e(t):e(t,o))}},e}();function l(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var o=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=(0,r.__assign)({iss:"https://securetoken.google.com/"+o,aud:o,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),a.encodeString(JSON.stringify(s),!1),""].join(".")}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())}function _(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(r){return!1}}function y(){return"object"==typeof self&&self.self===self}function x(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function g(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function E(){return v().indexOf("Electron/")>=0}function A(){var e=v();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function S(){return v().indexOf("MSAppHost/")>=0}function m(){return!0===t.NODE_CLIENT||!0===t.NODE_ADMIN}function O(){return!_()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function C(){return"indexedDB"in self&&null!=indexedDB}function w(){return new Promise(function(e,r){try{var t=!0,o="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(o);n.onsuccess=function(){n.result.close(),t||self.indexedDB.deleteDatabase(o),e(!0)},n.onupgradeneeded=function(){t=!1},n.onerror=function(){var e;r((null===(e=n.error)||void 0===e?void 0:e.message)||"")}}catch(i){r(i)}})}function T(){return!(!navigator||!navigator.cookieEnabled)}function D(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("Unable to locate global object.")}exports.Deferred=d;var N="FirebaseError",M=function(e){function t(r,o,n){var i=e.call(this,o)||this;return i.code=r,i.customData=n,i.name=N,Object.setPrototypeOf(i,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,j.prototype.create),i}return(0,r.__extends)(t,e),t}(Error);exports.FirebaseError=M;var j=function(){function e(e,r,t){this.service=e,this.serviceName=r,this.errors=t}return e.prototype.create=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var o=r[0]||{},n=this.service+"/"+e,i=this.errors[e],s=i?k(i,o):"Error",a=this.serviceName+": "+s+" ("+n+").";return new M(n,a,o)},e}();function k(e,r){return e.replace(B,function(e,t){var o=r[t];return null!=o?String(o):"<"+t+"?>"})}exports.ErrorFactory=j;var B=/\{\$([^}]+)}/g;function I(e){return JSON.parse(e)}function P(e){return JSON.stringify(e)}var L=function(e){var r={},t={},o={},n="";try{var i=e.split(".");r=I(u(i[0])||""),t=I(u(i[1])||""),n=i[2],o=t.d||{},delete t.d}catch(s){}return{header:r,claims:t,data:o,signature:n}};exports.decode=L;var V=function(e){var r=L(e).claims,t=Math.floor((new Date).getTime()/1e3),o=0,n=0;return"object"==typeof r&&(r.hasOwnProperty("nbf")?o=r.nbf:r.hasOwnProperty("iat")&&(o=r.iat),n=r.hasOwnProperty("exp")?r.exp:o+86400),!!t&&!!o&&!!n&&t>=o&&t<=n};exports.isValidTimestamp=V;var R=function(e){var r=L(e).claims;return"object"==typeof r&&r.hasOwnProperty("iat")?r.iat:null};exports.issuedAtTime=R;var U=function(e){var r=L(e).claims;return!!r&&"object"==typeof r&&r.hasOwnProperty("iat")};exports.isValidFormat=U;var W=function(e){var r=L(e).claims;return"object"==typeof r&&!0===r.admin};function F(e,r){return Object.prototype.hasOwnProperty.call(e,r)}function z(e,r){return Object.prototype.hasOwnProperty.call(e,r)?e[r]:void 0}function J(e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function q(e,r,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=r.call(t,e[n],n,e));return o}function H(e,r){if(e===r)return!0;for(var t=Object.keys(e),o=Object.keys(r),n=0,i=t;n<i.length;n++){var s=i[n];if(!o.includes(s))return!1;var a=e[s],c=r[s];if(G(a)&&G(c)){if(!H(a,c))return!1}else if(a!==c)return!1}for(var u=0,h=o;u<h.length;u++){s=h[u];if(!t.includes(s))return!1}return!0}function G(e){return null!==e&&"object"==typeof e}function K(e){for(var r=[],t=function(e,t){Array.isArray(t)?t.forEach(function(t){r.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):r.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},o=0,n=Object.entries(e);o<n.length;o++){var i=n[o];t(i[0],i[1])}return r.length?"&"+r.join("&"):""}function X(e){var r={};return e.replace(/^\?/,"").split("&").forEach(function(e){if(e){var t=e.split("="),o=t[0],n=t[1];r[decodeURIComponent(o)]=decodeURIComponent(n)}}),r}function Q(e){var r=e.indexOf("?");if(!r)return"";var t=e.indexOf("#",r);return e.substring(r,t>0?t:void 0)}exports.isAdmin=W;var $=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,r){r||(r=0);var t=this.W_;if("string"==typeof e)for(var o=0;o<16;o++)t[o]=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),r+=4;else for(o=0;o<16;o++)t[o]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],r+=4;for(o=16;o<80;o++){var n=t[o-3]^t[o-8]^t[o-14]^t[o-16];t[o]=4294967295&(n<<1|n>>>31)}var i,s,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],h=this.chain_[3],f=this.chain_[4];for(o=0;o<80;o++){o<40?o<20?(i=h^c&(u^h),s=1518500249):(i=c^u^h,s=1859775393):o<60?(i=c&u|h&(c|u),s=2400959708):(i=c^u^h,s=3395469782);n=(a<<5|a>>>27)+i+f+s+t[o]&4294967295;f=h,h=u,u=4294967295&(c<<30|c>>>2),c=a,a=n}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295},e.prototype.update=function(e,r){if(null!=e){void 0===r&&(r=e.length);for(var t=r-this.blockSize,o=0,n=this.buf_,i=this.inbuf_;o<r;){if(0===i)for(;o<=t;)this.compress_(e,o),o+=this.blockSize;if("string"==typeof e){for(;o<r;)if(n[i]=e.charCodeAt(o),++o,++i===this.blockSize){this.compress_(n),i=0;break}}else for(;o<r;)if(n[i]=e[o],++o,++i===this.blockSize){this.compress_(n),i=0;break}}this.inbuf_=i,this.total_+=r}},e.prototype.digest=function(){var e=[],r=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var t=this.blockSize-1;t>=56;t--)this.buf_[t]=255&r,r/=256;this.compress_(this.buf_);var o=0;for(t=0;t<5;t++)for(var n=24;n>=0;n-=8)e[o]=this.chain_[t]>>n&255,++o;return e},e}();function Y(e,r){var t=new Z(e,r);return t.subscribe.bind(t)}exports.Sha1=$;var Z=function(){function e(e,r){var t=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(function(){e(t)}).catch(function(e){t.error(e)})}return e.prototype.next=function(e){this.forEachObserver(function(r){r.next(e)})},e.prototype.error=function(e){this.forEachObserver(function(r){r.error(e)}),this.close(e)},e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},e.prototype.subscribe=function(e,r,t){var o,n=this;if(void 0===e&&void 0===r&&void 0===t)throw new Error("Missing Observer.");void 0===(o=re(e,["next","error","complete"])?e:{next:e,error:r,complete:t}).next&&(o.next=te),void 0===o.error&&(o.error=te),void 0===o.complete&&(o.complete=te);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{n.finalError?o.error(n.finalError):o.complete()}catch(e){}}),this.observers.push(o),i},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var r=0;r<this.observers.length;r++)this.sendOne(r,e)},e.prototype.sendOne=function(e,r){var t=this;this.task.then(function(){if(void 0!==t.observers&&void 0!==t.observers[e])try{r(t.observers[e])}catch(o){"undefined"!=typeof console&&console.error&&console.error(o)}})},e.prototype.close=function(e){var r=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){r.observers=void 0,r.onNoObservers=void 0}))},e}();function ee(e,r){return function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];Promise.resolve(!0).then(function(){e.apply(void 0,t)}).catch(function(e){r&&r(e)})}}function re(e,r){if("object"!=typeof e||null===e)return!1;for(var t=0,o=r;t<o.length;t++){var n=o[t];if(n in e&&"function"==typeof e[n])return!0}return!1}function te(){}var oe=function(e,r,t,o){var n;if(o<r?n="at least "+r:o>t&&(n=0===t?"none":"no more than "+t),n)throw new Error(e+" failed: Was called with "+o+(1===o?" argument.":" arguments.")+" Expects "+n+".")};function ne(e,r){return e+" failed: "+r+" argument "}function ie(e,r,t){if((!t||r)&&"string"!=typeof r)throw new Error(ne(e,"namespace")+"must be a valid firebase namespace.")}function se(e,r,t,o){if((!o||t)&&"function"!=typeof t)throw new Error(ne(e,r)+"must be a valid function.")}function ae(e,r,t,o){if((!o||t)&&("object"!=typeof t||null===t))throw new Error(ne(e,r)+"must be a valid context object.")}exports.validateArgCount=oe;var ce=function(e){for(var r=[],t=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i>=55296&&i<=56319){var s=i-55296;o(++n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(s<<10)+(e.charCodeAt(n)-56320)}i<128?r[t++]=i:i<2048?(r[t++]=i>>6|192,r[t++]=63&i|128):i<65536?(r[t++]=i>>12|224,r[t++]=i>>6&63|128,r[t++]=63&i|128):(r[t++]=i>>18|240,r[t++]=i>>12&63|128,r[t++]=i>>6&63|128,r[t++]=63&i|128)}return r};exports.stringToByteArray=ce;var ue=function(e){for(var r=0,t=0;t<e.length;t++){var o=e.charCodeAt(t);o<128?r++:o<2048?r+=2:o>=55296&&o<=56319?(r+=4,t++):r+=3}return r};exports.stringLength=ue;var he=1e3,fe=2,pe=144e5;exports.MAX_VALUE_MILLIS=pe;var de=.5;function le(e,r,t){void 0===r&&(r=he),void 0===t&&(t=fe);var o=r*Math.pow(t,e),n=Math.round(de*o*(Math.random()-.5)*2);return Math.min(pe,o+n)}function ve(e){return Number.isFinite(e)?e+be(e):""+e}function be(e){var r=(e=Math.abs(e))%100;if(r>=10&&r<=20)return"th";var t=e%10;return 1===t?"st":2===t?"nd":3===t?"rd":"th"}function _e(e){return e&&e._delegate?e._delegate:e}exports.RANDOM_FACTOR=de;
},{"tslib":"CvJj"}],"KLrb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Provider=exports.ComponentContainer=exports.Component=void 0;var t=require("tslib"),e=require("@firebase/util"),n=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}();exports.Component=n;var i="[DEFAULT]",r=function(){function n(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Map}return n.prototype.get=function(t){var n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){var i=new e.Deferred;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:n});r&&i.resolve(r)}catch(o){}}return this.instancesDeferred.get(n).promise},n.prototype.getImmediate=function(t){var e,n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(e){var n,r;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if(s(e))try{this.getOrInitializeService({instanceIdentifier:i})}catch(u){}try{for(var o=(0,t.__values)(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=(0,t.__read)(a.value,2),l=c[0],h=c[1],p=this.normalizeInstanceIdentifier(l);try{var d=this.getOrInitializeService({instanceIdentifier:p});h.resolve(d)}catch(u){}}}catch(f){n={error:f}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}},n.prototype.clearInstance=function(t){void 0===t&&(t=i),this.instancesDeferred.delete(t),this.instances.delete(t)},n.prototype.delete=function(){return(0,t.__awaiter)(this,void 0,void 0,function(){var e;return(0,t.__generator)(this,function(n){switch(n.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all((0,t.__spreadArray)((0,t.__spreadArray)([],(0,t.__read)(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))),(0,t.__read)(e.filter(function(t){return"_delete"in t}).map(function(t){return t._delete()}))))];case 1:return n.sent(),[2]}})})},n.prototype.isComponentSet=function(){return null!=this.component},n.prototype.isInitialized=function(t){return void 0===t&&(t=i),this.instances.has(t)},n.prototype.initialize=function(e){var n,i;void 0===e&&(e={});var r=e.options,o=void 0===r?{}:r,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(this.name+"("+s+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var a=this.getOrInitializeService({instanceIdentifier:s,options:o});try{for(var c=(0,t.__values)(this.instancesDeferred.entries()),l=c.next();!l.done;l=c.next()){var h=(0,t.__read)(l.value,2),p=h[0],d=h[1];s===this.normalizeInstanceIdentifier(p)&&d.resolve(a)}}catch(u){n={error:u}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return a},n.prototype.onInit=function(t,e){var n,i=this.normalizeInstanceIdentifier(e),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(t),this.onInitCallbacks.set(i,r);var o=this.instances.get(i);return o&&t(o,i),function(){r.delete(t)}},n.prototype.invokeOnInitCallbacks=function(e,n){var i,r,o=this.onInitCallbacks.get(n);if(o)try{for(var s=(0,t.__values)(o),a=s.next();!a.done;a=s.next()){var c=a.value;try{c(e,n)}catch(l){}}}catch(h){i={error:h}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}},n.prototype.getOrInitializeService=function(t){var e=t.instanceIdentifier,n=t.options,i=void 0===n?{}:n,r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:o(e),options:i}),this.instances.set(e,r),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(s){}return r||null},n.prototype.normalizeInstanceIdentifier=function(t){return void 0===t&&(t=i),this.component?this.component.multipleInstances?t:i:t},n.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},n}();function o(t){return t===i?void 0:t}function s(t){return"EAGER"===t.instantiationMode}exports.Provider=r;var a=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new r(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();exports.ComponentContainer=a;
},{"tslib":"CvJj","@firebase/util":"gYkb"}],"srlT":[function(require,module,exports) {
"use strict";function e(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),n=0;for(t=0;t<r;t++)for(var l=arguments[t],i=0,s=l.length;i<s;i++,n++)o[n]=l[i];return o}var t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.setLogLevel=g,exports.setUserLogHandler=u,exports.Logger=exports.LogLevel=void 0;var r,o=[];exports.LogLevel=r,function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(exports.LogLevel=r={}));var n={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},l=r.INFO,i=((t={})[r.DEBUG]="log",t[r.VERBOSE]="log",t[r.INFO]="info",t[r.WARN]="warn",t[r.ERROR]="error",t),s=function(t,r){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];if(!(r<t.logLevel)){var l=(new Date).toISOString(),s=i[r];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+r+")");console[s].apply(console,e(["["+l+"]  "+t.name+":"],o))}},a=function(){function t(e){this.name=e,this._logLevel=l,this._logHandler=s,this._userLogHandler=null,o.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in r))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?n[e]:e},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.DEBUG],t)),this._logHandler.apply(this,e([this,r.DEBUG],t))},t.prototype.log=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.VERBOSE],t)),this._logHandler.apply(this,e([this,r.VERBOSE],t))},t.prototype.info=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.INFO],t)),this._logHandler.apply(this,e([this,r.INFO],t))},t.prototype.warn=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.WARN],t)),this._logHandler.apply(this,e([this,r.WARN],t))},t.prototype.error=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.ERROR],t)),this._logHandler.apply(this,e([this,r.ERROR],t))},t}();function g(e){o.forEach(function(t){t.setLogLevel(e)})}function u(e,t){for(var l=function(o){var l=null;t&&t.level&&(l=n[t.level]),o.userLogHandler=null===e?null:function(t,o){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var s=n.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}}).filter(function(e){return e}).join(" ");o>=(null!=l?l:t.logLevel)&&e({level:r[o].toLowerCase(),message:s,args:n,type:t.name})}},i=0,s=o;i<s.length;i++){l(s[i])}}exports.Logger=a;
},{}],"Q47K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.firebase=exports.default=void 0;var e,n,t=require("tslib"),r=require("@firebase/util"),i=require("@firebase/component"),a=require("@firebase/logger"),o=((e={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),s=new r.ErrorFactory("app","Firebase",o),p="@firebase/app",c="0.6.29",l="@firebase/analytics",u="@firebase/app-check",f="@firebase/auth",d="@firebase/database",m="@firebase/functions",b="@firebase/installations",h="@firebase/messaging",g="@firebase/performance",v="@firebase/remote-config",y="@firebase/storage",_="@firebase/firestore",w="firebase-wrapper",N="[DEFAULT]",C=((n={})[p]="fire-core",n[l]="fire-analytics",n[u]="fire-app-check",n[f]="fire-auth",n[d]="fire-rtdb",n[m]="fire-fn",n[b]="fire-iid",n[h]="fire-fcm",n[g]="fire-perf",n[v]="fire-rc",n[y]="fire-gcs",n[_]="fire-fst",n["fire-js"]="fire-js",n[w]="fire-js-all",n),E=new a.Logger("@firebase/app"),I=function(){function e(e,n,t){var a=this;this.firebase_=t,this.isDeleted_=!1,this.name_=n.name,this.automaticDataCollectionEnabled_=n.automaticDataCollectionEnabled||!1,this.options_=(0,r.deepCopy)(e),this.container=new i.ComponentContainer(n.name),this._addComponent(new i.Component("app",function(){return a},"PUBLIC")),this.firebase_.INTERNAL.components.forEach(function(e){return a._addComponent(e)})}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise(function(n){e.checkDestroyed_(),n()}).then(function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map(function(e){return e.delete()}))}).then(function(){e.isDeleted_=!0})},e.prototype._getService=function(e,n){var t;void 0===n&&(n=N),this.checkDestroyed_();var r=this.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(t=r.getComponent())||void 0===t?void 0:t.instantiationMode)||r.initialize(),r.getImmediate({identifier:n})},e.prototype._removeServiceInstance=function(e,n){void 0===n&&(n=N),this.container.getProvider(e).clearInstance(n)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(n){E.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,n)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw s.create("app-deleted",{appName:this.name_})},e}();I.prototype.name&&I.prototype.options||I.prototype.delete||console.log("dc");var A="8.8.1";function P(e){var n={},t=new Map,o={__esModule:!0,initializeApp:function(t,i){void 0===i&&(i={});if("object"!=typeof i||null===i){var a=i;i={name:a}}var p=i;void 0===p.name&&(p.name=N);var c=p.name;if("string"!=typeof c||!c)throw s.create("bad-app-name",{appName:String(c)});if((0,r.contains)(n,c))throw s.create("duplicate-app",{appName:c});var l=new e(t,p,o);return n[c]=l,l},app:p,registerVersion:function(e,n,t){var r,a=null!==(r=C[e])&&void 0!==r?r:e;t&&(a+="-"+t);var o=a.match(/\s|\//),s=n.match(/\s|\//);if(o||s){var p=['Unable to register library "'+a+'" with version "'+n+'":'];return o&&p.push('library name "'+a+'" contains illegal characters (whitespace or "/")'),o&&s&&p.push("and"),s&&p.push('version name "'+n+'" contains illegal characters (whitespace or "/")'),void E.warn(p.join(" "))}c(new i.Component(a+"-version",function(){return{library:a,version:n}},"VERSION"))},setLogLevel:a.setLogLevel,onLog:function(e,n){if(null!==e&&"function"!=typeof e)throw s.create("invalid-log-argument");(0,a.setUserLogHandler)(e,n)},apps:null,SDK_VERSION:A,INTERNAL:{registerComponent:c,removeApp:function(e){delete n[e]},components:t,useAsService:function(e,n){if("serverAuth"===n)return null;return n}}};function p(e){if(e=e||N,!(0,r.contains)(n,e))throw s.create("no-app",{appName:e});return n[e]}function c(i){var a=i.name;if(t.has(a))return E.debug("There were multiple attempts to register component "+a+"."),"PUBLIC"===i.type?o[a]:null;if(t.set(a,i),"PUBLIC"===i.type){var c=function(e){if(void 0===e&&(e=p()),"function"!=typeof e[a])throw s.create("invalid-app-argument",{appName:a});return e[a]()};void 0!==i.serviceProps&&(0,r.deepExtend)(c,i.serviceProps),o[a]=c,e.prototype[a]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,a).apply(this,i.multipleInstances?e:[])}}for(var l=0,u=Object.keys(n);l<u.length;l++){var f=u[l];n[f]._addComponent(i)}return"PUBLIC"===i.type?o[a]:null}return o.default=o,Object.defineProperty(o,"apps",{get:function(){return Object.keys(n).map(function(e){return n[e]})}}),p.App=e,o}function F(){var e=P(I);return e.INTERNAL=(0,t.__assign)((0,t.__assign)({},e.INTERNAL),{createFirebaseNamespace:F,extendNamespace:function(n){(0,r.deepExtend)(e,n)},createSubscribe:r.createSubscribe,ErrorFactory:r.ErrorFactory,deepExtend:r.deepExtend}),e}var L=F(),D=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(e){if(k(e)){var n=e.getImmediate();return n.library+"/"+n.version}return null}).filter(function(e){return e}).join(" ")},e}();function k(e){var n=e.getComponent();return"VERSION"===(null==n?void 0:n.type)}function O(e,n){e.INTERNAL.registerComponent(new i.Component("platform-logger",function(e){return new D(e)},"PRIVATE")),e.registerVersion(p,c,n),e.registerVersion("fire-js","")}if((0,r.isBrowser)()&&void 0!==self.firebase){E.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var j=self.firebase.SDK_VERSION;j&&j.indexOf("LITE")>=0&&E.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var S=L.initializeApp;L.initializeApp=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(0,r.isNode)()&&E.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),S.apply(void 0,e)};var x=L;exports.firebase=x,O(x);var R=x;exports.default=R;
},{"tslib":"CvJj","@firebase/util":"gYkb","@firebase/component":"KLrb","@firebase/logger":"srlT"}],"bHFp":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3],e=n(require("@firebase/app"));function n(t){return t&&t.__esModule?t:{default:t}}(function(){var n,i="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)};var r=function(e){e=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t,e];for(var n=0;n<e.length;++n){var i=e[n];if(i&&i.Math==Math)return i}return globalThis}(this);function o(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function a(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:o(t)}}!function(t,e){if(e){var n=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in n||(n[a]={}),n=n[a]}(e=e(o=n[t=t[t.length-1]]))!=o&&null!=e&&i(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(n){e.reject(n)}}function n(){this.a=null}function i(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;n.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var o=r.setTimeout;n.prototype.c=function(t){o(t,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(i){this.f(i)}}}this.a=null},n.prototype.f=function(t){this.c(function(){throw t})},e.prototype.f=function(){function t(t){return function(i){n||(n=!0,t.call(e,i))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.s(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.v(t):this.h(t)}},e.prototype.v=function(t){var e=void 0;try{e=t.then}catch(n){return void this.g(n)}"function"==typeof e?this.u(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new n;return e.prototype.s=function(t){var e=this.f();t.Ra(e.resolve,e.reject)},e.prototype.u=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(i){n.reject(i)}},e.prototype.then=function(t,n){function i(t,e){return"function"==typeof t?function(e){try{r(t(e))}catch(n){o(n)}}:e}var r,o,a=new e(function(t,e){r=t,o=e});return this.Ra(i(t,r),i(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Ra=function(t,e){function n(){switch(i.b){case 1:t(i.c);break;case 2:e(i.c);break;default:throw Error("Unexpected state: "+i.b)}}var i=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=i,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=a(t),o=r.next();!o.done;o=r.next())i(o.value).Ra(e,n)})},e.all=function(t){var n=a(t),r=n.next();return r.done?i([]):new e(function(t,e){function o(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,i(r.value).Ra(o(a.length-1),e),r=n.next()}while(!r.done)})},e});var s=s||{},u=this||self,c=/^[\w+/_-]+[=]{0,2}$/,h=null;function l(t){return(t=t.querySelector&&t.querySelector("script[nonce]"))&&(t=t.nonce||t.getAttribute("nonce"))&&c.test(t)?t:""}function f(){}function d(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function p(t){var e=d(t);return"array"==e||"object"==e&&"number"==typeof t.length}function v(t){return"function"==d(t)}function m(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function g(t){return Object.prototype.hasOwnProperty.call(t,b)&&t[b]||(t[b]=++y)}var b="closure_uid_"+(1e9*Math.random()>>>0),y=0;function w(t,e,n){return t.call.apply(t.bind,arguments)}function I(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function T(t,e,n){return(T=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:I).apply(null,arguments)}function E(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var A=Date.now;function k(t,e){function n(){}n.prototype=e.prototype,t.bb=e.prototype,t.prototype=new n,t.prototype.constructor=t}function S(t){return t}function N(t,e,n){this.code=C+t,this.message=e||R[t]||"",this.a=n||null}function _(t){var e=t&&t.code;return e?new N(e.substring(C.length),t.message,t.serverResponse):null}k(N,Error),N.prototype.w=function(){var t={code:this.code,message:this.message};return this.a&&(t.serverResponse=this.a),t},N.prototype.toJSON=function(){return this.w()};var O,C="auth/",R={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."},P={ld:{Ua:"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",$a:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Xa:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"b"},sd:{Ua:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",$a:"https://securetoken.googleapis.com/v1/token",Xa:"https://identitytoolkit.googleapis.com/v2/",id:"p"},ud:{Ua:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",$a:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Xa:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"s"},vd:{Ua:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",$a:"https://test-securetoken.sandbox.googleapis.com/v1/token",Xa:"https://test-identitytoolkit.sandbox.googleapis.com/v2/",id:"t"}};function D(t){for(var e in P)if(P[e].id===t)return{firebaseEndpoint:(t=P[e]).Ua,secureTokenEndpoint:t.$a,identityPlatformEndpoint:t.Xa};return null}function L(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(e){return!1}}function x(t){if(Error.captureStackTrace)Error.captureStackTrace(this,x);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function M(t,e){for(var n="",i=(t=t.split("%s")).length-1,r=0;r<i;r++)n+=t[r]+(r<e.length?e[r]:"%s");x.call(this,n+t[i])}function j(t,e){throw new M("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function U(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function V(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function F(){this.b=this.a=null}O=D("__EID__")?"__EID__":void 0,k(x,Error),x.prototype.name="CustomError",k(M,x),M.prototype.name="AssertionError",U.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var q=new U(function(){return new H},function(t){t.reset()});function K(){var t=Ie,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function H(){this.next=this.b=this.a=null}F.prototype.add=function(t,e){var n=q.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},H.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},H.prototype.reset=function(){this.next=this.b=this.a=null};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,r="string"==typeof t?t.split(""):t,o=0;o<i;o++)o in r&&e.call(n,r[o],o,t)};var W=Array.prototype.filter?function(t,e){return Array.prototype.filter.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=[],r=0,o="string"==typeof t?t.split(""):t,a=0;a<n;a++)if(a in o){var s=o[a];e.call(void 0,s,a,t)&&(i[r++]=s)}return i},X=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),r="string"==typeof t?t.split(""):t,o=0;o<n;o++)o in r&&(i[o]=e.call(void 0,r[o],o,t));return i},J=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,i="string"==typeof t?t.split(""):t,r=0;r<n;r++)if(r in i&&e.call(void 0,i[r],r,t))return!0;return!1};function Y(t,e){return 0<=G(t,e)}function z(t,e){var n;return(n=0<=(e=G(t,e)))&&Array.prototype.splice.call(t,e,1),n}function $(t,e){!function(t,e){for(var n="string"==typeof t?t.split(""):t,i=t.length-1;0<=i;--i)i in n&&e.call(void 0,n[i],i,t)}(t,function(n,i){e.call(void 0,n,i,t)&&1==Array.prototype.splice.call(t,i,1).length&&0})}function Z(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),i=0;i<e;i++)n[i]=t[i];return n}return[]}var tt,et=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},nt=/&/g,it=/</g,rt=/>/g,ot=/"/g,at=/'/g,st=/\x00/g,ut=/[\x00&<>"']/;function ct(t,e){return-1!=t.indexOf(e)}function ht(t,e){return t<e?-1:t>e?1:0}t:{var lt=u.navigator;if(lt){var ft=lt.userAgent;if(ft){tt=ft;break t}}tt=""}function dt(t){return ct(tt,t)}function pt(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function vt(t){for(var e in t)return!1;return!0}function mt(t){var e,n={};for(e in t)n[e]=t[e];return n}var gt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bt(t,e){for(var n,i,r=1;r<arguments.length;r++){for(n in i=arguments[r])t[n]=i[n];for(var o=0;o<gt.length;o++)n=gt[o],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function yt(t,e){t:{try{var n=t&&t.ownerDocument,i=n&&(n.defaultView||n.parentWindow);if((i=i||u).Element&&i.Location){var r=i;break t}}catch(a){}r=null}if(r&&void 0!==r[e]&&(!t||!(t instanceof r[e])&&(t instanceof r.Location||t instanceof r.Element))){if(m(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(a){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;j("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}function wt(t,e){this.a=t===At&&e||"",this.b=Et}function It(t){return t instanceof wt&&t.constructor===wt&&t.b===Et?t.a:(j("expected object of type Const, got '"+t+"'"),"type_error:Const")}wt.prototype.ta=!0,wt.prototype.sa=function(){return this.a},wt.prototype.toString=function(){return"Const{"+this.a+"}"};var Tt,Et={},At={};function kt(){if(void 0===Tt){var t=null,e=u.trustedTypes;if(e&&e.createPolicy){try{t=e.createPolicy("goog#html",{createHTML:S,createScript:S,createScriptURL:S})}catch(n){u.console&&u.console.error(n.message)}Tt=t}else Tt=t}return Tt}function St(t,e){this.a=e===Rt?t:""}function Nt(t){return t instanceof St&&t.constructor===St?t.a:(j("expected object of type TrustedResourceUrl, got '"+t+"' of type "+d(t)),"type_error:TrustedResourceUrl")}function _t(t,e){var n=It(t);if(!Ct.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return function(t){var e=kt();return new St(t=e?e.createScriptURL(t):t,Rt)}(t=n.replace(Ot,function(t,i){if(!Object.prototype.hasOwnProperty.call(e,i))throw Error('Found marker, "'+i+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[i])instanceof wt?It(t):encodeURIComponent(String(t))}))}St.prototype.ta=!0,St.prototype.sa=function(){return this.a.toString()},St.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var Ot=/%{(\w+)}/g,Ct=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,Rt={};function Pt(t,e){this.a=e===Vt?t:""}function Dt(t){return t instanceof Pt&&t.constructor===Pt?t.a:(j("expected object of type SafeUrl, got '"+t+"' of type "+d(t)),"type_error:SafeUrl")}Pt.prototype.ta=!0,Pt.prototype.sa=function(){return this.a.toString()},Pt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Lt=/^(?:audio\/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-matroska|x-wav|wav|webm)|font\/\w+|image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|text\/csv|video\/(?:mpeg|mp4|ogg|webm|quicktime|x-matroska))(?:;\w+=(?:\w+|"[\w;,= ]+"))*$/i,xt=/^data:(.*);base64,[a-z0-9+\/]+=*$/i,Mt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function jt(t){if(t instanceof Pt)return t;if(t="object"==typeof t&&t.ta?t.sa():String(t),Mt.test(t))t=new Pt(t,Vt);else{var e=(t=(t=String(t)).replace(/(%0A|%0D)/g,"")).match(xt);t=e&&Lt.test(e[1])?new Pt(t,Vt):null}return t}function Ut(t){return t instanceof Pt?t:(t="object"==typeof t&&t.ta?t.sa():String(t),Mt.test(t)||(t="about:invalid#zClosurez"),new Pt(t,Vt))}var Vt={},Ft=new Pt("about:invalid#zClosurez",Vt);function qt(t,e,n){this.a=n===Kt?t:""}qt.prototype.ta=!0,qt.prototype.sa=function(){return this.a.toString()},qt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Kt={};function Ht(t,e,n,i){return t=t instanceof Pt?t:Ut(t),e=e||u,n=n instanceof wt?It(n):n||"",e.open(Dt(t),n,i,void 0)}function Gt(t,e){for(var n=t.split("%s"),i="",r=Array.prototype.slice.call(arguments,1);r.length&&1<n.length;)i+=n.shift()+r.shift();return i+n.join("%s")}function Bt(t){return ut.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(nt,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(it,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(rt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(ot,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(at,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(st,"&#0;"))),t}function Wt(t){return Wt[" "](t),t}Wt[" "]=f;var Xt,Jt,Yt=dt("Opera"),zt=dt("Trident")||dt("MSIE"),$t=dt("Edge"),Zt=$t||zt,Qt=dt("Gecko")&&!(ct(tt.toLowerCase(),"webkit")&&!dt("Edge"))&&!(dt("Trident")||dt("MSIE"))&&!dt("Edge"),te=ct(tt.toLowerCase(),"webkit")&&!dt("Edge");function ee(){var t=u.document;return t?t.documentMode:void 0}t:{var ne="",ie=(Jt=tt,Qt?/rv:([^\);]+)(\)|;)/.exec(Jt):$t?/Edge\/([\d\.]+)/.exec(Jt):zt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Jt):te?/WebKit\/(\S+)/.exec(Jt):Yt?/(?:Version)[ \/]?(\S+)/.exec(Jt):void 0);if(ie&&(ne=ie?ie[1]:""),zt){var re=ee();if(null!=re&&re>parseFloat(ne)){Xt=String(re);break t}}Xt=ne}var oe,ae={};function se(t){return function(t,e){var n=ae;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=et(String(Xt)).split("."),i=et(String(t)).split("."),r=Math.max(n.length,i.length),o=0;0==e&&o<r;o++){var a=n[o]||"",s=i[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=ht(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||ht(0==a[2].length,0==s[2].length)||ht(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}if(u.document&&zt){var ue=ee();oe=ue||(parseInt(Xt,10)||void 0)}else oe=void 0;var ce=oe;try{new self.OffscreenCanvas(0,0).getContext("2d")}catch(Jt){}var he=!zt||9<=Number(ce);function le(t){var e=document;return"string"==typeof t?e.getElementById(t):t}function fe(t,e){pt(e,function(e,n){e&&"object"==typeof e&&e.ta&&(e=e.sa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:ve.hasOwnProperty(n)?t.setAttribute(ve[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}var de,pe,ve={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function me(t,e,n){var i=arguments,r=document,o=String(i[0]),a=i[1];if(!he&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Bt(a.name),'"'),a.type){o.push(' type="',Bt(a.type),'"');var s={};bt(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=ge(r,o),a&&("string"==typeof a?o.className=a:Array.isArray(a)?o.className=a.join(" "):fe(o,a)),2<i.length&&function(t,e,n){function i(n){n&&e.appendChild("string"==typeof n?t.createTextNode(n):n)}for(var r=2;r<n.length;r++){var o=n[r];if(!p(o)||m(o)&&0<o.nodeType)i(o);else{t:{if(o&&"number"==typeof o.length){if(m(o)){var a="function"==typeof o.item||"string"==typeof o.item;break t}if(v(o)){a="function"==typeof o.item;break t}}a=!1}B(a?Q(o):o,i)}}}(r,o,i),o}function ge(t,e){return e=String(e),"application/xhtml+xml"===t.contentType&&(e=e.toLowerCase()),t.createElement(e)}function be(t){u.setTimeout(function(){throw t},0)}function ye(t,e){pe||function(){if(u.Promise&&u.Promise.resolve){var t=u.Promise.resolve(void 0);pe=function(){t.then(Te)}}else pe=function(){var t=Te;!v(u.setImmediate)||u.Window&&u.Window.prototype&&!dt("Edge")&&u.Window.prototype.setImmediate==u.setImmediate?(de||(de=function(){var t=u.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!dt("Presto")&&(t=function(){var t=ge(document,"IFRAME");t.style.display="none",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.close();var n="callImmediate"+Math.random(),i="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=T(function(t){"*"!=i&&t.origin!=i||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,i)}}}),void 0!==t&&!dt("Trident")&&!dt("MSIE")){var e=new t,n={},i=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).Hb;n.Hb=null,t()}},function(t){i.next={Hb:t},i=i.next,e.port2.postMessage(0)}}return function(t){u.setTimeout(t,0)}}()),de(t)):u.setImmediate(t)}}(),we||(pe(),we=!0),Ie.add(t,e)}var we=!1,Ie=new F;function Te(){for(var t;t=K();){try{t.a.call(t.b)}catch(e){be(e)}V(q,t)}we=!1}function Ee(t,e){if(this.a=Ae,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=f)try{var n=this;t.call(e,function(t){Me(n,ke,t)},function(t){if(!(t instanceof He))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(e){}Me(n,Se,t)})}catch(i){Me(this,Se,i)}}var Ae=0,ke=2,Se=3;function Ne(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ne.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var _e=new U(function(){return new Ne},function(t){t.reset()});function Oe(t,e,n){var i=_e.get();return i.g=t,i.b=e,i.f=n,i}function Ce(t){if(t instanceof Ee)return t;var e=new Ee(f);return Me(e,ke,t),e}function Re(t){return new Ee(function(e,n){n(t)})}function Pe(t,e,n){je(t,e,n,null)||ye(E(e,t))}function De(t){return new Ee(function(e){var n=t.length,i=[];if(n)for(var r=function(t,r,o){n--,i[t]=r?{Qb:!0,value:o}:{Qb:!1,reason:o},0==n&&e(i)},o=0;o<t.length;o++)Pe(t[o],E(r,o,!0),E(r,o,!1));else e(i)})}function Le(t,e){t.b||t.a!=ke&&t.a!=Se||Ue(t),t.f?t.f.next=e:t.b=e,t.f=e}function xe(t,e,n,i){var r=Oe(null,null,null);return r.a=new Ee(function(t,o){r.g=e?function(n){try{var r=e.call(i,n);t(r)}catch(a){o(a)}}:t,r.b=n?function(e){try{var r=n.call(i,e);void 0===r&&e instanceof He?o(e):t(r)}catch(a){o(a)}}:o}),r.a.c=t,Le(t,r),r.a}function Me(t,e,n){t.a==Ae&&(t===n&&(e=Se,n=new TypeError("Promise cannot resolve to itself")),t.a=1,je(n,t.$c,t.ad,t)||(t.i=n,t.a=e,t.c=null,Ue(t),e!=Se||n instanceof He||function(t,e){t.g=!0,ye(function(){t.g&&Ke.call(null,e)})}(t,n)))}function je(t,e,n,i){if(t instanceof Ee)return Le(t,Oe(e||f,n||null,i)),!0;if(L(t))return t.then(e,n,i),!0;if(m(t))try{var r=t.then;if(v(r))return function(t,e,n,i,r){function o(t){a||(a=!0,i.call(r,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(r,t))},o)}catch(s){o(s)}}(t,r,e,n,i),!0}catch(o){return n.call(i,o),!0}return!1}function Ue(t){t.h||(t.h=!0,ye(t.gc,t))}function Ve(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function Fe(t,e,n,i){if(n==Se&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,qe(e,n,i);else try{e.c?e.g.call(e.f):qe(e,n,i)}catch(r){Ke.call(null,r)}V(_e,e)}function qe(t,e,n){e==ke?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}Ee.prototype.then=function(t,e,n){return xe(this,v(t)?t:null,v(e)?e:null,n)},Ee.prototype.$goog_Thenable=!0,(n=Ee.prototype).oa=function(t,e){return(t=Oe(t,t,e)).c=!0,Le(this,t),this},n.o=function(t,e){return xe(this,null,t,e)},n.cancel=function(t){if(this.a==Ae){var e=new He(t);ye(function(){!function t(e,n){if(e.a==Ae)if(e.c){var i=e.c;if(i.b){for(var r=0,o=null,a=null,s=i.b;s&&(s.c||(r++,s.a==e&&(o=s),!(o&&1<r)));s=s.next)o||(a=s);o&&(i.a==Ae&&1==r?t(i,n):(a?((r=a).next==i.f&&(i.f=r),r.next=r.next.next):Ve(i),Fe(i,o,Se,n)))}e.c=null}else Me(e,Se,n)}(this,e)},this)}},n.$c=function(t){this.a=Ae,Me(this,ke,t)},n.ad=function(t){this.a=Ae,Me(this,Se,t)},n.gc=function(){for(var t;t=Ve(this);)Fe(this,t,this.a,this.i);this.h=!1};var Ke=be;function He(t){x.call(this,t)}function Ge(){0!=Be&&(We[g(this)]=this),this.ya=this.ya,this.pa=this.pa}k(He,x),He.prototype.name="cancel";var Be=0,We={};function Xe(t){if(!t.ya&&(t.ya=!0,t.Da(),0!=Be)){var e=g(t);if(0!=Be&&t.pa&&0<t.pa.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete We[e]}}Ge.prototype.ya=!1,Ge.prototype.Da=function(){if(this.pa)for(;this.pa.length;)this.pa.shift()()};var Je=Object.freeze||function(t){return t},Ye=!zt||9<=Number(ce),ze=zt&&!se("9"),$e=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{u.addEventListener("test",f,e),u.removeEventListener("test",f,e)}catch(n){}return t}();function Ze(t,e){this.type=t,this.b=this.target=e,this.defaultPrevented=!1}function Qe(t,e){if(Ze.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Qt){t:{try{Wt(e.nodeName);var r=!0;break t}catch(o){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:tn[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}Ze.prototype.preventDefault=function(){this.defaultPrevented=!0},k(Qe,Ze);var tn=Je({2:"touch",3:"pen",4:"mouse"});Qe.prototype.preventDefault=function(){Qe.bb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ze)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}},Qe.prototype.g=function(){return this.a};var en="closure_listenable_"+(1e6*Math.random()|0),nn=0;function rn(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.Wa=r,this.key=++nn,this.wa=this.Qa=!1}function on(t){t.wa=!0,t.listener=null,t.proxy=null,t.src=null,t.Wa=null}function an(t){this.src=t,this.a={},this.b=0}function sn(t,e){var n=e.type;n in t.a&&z(t.a[n],e)&&(on(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function un(t,e,n,i){for(var r=0;r<t.length;++r){var o=t[r];if(!o.wa&&o.listener==e&&o.capture==!!n&&o.Wa==i)return r}return-1}an.prototype.add=function(t,e,n,i,r){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=un(t,e,i,r);return-1<a?(e=t[a],n||(e.Qa=!1)):((e=new rn(e,this.src,o,!!i,r)).Qa=n,t.push(e)),e};var cn="closure_lm_"+(1e6*Math.random()|0),hn={};function ln(t,e,n,i,r){if(i&&i.once)dn(t,e,n,i,r);else if(Array.isArray(e))for(var o=0;o<e.length;o++)ln(t,e[o],n,i,r);else n=Tn(n),t&&t[en]?An(t,e,n,m(i)?!!i.capture:!!i,r):fn(t,e,n,!1,i,r)}function fn(t,e,n,i,r,o){if(!e)throw Error("Invalid event type");var a=m(r)?!!r.capture:!!r,s=wn(t);if(s||(t[cn]=s=new an(t)),!(n=s.add(e,n,i,a,o)).proxy){if(i=function(){var t=yn,e=Ye?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)$e||(r=a),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(mn(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}0}}function dn(t,e,n,i,r){if(Array.isArray(e))for(var o=0;o<e.length;o++)dn(t,e[o],n,i,r);else n=Tn(n),t&&t[en]?kn(t,e,n,m(i)?!!i.capture:!!i,r):fn(t,e,n,!0,i,r)}function pn(t,e,n,i,r){if(Array.isArray(e))for(var o=0;o<e.length;o++)pn(t,e[o],n,i,r);else i=m(i)?!!i.capture:!!i,n=Tn(n),t&&t[en]?(t=t.v,(e=String(e).toString())in t.a&&(-1<(n=un(o=t.a[e],n,i,r))&&(on(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=wn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=un(e,n,i,r)),(n=-1<t?e[t]:null)&&vn(n))}function vn(t){if("number"!=typeof t&&t&&!t.wa){var e=t.src;if(e&&e[en])sn(e.v,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(mn(n),i):e.addListener&&e.removeListener&&e.removeListener(i),0,(n=wn(e))?(sn(n,t),0==n.b&&(n.src=null,e[cn]=null)):on(t)}}}function mn(t){return t in hn?hn[t]:hn[t]="on"+t}function gn(t,e,n,i){var r=!0;if((t=wn(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.wa&&(o=bn(o,i),r=r&&!1!==o)}return r}function bn(t,e){var n=t.listener,i=t.Wa||t.src;return t.Qa&&vn(t),n.call(i,e)}function yn(t,e){if(t.wa)return!0;if(!Ye){if(!e)t:{e=["window","event"];for(var n=u,i=0;i<e.length;i++)if(null==(n=n[e[i]])){e=null;break t}e=n}if(e=new Qe(i=e,this),n=!0,!(0>i.keyCode||null!=i.returnValue)){t:{var r=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(a){r=!0}(r||null==i.returnValue)&&(i.returnValue=!0)}for(i=[],r=e.b;r;r=r.parentNode)i.push(r);for(t=t.type,r=i.length-1;0<=r;r--){e.b=i[r];var o=gn(i[r],t,!0,e);n=n&&o}for(r=0;r<i.length;r++)e.b=i[r],o=gn(i[r],t,!1,e),n=n&&o}return n}return bn(t,new Qe(e,this))}function wn(t){return(t=t[cn])instanceof an?t:null}var In="__closure_events_fn_"+(1e9*Math.random()>>>0);function Tn(t){return v(t)?t:(t[In]||(t[In]=function(e){return t.handleEvent(e)}),t[In])}function En(){Ge.call(this),this.v=new an(this),this.bc=this,this.hb=null}function An(t,e,n,i,r){t.v.add(String(e),n,!1,i,r)}function kn(t,e,n,i,r){t.v.add(String(e),n,!0,i,r)}function Sn(t,e,n,i){if(!(e=t.v.a[String(e)]))return!0;e=e.concat();for(var r=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.wa&&a.capture==n){var s=a.listener,u=a.Wa||a.src;a.Qa&&sn(t.v,a),r=!1!==s.call(u,i)&&r}}return r&&!i.defaultPrevented}function Nn(t,e,n){if(v(t))n&&(t=T(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=T(t.handleEvent,t)}return 2147483647<Number(e)?-1:u.setTimeout(t,e||0)}function _n(t){var e=null;return new Ee(function(n,i){-1==(e=Nn(function(){n(void 0)},t))&&i(Error("Failed to schedule timer."))}).o(function(t){throw u.clearTimeout(e),t})}function On(t){if(t.X&&"function"==typeof t.X)return t.X();if("string"==typeof t)return t.split("");if(p(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}function Cn(t){if(t.Y&&"function"==typeof t.Y)return t.Y();if(!t.X||"function"!=typeof t.X){if(p(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var i in e=[],n=0,t)e[n++]=i;return e}}function Rn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof Rn)for(n=t.Y(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function Pn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var i=t.a[e];Dn(t.b,i)&&(t.a[n++]=i),e++}t.a.length=n}if(t.c!=t.a.length){var r={};for(n=e=0;e<t.a.length;)Dn(r,i=t.a[e])||(t.a[n++]=i,r[i]=1),e++;t.a.length=n}}function Dn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}k(En,Ge),En.prototype[en]=!0,En.prototype.addEventListener=function(t,e,n,i){ln(this,t,e,n,i)},En.prototype.removeEventListener=function(t,e,n,i){pn(this,t,e,n,i)},En.prototype.dispatchEvent=function(t){var e,n=this.hb;if(n)for(e=[];n;n=n.hb)e.push(n);n=this.bc;var i=t.type||t;if("string"==typeof t)t=new Ze(t,n);else if(t instanceof Ze)t.target=t.target||n;else{var r=t;bt(t=new Ze(i,n),r)}if(r=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];r=Sn(a,i,!0,t)&&r}if(r=Sn(a=t.b=n,i,!0,t)&&r,r=Sn(a,i,!1,t)&&r,e)for(o=0;o<e.length;o++)r=Sn(a=t.b=e[o],i,!1,t)&&r;return r},En.prototype.Da=function(){if(En.bb.Da.call(this),this.v){var t,e=this.v;for(t in e.a){for(var n=e.a[t],i=0;i<n.length;i++)0,on(n[i]);delete e.a[t],e.b--}}this.hb=null},(n=Rn.prototype).X=function(){Pn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},n.Y=function(){return Pn(this),this.a.concat()},n.clear=function(){this.b={},this.c=this.a.length=0},n.get=function(t,e){return Dn(this.b,t)?this.b[t]:e},n.set=function(t,e){Dn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},n.forEach=function(t,e){for(var n=this.Y(),i=0;i<n.length;i++){var r=n[i],o=this.get(r);t.call(e,o,r,this)}};var Ln=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function xn(t,e){var n;this.a=this.l=this.c="",this.g=null,this.h=this.f="",this.i=!1,t instanceof xn?(this.i=void 0!==e?e:t.i,Mn(this,t.c),this.l=t.l,this.a=t.a,jn(this,t.g),this.f=t.f,Un(this,ii(t.b)),this.h=t.h):t&&(n=String(t).match(Ln))?(this.i=!!e,Mn(this,n[1]||"",!0),this.l=Hn(n[2]||""),this.a=Hn(n[3]||"",!0),jn(this,n[4]),this.f=Hn(n[5]||"",!0),Un(this,n[6]||"",!0),this.h=Hn(n[7]||"")):(this.i=!!e,this.b=new $n(null,this.i))}function Mn(t,e,n){t.c=n?Hn(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function jn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.g=e}else t.g=null}function Un(t,e,n){e instanceof $n?(t.b=e,function(t,e){e&&!t.f&&(Zn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(ti(this,e),ni(this,n,t))},t)),t.f=e}(t.b,t.i)):(n||(e=Gn(e,Yn)),t.b=new $n(e,t.i))}function Vn(t,e,n){t.b.set(e,n)}function Fn(t,e){return t.b.get(e)}function qn(t){return t instanceof xn?new xn(t):new xn(t,void 0)}function Kn(t,e,n,i){var r=new xn(null,void 0);return t&&Mn(r,t),e&&(r.a=e),n&&jn(r,n),i&&(r.f=i),r}function Hn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Gn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Bn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Bn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}xn.prototype.toString=function(){var t=[],e=this.c;e&&t.push(Gn(e,Wn,!0),":");var n=this.a;return(n||"file"==e)&&(t.push("//"),(e=this.l)&&t.push(Gn(e,Wn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.g)&&t.push(":",String(n))),(n=this.f)&&(this.a&&"/"!=n.charAt(0)&&t.push("/"),t.push(Gn(n,"/"==n.charAt(0)?Jn:Xn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.h)&&t.push("#",Gn(n,zn)),t.join("")},xn.prototype.resolve=function(t){var e=new xn(this),n=!!t.c;n?Mn(e,t.c):n=!!t.l,n?e.l=t.l:n=!!t.a,n?e.a=t.a:n=null!=t.g;var i=t.f;if(n)jn(e,t.g);else if(n=!!t.f){if("/"!=i.charAt(0))if(this.a&&!this.f)i="/"+i;else{var r=e.f.lastIndexOf("/");-1!=r&&(i=e.f.substr(0,r+1)+i)}if(".."==(r=i)||"."==r)i="";else if(ct(r,"./")||ct(r,"/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");for(var o=[],a=0;a<r.length;){var s=r[a++];"."==s?i&&a==r.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),i&&a==r.length&&o.push("")):(o.push(s),i=!0)}i=o.join("/")}else i=r}return n?e.f=i:n=""!==t.b.toString(),n?Un(e,ii(t.b)):n=!!t.h,n&&(e.h=t.h),e};var Wn=/[#\/\?@]/g,Xn=/[#\?:]/g,Jn=/[#\?]/g,Yn=/[#\?@]/g,zn=/#/g;function $n(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Zn(t){t.a||(t.a=new Rn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var o=t[n].substring(0,i);r=t[n].substring(i+1)}else o=t[n];e(o,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Qn(t){var e=Cn(t);if(void 0===e)throw Error("Keys are undefined");var n=new $n(null,void 0);t=On(t);for(var i=0;i<e.length;i++){var r=e[i],o=t[i];Array.isArray(o)?ni(n,r,o):n.add(r,o)}return n}function ti(t,e){Zn(t),e=ri(t,e),Dn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Dn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Pn(t)))}function ei(t,e){return Zn(t),e=ri(t,e),Dn(t.a.b,e)}function ni(t,e,n){ti(t,e),0<n.length&&(t.c=null,t.a.set(ri(t,e),Q(n)),t.b+=n.length)}function ii(t){var e=new $n;return e.c=t.c,t.a&&(e.a=new Rn(t.a),e.b=t.b),e}function ri(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function oi(t){var e=[];return function t(e,n,i){if(null==n)i.push("null");else{if("object"==typeof n){if(Array.isArray(n)){var r=n;n=r.length,i.push("[");for(var o="",a=0;a<n;a++)i.push(o),t(e,r[a],i),o=",";return void i.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(r in i.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,r)&&("function"!=typeof(a=n[r])&&(i.push(o),ci(r,i),i.push(":"),t(e,a,i),o=","));return void i.push("}")}n=n.valueOf()}switch(typeof n){case"string":ci(n,i);break;case"number":i.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":i.push(String(n));break;case"function":i.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new ai,t,e),e.join("")}function ai(){}(n=$n.prototype).add=function(t,e){Zn(this),this.c=null,t=ri(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},n.clear=function(){this.a=this.c=null,this.b=0},n.forEach=function(t,e){Zn(this),this.a.forEach(function(n,i){B(n,function(n){t.call(e,n,i,this)},this)},this)},n.Y=function(){Zn(this);for(var t=this.a.X(),e=this.a.Y(),n=[],i=0;i<e.length;i++)for(var r=t[i],o=0;o<r.length;o++)n.push(e[i]);return n},n.X=function(t){Zn(this);var e=[];if("string"==typeof t)ei(this,t)&&(e=Z(e,this.a.get(ri(this,t))));else{t=this.a.X();for(var n=0;n<t.length;n++)e=Z(e,t[n])}return e},n.set=function(t,e){return Zn(this),this.c=null,ei(this,t=ri(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},n.get=function(t,e){return t&&0<(t=this.X(t)).length?String(t[0]):e},n.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.Y(),n=0;n<e.length;n++){var i=e[n],r=encodeURIComponent(String(i));i=this.X(i);for(var o=0;o<i.length;o++){var a=r;""!==i[o]&&(a+="="+encodeURIComponent(String(i[o]))),t.push(a)}}return this.c=t.join("&")};var si={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},ui=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function ci(t,e){e.push('"',t.replace(ui,function(t){var e=si[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),si[t]=e),e}),'"')}function hi(){var t=Oi();return zt&&!!ce&&11==ce||/Edge\/\d+/.test(t)}function li(){return u.window&&u.window.location.href||self&&self.location&&self.location.href||""}function fi(t,e){e=e||u.window;var n="about:blank";t&&(n=Dt(jt(t)||Ft)),e.location.href=n}function di(t){return!!((t=(t||Oi()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function pi(t){t=t||u.window;try{t.close()}catch(e){}}function vi(t,e,n){var i=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var r=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<r?r:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=Oi().toLowerCase(),i&&(e.target=i,ct(n,"crios/")&&(e.target="_blank")),Si(Oi())==Ai&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),i=window,e=n instanceof Pt?n:jt(void 0!==n.href?n.href:String(n))||Ft,n=t.target||n.target,r=[],t)switch(a){case"width":case"height":case"top":case"left":r.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:r.push(a+"="+(t[a]?1:0))}var a=r.join(",");if((dt("iPhone")&&!dt("iPod")&&!dt("iPad")||dt("iPad")||dt("iPod"))&&i.navigator&&i.navigator.standalone&&n&&"_self"!=n?(yt(a=ge(document,"A"),"HTMLAnchorElement"),e=e instanceof Pt?e:Ut(e),a.href=Dt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,i,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=Ht("",i,n,a),t=Dt(e),a&&(Zt&&ct(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Bt(t)+'">',t=new qt(t=(i=kt())?i.createHTML(t):t,null,Kt),i=a.document)&&(i.write(function(t){return t instanceof qt&&t.constructor===qt?t.a:(j("expected object of type SafeHtml, got '"+t+"' of type "+d(t)),"type_error:SafeHtml")}(t)),i.close())):(a=Ht(e,i,n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(s){}return a}var mi=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gi=/^[^@]+@[^@]+$/;function bi(){var t=null;return new Ee(function(e){"complete"==u.document.readyState?e():(t=function(){e()},dn(window,"load",t))}).o(function(e){throw pn(window,"load",t),e})}function yi(t){return t=t||Oi(),!("file:"!==Li()&&"ionic:"!==Li()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function wi(){var t=u.window;try{return!(!t||t==t.top)}catch(e){return!1}}function Ii(){return void 0!==u.WorkerGlobalScope&&"function"==typeof u.importScripts}function Ti(){return e.default.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":e.default.INTERNAL.hasOwnProperty("node")?"Node":Ii()?"Worker":"Browser"}function Ei(){var t=Ti();return"ReactNative"===t||"Node"===t}var Ai="Firefox",ki="Chrome";function Si(t){var e=t.toLowerCase();return ct(e,"opera/")||ct(e,"opr/")||ct(e,"opios/")?"Opera":ct(e,"iemobile")?"IEMobile":ct(e,"msie")||ct(e,"trident/")?"IE":ct(e,"edge/")?"Edge":ct(e,"firefox/")?Ai:ct(e,"silk/")?"Silk":ct(e,"blackberry")?"Blackberry":ct(e,"webos")?"Webos":!ct(e,"safari/")||ct(e,"chrome/")||ct(e,"crios/")||ct(e,"android")?!ct(e,"chrome/")&&!ct(e,"crios/")||ct(e,"edge/")?ct(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":ki:"Safari"}var Ni={md:"FirebaseCore-web",od:"FirebaseUI-web"};function _i(t,e){e=e||[];var n,i=[],r={};for(n in Ni)r[Ni[n]]=!0;for(n=0;n<e.length;n++)void 0!==r[e[n]]&&(delete r[e[n]],i.push(e[n]));return i.sort(),(e=i).length||(e=["FirebaseCore-web"]),"Browser"===(i=Ti())?i=Si(r=Oi()):"Worker"===i&&(i=Si(r=Oi())+"-"+i),i+"/JsCore/"+t+"/"+e.join(",")}function Oi(){return u.navigator&&u.navigator.userAgent||""}function Ci(t,e){t=t.split("."),e=e||u;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function Ri(){try{var t=u.localStorage,e=Vi();if(t)return t.setItem(e,"1"),t.removeItem(e),!hi()||!!u.indexedDB}catch(n){return Ii()&&!!u.indexedDB}return!1}function Pi(){return(Di()||"chrome-extension:"===Li()||yi())&&!Ei()&&Ri()&&!Ii()}function Di(){return"http:"===Li()||"https:"===Li()}function Li(){return u.location&&u.location.protocol||null}function xi(t){return!di(t=t||Oi())&&Si(t)!=Ai}function Mi(t){return void 0===t?null:oi(t)}function ji(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Ui(t){if(null!==t)return JSON.parse(t)}function Vi(t){return t||Math.floor(1e9*Math.random()).toString()}function Fi(t){return"Safari"!=Si(t=t||Oi())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function qi(){var t=u.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ki(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=Oi(),e=Ti(),this.b=di(t)||"ReactNative"===e}function Hi(){var t=u.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Gi(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(n){}return null}function Bi(){return!(!Ci("fireauth.oauthhelper",u)&&!Ci("fireauth.iframe",u))}Ki.prototype.get=function(){var t=u.navigator;return!t||"boolean"!=typeof t.onLine||!Di()&&"chrome-extension:"!==Li()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Wi,Xi={};function Ji(t){Xi[t]||(Xi[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Yi={};Object.defineProperty(Yi,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Yi,"abcd",{configurable:!0,enumerable:!0,value:2}),Wi=2==Yi.abcd}catch(Jt){Wi=!1}function zi(t,e,n){Wi?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function $i(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&zi(t,n,e[n])}function Zi(t){var e={};return $i(e,t),e}function Qi(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)zi(e,n,Qi(t[n]));return e}function tr(t){var e=t&&(t[or]?"phone":null);if(!(e&&t&&t[rr]))throw new N("internal-error","Internal assert: invalid MultiFactorInfo object");zi(this,"uid",t[rr]),zi(this,"displayName",t[nr]||null);var n=null;t[ir]&&(n=new Date(t[ir]).toUTCString()),zi(this,"enrollmentTime",n),zi(this,"factorId",e)}function er(t){try{var e=new ar(t)}catch(n){e=null}return e}tr.prototype.w=function(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}};var nr="displayName",ir="enrolledAt",rr="mfaEnrollmentId",or="phoneInfo";function ar(t){tr.call(this,t),zi(this,"phoneNumber",t[or])}function sr(t){var e={},n=t[lr],i=t[dr],r=t[pr];if(t=er(t[fr]),!r||r!=cr&&r!=hr&&!n||r==hr&&!i||r==ur&&!t)throw Error("Invalid checkActionCode response!");r==hr?(e[mr]=n||null,e[br]=n||null,e[vr]=i):(e[mr]=i||null,e[br]=i||null,e[vr]=n||null),e[gr]=t||null,zi(this,wr,r),zi(this,yr,Qi(e))}k(ar,tr),ar.prototype.w=function(){var t=ar.bb.w.call(this);return t.phoneNumber=this.phoneNumber,t};var ur="REVERT_SECOND_FACTOR_ADDITION",cr="EMAIL_SIGNIN",hr="VERIFY_AND_CHANGE_EMAIL",lr="email",fr="mfaInfo",dr="newEmail",pr="requestType",vr="email",mr="fromEmail",gr="multiFactorInfo",br="previousEmail",yr="data",wr="operation";function Ir(t){var e=Fn(t=qn(t),Tr)||null,n=Fn(t,Er)||null,i=Fn(t,Sr)||null;if(i=i&&_r[i]||null,!e||!n||!i)throw new N("argument-error",Tr+", "+Er+"and "+Sr+" are required in a valid action code URL.");$i(this,{apiKey:e,operation:i,code:n,continueUrl:Fn(t,Ar)||null,languageCode:Fn(t,kr)||null,tenantId:Fn(t,Nr)||null})}var Tr="apiKey",Er="oobCode",Ar="continueUrl",kr="languageCode",Sr="mode",Nr="tenantId",_r={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",revertSecondFactorAddition:ur,signIn:cr,verifyAndChangeEmail:hr,verifyEmail:"VERIFY_EMAIL"};function Or(t){try{return new Ir(t)}catch(e){return null}}function Cr(t){var e=t[xr];if(void 0===e)throw new N("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new N("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Rr];if(n&&"object"==typeof n){e=n[Ur];var i=n[Mr];if(n=n[jr],"string"==typeof e&&e.length){if(this.a=e,void 0!==i&&"boolean"!=typeof i)throw new N("argument-error",Mr+" property must be a boolean when specified.");if(this.g=!!i,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new N("argument-error",jr+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new N("argument-error",Ur+" property must be a non empty string when specified.");if(void 0!==i||void 0!==n)throw new N("missing-android-pkg-name")}}else if(void 0!==n)throw new N("argument-error",Rr+" property must be a non null object when specified.");if(this.f=null,(e=t[Lr])&&"object"==typeof e){if("string"==typeof(e=e[Vr])&&e.length)this.f=e;else if(void 0!==e)throw new N("argument-error",Vr+" property must be a non empty string when specified.")}else if(void 0!==e)throw new N("argument-error",Lr+" property must be a non null object when specified.");if(void 0!==(e=t[Dr])&&"boolean"!=typeof e)throw new N("argument-error",Dr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Pr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new N("argument-error",Pr+" property must be a non empty string when specified.");this.i=t||null}var Rr="android",Pr="dynamicLinkDomain",Dr="handleCodeInApp",Lr="iOS",xr="url",Mr="installApp",jr="minimumVersion",Ur="packageName",Vr="bundleId";function Fr(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var qr=null;function Kr(t){var e=[];return function(t,e){function n(e){for(;i<t.length;){var n=t.charAt(i++),r=qr[n];if(null!=r)return r;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!qr){qr={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++)for(var i=t.concat(e[n].split("")),r=0;r<i.length;r++){var o=i[r];void 0===qr[o]&&(qr[o]=r)}}}();for(var i=0;;){var r=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===r)break;e(r<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e.push(t)}),e}function Hr(t){var e=Br(t);if(!(e&&e.sub&&e.iss&&e.aud&&e.exp))throw Error("Invalid JWT");this.h=t,this.a=e.exp,this.i=e.sub,t=Date.now()/1e3,this.g=e.iat||(t>this.a?this.a:t),this.b=e.provider_id||e.firebase&&e.firebase.sign_in_provider||null,this.f=e.firebase&&e.firebase.tenant||null,this.c=!!e.is_anonymous||"anonymous"==this.b}function Gr(t){try{return new Hr(t)}catch(e){return null}}function Br(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{var i=Kr(t);for(t=[],n=e=0;e<i.length;){var r=i[e++];if(128>r)t[n++]=String.fromCharCode(r);else if(191<r&&224>r){var o=i[e++];t[n++]=String.fromCharCode((31&r)<<6|63&o)}else if(239<r&&365>r){o=i[e++];var a=i[e++],s=((7&r)<<18|(63&o)<<12|(63&a)<<6|63&i[e++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else o=i[e++],a=i[e++],t[n++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&a)}return JSON.parse(t.join(""))}catch(u){}return null}Hr.prototype.T=function(){return this.f},Hr.prototype.l=function(){return this.c},Hr.prototype.toString=function(){return this.h};var Wr="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Xr=["client_id","response_type","scope","redirect_uri","state"],Jr={nd:{Ja:"locale",va:700,ua:600,fa:"facebook.com",Ya:Xr},pd:{Ja:null,va:500,ua:750,fa:"github.com",Ya:Xr},qd:{Ja:"hl",va:515,ua:680,fa:"google.com",Ya:Xr},wd:{Ja:"lang",va:485,ua:705,fa:"twitter.com",Ya:Wr},kd:{Ja:"locale",va:640,ua:600,fa:"apple.com",Ya:[]}};function Yr(t){for(var e in Jr)if(Jr[e].fa==t)return Jr[e];return null}function zr(t){var e={};e["facebook.com"]=eo,e["google.com"]=io,e["github.com"]=no,e["twitter.com"]=ro;var n=t&&t[Zr];try{if(n)return e[n]?new e[n](t):new to(t);if(void 0!==t[$r])return new Qr(t)}catch(i){}return null}var $r="idToken",Zr="providerId";function Qr(t){var e=t[Zr];if(!e&&t[$r]){var n=Gr(t[$r]);n&&n.b&&(e=n.b)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),zi(this,"providerId",e),zi(this,"isNewUser",n)}function to(t){Qr.call(this,t),zi(this,"profile",Qi((t=Ui(t.rawUserInfo||"{}"))||{}))}function eo(t){if(to.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function no(t){if(to.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");zi(this,"username",this.profile&&this.profile.login||null)}function io(t){if(to.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function ro(t){if(to.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");zi(this,"username",t.screenName||null)}function oo(t){var e=qn(t),n=Fn(e,"link"),i=Fn(qn(n),"link");return e=Fn(e,"deep_link_id"),Fn(qn(e),"link")||e||i||n||t}function ao(t,e){if(!t&&!e)throw new N("internal-error","Internal assert: no raw session string available");if(t&&e)throw new N("internal-error","Internal assert: unable to determine the session type");this.a=t||null,this.b=e||null,this.type=this.a?so:uo}k(to,Qr),k(eo,to),k(no,to),k(io,to),k(ro,to);var so="enroll",uo="signin";function co(){}function ho(t,e){return t.then(function(t){if(t[Za]){var n=Gr(t[Za]);if(!n||e!=n.i)throw new N("user-mismatch");return t}throw new N("user-mismatch")}).o(function(t){throw t&&t.code&&t.code==C+"user-not-found"?new N("user-mismatch"):t})}function lo(t,e){if(!e)throw new N("internal-error","failed to construct a credential");this.a=e,zi(this,"providerId",t),zi(this,"signInMethod",t)}function fo(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function po(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new lo(t.providerId,t.pendingToken)}catch(e){}return null}function vo(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&zi(this,"idToken",e.idToken),e.accessToken&&zi(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&zi(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new N("internal-error","failed to construct a credential");zi(this,"accessToken",e.oauthToken),zi(this,"secret",e.oauthTokenSecret)}zi(this,"providerId",t),zi(this,"signInMethod",n)}function mo(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Qn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function go(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new vo(t.providerId,e,t.signInMethod)}catch(n){}}return null}function bo(t,e){this.Qc=e||[],$i(this,{providerId:t,isOAuthProvider:!0}),this.Jb={},this.qb=(Yr(t)||{}).Ja||null,this.pb=null}function yo(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new N("argument-error",'SAML provider IDs must be prefixed with "saml."');bo.call(this,t,[])}function wo(t){bo.call(this,t,Xr),this.a=[]}function Io(){wo.call(this,"facebook.com")}function To(t){if(!t)throw new N("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return m(t)&&(e=t.accessToken),(new Io).credential({accessToken:e})}function Eo(){wo.call(this,"github.com")}function Ao(t){if(!t)throw new N("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return m(t)&&(e=t.accessToken),(new Eo).credential({accessToken:e})}function ko(){wo.call(this,"google.com"),this.Ca("profile")}function So(t,e){var n=t;return m(t)&&(n=t.idToken,e=t.accessToken),(new ko).credential({idToken:n,accessToken:e})}function No(){bo.call(this,"twitter.com",Wr)}function _o(t,e){var n=t;if(m(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new N("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new vo("twitter.com",n,"twitter.com")}function Oo(t,e,n){this.a=t,this.f=e,zi(this,"providerId","password"),zi(this,"signInMethod",n===Ro.EMAIL_LINK_SIGN_IN_METHOD?Ro.EMAIL_LINK_SIGN_IN_METHOD:Ro.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Co(t){return t&&t.email&&t.password?new Oo(t.email,t.password,t.signInMethod):null}function Ro(){$i(this,{providerId:"password",isOAuthProvider:!1})}function Po(t,e){if(!(e=Do(e)))throw new N("argument-error","Invalid email link!");return new Oo(t,e.code,Ro.EMAIL_LINK_SIGN_IN_METHOD)}function Do(t){return(t=Or(t=oo(t)))&&t.operation===cr?t:null}function Lo(t){if(!(t.fb&&t.eb||t.La&&t.ea))throw new N("internal-error");this.a=t,zi(this,"providerId","phone"),this.fa="phone",zi(this,"signInMethod","phone")}function xo(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return B(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new Lo(e)}return null}function Mo(t){return t.a.La&&t.a.ea?{temporaryProof:t.a.La,phoneNumber:t.a.ea}:{sessionInfo:t.a.fb,code:t.a.eb}}function jo(t){try{this.a=t||e.default.auth()}catch(n){throw new N("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}$i(this,{providerId:"phone",isOAuthProvider:!1})}function Uo(t,e){if(!t)throw new N("missing-verification-id");if(!e)throw new N("missing-verification-code");return new Lo({fb:t,eb:e})}function Vo(t){if(t.temporaryProof&&t.phoneNumber)return new Lo({La:t.temporaryProof,ea:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,i=t&&t.oauthTokenSecret,r=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return So(o,n);case"facebook.com":return To(n);case"github.com":return Ao(n);case"twitter.com":return _o(n,i);default:return n||i||o||a?a?0==e.indexOf("saml.")?new lo(e,a):new vo(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new wo(e).credential({idToken:o,accessToken:n,rawNonce:r}):null}}catch(s){return null}}function Fo(t){if(!t.isOAuthProvider)throw new N("invalid-oauth-provider")}function qo(t,e,n,i,r,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=i||null,this.i=o||null,this.h=a||null,this.a=r||null,!this.g&&!this.a)throw new N("invalid-auth-event");if(this.g&&this.a)throw new N("invalid-auth-event");if(this.g&&!this.f)throw new N("invalid-auth-event")}function Ko(t){return(t=t||{}).type?new qo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&_(t.error),t.postBody,t.tenantId):null}function Ho(){this.b=null,this.a=[]}ao.prototype.Ha=function(){return this.a?Ce(this.a):Ce(this.b)},ao.prototype.w=function(){return this.type==so?{multiFactorSession:{idToken:this.a}}:{multiFactorSession:{pendingCredential:this.b}}},co.prototype.ka=function(){},co.prototype.b=function(){},co.prototype.c=function(){},co.prototype.w=function(){},lo.prototype.ka=function(t){return ws(t,fo(this))},lo.prototype.b=function(t,e){var n=fo(this);return n.idToken=e,Is(t,n)},lo.prototype.c=function(t,e){return ho(Ts(t,fo(this)),e)},lo.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},vo.prototype.ka=function(t){return ws(t,mo(this))},vo.prototype.b=function(t,e){var n=mo(this);return n.idToken=e,Is(t,n)},vo.prototype.c=function(t,e){return ho(Ts(t,mo(this)),e)},vo.prototype.w=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},bo.prototype.Ka=function(t){return this.Jb=mt(t),this},k(yo,bo),k(wo,bo),wo.prototype.Ca=function(t){return Y(this.a,t)||this.a.push(t),this},wo.prototype.Rb=function(){return Q(this.a)},wo.prototype.credential=function(t,e){var n;if(!(n=m(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new N("argument-error","credential failed: must provide the ID token and/or the access token.");return new vo(this.providerId,n,this.providerId)},k(Io,wo),zi(Io,"PROVIDER_ID","facebook.com"),zi(Io,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),k(Eo,wo),zi(Eo,"PROVIDER_ID","github.com"),zi(Eo,"GITHUB_SIGN_IN_METHOD","github.com"),k(ko,wo),zi(ko,"PROVIDER_ID","google.com"),zi(ko,"GOOGLE_SIGN_IN_METHOD","google.com"),k(No,bo),zi(No,"PROVIDER_ID","twitter.com"),zi(No,"TWITTER_SIGN_IN_METHOD","twitter.com"),Oo.prototype.ka=function(t){return this.signInMethod==Ro.EMAIL_LINK_SIGN_IN_METHOD?iu(t,Cs,{email:this.a,oobCode:this.f}):iu(t,Zs,{email:this.a,password:this.f})},Oo.prototype.b=function(t,e){return this.signInMethod==Ro.EMAIL_LINK_SIGN_IN_METHOD?iu(t,Rs,{idToken:e,email:this.a,oobCode:this.f}):iu(t,Gs,{idToken:e,email:this.a,password:this.f})},Oo.prototype.c=function(t,e){return ho(this.ka(t),e)},Oo.prototype.w=function(){return{email:this.a,password:this.f,signInMethod:this.signInMethod}},$i(Ro,{PROVIDER_ID:"password"}),$i(Ro,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),$i(Ro,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Lo.prototype.ka=function(t){return t.gb(Mo(this))},Lo.prototype.b=function(t,e){var n=Mo(this);return n.idToken=e,iu(t,tu,n)},Lo.prototype.c=function(t,e){var n=Mo(this);return n.operation="REAUTH",ho(t=iu(t,eu,n),e)},Lo.prototype.w=function(){var t={providerId:"phone"};return this.a.fb&&(t.verificationId=this.a.fb),this.a.eb&&(t.verificationCode=this.a.eb),this.a.La&&(t.temporaryProof=this.a.La),this.a.ea&&(t.phoneNumber=this.a.ea),t},jo.prototype.gb=function(t,e){var n=this.a.a;return Ce(e.verify()).then(function(i){if("string"!=typeof i)throw new N("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":var r=m(t)?t.session:null,o=m(t)?t.phoneNumber:t;return(r&&r.type==so?r.Ha().then(function(t){return iu(n,Ws,{idToken:t,phoneEnrollmentInfo:{phoneNumber:o,recaptchaToken:i}}).then(function(t){return t.phoneSessionInfo.sessionInfo})}):r&&r.type==uo?r.Ha().then(function(e){return function(t,e){return iu(t,Xs,e).then(function(t){return t.phoneResponseInfo.sessionInfo})}(n,{mfaPendingCredential:e,mfaEnrollmentId:t.multiFactorHint&&t.multiFactorHint.uid||t.multiFactorUid,phoneSignInInfo:{recaptchaToken:i}})}):function(t,e){return iu(t,Ks,e)}(n,{phoneNumber:o,recaptchaToken:i})).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new N("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},$i(jo,{PROVIDER_ID:"phone"}),$i(jo,{PHONE_SIGN_IN_METHOD:"phone"}),qo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},qo.prototype.T=function(){return this.h},qo.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.w()}};var Go,Bo=null;function Wo(t){var e="unauthorized-domain",n=void 0,i=qn(t);t=i.a,"chrome-extension"==(i=i.c)?n=Gt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==i||"https"==i?n=Gt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",N.call(this,e,n)}function Xo(t,e,n){N.call(this,t,n),(t=e||{}).Kb&&zi(this,"email",t.Kb),t.ea&&zi(this,"phoneNumber",t.ea),t.credential&&zi(this,"credential",t.credential),t.$b&&zi(this,"tenantId",t.$b)}function Jo(t){if(t.code){var e=t.code||"";0==e.indexOf(C)&&(e=e.substring(C.length));var n={credential:Vo(t),$b:t.tenantId};if(t.email)n.Kb=t.email;else if(t.phoneNumber)n.ea=t.phoneNumber;else if(!n.credential)return new N(e,t.message||void 0);return new Xo(e,n,t.message)}return null}function Yo(){}function zo(t){return t.c||(t.c=t.b())}function $o(){}function Zo(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var i=e[n];try{return new ActiveXObject(i),t.f=i}catch(r){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function Qo(){}function ta(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=T(this.qc,this),this.a.onerror=T(this.Tb,this),this.a.onprogress=T(this.rc,this),this.a.ontimeout=T(this.vc,this)}function ea(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function na(t,e,n){this.reset(t,e,n,void 0,void 0)}k(Wo,N),k(Xo,N),Xo.prototype.w=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.w();return e&&bt(t,e),t},Xo.prototype.toJSON=function(){return this.w()},Yo.prototype.c=null,k($o,Yo),$o.prototype.a=function(){var t=Zo(this);return t?new ActiveXObject(t):new XMLHttpRequest},$o.prototype.b=function(){var t={};return Zo(this)&&(t[0]=!0,t[1]=!0),t},Go=new $o,k(Qo,Yo),Qo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new ta;throw Error("Unsupported browser")},Qo.prototype.b=function(){return{}},(n=ta.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},n.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},n.abort=function(){this.a.abort()},n.setRequestHeader=function(){},n.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},n.qc=function(){this.status=200,this.response=this.responseText=this.a.responseText,ea(this,4)},n.Tb=function(){this.status=500,this.response=this.responseText="",ea(this,4)},n.vc=function(){this.Tb()},n.rc=function(){this.status=200,ea(this,1)},n.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},na.prototype.a=null;function ia(t){this.f=t,this.b=this.c=this.a=null}function ra(t,e){this.name=t,this.value=e}na.prototype.reset=function(t,e,n,i,r){"number"==typeof r||0,i||A(),delete this.a},ra.prototype.toString=function(){return this.name};var oa=new ra("SEVERE",1e3),aa=new ra("WARNING",900),sa=new ra("CONFIG",700),ua=new ra("FINE",500);ia.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(j("Root logger has no level set."),null)}(this).value)for(v(e)&&(e=e()),t=new na(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var ca={},ha=null;function la(t){var e;if(ha||(ha=new ia(""),ca[""]=ha,ha.c=sa),!(e=ca[t])){e=new ia(t);var n=t.lastIndexOf("."),i=t.substr(n+1);(n=la(t.substr(0,n))).b||(n.b={}),n.b[i]=e,e.a=n,ca[t]=e}return e}function fa(t,e){t&&t.log(ua,e,void 0)}function da(t){this.f=t}function pa(t){En.call(this),this.u=t,this.h=void 0,this.readyState=va,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.f="",this.a=!1,this.i=la("goog.net.FetchXmlHttp"),this.m=this.c=this.g=null}k(da,Yo),da.prototype.a=function(){return new pa(this.f)},da.prototype.b=function(t){return function(){return t}}({}),k(pa,En);var va=0;function ma(t){t.c.read().then(t.pc.bind(t)).catch(t.Va.bind(t))}function ga(t){t.readyState=4,t.g=null,t.c=null,t.m=null,ba(t)}function ba(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function ya(t){En.call(this),this.headers=new Rn,this.D=t||null,this.c=!1,this.C=this.a=null,this.h=this.P=this.l="",this.f=this.N=this.i=this.J=!1,this.g=0,this.s=null,this.m=wa,this.u=this.S=!1}(n=pa.prototype).open=function(t,e){if(this.readyState!=va)throw this.abort(),Error("Error reopening a connection");this.s=t,this.f=e,this.readyState=1,ba(this)},n.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.l,method:this.s,credentials:this.h,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.f,e)).then(this.uc.bind(this),this.Va.bind(this))},n.abort=function(){this.response=this.responseText="",this.l=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,ga(this)),this.readyState=va},n.uc=function(t){this.a&&(this.g=t,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=t.headers,this.readyState=2,ba(this)),this.a&&(this.readyState=3,ba(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.sc.bind(this),this.Va.bind(this)):void 0!==u.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.m=new TextDecoder,ma(this)):t.text().then(this.tc.bind(this),this.Va.bind(this)))))},n.pc=function(t){if(this.a){var e=this.m.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?ga(this):ba(this),3==this.readyState&&ma(this)}},n.tc=function(t){this.a&&(this.response=this.responseText=t,ga(this))},n.sc=function(t){this.a&&(this.response=t,ga(this))},n.Va=function(t){var e=this.i;e&&e.log(aa,"Failed to fetch url "+this.f,t instanceof Error?t:Error(t)),this.a&&ga(this)},n.setRequestHeader=function(t,e){this.l.append(t,e)},n.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.i)&&t.log(aa,"Attempting to get response header but no headers have been received for url: "+this.f,void 0),"")},n.getAllResponseHeaders=function(){if(!this.b){var t=this.i;return t&&t.log(aa,"Attempting to get all response headers but no headers have been received for url: "+this.f,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(pa.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(t){this.h=t?"include":"same-origin"}}),k(ya,En);var wa="";ya.prototype.b=la("goog.net.XhrIo");var Ia=/^https?$/i,Ta=["POST","PUT"];function Ea(t,e,n,i,r){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.P=n,t.J=!1,t.c=!0,t.a=t.D?t.D.a():Go.a(),t.C=t.D?zo(t.D):zo(Go),t.a.onreadystatechange=T(t.Wb,t);try{fa(t.b,Pa(t,"Opening Xhr")),t.N=!0,t.a.open(n,String(e),!0),t.N=!1}catch(a){return fa(t.b,Pa(t,"Error opening Xhr: "+a.message)),void ka(t,a)}e=i||"";var o=new Rn(t.headers);r&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(p(t)||"string"==typeof t)B(t,e,void 0);else for(var n=Cn(t),i=On(t),r=i.length,o=0;o<r;o++)e.call(void 0,i[o],n&&n[o],t)}(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Aa,n=t.length,i="string"==typeof t?t.split(""):t,r=0;r<n;r++)if(r in i&&e.call(void 0,i[r],r,t)){e=r;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(o.Y()),i=u.FormData&&e instanceof u.FormData,!Y(Ta,n)||r||i||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.S&&(t.a.withCredentials=t.S);try{Oa(t),0<t.g&&(t.u=function(t){return zt&&se(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),fa(t.b,Pa(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.u)),t.u?(t.a.timeout=t.g,t.a.ontimeout=T(t.Ma,t)):t.s=Nn(t.Ma,t.g,t)),fa(t.b,Pa(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(a){fa(t.b,Pa(t,"Send error: "+a.message)),ka(t,a)}}function Aa(t){return"content-type"==t.toLowerCase()}function ka(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Sa(t),_a(t)}function Sa(t){t.J||(t.J=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Na(t){if(t.c&&void 0!==s)if(t.C[1]&&4==Ca(t)&&2==Ra(t))fa(t.b,Pa(t,"Local request error detected and ignored"));else if(t.i&&4==Ca(t))Nn(t.Wb,0,t);else if(t.dispatchEvent("readystatechange"),4==Ca(t)){fa(t.b,Pa(t,"Request complete")),t.c=!1;try{var e,n=Ra(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break t;default:i=!1}if(!(e=i)){var r;if(r=0===n){var o=String(t.l).match(Ln)[1]||null;if(!o&&u.self&&u.self.location){var a=u.self.location.protocol;o=a.substr(0,a.length-1)}r=!Ia.test(o?o.toLowerCase():"")}e=r}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<Ca(t)?t.a.statusText:""}catch(h){fa(t.b,"Can not get status: "+h.message),c=""}t.h=c+" ["+Ra(t)+"]",Sa(t)}}finally{_a(t)}}}function _a(t,e){if(t.a){Oa(t);var n=t.a,i=t.C[0]?f:null;t.a=null,t.C=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=i}catch(r){(t=t.b)&&t.log(oa,"Problem encountered resetting onreadystatechange: "+r.message,void 0)}}}function Oa(t){t.a&&t.u&&(t.a.ontimeout=null),t.s&&(u.clearTimeout(t.s),t.s=null)}function Ca(t){return t.a?t.a.readyState:0}function Ra(t){try{return 2<Ca(t)?t.a.status:-1}catch(e){return-1}}function Pa(t,e){return e+" ["+t.P+" "+t.l+" "+Ra(t)+"]"}function Da(t){var e=Ga;this.g=[],this.u=e,this.s=t||null,this.f=this.a=!1,this.c=void 0,this.v=this.C=this.i=!1,this.h=0,this.b=null,this.l=0}function La(t,e,n){t.a=!0,t.c=n,t.f=!e,Ua(t)}function xa(t){if(t.a){if(!t.v)throw new Va(t);t.v=!1}}function Ma(t,e,n,i){t.g.push([e,n,i]),t.a&&Ua(t)}function ja(t){return J(t.g,function(t){return v(t[1])})}function Ua(t){if(t.h&&t.a&&ja(t)){var e=t.h,n=Ka[e];n&&(u.clearTimeout(n.a),delete Ka[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var i=n=!1;t.g.length&&!t.i;){var r=t.g.shift(),o=r[0],a=r[1];if(r=r[2],o=t.f?a:o)try{var s=o.call(r||t.s,e);void 0!==s&&(t.f=t.f&&(s==e||s instanceof Error),t.c=e=s),(L(e)||"function"==typeof u.Promise&&e instanceof u.Promise)&&(i=!0,t.i=!0)}catch(c){e=c,t.f=!0,ja(t)||(n=!0)}}t.c=e,i&&(s=T(t.m,t,!0),i=T(t.m,t,!1),e instanceof Da?(Ma(e,s,i),e.C=!0):e.then(s,i)),n&&(e=new qa(e),Ka[e.a]=e,t.h=e.a)}function Va(){x.call(this)}function Fa(){x.call(this)}function qa(t){this.a=u.setTimeout(T(this.c,this),0),this.b=t}(n=ya.prototype).Ma=function(){void 0!==s&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",fa(this.b,Pa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},n.abort=function(){this.a&&this.c&&(fa(this.b,Pa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),_a(this))},n.Da=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),_a(this,!0)),ya.bb.Da.call(this)},n.Wb=function(){this.ya||(this.N||this.i||this.f?Na(this):this.Jc())},n.Jc=function(){Na(this)},n.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case wa:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(oa,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(e){return fa(this.b,"Can not get response: "+e.message),null}},Da.prototype.cancel=function(t){if(this.a)this.c instanceof Da&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.u?this.u.call(this.s,this):this.v=!0,this.a||(t=new Fa(this),xa(this),La(this,!1,t))}},Da.prototype.m=function(t,e){this.i=!1,La(this,t,e)},Da.prototype.then=function(t,e,n){var i,r,o=new Ee(function(t,e){i=t,r=e});return Ma(this,i,function(t){t instanceof Fa?o.cancel():r(t)}),o.then(t,e,n)},Da.prototype.$goog_Thenable=!0,k(Va,x),Va.prototype.message="Deferred has already fired",Va.prototype.name="AlreadyCalledError",k(Fa,x),Fa.prototype.message="Deferred was canceled",Fa.prototype.name="CanceledError",qa.prototype.c=function(){throw delete Ka[this.a],this.b};var Ka={};function Ha(t){var e={},n=e.document||document,i=Nt(t).toString(),r=ge(document,"SCRIPT"),o={Xb:r,Ma:void 0},a=new Da(o),s=null,c=null!=e.timeout?e.timeout:5e3;return 0<c&&(s=window.setTimeout(function(){Ba(r,!0);var t=new Ja(Xa,"Timeout reached for loading script "+i);xa(a),La(a,!1,t)},c),o.Ma=s),r.onload=r.onreadystatechange=function(){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(Ba(r,e.xd||!1,s),xa(a),La(a,!0,null))},r.onerror=function(){Ba(r,!0,s);var t=new Ja(Wa,"Error while loading script "+i);xa(a),La(a,!1,t)},bt(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),fe(r,o),function(t,e){yt(t,"HTMLScriptElement"),t.src=Nt(e),(e=t.ownerDocument&&t.ownerDocument.defaultView)&&e!=u?e=l(e.document):(null===h&&(h=l(u.document)),e=h),e&&t.setAttribute("nonce",e)}(r,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(r),a}function Ga(){if(this&&this.Xb){var t=this.Xb;t&&"SCRIPT"==t.tagName&&Ba(t,!0,this.Ma)}}function Ba(t,e,n){null!=n&&u.clearTimeout(n),t.onload=f,t.onerror=f,t.onreadystatechange=f,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Wa=0,Xa=1;function Ja(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),x.call(this,n),this.code=t}function Ya(t){this.f=t}function za(t,n,i){if(this.c=t,t=n||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Qa,this.g=mt(t.secureTokenHeaders||ts),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.identityPlatformEndpoint||"https://identitytoolkit.googleapis.com/v2/",this.v=t.firebaseTimeout||es,this.a=mt(t.firebaseHeaders||ns),i&&(this.a["X-Client-Version"]=i,this.g["X-Client-Version"]=i),i="Node"==Ti(),!(i=u.XMLHttpRequest||i&&e.default.INTERNAL.node&&e.default.INTERNAL.node.XMLHttpRequest)&&!Ii())throw new N("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,Ii()?this.f=new da(self):Ei()?this.f=new Ya(i):this.f=new Qo,this.b=null}k(Ja,x),k(Ya,Yo),Ya.prototype.a=function(){return new this.f},Ya.prototype.b=function(){return{}};var $a,Za="idToken",Qa=new Ki(3e4,6e4),ts={"Content-Type":"application/x-www-form-urlencoded"},es=new Ki(3e4,6e4),ns={"Content-Type":"application/json"};function is(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function rs(t,e){e&&(t.l=os("https://securetoken.googleapis.com/v1/token",e),t.h=os("https://www.googleapis.com/identitytoolkit/v3/relyingparty/",e),t.i=os("https://identitytoolkit.googleapis.com/v2/",e))}function os(t,e){return t=qn(t),e=qn(e.url),t.f=t.a+t.f,Mn(t,e.c),t.a=e.a,jn(t,e.g),t.toString()}function as(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function ss(t,e,n,i,r,o,a){(function(){var t=Oi();return!((t=Si(t)!=ki?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||zt&&ce&&!(9<ce))})()||Ii()?t=T(t.u,t):($a||($a=new Ee(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{u[cs]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=_t(us,{onload:cs});!function(t,e){Ma(t,null,e,void 0)}(Ha(n),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=T(t.s,t)),t(e,n,i,r,o,a)}za.prototype.T=function(){return this.b},za.prototype.u=function(t,e,n,i,r,o){if(Ii()&&(void 0===u.fetch||void 0===u.Headers||void 0===u.Request))throw new N("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new ya(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}An(a,"complete",function(){s&&clearTimeout(s);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return fa(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(n){t=null}e&&e(t)}),kn(a,"ready",function(){s&&clearTimeout(s),Xe(this)}),kn(a,"timeout",function(){s&&clearTimeout(s),Xe(this),e&&e(null)}),Ea(a,t,n,i,r)};var us=new wt(At,"https://apis.google.com/js/client.js?onload=%{onload}"),cs="__fcb"+Math.floor(1e6*Math.random()).toString();function hs(t,e,n,i,r,o,a){var s=qn(e+n);Vn(s,"key",t.c),a&&Vn(s,"cb",Date.now().toString());var u="GET"==i;if(u)for(var c in r)r.hasOwnProperty(c)&&Vn(s,c,r[c]);return new Ee(function(e,n){ss(t,s.toString(),function(t){t?t.error?n(ou(t,o||{})):e(t):n(new N("network-request-failed"))},i,u?void 0:oi(ji(r)),t.a,t.v.get())})}function ls(t){if("string"!=typeof(t=t.email)||!gi.test(t))throw new N("invalid-email")}function fs(t){"email"in t&&ls(t)}function ds(t){if(!t[Za]){if(t.mfaPendingCredential)throw new N("multi-factor-auth-required",null,mt(t));throw new N("internal-error")}}function ps(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new N("internal-error")}else{if(!t.sessionInfo)throw new N("missing-verification-id");if(!t.code)throw new N("missing-verification-code")}}za.prototype.s=function(t,e,n,i,r){var o=this;$a.then(function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:i,headers:r,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).o(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},za.prototype.Ab=function(){return iu(this,Bs,{})},za.prototype.Cb=function(t,e){return iu(this,Hs,{idToken:t,email:e})},za.prototype.Db=function(t,e){return iu(this,Gs,{idToken:t,password:e})};var vs={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function ms(t){if(!t.phoneVerificationInfo)throw new N("internal-error");if(!t.phoneVerificationInfo.sessionInfo)throw new N("missing-verification-id");if(!t.phoneVerificationInfo.code)throw new N("missing-verification-code")}function gs(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new N("internal-error")}function bs(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(ei(t=new $n(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function ys(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=Jo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=Jo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=Jo(t)):t.errorMessage&&(e=ru(t.errorMessage)),e)throw e;ds(t)}function ws(t,e){return e.returnIdpCredential=!0,iu(t,Js,e)}function Is(t,e){return e.returnIdpCredential=!0,iu(t,zs,e)}function Ts(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,iu(t,Ys,e)}function Es(t){if(!t.oobCode)throw new N("invalid-action-code")}(n=za.prototype).Eb=function(t,e){var n={idToken:t},i=[];return pt(vs,function(t,r){var o=e[r];null===o?i.push(t):r in e&&(n[r]=o)}),i.length&&(n.deleteAttribute=i),iu(this,Hs,n)},n.wb=function(t,e){return bt(t={requestType:"PASSWORD_RESET",email:t},e),iu(this,Us,t)},n.xb=function(t,e){return bt(t={requestType:"EMAIL_SIGNIN",email:t},e),iu(this,xs,t)},n.vb=function(t,e){return bt(t={requestType:"VERIFY_EMAIL",idToken:t},e),iu(this,Ms,t)},n.Fb=function(t,e,n){return bt(t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:t,newEmail:e},n),iu(this,js,t)},n.gb=function(t){return iu(this,Qs,t)},n.ob=function(t,e){return iu(this,qs,{oobCode:t,newPassword:e})},n.Sa=function(t){return iu(this,ks,{oobCode:t})},n.kb=function(t){return iu(this,As,{oobCode:t})};var As={endpoint:"setAccountInfo",A:Es,Z:"email",B:!0},ks={endpoint:"resetPassword",A:Es,G:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e&&"VERIFY_AND_CHANGE_EMAIL"!=e)throw new N("internal-error")},B:!0},Ss={endpoint:"signupNewUser",A:function(t){if(ls(t),!t.password)throw new N("weak-password")},G:ds,V:!0,B:!0},Ns={endpoint:"createAuthUri",B:!0},_s={endpoint:"deleteAccount",O:["idToken"]},Os={endpoint:"setAccountInfo",O:["idToken","deleteProvider"],A:function(t){if(!Array.isArray(t.deleteProvider))throw new N("internal-error")}},Cs={endpoint:"emailLinkSignin",O:["email","oobCode"],A:ls,G:ds,V:!0,B:!0},Rs={endpoint:"emailLinkSignin",O:["idToken","email","oobCode"],A:ls,G:ds,V:!0},Ps={endpoint:"accounts/mfaEnrollment:finalize",O:["idToken","phoneVerificationInfo"],A:ms,G:ds,B:!0,Na:!0},Ds={endpoint:"accounts/mfaSignIn:finalize",O:["mfaPendingCredential","phoneVerificationInfo"],A:ms,G:ds,B:!0,Na:!0},Ls={endpoint:"getAccountInfo"},xs={endpoint:"getOobConfirmationCode",O:["requestType"],A:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new N("internal-error");ls(t)},Z:"email",B:!0},Ms={endpoint:"getOobConfirmationCode",O:["idToken","requestType"],A:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new N("internal-error")},Z:"email",B:!0},js={endpoint:"getOobConfirmationCode",O:["idToken","newEmail","requestType"],A:function(t){if("VERIFY_AND_CHANGE_EMAIL"!=t.requestType)throw new N("internal-error")},Z:"email",B:!0},Us={endpoint:"getOobConfirmationCode",O:["requestType"],A:function(t){if("PASSWORD_RESET"!=t.requestType)throw new N("internal-error");ls(t)},Z:"email",B:!0},Vs={mb:!0,endpoint:"getProjectConfig",Vb:"GET"},Fs={mb:!0,endpoint:"getRecaptchaParam",Vb:"GET",G:function(t){if(!t.recaptchaSiteKey)throw new N("internal-error")}},qs={endpoint:"resetPassword",A:Es,Z:"email",B:!0},Ks={endpoint:"sendVerificationCode",O:["phoneNumber","recaptchaToken"],Z:"sessionInfo",B:!0},Hs={endpoint:"setAccountInfo",O:["idToken"],A:fs,V:!0},Gs={endpoint:"setAccountInfo",O:["idToken"],A:function(t){if(fs(t),!t.password)throw new N("weak-password")},G:ds,V:!0},Bs={endpoint:"signupNewUser",G:ds,V:!0,B:!0},Ws={endpoint:"accounts/mfaEnrollment:start",O:["idToken","phoneEnrollmentInfo"],A:function(t){if(!t.phoneEnrollmentInfo)throw new N("internal-error");if(!t.phoneEnrollmentInfo.phoneNumber)throw new N("missing-phone-number");if(!t.phoneEnrollmentInfo.recaptchaToken)throw new N("missing-app-credential")},G:function(t){if(!t.phoneSessionInfo||!t.phoneSessionInfo.sessionInfo)throw new N("internal-error")},B:!0,Na:!0},Xs={endpoint:"accounts/mfaSignIn:start",O:["mfaPendingCredential","mfaEnrollmentId","phoneSignInInfo"],A:function(t){if(!t.phoneSignInInfo||!t.phoneSignInInfo.recaptchaToken)throw new N("missing-app-credential")},G:function(t){if(!t.phoneResponseInfo||!t.phoneResponseInfo.sessionInfo)throw new N("internal-error")},B:!0,Na:!0},Js={endpoint:"verifyAssertion",A:gs,Za:bs,G:ys,V:!0,B:!0},Ys={endpoint:"verifyAssertion",A:gs,Za:bs,G:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new N("user-not-found");if(t.errorMessage)throw ru(t.errorMessage);ds(t)},V:!0,B:!0},zs={endpoint:"verifyAssertion",A:function(t){if(gs(t),!t.idToken)throw new N("internal-error")},Za:bs,G:ys,V:!0},$s={endpoint:"verifyCustomToken",A:function(t){if(!t.token)throw new N("invalid-custom-token")},G:ds,V:!0,B:!0},Zs={endpoint:"verifyPassword",A:function(t){if(ls(t),!t.password)throw new N("wrong-password")},G:ds,V:!0,B:!0},Qs={endpoint:"verifyPhoneNumber",A:ps,G:ds,B:!0},tu={endpoint:"verifyPhoneNumber",A:function(t){if(!t.idToken)throw new N("internal-error");ps(t)},G:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",Jo(t);ds(t)}},eu={Ib:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",A:ps,G:ds,B:!0},nu={endpoint:"accounts/mfaEnrollment:withdraw",O:["idToken","mfaEnrollmentId"],G:function(t){if(!!t[Za]^!!t.refreshToken)throw new N("internal-error")},B:!0,Na:!0};function iu(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var i=t[e[n]];if(null==i||""===i)return!1}return!0}(n,e.O))return Re(new N("internal-error"));var i,r=!!e.Na,o=e.Vb||"POST";return Ce(n).then(e.A).then(function(){return e.V&&(n.returnSecureToken=!0),e.B&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),hs(t,r?t.i:t.h,e.endpoint,o,n,e.Ib,e.mb||!1)}).then(function(t){return i=t,e.Za?e.Za(n,i):i}).then(e.G).then(function(){if(!e.Z)return i;if(!(e.Z in i))throw new N("internal-error");return i[e.Z]})}function ru(t){return ou({error:{errors:[{message:t}],code:400,message:t}})}function ou(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",i={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=i[n]?new N(i[n]):null)return n;for(var r in n=t.error&&t.error.message||"",bt(i={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",EMAIL_CHANGE_NEEDS_VERIFICATION:"email-change-needs-verification",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",UNSUPPORTED_FIRST_FACTOR:"unsupported-first-factor",UNVERIFIED_EMAIL:"unverified-email"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,i)if(0===n.indexOf(r))return new N(i[r],e);return!e&&t&&(e=Mi(t)),new N("internal-error",e)}function au(t){this.b=t,this.a=null,this.sb=function(t){return(hu||(hu=new Ee(function(t,e){function n(){qi(),Ci("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){qi(),e(Error("Network Error"))},timeout:uu.get()})}if(Ci("gapi.iframes.Iframe"))t();else if(Ci("gapi.load"))n();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();u[i]=function(){Ci("gapi.load")?n():e(Error("Network Error"))},Ce(Ha(i=_t(su,{onload:i}))).o(function(){e(Error("Network Error"))})}}).o(function(t){throw hu=null,t}))).then(function(){return new Ee(function(e,n){Ci("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:Ci("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(i){function r(){clearTimeout(o),e()}t.a=i,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},cu.get());i.ping(r).then(r,function(){n(Error("Network Error"))})})})})}(this)}var su=new wt(At,"https://apis.google.com/js/api.js?onload=%{onload}"),uu=new Ki(3e4,6e4),cu=new Ki(5e3,15e3),hu=null;function lu(t,e,n,i){this.l=t,this.h=e,this.i=n,this.g=i,this.f=null,this.g?t=Kn((t=qn(this.g.url)).c,t.a,t.g,"/emulator/auth/iframe"):t=Kn("https",this.l,null,"/__/auth/iframe"),this.a=t,Vn(this.a,"apiKey",this.h),Vn(this.a,"appName",this.i),this.b=null,this.c=[]}function fu(t,e,n,i,r,o){this.u=t,this.s=e,this.c=n,this.m=i,this.v=o,this.i=this.g=this.l=null,this.a=r,this.h=this.f=null}function du(t){try{return e.default.app(t).auth().Ga()}catch(n){return[]}}function pu(t,e,n,i,r,o){this.s=t,this.g=e,this.b=n,this.f=o,this.c=i||null,this.i=r||null,this.l=this.u=this.C=null,this.h=[],this.m=this.a=null}function vu(t){var e=li();return function(t){return iu(t,Vs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=qn(e),i=n.c;n=n.a;for(var r=0;r<t.length;r++){var o=t[r],a=n,s=i;if(0==o.indexOf("chrome-extension://")?a=qn(o).a==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:mi.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){t=!0;break t}}t=!1}if(!t)throw new Wo(li())})}function mu(t){return t.m?t.m:(t.m=bi().then(function(){if(!t.u){var e=t.c,n=t.i,i=du(t.b),r=new lu(t.s,t.g,t.b,t.f);r.f=e,r.b=n,r.c=Q(i||[]),t.u=r.toString()}t.v=new au(t.u),function(t){if(!t.v)throw Error("IfcHandler must be initialized!");!function(t,e){t.sb.then(function(){t.a.register("authEvent",e,Ci("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.v,function(e){var n={};if(e&&e.authEvent){var i=!1;for(e=Ko(e.authEvent),n=0;n<t.h.length;n++)i=t.h[n](e)||i;return(n={}).status=i?"ACK":"ERROR",Ce(n)}return n.status="ERROR",Ce(n)})}(t)}),t.m)}function gu(t){return t.l||(t.C=t.c?_i(t.c,du(t.b)):null,t.l=new za(t.g,D(t.i),t.C),t.f&&rs(t.l,t.f)),t.l}function bu(t,e,n,i,r,o,a,s,u,c,h,l){return(t=new fu(t,e,n,i,r,l)).l=o,t.g=a,t.i=s,t.b=mt(u||null),t.f=c,t.zb(h).toString()}function yu(t){if(this.a=t||e.default.INTERNAL.reactNative&&e.default.INTERNAL.reactNative.AsyncStorage,!this.a)throw new N("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function wu(t){this.b=t,this.a={},this.f=T(this.c,this)}lu.prototype.toString=function(){return this.f?Vn(this.a,"v",this.f):ti(this.a.b,"v"),this.b?Vn(this.a,"eid",this.b):ti(this.a.b,"eid"),this.c.length?Vn(this.a,"fw",this.c.join(",")):ti(this.a.b,"fw"),this.a.toString()},fu.prototype.zb=function(t){return this.h=t,this},fu.prototype.toString=function(){if(this.v){var t=qn(this.v.url);t=Kn(t.c,t.a,t.g,"/emulator/auth/handler")}else t=Kn("https",this.u,null,"/__/auth/handler");if(Vn(t,"apiKey",this.s),Vn(t,"appName",this.c),Vn(t,"authType",this.m),this.a.isOAuthProvider){var n=this.a;try{var i=e.default.app(this.c).auth().la()}catch(u){i=null}for(var r in n.pb=i,Vn(t,"providerId",this.a.providerId),n=ji((i=this.a).Jb))n[r]=n[r].toString();r=i.Qc,n=mt(n);for(var o=0;o<r.length;o++){var a=r[o];a in n&&delete n[a]}i.qb&&i.pb&&!n[i.qb]&&(n[i.qb]=i.pb),vt(n)||Vn(t,"customParameters",Mi(n))}if("function"==typeof this.a.Rb&&((i=this.a.Rb()).length&&Vn(t,"scopes",i.join(","))),this.l?Vn(t,"redirectUrl",this.l):ti(t.b,"redirectUrl"),this.g?Vn(t,"eventId",this.g):ti(t.b,"eventId"),this.i?Vn(t,"v",this.i):ti(t.b,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Fn(t,s)&&Vn(t,s,this.b[s]);return this.h?Vn(t,"tid",this.h):ti(t.b,"tid"),this.f?Vn(t,"eid",this.f):ti(t.b,"eid"),(s=du(this.c)).length&&Vn(t,"fw",s.join(",")),t.toString()},(n=pu.prototype).Pb=function(t,e,n){var i=new N("popup-closed-by-user"),r=new N("web-storage-unsupported"),o=this,a=!1;return this.ma().then(function(){(function(t){var e={type:"webStorageSupport"};return mu(t).then(function(){return function(t,e){return t.sb.then(function(){return new Ee(function(n){t.a.send(e.type,e,n,Ci("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.v,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&pi(t),e(r),a=!0)})}).o(function(){}).then(function(){if(!a)return function(t){return new Ee(function(e){return function n(){_n(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!a)return _n(n).then(function(){e(i)})})},n.Yb=function(){var t=Oi();return!xi(t)&&!Fi(t)},n.Ub=function(){return!1},n.Nb=function(t,e,n,i,r,o,a,s){if(!t)return Re(new N("popup-blocked"));if(a&&!xi())return this.ma().o(function(e){pi(t),r(e)}),i(),Ce();this.a||(this.a=vu(gu(this)));var u=this;return this.a.then(function(){var e=u.ma().o(function(e){throw pi(t),r(e),e});return i(),e}).then(function(){(Fo(n),a)||fi(bu(u.s,u.g,u.b,e,n,null,o,u.c,void 0,u.i,s,u.f),t)}).o(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},n.Ob=function(t,e,n,i){this.a||(this.a=vu(gu(this)));var r=this;return this.a.then(function(){Fo(e),fi(bu(r.s,r.g,r.b,t,e,li(),n,r.c,void 0,r.i,i,r.f))}).o(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},n.ma=function(){var t=this;return mu(this).then(function(){return t.v.sb}).o(function(){throw t.a=null,new N("network-request-failed")})},n.ac=function(){return!0},n.Ea=function(t){this.h.push(t)},n.Ta=function(t){$(this.h,function(e){return e==t})},(n=yu.prototype).get=function(t){return Ce(this.a.getItem(t)).then(function(t){return t&&Ui(t)})},n.set=function(t,e){return Ce(this.a.setItem(t,Mi(e)))},n.U=function(t){return Ce(this.a.removeItem(t))},n.ca=function(){},n.ia=function(){};var Iu,Tu=[];function Eu(t,e,n){vt(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Au(t){this.a=t}function ku(t){this.c=t,this.b=!1,this.a=[]}function Su(t,e,n,i){var r,o,a,s,u=n||{},c=null;if(t.b)return Re(Error("connection_unavailable"));var h=i?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new Ee(function(n,i){l?(r=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){i(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===r&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){i(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):i(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),i(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:r,data:u},[l.port2])):i(Error("connection_unavailable"))}).then(function(e){return Nu(t,c),e}).o(function(e){throw Nu(t,c),e})}function Nu(t,e){if(e){var n=e.messageChannel,i=e.onMessage;n&&(n.port1.removeEventListener("message",i),n.port1.close()),$(t.a,function(t){return t==e})}}function _u(){if(!Pu())throw new N("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.m=u.indexedDB,this.type="indexedDB",this.g=this.v=this.f=this.l=null,this.s=!1,this.h=null;var t=this;Ii()&&self?(this.v=function(){var t=Ii()?self:null;if(B(Tu,function(n){n.b==t&&(e=n)}),!e){var e=new wu(t);Tu.push(e)}return e}(),Eu(this.v,"keyChanged",function(e,n){return ju(t).then(function(e){return 0<e.length&&B(t.a,function(t){t(e)}),{keyProcessed:Y(e,n.key)}})}),Eu(this.v,"ping",function(){return Ce(["keyChanged"])})):function(){var t=u.navigator;return t&&t.serviceWorker?Ce().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).o(function(){return null}):Ce(null)}().then(function(e){(t.h=e)&&(t.g=new ku(new Au(e)),Su(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&Y(e[0].value,"keyChanged")&&(t.s=!0)}).o(function(){}))})}function Ou(t){return new Ee(function(e,n){var i=t.m.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(e){}n(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){n(e)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(i):function(t){return new Ee(function(e,n){var i=t.m.deleteDatabase("firebaseLocalStorageDb");i.onsuccess=function(){e()},i.onerror=function(t){n(Error(t.target.error))}})}(t).then(function(){return Ou(t)}).then(function(t){e(t)}).o(function(t){n(t)})}})}function Cu(t){return t.i||(t.i=Ou(t)),t.i}function Ru(t,e){var n=0;return new Ee(function i(r,o){Cu(t).then(e).then(r).o(function(e){if(!(3<++n))return Cu(t).then(function(e){return e.close(),t.i=void 0,i(r,o)}).o(function(t){o(t)});o(e)})})}function Pu(){try{return!!u.indexedDB}catch(Jt){return!1}}function Du(t){return t.objectStore("firebaseLocalStorage")}function Lu(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function xu(t){return new Ee(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Mu(t,e){return t.g&&t.h&&function(){var t=u.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Su(t.g,"keyChanged",{key:e},t.s).then(function(){}).o(function(){}):Ce()}function ju(t){return Cu(t).then(function(t){var e=Du(Lu(t,!1));return e.getAll?xu(e.getAll()):new Ee(function(t,n){var i=[],r=e.openCursor();r.onsuccess=function(e){(e=e.target.result)?(i.push(e.value),e.continue()):t(i)},r.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},i=[];if(0==t.b){for(i=0;i<e.length;i++)n[e[i].fbase_key]=e[i].value;i=function t(e,n){var i,r=[];for(i in e)i in n?typeof e[i]!=typeof n[i]?r.push(i):"object"==typeof e[i]&&null!=e[i]&&null!=n[i]?0<t(e[i],n[i]).length&&r.push(i):e[i]!==n[i]&&r.push(i):r.push(i);for(i in n)i in e||r.push(i);return r}(t.c,n),t.c=n}return i})}function Uu(t){t.l&&t.l.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Vu(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Ce().then(function(){if(Pu()){var t=Vi(),i="__sak"+t;return Iu||(Iu=new _u),(n=Iu).set(i,t).then(function(){return n.get(i)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.U(i)}).then(function(){return n}).o(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.ca(function(t){B(e.a,function(e){e(t)})}),t})}function Fu(){this.a={},this.type="inMemory"}function qu(){if(!function(){var t="Node"==Ti();if(!(t=Ku()||t&&e.default.INTERNAL.node&&e.default.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(n){return!1}}()){if("Node"==Ti())throw new N("internal-error","The LocalStorage compatibility library was not found.");throw new N("web-storage-unsupported")}this.a=Ku()||e.default.INTERNAL.node.localStorage,this.type="localStorage"}function Ku(){try{var t=u.localStorage,e=Vi();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(n){return null}}function Hu(){this.type="nullStorage"}function Gu(){if(!function(){var t="Node"==Ti();if(!(t=Bu()||t&&e.default.INTERNAL.node&&e.default.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(n){return!1}}()){if("Node"==Ti())throw new N("internal-error","The SessionStorage compatibility library was not found.");throw new N("web-storage-unsupported")}this.a=Bu()||e.default.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Bu(){try{var t=u.sessionStorage,e=Vi();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(n){return null}}function Wu(){var t={};t.Browser=Yu,t.Node=zu,t.ReactNative=$u,t.Worker=Zu,this.a=t[Ti()]}wu.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,i=this.a[e];if(i&&0<i.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var r=[];B(i,function(e){r.push(Ce().then(function(){return e(t.origin,t.data.data)}))}),De(r).then(function(i){var r=[];B(i,function(t){r.push({fulfilled:t.Qb,value:t.value,reason:t.reason?t.reason.message:void 0})}),B(r,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:r})})}},Au.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},ku.prototype.close=function(){for(;0<this.a.length;)Nu(this,this.a[0]);this.b=!0},(n=_u.prototype).set=function(t,e){var n=this,i=!1;return Ru(this,function(e){return xu((e=Du(Lu(e,!0))).get(t))}).then(function(r){return Ru(n,function(o){if(o=Du(Lu(o,!0)),r)return r.value=e,xu(o.put(r));n.b++,i=!0;var a={};return a.fbase_key=t,a.value=e,xu(o.add(a))})}).then(function(){return n.c[t]=e,Mu(n,t)}).oa(function(){i&&n.b--})},n.get=function(t){return Ru(this,function(e){return xu(Du(Lu(e,!1)).get(t))}).then(function(t){return t&&t.value})},n.U=function(t){var e=this,n=!1;return Ru(this,function(i){return n=!0,e.b++,xu(Du(Lu(i,!0)).delete(t))}).then(function(){return delete e.c[t],Mu(e,t)}).oa(function(){n&&e.b--})},n.ca=function(t){0==this.a.length&&function(t){Uu(t),function e(){t.f=setTimeout(function(){t.l=ju(t).then(function(e){0<e.length&&B(t.a,function(t){t(e)})}).then(function(){e()}).o(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},n.ia=function(t){$(this.a,function(e){return e==t}),0==this.a.length&&Uu(this)},(n=Vu.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},n.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},n.U=function(t){return this.b.then(function(e){return e.U(t)})},n.ca=function(t){this.a.push(t)},n.ia=function(t){$(this.a,function(e){return e==t})},(n=Fu.prototype).get=function(t){return Ce(this.a[t])},n.set=function(t,e){return this.a[t]=e,Ce()},n.U=function(t){return delete this.a[t],Ce()},n.ca=function(){},n.ia=function(){},(n=qu.prototype).get=function(t){var e=this;return Ce().then(function(){return Ui(e.a.getItem(t))})},n.set=function(t,e){var n=this;return Ce().then(function(){var i=Mi(e);null===i?n.U(t):n.a.setItem(t,i)})},n.U=function(t){var e=this;return Ce().then(function(){e.a.removeItem(t)})},n.ca=function(t){u.window&&ln(u.window,"storage",t)},n.ia=function(t){u.window&&pn(u.window,"storage",t)},(n=Hu.prototype).get=function(){return Ce(null)},n.set=function(){return Ce()},n.U=function(){return Ce()},n.ca=function(){},n.ia=function(){},(n=Gu.prototype).get=function(t){var e=this;return Ce().then(function(){return Ui(e.a.getItem(t))})},n.set=function(t,e){var n=this;return Ce().then(function(){var i=Mi(e);null===i?n.U(t):n.a.setItem(t,i)})},n.U=function(t){var e=this;return Ce().then(function(){e.a.removeItem(t)})},n.ca=function(){},n.ia=function(){};var Xu,Ju,Yu={F:qu,cb:Gu},zu={F:qu,cb:Gu},$u={F:yu,cb:Hu},Zu={F:qu,cb:Hu},Qu={rd:"local",NONE:"none",td:"session"};function tc(){var t=!(Fi(Oi())||!wi()),e=xi(),n=Ri();this.m=t,this.h=e,this.l=n,this.a={},Xu||(Xu=new Wu),t=Xu;try{this.g=!hi()&&Bi()||!u.indexedDB?new t.a.F:new Vu(Ii()?new Fu:new t.a.F)}catch(i){this.g=new Fu,this.h=!0}try{this.i=new t.a.cb}catch(i){this.i=new Fu}this.v=new Fu,this.f=T(this.Zb,this),this.b={}}function ec(){return Ju||(Ju=new tc),Ju}function nc(t,e){switch(e){case"session":return t.i;case"none":return t.v;default:return t.g}}function ic(t,e){return"firebase:"+t.name+(e?":"+e:"")}function rc(t,e,n){return n=ic(e,n),"local"==e.F&&(t.b[n]=null),nc(t,e.F).U(n)}function oc(t){t.c&&(clearInterval(t.c),t.c=null)}function ac(t){this.a=t,this.b=ec()}(n=tc.prototype).get=function(t,e){return nc(this,t.F).get(ic(t,e))},n.set=function(t,e,n){var i=ic(t,n),r=this,o=nc(this,t.F);return o.set(i,e).then(function(){return o.get(i)}).then(function(e){"local"==t.F&&(r.b[i]=e)})},n.addListener=function(t,e,n){t=ic(t,e),this.l&&(this.b[t]=u.localStorage.getItem(t)),vt(this.a)&&(nc(this,"local").ca(this.f),this.h||(hi()||!Bi())&&u.indexedDB||!this.l||function(t){oc(t),t.c=setInterval(function(){for(var e in t.a){var n=u.localStorage.getItem(e),i=t.b[e];n!=i&&(t.b[e]=n,n=new Qe({type:"storage",key:e,target:window,oldValue:i,newValue:n,a:!0}),t.Zb(n))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},n.removeListener=function(t,e,n){t=ic(t,e),this.a[t]&&($(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),vt(this.a)&&(nc(this,"local").ia(this.f),oc(this))},n.Zb=function(t){if(t&&t.g){var e=t.a.key;if(null==e)for(var n in this.a){var i=this.b[n];void 0===i&&(i=null);var r=u.localStorage.getItem(n);r!==i&&(this.b[n]=r,this.nb(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?nc(this,"local").ia(this.f):oc(this),this.m)if(n=u.localStorage.getItem(e),(i=t.a.newValue)!==n)null!==i?u.localStorage.setItem(e,i):u.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===u.localStorage.getItem(e)||(o.b[e]=u.localStorage.getItem(e),o.nb(e))},zt&&ce&&10==ce&&u.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else B(t,T(this.nb,this))},n.nb=function(t){this.a[t]&&B(this.a[t],function(t){t()})};var sc,uc={name:"authEvent",F:"local"};function cc(){this.a=ec()}function hc(t,e){this.b=lc,this.f=u.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=u.Int32Array?new Int32Array(64):Array(64),void 0===sc&&(sc=u.Int32Array?new Int32Array(bc):bc),this.reset()}k(hc,function(){this.b=-1});for(var lc=64,fc=lc-1,dc=[],pc=0;pc<fc;pc++)dc[pc]=0;var vc=Z(128,dc);function mc(t){for(var e=t.f,n=t.l,i=0,r=0;r<e.length;)n[i++]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],r=4*i;for(e=16;64>e;e++){r=0|n[e-15],i=0|n[e-2];var o=(0|n[e-16])+((r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3)|0,a=(0|n[e-7])+((i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10)|0;n[e]=o+a|0}i=0|t.a[0],r=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&r^i&s^r&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|sc[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=r,r=i,i=a+f|0}t.a[0]=t.a[0]+i|0,t.a[1]=t.a[1]+r|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function gc(t,e,n){void 0===n&&(n=e.length);var i=0,r=t.c;if("string"==typeof e)for(;i<n;)t.f[r++]=e.charCodeAt(i++),r==t.b&&(mc(t),r=0);else{if(!p(e))throw Error("message must be string or array");for(;i<n;){var o=e[i++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[r++]=o,r==t.b&&(mc(t),r=0)}}t.c=r,t.g+=n}hc.prototype.reset=function(){this.g=this.c=0,this.a=u.Int32Array?new Int32Array(this.h):Q(this.h)};var bc=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function yc(){hc.call(this,8,wc)}k(yc,hc);var wc=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Ic(t,e,n,i,r,o){this.v=t,this.i=e,this.l=n,this.m=i||null,this.u=r||null,this.s=o,this.h=e+":"+n,this.C=new cc,this.g=new ac(this.h),this.f=null,this.b=[],this.a=this.c=null}function Tc(t){return new N("invalid-cordova-configuration",t)}function Ec(t){var e=new yc;gc(e,t),t=[];var n=8*e.g;56>e.c?gc(e,vc,56-e.c):gc(e,vc,e.b-(e.c-56));for(var i=63;56<=i;i--)e.f[i]=255&n,n/=256;for(mc(e),i=n=0;i<e.i;i++)for(var r=24;0<=r;r-=8)t[n++]=e.a[i]>>r&255;return function(t){return X(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Ac(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(i){}}function kc(t){return t.f||(t.f=t.ma().then(function(){return new Ee(function(e){t.Ea(function n(i){return e(i),t.Ta(n),!1}),function(t){function e(e){i=!0,r&&r.cancel(),Sc(t).then(function(i){var r=n;if(i&&e&&e.url){var o=null;-1!=(r=oo(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Ui(Fn(o=qn(r),"firebaseError")||null))?_(o):null)?new qo(i.c,i.b,null,null,o,null,i.T()):new qo(i.c,i.b,r,i.f,null,null,i.T())),r=o||n}Ac(t,r)})}var n=new qo("unknown",null,null,null,new N("no-auth-event")),i=!1,r=_n(500).then(function(){return Sc(t).then(function(){i||Ac(t,n)})}),o=u.handleOpenURL;u.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(Ci("BuildInfo.packageName",u).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(n){console.error(n)}},Bo||(Bo=new Ho),function(t){var e=Bo;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=Ci("universalLinks.subscribe",u))&&t(null,e.b))}(e)}(t)})})),t.f}function Sc(t){var e=null;return function(t){return t.b.get(uc,t.a).then(function(t){return Ko(t)})}(t.g).then(function(n){return e=n,rc((n=t.g).b,uc,n.a)}).then(function(){return e})}function Nc(t){this.a=t,this.b=ec()}(n=Ic.prototype).ma=function(){return this.Ia?this.Ia:this.Ia=(yi(void 0)?bi().then(function(){return new Ee(function(t,e){var n=u.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):Re(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof Ci("universalLinks.subscribe",u))throw Tc("cordova-universal-links-plugin-fix is not installed");if(void 0===Ci("BuildInfo.packageName",u))throw Tc("cordova-plugin-buildinfo is not installed");if("function"!=typeof Ci("cordova.plugins.browsertab.openUrl",u))throw Tc("cordova-plugin-browsertab is not installed");if("function"!=typeof Ci("cordova.InAppBrowser.open",u))throw Tc("cordova-plugin-inappbrowser is not installed")},function(){throw new N("cordova-not-ready")})},n.Pb=function(t,e){return e(new N("operation-not-supported-in-this-environment")),Ce()},n.Nb=function(){return Re(new N("operation-not-supported-in-this-environment"))},n.ac=function(){return!1},n.Yb=function(){return!0},n.Ub=function(){return!0},n.Ob=function(t,e,n,i){if(this.c)return Re(new N("redirect-operation-pending"));var r=this,o=u.document,a=null,s=null,c=null,h=null;return this.c=Ce().then(function(){return Fo(e),kc(r)}).then(function(){return function(t,e,n,i,r){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new qo(e,i,null,o,new N("no-auth-event"),null,r),s=Ci("BuildInfo.packageName",u);if("string"!=typeof s)throw new N("invalid-cordova-configuration");var c=Ci("BuildInfo.displayName",u),h={};if(Oi().toLowerCase().match(/iphone|ipad|ipod/))h.ibi=s;else{if(!Oi().toLowerCase().match(/android/))return Re(new N("operation-not-supported-in-this-environment"));h.apn=s}c&&(h.appDisplayName=c),o=Ec(o),h.sessionId=o;var l=bu(t.v,t.i,t.l,e,n,null,i,t.m,h,t.u,r,t.s);return t.ma().then(function(){var e=t.h;return t.C.a.set(uc,a.w(),e)}).then(function(){var e=Ci("cordova.plugins.browsertab.isAvailable",u);if("function"!=typeof e)throw new N("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=Ci("cordova.plugins.browsertab.openUrl",u)))throw new N("invalid-cordova-configuration");n(l)}else{if("function"!=typeof(n=Ci("cordova.InAppBrowser.open",u)))throw new N("invalid-cordova-configuration");e=Oi(),t.a=n(l,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n,i)}).then(function(){return new Ee(function(t,e){s=function(){var e=Ci("cordova.plugins.browsertab.close",u);return t(),"function"==typeof e&&e(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.Ea(s),c=function(){a||(a=_n(2e3).then(function(){e(new N("redirect-cancelled-by-user"))}))},h=function(){Hi()&&c()},o.addEventListener("resume",c,!1),Oi().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",h,!1)}).o(function(t){return Sc(r).then(function(){throw t})})}).oa(function(){c&&o.removeEventListener("resume",c,!1),h&&o.removeEventListener("visibilitychange",h,!1),a&&a.cancel(),s&&r.Ta(s),r.c=null})},n.Ea=function(t){this.b.push(t),kc(this).o(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new qo("unknown",null,null,null,new N("no-auth-event")),t(e))})},n.Ta=function(t){$(this.b,function(e){return e==t})};var _c={name:"pendingRedirect",F:"session"};function Oc(t){return rc(t.b,_c,t.a)}function Cc(t,e,n,i){this.i={},this.u=0,this.D=t,this.v=e,this.m=n,this.J=i,this.h=[],this.f=!1,this.l=T(this.s,this),this.b=new Bc,this.C=new zc,this.g=new Nc(Hc(this.v,this.m)),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.C,this.c.linkViaPopup=this.C,this.c.reauthViaPopup=this.C,this.a=Rc(this.D,this.v,this.m,O,this.J)}function Rc(t,n,i,r,o){var a=e.default.SDK_VERSION||null;return yi()?new Ic(t,n,i,a,r,o):new pu(t,n,i,a,r,o)}function Pc(t){t.f||(t.f=!0,t.a.Ea(t.l));var e=t.a;return t.a.ma().o(function(n){throw t.a==e&&t.reset(),n})}function Dc(t){t.a.Yb()&&Pc(t).o(function(e){var n=new qo("unknown",null,null,null,new N("operation-not-supported-in-this-environment"));Vc(e)&&t.s(n)}),t.a.Ub()||Wc(t.b)}function Lc(t,e){Y(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(_c,t.a).then(function(t){return"pending"==t})}(t.g).then(function(e){e?Oc(t.g).then(function(){Pc(t).o(function(e){var n=new qo("unknown",null,null,null,new N("operation-not-supported-in-this-environment"));Vc(e)&&t.s(n)})}):Dc(t)}).o(function(){Dc(t)})}function xc(t,e){$(t.h,function(t){return t==e})}Cc.prototype.reset=function(){this.f=!1,this.a.Ta(this.l),this.a=Rc(this.D,this.v,this.m,null,this.J),this.i={}},Cc.prototype.s=function(t){if(!t)throw new N("invalid-auth-event");if(6e5<=Date.now()-this.u&&(this.i={},this.u=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var i=this.h[n];if(i.Gb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,i),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.u=Date.now())),e=!0;break}}return Wc(this.b),e};var Mc=new Ki(2e3,1e4),jc=new Ki(3e4,6e4);function Uc(t,e,n,i,r,o,a){return t.a.Nb(e,n,i,function(){t.f||(t.f=!0,t.a.Ea(t.l))},function(){t.reset()},r,o,a)}function Vc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function Fc(t,e,n,i,r){var o;return function(t){return t.b.set(_c,"pending",t.a)}(t.g).then(function(){return t.a.Ob(e,n,i,r).o(function(e){if(Vc(e))throw new N("operation-not-supported-in-this-environment");return o=e,Oc(t.g).then(function(){throw o})}).then(function(){return t.a.ac()?new Ee(function(){}):Oc(t.g).then(function(){return t.ra()}).then(function(){}).o(function(){})})})}function qc(t,e,n,i,r){return t.a.Pb(i,function(t){e.na(n,null,t,r)},Mc.get())}Cc.prototype.ra=function(){return this.b.ra()};var Kc={};function Hc(t,e,n){return t=t+":"+e,n&&(t=t+":"+n.url),t}function Gc(t,e,n,i){var r=Hc(e,n,i);return Kc[r]||(Kc[r]=new Cc(t,e,n,i)),Kc[r]}function Bc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Wc(t){t.g||(t.g=!0,Yc(t,!1,null,null))}function Xc(t){t.g&&!t.i&&Yc(t,!1,null,null)}function Jc(t,e){if(t.b=function(){return Ce(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Yc(t,e,n,i){e?i?function(t,e){if(t.b=function(){return Re(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,i):Jc(t,n):Jc(t,{user:null}),t.f=[],t.c=[]}function zc(){}function $c(){this.jb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.jb},set:function(t){this.jb=t},enumerable:!1})}function Zc(t,e){this.a=e,zi(this,"verificationId",t)}function Qc(t,e,n,i){return new jo(t).gb(e,n).then(function(t){return new Zc(t,i)})}function th(t){var e=Br(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new N("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");$i(this,{token:t,expirationTime:Gi(1e3*e.exp),authTime:Gi(1e3*e.auth_time),issuedAtTime:Gi(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,signInSecondFactor:e.firebase&&e.firebase.sign_in_second_factor?e.firebase.sign_in_second_factor:null,claims:e})}function eh(t,e,n){var i=e&&e[ih];if(!i)throw new N("argument-error","Internal assert: Invalid MultiFactorResolver");this.a=t,this.f=mt(e),this.g=n,this.c=new ao(null,i),this.b=[];var r=this;B(e[nh]||[],function(t){(t=er(t))&&r.b.push(t)}),zi(this,"auth",this.a),zi(this,"session",this.c),zi(this,"hints",this.b)}Bc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Bc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,i=t.b,r=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!r&&!o),"unknown"!=n||r||o?t.a?(Yc(this,!0,null,t.a),Ce()):e.Fa(n,i)?function(t,e,n){n=n.Fa(e.c,e.b);var i=e.g,r=e.f,o=e.i,a=e.T(),s=!!e.c.match(/Redirect$/);n(i,r,a,o).then(function(e){Yc(t,s,e,null)}).o(function(e){Yc(t,s,null,e)})}(this,t,e):Re(new N("invalid-auth-event")):(Yc(this,!1,null,null),Ce())}else Re(new N("invalid-auth-event"))},Bc.prototype.ra=function(){var t=this;return new Ee(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new N("timeout");t.a&&t.a.cancel(),t.a=_n(jc.get()).then(function(){t.b||(t.g=!0,Yc(t,!0,null,e))})}(t))})},zc.prototype.h=function(t,e){if(t){var n=t.c,i=t.b;t.a?(e.na(t.c,null,t.a,t.b),Ce()):e.Fa(n,i)?function(t,e){var n=t.b,i=t.c;e.Fa(i,n)(t.g,t.f,t.T(),t.i).then(function(t){e.na(i,t,null,n)}).o(function(t){e.na(i,null,t,n)})}(t,e):Re(new N("invalid-auth-event"))}else Re(new N("invalid-auth-event"))},Zc.prototype.confirm=function(t){return t=Uo(this.verificationId,t),this.a(t)};var nh="mfaInfo",ih="mfaPendingCredential";function rh(t,e,n,i){N.call(this,"multi-factor-auth-required",i,e),this.b=new eh(t,e,n),zi(this,"resolver",this.b)}function oh(t,e,n){if(t&&m(t.serverResponse)&&"auth/multi-factor-auth-required"===t.code)try{return new rh(e,t.serverResponse,n,t.message)}catch(i){}return null}function ah(){}function sh(t){zi(this,"factorId",t.fa),this.a=t}function uh(t){if(sh.call(this,t),this.a.fa!=jo.PROVIDER_ID)throw new N("argument-error","firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential")}function ch(t,e){for(var n in Ze.call(this,t),e)this[n]=e[n]}function hh(t,e){this.a=t,this.b=[],this.c=T(this.yc,this),ln(this.a,"userReloaded",this.c);var n=[];e&&e.multiFactor&&e.multiFactor.enrolledFactors&&B(e.multiFactor.enrolledFactors,function(t){var e=null,i={};if(t){t.uid&&(i[rr]=t.uid),t.displayName&&(i[nr]=t.displayName),t.enrollmentTime&&(i[ir]=new Date(t.enrollmentTime).toISOString()),t.phoneNumber&&(i[or]=t.phoneNumber);try{e=new ar(i)}catch(r){}t=e}else t=null;t&&n.push(t)}),lh(this,n)}function lh(t,e){t.b=e,zi(t,"enrolledFactors",e)}function fh(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function dh(t){this.f=t,this.b=this.a=null,this.c=Date.now()}function ph(t,e){void 0===e&&(t.b?e=(e=t.b).a-e.g:e=0),t.c=Date.now()+1e3*e}function vh(t,e){t.b=Gr(e[Za]||""),t.a=e.refreshToken,ph(t,void 0!==(e=e.expiresIn)?Number(e):void 0)}function mh(t,e){return function(t,e){return new Ee(function(n,i){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?ss(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?i(ou(t)):t.access_token&&t.refresh_token?n(t):i(new N("internal-error")):i(new N("network-request-failed"))},"POST",Qn(e).toString(),t.g,t.m.get()):i(new N("internal-error"))})}(t.f,e).then(function(e){return t.b=Gr(e.access_token),t.a=e.refresh_token,ph(t,e.expires_in),{accessToken:t.b.toString(),refreshToken:t.a}}).o(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}function gh(t,e){this.a=t||null,this.b=e||null,$i(this,{lastSignInTime:Gi(e||null),creationTime:Gi(t||null)})}function bh(t,e,n,i,r,o){$i(this,{uid:t,displayName:i||null,photoURL:r||null,email:n||null,phoneNumber:o||null,providerId:e})}function yh(t,n,i){this.N=[],this.l=t.apiKey,this.m=t.appName,this.s=t.authDomain||null;var r=e.default.SDK_VERSION?_i(e.default.SDK_VERSION):null;this.a=new za(this.l,D(O),r),(this.u=t.emulatorConfig||null)&&rs(this.a,this.u),this.h=new dh(this.a),_h(this,n[Za]),vh(this.h,n),zi(this,"refreshToken",this.h.a),Rh(this,i||{}),En.call(this),this.P=!1,this.s&&Pi()&&(this.b=Gc(this.s,this.l,this.m,this.u)),this.W=[],this.i=null,this.D=function(t){return new fh(function(){return t.I(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.h.c-Date.now()-3e5;return 0<e?e:0})}(this),this.ba=T(this.ib,this);var o=this;this.za=null,this.Pa=function(t){o.xa(t.h)},this.qa=null,this.Ba=function(t){wh(o,t.c)},this.$=null,this.aa=[],this.Oa=function(t){Eh(o,t.f)},this.ja=null,this.S=new hh(this,i),zi(this,"multiFactor",this.S)}function wh(t,e){t.u=e,rs(t.a,e),t.b&&(e=t.b,t.b=Gc(t.s,t.l,t.m,t.u),t.P&&(xc(e,t),Lc(t.b,t)))}function Ih(t,e){t.qa&&pn(t.qa,"languageCodeChanged",t.Pa),(t.qa=e)&&ln(e,"languageCodeChanged",t.Pa)}function Th(t,e){t.$&&pn(t.$,"emulatorConfigChanged",t.Ba),(t.$=e)&&ln(e,"emulatorConfigChanged",t.Ba)}function Eh(t,n){t.aa=n,as(t.a,e.default.SDK_VERSION?_i(e.default.SDK_VERSION,t.aa):null)}function Ah(t,e){t.ja&&pn(t.ja,"frameworkChanged",t.Oa),(t.ja=e)&&ln(e,"frameworkChanged",t.Oa)}function kh(t){try{return e.default.app(t.m).auth()}catch(n){throw new N("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function Sh(t){t.J||t.D.b||(t.D.start(),pn(t,"tokenChanged",t.ba),ln(t,"tokenChanged",t.ba))}function Nh(t){pn(t,"tokenChanged",t.ba),t.D.stop()}function _h(t,e){t.Aa=e,zi(t,"_lat",e)}function Oh(t){for(var e=[],n=0;n<t.W.length;n++)e.push(t.W[n](t));return De(e).then(function(){return t})}function Ch(t){t.b&&!t.P&&(t.P=!0,Lc(t.b,t))}function Rh(t,e){$i(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new gh(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Ph(){}function Dh(t){return Ce().then(function(){if(t.J)throw new N("app-deleted")})}function Lh(t){return X(t.providerData,function(t){return t.providerId})}function xh(t,e){e&&(Mh(t,e.providerId),t.providerData.push(e))}function Mh(t,e){$(t.providerData,function(t){return t.providerId==e})}function jh(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&zi(t,e,n)}function Uh(t,e){t!=e&&($i(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),e.metadata?zi(t,"metadata",function(t){return new gh(t.a,t.b)}(e.metadata)):zi(t,"metadata",new gh),B(e.providerData,function(e){xh(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.h,e.h),zi(t,"refreshToken",t.h.a),lh(t.S,e.S.b))}function Vh(t){return t.I().then(function(e){var n=t.isAnonymous;return function(t,e){return iu(t.a,Ls,{idToken:e}).then(T(t.Kc,t))}(t,e).then(function(){return n||jh(t,"isAnonymous",!1),e})})}function Fh(t,e){e[Za]&&t.Aa!=e[Za]&&(vh(t.h,e),t.dispatchEvent(new ch("tokenChanged")),_h(t,e[Za]),jh(t,"refreshToken",t.h.a))}function qh(t,e){return Vh(t).then(function(){if(Y(Lh(t),e))return Oh(t).then(function(){throw new N("provider-already-linked")})})}function Kh(t,e,n){return Zi({user:t,credential:Vo(e),additionalUserInfo:e=zr(e),operationType:n})}function Hh(t,e){return Fh(t,e),t.reload().then(function(){return t})}function Gh(t,n,i,r,o){if(!Pi())return Re(new N("operation-not-supported-in-this-environment"));if(t.i&&!o)return Re(t.i);var a=Yr(i.providerId),s=Vi(t.uid+":::"),u=null;(!xi()||wi())&&t.s&&i.isOAuthProvider&&(u=bu(t.s,t.l,t.m,n,i,null,s,e.default.SDK_VERSION||null,null,null,t.tenantId,t.u));var c=vi(u,a&&a.va,a&&a.ua);return r=r().then(function(){if(Wh(t),!o)return t.I().then(function(){})}).then(function(){return Uc(t.b,c,n,i,s,!!u,t.tenantId)}).then(function(){return new Ee(function(e,i){t.na(n,null,new N("cancelled-popup-request"),t.g||null),t.f=e,t.C=i,t.g=s,t.c=qc(t.b,t,n,c,s)})}).then(function(t){return c&&pi(c),t?Zi(t):null}).o(function(t){throw c&&pi(c),t}),Xh(t,r,o)}function Bh(t,e,n,i,r){if(!Pi())return Re(new N("operation-not-supported-in-this-environment"));if(t.i&&!r)return Re(t.i);var o=null,a=Vi(t.uid+":::");return i=i().then(function(){if(Wh(t),!r)return t.I().then(function(){})}).then(function(){return t.ga=a,Oh(t)}).then(function(e){return t.ha&&(e=(e=t.ha).b.set(zh,t.w(),e.a)),e}).then(function(){return Fc(t.b,e,n,a,t.tenantId)}).o(function(e){if(o=e,t.ha)return $h(t.ha);throw o}).then(function(){if(o)throw o}),Xh(t,i,r)}function Wh(t){if(!t.b||!t.P){if(t.b&&!t.P)throw new N("internal-error");throw new N("auth-domain-config-required")}}function Xh(t,e,n){var i=function(t,e,n){return t.i&&!n?(e.cancel(),Re(t.i)):e.o(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.i||t.dispatchEvent(new ch("userInvalidated")),t.i=e),e})}(t,e,n);return t.N.push(i),i.oa(function(){z(t.N,i)}),i.o(function(e){var n=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(n=oh(e.w(),kh(t),T(t.jc,t))),n||e})}function Jh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName,emulatorConfig:t.emulatorConfig},n={};if(!t.stsTokenManager||!t.stsTokenManager.accessToken)return null;n[Za]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null;var i=t.stsTokenManager.expirationTime;i&&(n.expiresIn=(i-Date.now())/1e3);var r=new yh(e,n,t);return t.providerData&&B(t.providerData,function(t){t&&xh(r,Zi(t))}),t.redirectEventId&&(r.ga=t.redirectEventId),r}function Yh(t){this.a=t,this.b=ec()}eh.prototype.Rc=function(t){var e=this;return t.tb(this.a.a,this.c).then(function(t){var n=mt(e.f);return delete n[nh],delete n[ih],bt(n,t),e.g(n)})},k(rh,N),ah.prototype.tb=function(t,e,n){return e.type==so?function(t,e,n,i){return n.Ha().then(function(n){return n={idToken:n},void 0!==i&&(n.displayName=i),bt(n,{phoneVerificationInfo:Mo(t.a)}),iu(e,Ps,n)})}(this,t,e,n):function(t,e,n){return n.Ha().then(function(n){return bt(n={mfaPendingCredential:n},{phoneVerificationInfo:Mo(t.a)}),iu(e,Ds,n)})}(this,t,e)},k(sh,ah),k(uh,sh),k(ch,Ze),(n=hh.prototype).yc=function(t){lh(this,function(t){var e=[];return B(t.mfaInfo||[],function(t){(t=er(t))&&e.push(t)}),e}(t.hd))},n.Sb=function(){return this.a.I().then(function(t){return new ao(t,null)})},n.fc=function(t,e){var n=this,i=this.a.a;return this.Sb().then(function(n){return t.tb(i,n,e)}).then(function(t){return Fh(n.a,t),n.a.reload()})},n.bd=function(t){var e=this,n="string"==typeof t?t:t.uid,i=this.a.a;return this.a.I().then(function(t){return iu(i,nu,{idToken:t,mfaEnrollmentId:n})}).then(function(t){var i=W(e.b,function(t){return t.uid!=n});return lh(e,i),Fh(e.a,t),e.a.reload().o(function(t){if("auth/user-token-expired"!=t.code)throw t})})},n.w=function(){return{multiFactor:{enrolledFactors:X(this.b,function(t){return t.w()})}}},fh.prototype.start=function(){this.a=this.c,function t(e,n){e.stop();e.b=_n(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then(function(){return t=u.document,e=null,Hi()||!t?Ce():new Ee(function(n){e=function(){Hi()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).o(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).o(function(n){e.i(n)&&t(e,!1)})}(this,!0)},fh.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},dh.prototype.w=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b&&this.b.toString(),expirationTime:this.c}},dh.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Re(new N("user-token-expired")):t||!this.b||Date.now()>this.c-3e4?this.a?mh(this,{grant_type:"refresh_token",refresh_token:this.a}):Ce(null):Ce({accessToken:this.b.toString(),refreshToken:this.a})},gh.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},k(yh,En),yh.prototype.xa=function(t){this.za=t,is(this.a,t)},yh.prototype.la=function(){return this.za},yh.prototype.Ga=function(){return Q(this.aa)},yh.prototype.ib=function(){this.D.b&&(this.D.stop(),this.D.start())},zi(yh.prototype,"providerId","firebase"),(n=yh.prototype).reload=function(){var t=this;return Xh(this,Dh(this).then(function(){return Vh(t).then(function(){return Oh(t)}).then(Ph)}))},n.oc=function(t){return this.I(t).then(function(t){return new th(t)})},n.I=function(t){var e=this;return Xh(this,Dh(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new N("internal-error");return t.accessToken!=e.Aa&&(_h(e,t.accessToken),e.dispatchEvent(new ch("tokenChanged"))),jh(e,"refreshToken",t.refreshToken),t.accessToken}))},n.Kc=function(t){if(!(t=t.users)||!t.length)throw new N("internal-error");Rh(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?X(t,function(t){return new bh(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)xh(this,e[n]);jh(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length)),this.dispatchEvent(new ch("userReloaded",{hd:t}))},n.Lc=function(t){return Ji("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.ub(t)},n.ub=function(t){var e=this,n=null;return Xh(this,t.c(this.a,this.uid).then(function(t){return Fh(e,t),n=Kh(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},n.Cc=function(t){return Ji("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.rb(t)},n.rb=function(t){var e=this,n=null;return Xh(this,qh(this,t.providerId).then(function(){return e.I()}).then(function(n){return t.b(e.a,n)}).then(function(t){return n=Kh(e,t,"link"),Hh(e,t)}).then(function(){return n}))},n.Dc=function(t,e){var n=this;return Xh(this,qh(this,"phone").then(function(){return Qc(kh(n),t,e,T(n.rb,n))}))},n.Mc=function(t,e){var n=this;return Xh(this,Ce().then(function(){return Qc(kh(n),t,e,T(n.ub,n))}),!0)},n.Cb=function(t){var e=this;return Xh(this,this.I().then(function(n){return e.a.Cb(n,t)}).then(function(t){return Fh(e,t),e.reload()}))},n.ed=function(t){var e=this;return Xh(this,this.I().then(function(n){return t.b(e.a,n)}).then(function(t){return Fh(e,t),e.reload()}))},n.Db=function(t){var e=this;return Xh(this,this.I().then(function(n){return e.a.Db(n,t)}).then(function(t){return Fh(e,t),e.reload()}))},n.Eb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Dh(this);var e=this;return Xh(this,this.I().then(function(n){return e.a.Eb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Fh(e,t),jh(e,"displayName",t.displayName||null),jh(e,"photoURL",t.photoUrl||null),B(e.providerData,function(t){"password"===t.providerId&&(zi(t,"displayName",e.displayName),zi(t,"photoURL",e.photoURL))}),Oh(e)}).then(Ph))},n.cd=function(t){var e=this;return Xh(this,Vh(this).then(function(n){return Y(Lh(e),t)?function(t,e,n){return iu(t,Os,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then(function(t){var n={};return B(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),B(Lh(e),function(t){n[t]||Mh(e,t)}),n[jo.PROVIDER_ID]||zi(e,"phoneNumber",null),Oh(e)}):Oh(e).then(function(){throw new N("no-such-provider")})}))},n.delete=function(){var t=this;return Xh(this,this.I().then(function(e){return iu(t.a,_s,{idToken:e})}).then(function(){t.dispatchEvent(new ch("userDeleted"))})).then(function(){for(var e=0;e<t.N.length;e++)t.N[e].cancel("app-deleted");Ih(t,null),Th(t,null),Ah(t,null),t.N=[],t.J=!0,Nh(t),zi(t,"refreshToken",null),t.b&&xc(t.b,t)})},n.Gb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ga||null)==e||"reauthViaRedirect"==t&&(this.ga||null)==e)},n.na=function(t,e,n,i){"linkViaPopup"!=t&&"reauthViaPopup"!=t||i!=(this.g||null)||(n&&this.C?this.C(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.C)},n.Fa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?T(this.Lb,this):"reauthViaPopup"==t&&e==(this.g||null)?T(this.Mb,this):"linkViaRedirect"==t&&(this.ga||null)==e?T(this.Lb,this):"reauthViaRedirect"==t&&(this.ga||null)==e?T(this.Mb,this):null},n.Ec=function(t){var e=this;return Gh(this,"linkViaPopup",t,function(){return qh(e,t.providerId).then(function(){return Oh(e)})},!1)},n.Nc=function(t){return Gh(this,"reauthViaPopup",t,function(){return Ce()},!0)},n.Fc=function(t){var e=this;return Bh(this,"linkViaRedirect",t,function(){return qh(e,t.providerId)},!1)},n.Oc=function(t){return Bh(this,"reauthViaRedirect",t,function(){return Ce()},!0)},n.Lb=function(t,e,n,i){var r=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Xh(this,this.I().then(function(n){return Is(r.a,{requestUri:t,postBody:i,sessionId:e,idToken:n})}).then(function(t){return o=Kh(r,t,"link"),Hh(r,t)}).then(function(){return o}))},n.Mb=function(t,e,n,i){var r=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Xh(this,Ce().then(function(){return ho(Ts(r.a,{requestUri:t,sessionId:e,postBody:i,tenantId:n}),r.uid)}).then(function(t){return o=Kh(r,t,"reauthenticate"),Fh(r,t),r.i=null,r.reload()}).then(function(){return o}),!0)},n.vb=function(t){var e=this,n=null;return Xh(this,this.I().then(function(e){return n=e,void 0===t||vt(t)?{}:Fr(new Cr(t))}).then(function(t){return e.a.vb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},n.Fb=function(t,e){var n=this,i=null;return Xh(this,this.I().then(function(t){return i=t,void 0===e||vt(e)?{}:Fr(new Cr(e))}).then(function(e){return n.a.Fb(i,t,e)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},n.jc=function(t){var e=null,n=this;return Xh(this,t=ho(Ce(t),n.uid).then(function(t){return e=Kh(n,t,"reauthenticate"),Fh(n,t),n.i=null,n.reload()}).then(function(){return e}),!0)},n.toJSON=function(){return this.w()},n.w=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.s,stsTokenManager:this.h.w(),redirectEventId:this.ga||null};return this.metadata&&bt(t,this.metadata.w()),B(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),bt(t,this.S.w()),t};var zh={name:"redirectUser",F:"session"};function $h(t){return rc(t.b,zh,t.a)}function Zh(t){this.a=t,this.b=ec(),this.c=null,this.f=function(t){var e=el("local"),n=el("session"),i=el("none");return function(t,e,n){var i=ic(e,n),r=nc(t,e.F);return t.get(e,n).then(function(o){var a=null;try{a=Ui(u.localStorage.getItem(i))}catch(s){}if(a&&!o)return u.localStorage.removeItem(i),t.set(e,a,n);a&&o&&"localStorage"!=r.type&&u.localStorage.removeItem(i)})}(t.b,e,t.a).then(function(){return t.b.get(n,t.a)}).then(function(r){return r?n:t.b.get(i,t.a).then(function(n){return n?i:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(tl,t.a).then(function(t){return t?el(t):e})})})}).then(function(e){return t.c=e,Qh(t,e.F)}).o(function(){t.c||(t.c=e)})}(this),this.b.addListener(el("local"),this.a,T(this.g,this))}function Qh(t,e){var n,i=[];for(n in Qu)Qu[n]!==e&&i.push(rc(t.b,el(Qu[n]),t.a));return i.push(rc(t.b,tl,t.a)),function(t){return new Ee(function(e,n){var i=t.length,r=[];if(i)for(var o=function(t,n){i--,r[t]=n,0==i&&e(r)},a=function(t){n(t)},s=0;s<t.length;s++)Pe(t[s],E(o,s),a);else e(r)})}(i)}Zh.prototype.g=function(){var t=this,e=el("local");ol(this,function(){return Ce().then(function(){return t.c&&"local"!=t.c.F?t.b.get(e,t.a):null}).then(function(n){if(n)return Qh(t,"local").then(function(){t.c=e})})})};var tl={name:"persistence",F:"session"};function el(t){return{name:"authUser",F:t}}function nl(t,e){return ol(t,function(){return t.b.set(t.c,e.w(),t.a)})}function il(t){return ol(t,function(){return rc(t.b,t.c,t.a)})}function rl(t,e,n){return ol(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),t&&n&&(t.emulatorConfig=n),Jh(t||{})})})}function ol(t,e){return t.f=t.f.then(e,e),t.f}function al(t){if(this.l=!1,zi(this,"settings",new $c),zi(this,"app",t),!vl(this).options||!vl(this).options.apiKey)throw new N("invalid-api-key");t=e.default.SDK_VERSION?_i(e.default.SDK_VERSION):null,this.a=new za(vl(this).options&&vl(this).options.apiKey,D(O),t),this.P=[],this.s=[],this.N=[],this.Pa=e.default.INTERNAL.createSubscribe(T(this.zc,this)),this.W=void 0,this.ib=e.default.INTERNAL.createSubscribe(T(this.Ac,this)),dl(this,null),this.i=new Zh(vl(this).options.apiKey+":"+vl(this).name),this.D=new Yh(vl(this).options.apiKey+":"+vl(this).name),this.$=yl(this,function(t){var e=vl(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(zh,t.a).then(function(t){return t&&e&&(t.authDomain=e),Jh(t||{})})}(t.D,vl(t).options.authDomain).then(function(e){return(t.m=e)&&(e.ha=t.D),$h(t.D)});return yl(t,e)}(t).then(function(){return rl(t.i,e,t.R)}).then(function(e){return e?(e.ha=t.D,t.m&&(t.m.ga||null)==(e.ga||null)?e:e.reload().then(function(){return nl(t.i,e).then(function(){return e})}).o(function(n){return"auth/network-request-failed"==n.code?e:il(t.i)})):null}).then(function(e){dl(t,e||null)});return yl(t,n)}(this)),this.h=yl(this,function(t){return t.$.then(function(){return ll(t)}).o(function(){}).then(function(){if(!t.l)return t.ja()}).o(function(){}).then(function(){if(!t.l){t.ba=!0;var e=t.i;e.b.addListener(el("local"),e.a,t.ja)}})}(this)),this.ba=!1,this.ja=T(this.Zc,this),this.Ba=T(this.da,this),this.qa=T(this.mc,this),this.za=T(this.wc,this),this.Aa=T(this.xc,this),this.b=null,function(t){var e=vl(t).options.authDomain,n=vl(t).options.apiKey;e&&Pi()&&(t.Oa=t.$.then(function(){if(!t.l){if(t.b=Gc(e,n,vl(t).name,t.R),Lc(t.b,t),ml(t)&&Ch(ml(t)),t.m){Ch(t.m);var i=t.m;i.xa(t.la()),Ih(i,t),Eh(i=t.m,t.J),Ah(i,t),wh(i=t.m,t.R),Th(i,t),t.m=null}return t.b}}))}(this),this.INTERNAL={},this.INTERNAL.delete=T(this.delete,this),this.INTERNAL.logFramework=T(this.Gc,this),this.u=0,En.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.la()},set:function(t){this.xa(t)},enumerable:!1}),t.aa=null,Object.defineProperty(t,"ti",{get:function(){return this.T()},set:function(t){this.zb(t)},enumerable:!1}),t.S=null,Object.defineProperty(t,"emulatorConfig",{get:function(){if(this.R){var t=qn(this.R.url);t=Zi({protocol:t.c,host:t.a,port:t.g,options:Zi({disableWarnings:this.R.ec})})}else t=null;return t},enumerable:!1})}(this),this.J=[],this.R=null}function sl(t){Ze.call(this,"languageCodeChanged"),this.h=t}function ul(t){Ze.call(this,"emulatorConfigChanged"),this.c=t}function cl(t){Ze.call(this,"frameworkChanged"),this.f=t}function hl(t){return t.Oa||Re(new N("auth-domain-config-required"))}function ll(t){if(!Pi())return Re(new N("operation-not-supported-in-this-environment"));var e=hl(t).then(function(){return t.b.ra()}).then(function(t){return t?Zi(t):null});return yl(t,e)}function fl(t,e){var n={};return n.apiKey=vl(t).options.apiKey,n.authDomain=vl(t).options.authDomain,n.appName=vl(t).name,t.R&&(n.emulatorConfig=t.R),t.$.then(function(){return function(t,e,n,i){var r=new yh(t,e);return n&&(r.ha=n),i&&Eh(r,i),r.reload().then(function(){return r})}(n,e,t.D,t.Ga())}).then(function(e){return ml(t)&&e.uid==ml(t).uid?(Uh(ml(t),e),t.da(e)):(dl(t,e),Ch(e),t.da(e))}).then(function(){bl(t)})}function dl(t,e){ml(t)&&(function(t,e){$(t.W,function(t){return t==e})}(ml(t),t.Ba),pn(ml(t),"tokenChanged",t.qa),pn(ml(t),"userDeleted",t.za),pn(ml(t),"userInvalidated",t.Aa),Nh(ml(t))),e&&(e.W.push(t.Ba),ln(e,"tokenChanged",t.qa),ln(e,"userDeleted",t.za),ln(e,"userInvalidated",t.Aa),0<t.u&&Sh(e)),zi(t,"currentUser",e),e&&(e.xa(t.la()),Ih(e,t),Eh(e,t.J),Ah(e,t),wh(e,t.R),Th(e,t))}function pl(t,e){var n=null,i=null;return yl(t,e.then(function(e){return n=Vo(e),i=zr(e),fl(t,e)},function(e){var n=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(n=oh(e.w(),t,T(t.kc,t))),n||e}).then(function(){return Zi({user:ml(t),credential:n,additionalUserInfo:i,operationType:"signIn"})}))}function vl(t){return t.app}function ml(t){return t.currentUser}function gl(t){return ml(t)&&ml(t)._lat||null}function bl(t){if(t.ba){for(var e=0;e<t.s.length;e++)t.s[e]&&t.s[e](gl(t));if(t.W!==t.getUid()&&t.N.length)for(t.W=t.getUid(),e=0;e<t.N.length;e++)t.N[e]&&t.N[e](gl(t))}}function yl(t,e){return t.P.push(e),e.oa(function(){z(t.P,e)}),e}function wl(){}function Il(){this.a={},this.b=1e12}Zh.prototype.yb=function(t){var e=null,n=this;return function(t){var e=new N("invalid-persistence-type"),n=new N("unsupported-persistence-type");t:{for(i in Qu)if(Qu[i]==t){var i=!0;break t}i=!1}if(!i||"string"!=typeof t)throw e;switch(Ti()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;case"Worker":if("session"===t||!Pu()&&"none"!==t)throw n;break;default:if(!Ri()&&"none"!==t)throw n}}(t),ol(this,function(){return t!=n.c.F?n.b.get(n.c,n.a).then(function(i){return e=i,Qh(n,t)}).then(function(){if(n.c=el(t),e)return n.b.set(n.c,e,n.a)}):Ce()})},k(al,En),k(sl,Ze),k(ul,Ze),k(cl,Ze),(n=al.prototype).yb=function(t){return yl(this,t=this.i.yb(t))},n.xa=function(t){this.aa===t||this.l||(this.aa=t,is(this.a,this.aa),this.dispatchEvent(new sl(this.la())))},n.la=function(){return this.aa},n.fd=function(){var t=u.navigator;this.xa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},n.gd=function(t,e){if(!this.R){if(!/^https?:\/\//.test(t))throw new N("argument-error","Emulator URL must start with a valid scheme (http:// or https://).");(function(t){"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),u.document&&!t&&bi().then(function(){var t=u.document.createElement("div");t.innerText="Running in emulator mode. Do not use with production credentials.",t.style.position="fixed",t.style.width="100%",t.style.backgroundColor="#ffffff",t.style.border=".1em solid #000000",t.style.color="#b50000",t.style.bottom="0px",t.style.left="0px",t.style.margin="0px",t.style.zIndex=1e4,t.style.textAlign="center",t.classList.add("firebase-emulator-warning"),u.document.body.appendChild(t)})})(e=!!e&&!!e.disableWarnings),this.R={url:t,ec:e},this.settings.jb=!0,rs(this.a,this.R),this.dispatchEvent(new ul(this.R))}},n.Gc=function(t){this.J.push(t),as(this.a,e.default.SDK_VERSION?_i(e.default.SDK_VERSION,this.J):null),this.dispatchEvent(new cl(this.J))},n.Ga=function(){return Q(this.J)},n.zb=function(t){this.S===t||this.l||(this.S=t,this.a.b=this.S)},n.T=function(){return this.S},n.toJSON=function(){return{apiKey:vl(this).options.apiKey,authDomain:vl(this).options.authDomain,appName:vl(this).name,currentUser:ml(this)&&ml(this).w()}},n.Gb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},n.na=function(t,e,n,i){"signInViaPopup"==t&&this.g==i&&(n&&this.C?this.C(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.C)},n.Fa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?T(this.ic,this):null},n.ic=function(t,e,n,i){var r=this,o={requestUri:t,postBody:i,sessionId:e,tenantId:n};return this.c&&(this.c.cancel(),this.c=null),r.$.then(function(){return pl(r,ws(r.a,o))})},n.Xc=function(t){if(!Pi())return Re(new N("operation-not-supported-in-this-environment"));var n=this,i=Yr(t.providerId),r=Vi(),o=null;(!xi()||wi())&&vl(this).options.authDomain&&t.isOAuthProvider&&(o=bu(vl(this).options.authDomain,vl(this).options.apiKey,vl(this).name,"signInViaPopup",t,null,r,e.default.SDK_VERSION||null,null,null,this.T(),this.R));var a=vi(o,i&&i.va,i&&i.ua);return yl(this,i=hl(this).then(function(e){return Uc(e,a,"signInViaPopup",t,r,!!o,n.T())}).then(function(){return new Ee(function(t,e){n.na("signInViaPopup",null,new N("cancelled-popup-request"),n.g),n.f=t,n.C=e,n.g=r,n.c=qc(n.b,n,"signInViaPopup",a,r)})}).then(function(t){return a&&pi(a),t?Zi(t):null}).o(function(t){throw a&&pi(a),t}))},n.Yc=function(t){if(!Pi())return Re(new N("operation-not-supported-in-this-environment"));var e=this;return yl(this,hl(this).then(function(){return ol(t=e.i,function(){return t.b.set(tl,t.c.F,t.a)});var t}).then(function(){return Fc(e.b,"signInViaRedirect",t,void 0,e.T())}))},n.ra=function(){var t=this;return ll(this).then(function(e){return t.b&&Xc(t.b.b),e}).o(function(e){throw t.b&&Xc(t.b.b),e})},n.dd=function(t){if(!t)return Re(new N("null-user"));if(this.S!=t.tenantId)return Re(new N("tenant-id-mismatch"));var e=this,n={};n.apiKey=vl(this).options.apiKey,n.authDomain=vl(this).options.authDomain,n.appName=vl(this).name;var i=function(t,e,n,i){var r=t.h,o={};return o[Za]=r.b&&r.b.toString(),o.refreshToken=r.a,e=new yh(e||{apiKey:t.l,authDomain:t.s,appName:t.m},o),n&&(e.ha=n),i&&Eh(e,i),Uh(e,t),e}(t,n,e.D,e.Ga());return yl(this,this.h.then(function(){if(vl(e).options.apiKey!=t.l)return i.reload()}).then(function(){return ml(e)&&t.uid==ml(e).uid?(Uh(ml(e),t),e.da(t)):(dl(e,i),Ch(i),e.da(i))}).then(function(){bl(e)}))},n.Bb=function(){var t=this;return yl(this,this.h.then(function(){return t.b&&Xc(t.b.b),ml(t)?(dl(t,null),il(t.i).then(function(){bl(t)})):Ce()}))},n.Zc=function(){var t=this;return rl(this.i,vl(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=ml(t)&&e){n=ml(t).uid;var i=e.uid;n=null!=n&&""!==n&&null!=i&&""!==i&&n==i}if(n)return Uh(ml(t),e),ml(t).I();(ml(t)||e)&&(dl(t,e),e&&(Ch(e),e.ha=t.D),t.b&&Lc(t.b,t),bl(t))}})},n.da=function(t){return nl(this.i,t)},n.mc=function(){bl(this),this.da(ml(this))},n.wc=function(){this.Bb()},n.xc=function(){this.Bb()},n.kc=function(t){var e=this;return this.h.then(function(){return pl(e,Ce(t))})},n.zc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(ml(e))})},n.Ac=function(t){var e=this;!function(t,e){t.N.push(e),yl(t,t.h.then(function(){!t.l&&Y(t.N,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(gl(t)))}))}(this,function(){t.next(ml(e))})},n.Ic=function(t,e,n){var i=this;return this.ba&&Promise.resolve().then(function(){"function"==typeof t?t(ml(i)):"function"==typeof t.next&&t.next(ml(i))}),this.Pa(t,e,n)},n.Hc=function(t,e,n){var i=this;return this.ba&&Promise.resolve().then(function(){i.W=i.getUid(),"function"==typeof t?t(ml(i)):"function"==typeof t.next&&t.next(ml(i))}),this.ib(t,e,n)},n.nc=function(t){var e=this;return yl(this,this.h.then(function(){return ml(e)?ml(e).I(t).then(function(t){return{accessToken:t}}):null}))},n.Tc=function(t){var e=this;return this.h.then(function(){return pl(e,iu(e.a,$s,{token:t}))}).then(function(t){var n=t.user;return jh(n,"isAnonymous",!1),e.da(n),t})},n.Uc=function(t,e){var n=this;return this.h.then(function(){return pl(n,iu(n.a,Zs,{email:t,password:e}))})},n.dc=function(t,e){var n=this;return this.h.then(function(){return pl(n,iu(n.a,Ss,{email:t,password:e}))})},n.ab=function(t){var e=this;return this.h.then(function(){return pl(e,t.ka(e.a))})},n.Sc=function(t){return Ji("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.ab(t)},n.Ab=function(){var t=this;return this.h.then(function(){var e=ml(t);if(e&&e.isAnonymous){var n=Zi({providerId:null,isNewUser:!1});return Zi({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return pl(t,t.a.Ab()).then(function(e){var n=e.user;return jh(n,"isAnonymous",!0),t.da(n),e})})},n.getUid=function(){return ml(this)&&ml(this).uid||null},n.cc=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&ml(this)&&Sh(ml(this))},n.Pc=function(t){var e=this;B(this.s,function(n){n==t&&e.u--}),0>this.u&&(this.u=0),0==this.u&&ml(this)&&Nh(ml(this)),this.removeAuthTokenListener(t)},n.addAuthTokenListener=function(t){var e=this;this.s.push(t),yl(this,this.h.then(function(){e.l||Y(e.s,t)&&t(gl(e))}))},n.removeAuthTokenListener=function(t){$(this.s,function(e){return e==t})},n.delete=function(){this.l=!0;for(var t=0;t<this.P.length;t++)this.P[t].cancel("app-deleted");return this.P=[],this.i&&(t=this.i).b.removeListener(el("local"),t.a,this.ja),this.b&&(xc(this.b,this),Xc(this.b.b)),Promise.resolve()},n.hc=function(t){return yl(this,function(t,e){return iu(t,Ns,{identifier:e,continueUri:Di()?li():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.a,t))},n.Bc=function(t){return!!Do(t)},n.xb=function(t,e){var n=this;return yl(this,Ce().then(function(){var t=new Cr(e);if(!t.c)throw new N("argument-error",Dr+" must be true when sending sign in link to email");return Fr(t)}).then(function(e){return n.a.xb(t,e)}).then(function(){}))},n.jd=function(t){return this.Sa(t).then(function(t){return t.data.email})},n.ob=function(t,e){return yl(this,this.a.ob(t,e).then(function(){}))},n.Sa=function(t){return yl(this,this.a.Sa(t).then(function(t){return new sr(t)}))},n.kb=function(t){return yl(this,this.a.kb(t).then(function(){}))},n.wb=function(t,e){var n=this;return yl(this,Ce().then(function(){return void 0===e||vt(e)?{}:Fr(new Cr(e))}).then(function(e){return n.a.wb(t,e)}).then(function(){}))},n.Wc=function(t,e){return yl(this,Qc(this,t,e,T(this.ab,this)))},n.Vc=function(t,e){var n=this;return yl(this,Ce().then(function(){var i=e||li(),r=Po(t,i);if(!(i=Do(i)))throw new N("argument-error","Invalid email link!");if(i.tenantId!==n.T())throw new N("tenant-id-mismatch");return n.ab(r)}))},wl.prototype.render=function(){},wl.prototype.reset=function(){},wl.prototype.getResponse=function(){},wl.prototype.execute=function(){};var Tl=null;function El(t,e){return(e=Al(e))&&t.a[e]||null}function Al(t){return(t=void 0===t?1e12:t)?t.toString():null}function kl(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=le(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ln(this.f,"click",this.i)}function Sl(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Nl(){}function _l(){}Il.prototype.render=function(t,e){return this.a[this.b.toString()]=new kl(t,e),this.b++},Il.prototype.reset=function(t){var e=El(this,t);t=Al(t),e&&t&&(e.delete(),delete this.a[t])},Il.prototype.getResponse=function(t){return(t=El(this,t))?t.getResponse():null},Il.prototype.execute=function(t){(t=El(this,t))&&t.execute()},kl.prototype.getResponse=function(){return Sl(this),this.b},kl.prototype.execute=function(){Sl(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(i){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(i){}t.h&&t.execute()},6e4)},500))},kl.prototype.delete=function(){Sl(this),this.g=!0,clearTimeout(this.a),this.a=null,pn(this.f,"click",this.i)},zi(Nl,"FACTOR_ID","phone"),_l.prototype.g=function(){return Tl||(Tl=new Il),Ce(Tl)},_l.prototype.c=function(){};var Ol=null;function Cl(){this.b=u.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Rl=new wt(At,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Pl=new Ki(3e4,6e4);Cl.prototype.g=function(t){var e=this;return new Ee(function(n,i){var r=setTimeout(function(){i(new N("network-request-failed"))},Pl.get());!u.grecaptcha||t!==e.f&&!e.b?(u[e.a]=function(){if(u.grecaptcha){e.f=t;var o=u.grecaptcha.render;u.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(r),n(u.grecaptcha)}else clearTimeout(r),i(new N("internal-error"));delete u[e.a]},Ce(Ha(_t(Rl,{onload:e.a,hl:t||""}))).o(function(){clearTimeout(r),i(new N("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),n(u.grecaptcha))})},Cl.prototype.c=function(){this.b--};var Dl=null;function Ll(t,e,n,i,r,o,a){if(zi(this,"type","recaptcha"),this.c=this.f=null,this.J=!1,this.v=e,this.g=null,a?(Ol||(Ol=new _l),a=Ol):(Dl||(Dl=new Cl),a=Dl),this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[jl])throw new N("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Ul],!u.document)throw new N("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!le(e)||!this.i&&le(e).hasChildNodes())throw new N("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.s=new za(t,o||null,r||null),this.u=i||function(){return null};var s=this;this.l=[];var c=this.a[xl];this.a[xl]=function(t){if(Vl(s,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=Ci(c,u);"function"==typeof e&&e(t)}};var h=this.a[Ml];this.a[Ml]=function(){if(Vl(s,null),"function"==typeof h)h();else if("string"==typeof h){var t=Ci(h,u);"function"==typeof t&&t()}}}var xl="callback",Ml="expired-callback",jl="sitekey",Ul="size";function Vl(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(i){}}function Fl(t,e){return t.h.push(e),e.oa(function(){z(t.h,e)}),e}function ql(t){if(t.J)throw new N("internal-error","RecaptchaVerifier instance has been destroyed.")}function Kl(t,n,i){var r=!1;try{this.b=i||e.default.app()}catch(s){throw new N("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new N("invalid-api-key");i=this.b.options.apiKey;var o=this,a=null;try{a=this.b.auth().Ga()}catch(s){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(s){}a=e.default.SDK_VERSION?_i(e.default.SDK_VERSION,a):null,Ll.call(this,i,t,n,function(){try{var t=o.b.auth().la()}catch(e){t=null}return t},a,D(O),r)}function Hl(t,e,n,i){t:{n=Array.prototype.slice.call(n);for(var r=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new N("internal-error","Argument validator encountered a required argument after an optional argument.");r++}if(o=e.length,n.length<r||o<n.length)i="Expected "+(r==o?1==r?"1 argument":r+" arguments":r+"-"+o+" arguments")+" but got "+n.length+".";else{for(r=0;r<n.length;r++)if(o=e[r].optional&&void 0===n[r],!e[r].M(n[r])&&!o){if(e=e[r],0>r||r>=Gl.length)throw new N("internal-error","Argument validator received an unsupported number of arguments.");n=Gl[r],i=(i?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}i=null}}if(i)throw new N("argument-error",t+" failed: "+i)}(n=Ll.prototype).Ia=function(){var t=this;return this.f?this.f:this.f=Fl(this,Ce().then(function(){if(Di()&&!Ii())return bi();throw new N("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.m.g(t.u())}).then(function(e){return t.g=e,iu(t.s,Fs,{})}).then(function(e){t.a[jl]=e.recaptchaSiteKey}).o(function(e){throw t.f=null,e}))},n.render=function(){ql(this);var t=this;return Fl(this,this.Ia().then(function(){if(null===t.c){var e=t.v;if(!t.i){var n=le(e);e=me("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},n.verify=function(){ql(this);var t=this;return Fl(this,this.render().then(function(e){return new Ee(function(n){var i=t.g.getResponse(e);if(i)n(i);else{var r=function(e){e&&(function(t,e){$(t.l,function(t){return t==e})}(t,r),n(e))};t.l.push(r),t.i&&t.g.execute(t.c)}})}))},n.reset=function(){ql(this),null!==this.c&&this.g.reset(this.c)},n.clear=function(){ql(this),this.J=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=le(this.v);for(var e;e=t.firstChild;)t.removeChild(e)}},k(Kl,Ll);var Gl="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Bl(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:function(t){return"string"==typeof t}}}function Wl(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:function(t){return"boolean"==typeof t}}}function Xl(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:m}}function Jl(t,e){return{name:t||"",K:"a function",optional:!!e,M:function(t){return"function"==typeof t}}}function Yl(t,e){return{name:t||"",K:"null",optional:!!e,M:function(t){return null===t}}}function zl(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.ka||!n)}}}function $l(t,e){return m(t)&&"string"==typeof t.type&&t.type===e&&"function"==typeof t.Ha}function Zl(t){return m(t)&&"string"==typeof t.uid}function Ql(t,e,n,i){return{name:n||"",K:t.K+" or "+e.K,optional:!!i,M:function(n){return t.M(n)||e.M(n)}}}function tf(t,e){for(var n in e){var i=e[n].name;t[i]=rf(i,t[n],e[n].j)}}function ef(t,e){for(var n in e){var i=e[n].name;i!==n&&Object.defineProperty(t,i,{get:E(function(t){return this[t]},n),set:E(function(t,e,n,i){Hl(t,[n],[i],!0),this[e]=i},i,n,e[n].lb),enumerable:!0})}}function nf(t,e,n,i){t[e]=rf(e,n,i)}function rf(t,e,n){function i(){var t=Array.prototype.slice.call(arguments);return Hl(o,n,t),e.apply(this,t)}if(!n)return e;var r,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(r in e)i[r]=e[r];for(r in e.prototype)i.prototype[r]=e.prototype[r];return i}tf(al.prototype,{kb:{name:"applyActionCode",j:[Bl("code")]},Sa:{name:"checkActionCode",j:[Bl("code")]},ob:{name:"confirmPasswordReset",j:[Bl("code"),Bl("newPassword")]},dc:{name:"createUserWithEmailAndPassword",j:[Bl("email"),Bl("password")]},hc:{name:"fetchSignInMethodsForEmail",j:[Bl("email")]},ra:{name:"getRedirectResult",j:[]},Bc:{name:"isSignInWithEmailLink",j:[Bl("emailLink")]},Hc:{name:"onAuthStateChanged",j:[Ql(Xl(),Jl(),"nextOrObserver"),Jl("opt_error",!0),Jl("opt_completed",!0)]},Ic:{name:"onIdTokenChanged",j:[Ql(Xl(),Jl(),"nextOrObserver"),Jl("opt_error",!0),Jl("opt_completed",!0)]},wb:{name:"sendPasswordResetEmail",j:[Bl("email"),Ql(Xl("opt_actionCodeSettings",!0),Yl(null,!0),"opt_actionCodeSettings",!0)]},xb:{name:"sendSignInLinkToEmail",j:[Bl("email"),Xl("actionCodeSettings")]},yb:{name:"setPersistence",j:[Bl("persistence")]},Sc:{name:"signInAndRetrieveDataWithCredential",j:[zl()]},Ab:{name:"signInAnonymously",j:[]},ab:{name:"signInWithCredential",j:[zl()]},Tc:{name:"signInWithCustomToken",j:[Bl("token")]},Uc:{name:"signInWithEmailAndPassword",j:[Bl("email"),Bl("password")]},Vc:{name:"signInWithEmailLink",j:[Bl("email"),Bl("emailLink",!0)]},Wc:{name:"signInWithPhoneNumber",j:[Bl("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Xc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Yc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},dd:{name:"updateCurrentUser",j:[Ql({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof yh)}},Yl(),"user")]},Bb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Bl(null,!0)]},fd:{name:"useDeviceLanguage",j:[]},gd:{name:"useEmulator",j:[Bl("url"),Xl("options",!0)]},jd:{name:"verifyPasswordResetCode",j:[Bl("code")]}}),ef(al.prototype,{lc:{name:"languageCode",lb:Ql(Bl(),Yl(),"languageCode")},ti:{name:"tenantId",lb:Ql(Bl(),Yl(),"tenantId")}}),al.Persistence=Qu,al.Persistence.LOCAL="local",al.Persistence.SESSION="session",al.Persistence.NONE="none",tf(yh.prototype,{delete:{name:"delete",j:[]},oc:{name:"getIdTokenResult",j:[Wl("opt_forceRefresh",!0)]},I:{name:"getIdToken",j:[Wl("opt_forceRefresh",!0)]},Cc:{name:"linkAndRetrieveDataWithCredential",j:[zl()]},rb:{name:"linkWithCredential",j:[zl()]},Dc:{name:"linkWithPhoneNumber",j:[Bl("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Ec:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Fc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Lc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[zl()]},ub:{name:"reauthenticateWithCredential",j:[zl()]},Mc:{name:"reauthenticateWithPhoneNumber",j:[Bl("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Nc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Oc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},vb:{name:"sendEmailVerification",j:[Ql(Xl("opt_actionCodeSettings",!0),Yl(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Bl(null,!0)]},cd:{name:"unlink",j:[Bl("provider")]},Cb:{name:"updateEmail",j:[Bl("email")]},Db:{name:"updatePassword",j:[Bl("password")]},ed:{name:"updatePhoneNumber",j:[zl("phone")]},Eb:{name:"updateProfile",j:[Xl("profile")]},Fb:{name:"verifyBeforeUpdateEmail",j:[Bl("email"),Ql(Xl("opt_actionCodeSettings",!0),Yl(null,!0),"opt_actionCodeSettings",!0)]}}),tf(Il.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tf(wl.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tf(Ee.prototype,{oa:{name:"finally"},o:{name:"catch"},then:{name:"then"}}),ef($c.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",lb:Wl("appVerificationDisabledForTesting")}}),tf(Zc.prototype,{confirm:{name:"confirm",j:[Bl("verificationCode")]}}),nf(co,"fromJSON",function(t){t="string"==typeof t?JSON.parse(t):t;for(var e,n=[go,Co,xo,po],i=0;i<n.length;i++)if(e=n[i](t))return e;return null},[Ql(Bl(),Xl(),"json")]),nf(Ro,"credential",function(t,e){return new Oo(t,e)},[Bl("email"),Bl("password")]),tf(Oo.prototype,{w:{name:"toJSON",j:[Bl(null,!0)]}}),tf(Io.prototype,{Ca:{name:"addScope",j:[Bl("scope")]},Ka:{name:"setCustomParameters",j:[Xl("customOAuthParameters")]}}),nf(Io,"credential",To,[Ql(Bl(),Xl(),"token")]),nf(Ro,"credentialWithLink",Po,[Bl("email"),Bl("emailLink")]),tf(Eo.prototype,{Ca:{name:"addScope",j:[Bl("scope")]},Ka:{name:"setCustomParameters",j:[Xl("customOAuthParameters")]}}),nf(Eo,"credential",Ao,[Ql(Bl(),Xl(),"token")]),tf(ko.prototype,{Ca:{name:"addScope",j:[Bl("scope")]},Ka:{name:"setCustomParameters",j:[Xl("customOAuthParameters")]}}),nf(ko,"credential",So,[Ql(Bl(),Ql(Xl(),Yl()),"idToken"),Ql(Bl(),Yl(),"accessToken",!0)]),tf(No.prototype,{Ka:{name:"setCustomParameters",j:[Xl("customOAuthParameters")]}}),nf(No,"credential",_o,[Ql(Bl(),Xl(),"token"),Bl("secret",!0)]),tf(wo.prototype,{Ca:{name:"addScope",j:[Bl("scope")]},credential:{name:"credential",j:[Ql(Bl(),Ql(Xl(),Yl()),"optionsOrIdToken"),Ql(Bl(),Yl(),"accessToken",!0)]},Ka:{name:"setCustomParameters",j:[Xl("customOAuthParameters")]}}),tf(vo.prototype,{w:{name:"toJSON",j:[Bl(null,!0)]}}),tf(lo.prototype,{w:{name:"toJSON",j:[Bl(null,!0)]}}),nf(jo,"credential",Uo,[Bl("verificationId"),Bl("verificationCode")]),tf(jo.prototype,{gb:{name:"verifyPhoneNumber",j:[Ql(Bl(),{name:"phoneInfoOptions",K:"valid phone info options",optional:!1,M:function(t){return!!t&&(t.session&&t.phoneNumber?$l(t.session,so)&&"string"==typeof t.phoneNumber:t.session&&t.multiFactorHint?$l(t.session,uo)&&Zl(t.multiFactorHint):t.session&&t.multiFactorUid?$l(t.session,uo)&&"string"==typeof t.multiFactorUid:!!t.phoneNumber&&"string"==typeof t.phoneNumber)}},"phoneInfoOptions"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]}}),tf(Lo.prototype,{w:{name:"toJSON",j:[Bl(null,!0)]}}),tf(N.prototype,{toJSON:{name:"toJSON",j:[Bl(null,!0)]}}),tf(Xo.prototype,{toJSON:{name:"toJSON",j:[Bl(null,!0)]}}),tf(Wo.prototype,{toJSON:{name:"toJSON",j:[Bl(null,!0)]}}),tf(rh.prototype,{toJSON:{name:"toJSON",j:[Bl(null,!0)]}}),tf(eh.prototype,{Rc:{name:"resolveSignIn",j:[{name:"multiFactorAssertion",K:"a valid multiFactorAssertion",optional:!1,M:function(t){return!!t&&!!t.tb}}]}}),tf(hh.prototype,{Sb:{name:"getSession",j:[]},fc:{name:"enroll",j:[{name:"multiFactorAssertion",K:"a valid multiFactorAssertion",optional:!1,M:function(t){return!!t&&!!t.tb}},Bl("displayName",!0)]},bd:{name:"unenroll",j:[Ql({name:"multiFactorInfo",K:"a valid multiFactorInfo",optional:!1,M:Zl},Bl(),"multiFactorInfoIdentifier")]}}),tf(Kl.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),nf(Ir,"parseLink",Or,[Bl("link")]),nf(Nl,"assertion",function(t){return new uh(t)},[zl("phone")]),function(){if(void 0===e.default||!e.default.INTERNAL||!e.default.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:cr,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:ur,VERIFY_AND_CHANGE_EMAIL:hr,VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:al,AuthCredential:co,Error:N};nf(t,"EmailAuthProvider",Ro,[]),nf(t,"FacebookAuthProvider",Io,[]),nf(t,"GithubAuthProvider",Eo,[]),nf(t,"GoogleAuthProvider",ko,[]),nf(t,"TwitterAuthProvider",No,[]),nf(t,"OAuthProvider",wo,[Bl("providerId")]),nf(t,"SAMLAuthProvider",yo,[Bl("providerId")]),nf(t,"PhoneAuthProvider",jo,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof al)}}]),nf(t,"RecaptchaVerifier",Kl,[Ql(Bl(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Xl("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof e.default.app.App)}}]),nf(t,"ActionCodeURL",Ir,[]),nf(t,"PhoneMultiFactorGenerator",Nl,[]),e.default.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new al(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC",onInstanceCreated:function(t){t.getProvider("auth-internal").initialize()}}),e.default.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:T((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:T(t.nc,t),addAuthTokenListener:T(t.cc,t),removeAuthTokenListener:T(t.Pc,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),e.default.registerVersion("@firebase/auth","0.16.8"),e.default.INTERNAL.extendNamespace({User:yh})}()}).apply(void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});
},{"@firebase/app":"Q47K"}],"g5IB":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"fbOU":[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerDatabase=nl,exports.enableLogging=exports.ServerValue=exports.Reference=exports.Query=exports.OnDisconnect=exports.Database=exports.DataSnapshot=void 0;var t=a(require("@firebase/app")),n=require("@firebase/component"),r=require("@firebase/util"),i=require("tslib"),o=require("@firebase/logger");function a(e){return e&&e.__esModule?e:{default:e}}var s="@firebase/database",u="0.10.9",l="";function c(e){l=e}var h=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,r.stringify)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,r.jsonEval)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),d=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return(0,r.contains)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),p=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new h(t)}}catch(n){}return new d},f=p("localStorage"),_=p("sessionStorage"),v=new o.Logger("@firebase/database"),y=function(){var e=1;return function(){return e++}}(),g=function(e){var t=(0,r.stringToByteArray)(e),n=new r.Sha1;n.update(t);var i=n.digest();return r.base64.encodeByteArray(i)},m=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",i=0;i<e.length;i++){var o=e[i];Array.isArray(o)||o&&"object"==typeof o&&"number"==typeof o.length?n+=m.apply(null,o):n+="object"==typeof o?(0,r.stringify)(o):o,n+=" "}return n},C=null,w=!0,b=function(e,t){(0,r.assert)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(v.logLevel=o.LogLevel.VERBOSE,C=v.log.bind(v),t&&_.set("logging_enabled",!0)):"function"==typeof e?C=e:(C=null,_.remove("logging_enabled"))};exports.enableLogging=b;var T=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===w&&(w=!1,null===C&&!0===_.get("logging_enabled")&&b(!0)),C){var n=m.apply(null,e);C(n)}},k=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];T.apply(void 0,(0,i.__spreadArray)([e],(0,i.__read)(t)))}},I=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+m.apply(void 0,(0,i.__spreadArray)([],(0,i.__read)(e)));v.error(n)},E=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+m.apply(void 0,(0,i.__spreadArray)([],(0,i.__read)(e)));throw v.error(n),new Error(n)},S=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+m.apply(void 0,(0,i.__spreadArray)([],(0,i.__read)(e)));v.warn(n)},P=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&S("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},x=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},N=function(e){if((0,r.isNodeSdk)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},R="[MIN_NAME]",A="[MAX_NAME]",D=function(e,t){if(e===t)return 0;if(e===R||t===A)return-1;if(t===R||e===A)return 1;var n=z(e),r=z(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},O=function(e,t){return e===t?0:e<t?-1:1},M=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,r.stringify)(t))},q=function(e){if("object"!=typeof e||null===e)return(0,r.stringify)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var i="{",o=0;o<t.length;o++)0!==o&&(i+=","),i+=(0,r.stringify)(t[o]),i+=":",i+=q(e[t[o]]);return i+="}"},F=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function L(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var W=function(e){(0,r.assert)(!x(e),"Invalid JSON number");var t,n,i,o,a;0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(o=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));var s=[];for(a=52;a;a-=1)s.push(i%2?1:0),i=Math.floor(i/2);for(a=11;a;a-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var u=s.join(""),l="";for(a=0;a<64;a+=8){var c=parseInt(u.substr(a,8),2).toString(16);1===c.length&&(c="0"+c),l+=c}return l.toLowerCase()},j=function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},U=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI};function B(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}var V=new RegExp("^-?(0*)\\d{1,10}$"),Q=-2147483648,H=2147483647,z=function(e){if(V.test(e)){var t=Number(e);if(t>=Q&&t<=H)return t}return null},Y=function(e){try{e()}catch(t){setTimeout(function(){var e=t.stack||"";throw S("Exception was thrown by user callback.",e),t},Math.floor(0))}},K=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},G=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},$=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(function(e){return n.appCheck=e})}return e.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise(function(n,r){setTimeout(function(){t.appCheck?t.getToken(e).then(n,r):n(null)},0)})},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(function(t){return t.addTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){S('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},e}(),J=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(function(e){return r.auth_=e})}return e.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch(function(e){return e&&"auth/token-not-initialized"===e.code?(T("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}):new Promise(function(n,r){setTimeout(function(){t.auth_?t.getToken(e).then(n,r):n(null)},0)})},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)})},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',S(e)},e}(),X=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),Z="5",ee="v",te="s",ne="r",re="f",ie=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,oe="ls",ae="p",se="ac",ue="websocket",le="long_polling",ce=function(){function e(e,t,n,r,i,o,a){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===a&&(a=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=f.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&f.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function he(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function de(e,t,n){var i;if((0,r.assert)("string"==typeof t,"typeof type must == string"),(0,r.assert)("object"==typeof n,"typeof params must == object"),t===ue)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==le)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}he(e)&&(n.ns=e.namespace);var o=[];return L(n,function(e,t){o.push(e+"="+t)}),i+o.join("&")}var pe=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),(0,r.contains)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return(0,r.deepCopy)(this.counters_)},e}(),fe={},_e={};function ve(e){var t=e.toString();return fe[t]||(fe[t]=new pe),fe[t]}function ye(e,t){var n=e.toString();return _e[n]||(_e[n]=t()),_e[n]}var ge=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Y(function(){n.onMessage_(e[t])})},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),me="start",Ce="close",we="pLPCommand",be="pRTLPCB",Te="id",ke="pw",Ie="ser",Ee="cb",Se="seg",Pe="ts",xe="d",Ne="dframe",Re=1870,Ae=30,De=Re-Ae,Oe=25e3,Me=3e4,qe=function(){function e(e,t,n,r,i,o,a){var s=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=k(e),this.stats_=ve(t),this.urlFn=function(e){return s.appCheckToken&&(e[se]=s.appCheckToken),de(t,le,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ge(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(Me)),N(function(){if(!n.isClosed_){n.scriptTagHolder=new Fe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,i.__read)(e,5),o=r[0],a=r[1],s=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,o===me)n.id=a,n.password=s;else{if(o!==Ce)throw new Error("Unrecognized command received: "+o);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,i.__read)(e,2),o=r[0],a=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(o,a)},function(){n.onClosed_()},n.urlFn);var e={};e[me]="t",e[Ie]=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e[Ee]=n.scriptTagHolder.uniqueCallbackIdentifier),e[ee]=Z,n.transportSessionId&&(e[te]=n.transportSessionId),n.lastSessionId&&(e[oe]=n.lastSessionId),n.applicationId&&(e[ae]=n.applicationId),n.appCheckToken&&(e[se]=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&ie.test(location.hostname)&&(e[ne]=re);var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,function(){})}})},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!(0,r.isNodeSdk)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!j()&&!U())},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=(0,r.stringify)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=(0,r.base64Encode)(t),i=F(n,De),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!(0,r.isNodeSdk)()){this.myDisconnFrame=document.createElement("iframe");var n={};n[Ne]="t",n[Te]=e,n[ke]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=(0,r.stringify)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Fe=function(){function e(t,n,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,r.isNodeSdk)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=y(),window[we+this.uniqueCallbackIdentifier]=t,window[be+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))a='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(u){T("frame writing exception"),u.stack&&T(u.stack),T(u)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||T("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[Te]=this.myID,e[ke]=this.myPW,e[Ie]=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+Ae+n.length<=Re))break;var i=this.pendingSegs.shift();n=n+"&"+Se+r+"="+i.seg+"&"+Pe+r+"="+i.ts+"&"+xe+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(Oe));this.addTag(e,function(){clearTimeout(i),r()})},e.prototype.addTag=function(e,t){var n=this;(0,r.isNodeSdk)()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){T("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}},Math.floor(1))},e}(),Le=16384,We=45e3,je=null;"undefined"!=typeof MozWebSocket?je=MozWebSocket:"undefined"!=typeof WebSocket&&(je=WebSocket);var Ue=function(){function t(e,n,r,i,o,a,s){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=k(this.connId),this.stats_=ve(n),this.connURL=t.connectionURL_(n,a,s,i),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n,i){var o={};return o[ee]=Z,!(0,r.isNodeSdk)()&&"undefined"!=typeof location&&location.hostname&&ie.test(location.hostname)&&(o[ne]=re),t&&(o[te]=t),n&&(o[oe]=n),i&&(o[se]=i),de(e,ue,o)},t.prototype.open=function(t,n){var i=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,f.set("previous_websocket_failure",!0);try{if((0,r.isNodeSdk)()){var o=this.nodeAdmin?"AdminNode":"Node",a={headers:{"User-Agent":"Firebase/"+Z+"/"+l+"/"+e.platform+"/"+o,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(a.headers.Authorization="Bearer "+this.authToken),this.appCheckToken&&(a.headers["X-Firebase-AppCheck"]=this.appCheckToken);var s=e.env,u=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;u&&(a.proxy={origin:u}),this.mySock=new je(this.connURL,[],a)}else{a={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new je(this.connURL,[],a)}}catch(h){this.log_("Error instantiating WebSocket.");var c=h.message||h.data;return c&&this.log_(c),void this.onClosed_()}this.mySock.onopen=function(){i.log_("Websocket connected."),i.everConnected_=!0},this.mySock.onclose=function(){i.log_("Websocket connection was disconnected."),i.mySock=null,i.onClosed_()},this.mySock.onmessage=function(e){i.handleIncomingFrame(e)},this.mySock.onerror=function(e){i.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&i.log_(t),i.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==je&&!t.forceDisallow_},t.previouslyFailed=function(){return f.isInMemoryStorage||!0===f.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){f.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=(0,r.jsonEval)(t);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(e){if((0,r.assert)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(e){this.resetKeepAlive();var t=(0,r.stringify)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=F(t,Le);n.length>1&&this.sendString_(String(n.length));for(var i=0;i<n.length;i++)this.sendString_(n[i])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(We))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Be=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[qe,Ue]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,o=Ue&&Ue.isAvailable(),a=o&&!Ue.previouslyFailed();if(t.webSocketOnly&&(o||S("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[Ue];else{var s=this.transports_=[];try{for(var u=(0,i.__values)(e.ALL_TRANSPORTS),l=u.next();!l.done;l=u.next()){var c=l.value;c&&c.isAvailable()&&s.push(c)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Ve=6e4,Qe=5e3,He=10240,ze=102400,Ye="t",Ke="d",Ge="s",$e="r",Je="e",Xe="o",Ze="a",et="n",tt="p",nt="h",rt=function(){function e(e,t,n,r,i,o,a,s,u,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=s,this.onKill_=u,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=k("c:"+this.id+":"),this.transportManager_=new Be(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=G(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>ze?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>He?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if(Ye in e){var t=e[Ye];t===Ze?this.upgradeIfSecondaryHealthy_():t===$e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):t===Xe&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=M("t",e),n=M("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:tt,d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ze,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:et,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=M("t",e),n=M("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=M(Ye,e);if(Ke in e){var n=e[Ke];if(t===nt)this.onHandshake_(n);else if(t===et){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Ge?this.onConnectionShutdown_(n):t===$e?this.onReset_(n):t===Je?I("Server Error: "+n):t===Xe?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):I("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Z!==n&&S("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),G(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(Ve))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):G(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(Qe))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:tt,d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(f.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),it=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),ot=function(){function e(e){this.allowedEvents_=e,this.listeners_={},(0,r.assert)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=(0,i.__spreadArray)([],(0,i.__read)(this.listeners_[e])),o=0;o<r.length;o++)r[o].callback.apply(r[o].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){(0,r.assert)(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},e}(),at=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,r.isMobileCordova)()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return(0,i.__extends)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,r.assert)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(ot),st=32,ut=768,lt=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();function ct(){return new lt("")}function ht(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function dt(e){return e.pieces_.length-e.pieceNum_}function pt(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new lt(e.pieces_,t)}function ft(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function _t(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}function vt(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function yt(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new lt(t,0)}function gt(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof lt)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new lt(n,0)}function mt(e){return e.pieceNum_>=e.pieces_.length}function Ct(e,t){var n=ht(e),r=ht(t);if(null===n)return t;if(n===r)return Ct(pt(e),pt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function wt(e,t){for(var n=vt(e,0),r=vt(t,0),i=0;i<n.length&&i<r.length;i++){var o=D(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function bt(e,t){if(dt(e)!==dt(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Tt(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(dt(e)>dt(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var kt=function(){return function(e,t){this.errorPrefix_=t,this.parts_=vt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=(0,r.stringLength)(this.parts_[n]);St(this)}}();function It(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=(0,r.stringLength)(t),St(e)}function Et(e){var t=e.parts_.pop();e.byteLength_-=(0,r.stringLength)(t),e.parts_.length>0&&(e.byteLength_-=1)}function St(e){if(e.byteLength_>ut)throw new Error(e.errorPrefix_+"has a key path longer than "+ut+" bytes ("+e.byteLength_+").");if(e.parts_.length>st)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+st+") or object contains a cycle "+Pt(e))}function Pt(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var xt,Nt,Rt=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))},!1),r}return(0,i.__extends)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,r.assert)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(ot),At=1e3,Dt=3e5,Ot=3e3,Mt=3e4,qt=1.3,Ft=3e4,Lt="server_kill",Wt=3,jt=function(e){function t(n,i,o,a,s,u,l,c){var h=e.call(this)||this;if(h.repoInfo_=n,h.applicationId_=i,h.onDataUpdate_=o,h.onConnectStatus_=a,h.onServerInfoUpdate_=s,h.authTokenProvider_=u,h.appCheckTokenProvider_=l,h.authOverride_=c,h.id=t.nextPersistentConnectionId_++,h.log_=k("p:"+h.id+":"),h.interruptReasons_={},h.listens=new Map,h.outstandingPuts_=[],h.outstandingGets_=[],h.outstandingPutCount_=0,h.outstandingGetCount_=0,h.onDisconnectRequestQueue_=[],h.connected_=!1,h.reconnectDelay_=At,h.maxReconnectDelay_=Dt,h.securityDebugCallback_=null,h.lastSessionId=null,h.establishConnectionTimer_=null,h.visible_=!1,h.requestCBHash_={},h.requestNumber_=0,h.realtime_=null,h.authToken_=null,h.appCheckToken_=null,h.forceTokenRefresh_=!1,h.invalidAuthTokenCount_=0,h.invalidAppCheckTokenCount_=0,h.firstConnection_=!0,h.lastConnectionAttemptTime_=null,h.lastConnectionEstablishedTime_=null,c&&!(0,r.isNodeSdk)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Rt.getInstance().on("visible",h.onVisible_,h),-1===n.host.indexOf("fblocal")&&at.getInstance().on("online",h.onOnline_,h),h}return(0,i.__extends)(t,e),t.prototype.sendRequest=function(e,t,n){var i=++this.requestNumber_,o={r:i,a:e,b:t};this.log_((0,r.stringify)(o)),(0,r.assert)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[i]=n)},t.prototype.get=function(e){var t=this;this.initConnection_();var n=new r.Deferred,i={p:e._path.toString(),q:e._queryObject},o={action:"g",request:i,onComplete:function(e){var r=e.d;"ok"===e.s?(t.onDataUpdate_(i.p,r,!1,null),n.resolve(r)):n.reject(r)}};this.outstandingGets_.push(o),this.outstandingGetCount_++;var a=this.outstandingGets_.length-1;return this.connected_||setTimeout(function(){var e=t.outstandingGets_[a];void 0!==e&&o===e&&(delete t.outstandingGets_[a],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+a+" timed out on connection"),n.reject(new Error("Client is offline.")))},Ot),this.connected_&&this.sendGet_(a),n.promise},t.prototype.listen=function(e,t,n,i){this.initConnection_();var o=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),(0,r.assert)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,r.assert)(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");var s={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(a).set(o,s),this.connected_&&this.sendListen_(s)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var a={p:i};e.tag&&(a.q=r._queryObject,a.t=e.tag),a.h=e.hashFn(),this.sendRequest("q",a,function(a){var s=a.d,u=a.s;t.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",a),"ok"!==u&&n.removeListen_(i,o),e.onComplete&&e.onComplete(u,s))})},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&(0,r.contains)(e,"w")){var n=(0,r.safeGet)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();S("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+i+" at "+o+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||(0,r.isAdmin)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Mt)},t.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=(0,r.isValidFormat)(t)?"auth":"gauth",i={cred:t};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(n,i,function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},t.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)})},t.prototype.unlisten=function(e,t){var n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),(0,r.assert)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){this.initConnection_();var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}})}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+(0,r.stringify)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):I("Unrecognized action received from server: "+(0,r.stringify)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;(0,r.assert)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},t.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=At,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=At,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>Ft&&(this.reconnectDelay_=At),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*qt)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n,o,a,s,u,l,c,h,d,p,f,_,v,y=this;return(0,i.__generator)(this,function(g){switch(g.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),a=this.id+":"+t.nextConnectionId_++,s=this.lastSessionId,u=!1,l=null,c=function(){l?l.close():(u=!0,o())},h=function(e){(0,r.assert)(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)},this.realtime_={close:c,sendRequest:h},d=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)])];case 2:return p=i.__read.apply(void 0,[g.sent(),2]),f=p[0],_=p[1],u?T("getToken() completed but was canceled"):(T("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=_&&_.token,l=new rt(a,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,o,function(e){S(e+" ("+y.repoInfo_.toString()+")"),y.interrupt(Lt)},s)),[3,4];case 3:return v=g.sent(),this.log_("Failed to get token: "+v),u||(this.repoInfo_.nodeAdmin&&S(v),c()),[3,4];case 4:return[2]}})})},t.prototype.interrupt=function(e){T("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){T("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,r.isEmpty)(this.interruptReasons_)&&(this.reconnectDelay_=At,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map(function(e){return q(e)}).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new lt(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){T("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Wt&&(this.reconnectDelay_=Mt,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onAppCheckRevoked_=function(e,t){T("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Wt&&this.appCheckTokenProvider_.notifyForInvalidToken())},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var o=(0,i.__values)(this.listens.values()),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,(0,i.__values)(s.values())),l=u.next();!l.done;l=u.next()){var c=l.value;this.sendListen_(c)}}catch(p){n={error:p}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(f){e={error:f}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var d=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(d.action,d.pathString,d.data,d.onComplete)}for(h=0;h<this.outstandingGets_.length;h++)this.outstandingGets_[h]&&this.sendGet_(h)},t.prototype.sendConnectStats_=function(){var e={},t="js";(0,r.isNodeSdk)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+l.replace(/\./g,"-")]=1,(0,r.isMobileCordova)()?e["framework.cordova"]=1:(0,r.isReactNative)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=at.getInstance().currentlyOnline();return(0,r.isEmpty)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(it),Ut=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Bt=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new Ut(R,e),r=new Ut(R,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return Ut.MIN},e}(),Vt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return xt},set:function(e){xt=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return D(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw(0,r.assertionError)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return Ut.MIN},t.prototype.maxPost=function(){return new Ut(A,xt)},t.prototype.makePost=function(e,t){return(0,r.assert)("string"==typeof e,"KeyIndex indexValue must always be a string."),new Ut(e,xt)},t.prototype.toString=function(){return".key"},t}(Bt),Qt=new Vt,Ht=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),zt=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Kt.EMPTY_NODE,this.right=null!=o?o:Kt.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Kt.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Kt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Yt=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new zt(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Kt=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,zt.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,zt.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Ht(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Ht(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Ht(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Ht(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Yt,e}();function Gt(e,t){return D(e.name,t.name)}function $t(e,t){return D(e,t)}function Jt(e){Nt=e}var Xt,Zt,en,tn=function(e){return"number"==typeof e?"number:"+W(e):"string:"+e},nn=function(e){if(e.isLeafNode()){var t=e.val();(0,r.assert)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,r.contains)(t,".sv"),"Priority must be a string or number.")}else(0,r.assert)(e===Nt||e.isEmpty(),"priority of unexpected type.");(0,r.assert)(e===Nt||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},rn=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,(0,r.assert)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),nn(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Xt},set:function(e){Xt=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return mt(t)?this:".priority"===ht(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var i=ht(t);return null===i?n:n.isEmpty()&&".priority"!==i?this:((0,r.assert)(".priority"!==i||1===dt(t),".priority must be the last token in a path"),this.updateImmediateChild(i,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(pt(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+tn(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?W(this.value_):this.value_,this.lazyHash_=g(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:((0,r.assert)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,i=typeof this.value_,o=e.VALUE_TYPE_ORDER.indexOf(n),a=e.VALUE_TYPE_ORDER.indexOf(i);return(0,r.assert)(o>=0,"Unknown leaf type: "+n),(0,r.assert)(a>=0,"Unknown leaf type: "+i),o===a?"object"===i?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:a-o},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();function on(e){Zt=e}function an(e){en=e}var sn,un,ln=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?D(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return Ut.MIN},t.prototype.maxPost=function(){return new Ut(A,new rn("[PRIORITY-POST]",en))},t.prototype.makePost=function(e,t){var n=Zt(e);return new Ut(t,new rn("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Bt),cn=new ln,hn=Math.log(2),dn=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/hn,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),pn=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,a,s=r-t;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new zt(a,o.node,zt.BLACK,null,null);var u=parseInt(s/2,10)+t,l=i(t,u),c=i(u+1,r);return o=e[u],a=n?n(o):o,new zt(a,o.node,zt.BLACK,l,c)},o=function(t){for(var r=null,o=null,a=e.length,s=function(t,r){var o=a-t,s=a;a-=t;var l=i(o+1,s),c=e[o],h=n?n(c):c;u(new zt(h,c.node,r,null,l))},u=function(e){r?(r.left=e,r=e):(o=e,r=e)},l=0;l<t.count;++l){var c=t.nextBitIsOne(),h=Math.pow(2,t.count-(l+1));c?s(h,zt.BLACK):(s(h,zt.BLACK),s(h,zt.RED))}return o}(new dn(e.length));return new Kt(r||t,o)},fn={},_n=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return(0,r.assert)(fn&&cn,"ChildrenNode.ts has not been loaded"),sn=sn||new e({".priority":fn},{".priority":cn})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=(0,r.safeGet)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Kt?t:null},e.prototype.hasIndex=function(e){return(0,r.contains)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){(0,r.assert)(t!==Qt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var o,a=[],s=!1,u=n.getIterator(Ut.Wrap),l=u.getNext();l;)s=s||t.isDefinedOn(l.node),a.push(l),l=u.getNext();o=s?pn(a,t.getCompare()):fn;var c=t.toString(),h=(0,i.__assign)({},this.indexSet_);h[c]=t;var d=(0,i.__assign)({},this.indexes_);return d[c]=o,new e(d,h)},e.prototype.addToIndexes=function(t,n){var i=this;return new e((0,r.map)(this.indexes_,function(e,o){var a=(0,r.safeGet)(i.indexSet_,o);if((0,r.assert)(a,"Missing index implementation for "+o),e===fn){if(a.isDefinedOn(t.node)){for(var s=[],u=n.getIterator(Ut.Wrap),l=u.getNext();l;)l.name!==t.name&&s.push(l),l=u.getNext();return s.push(t),pn(s,a.getCompare())}return fn}var c=n.get(t.name),h=e;return c&&(h=h.remove(new Ut(t.name,c))),h.insert(t,t.node)}),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e((0,r.map)(this.indexes_,function(e){if(e===fn)return e;var r=n.get(t.name);return r?e.remove(new Ut(t.name,r)):e}),this.indexSet_)},e}(),vn=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&nn(this.priorityNode_),this.children_.isEmpty()&&(0,r.assert)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return un||(un=new e(new Kt($t),null,_n.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||un},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?un:t},e.prototype.getChild=function(e){var t=ht(e);return null===t?this:this.getImmediateChild(t).getChild(pt(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if((0,r.assert)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var i=new Ut(t,n),o=void 0,a=void 0;n.isEmpty()?(o=this.children_.remove(t),a=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,n),a=this.indexMap_.addToIndexes(i,this.children_));var s=o.isEmpty()?un:this.priorityNode_;return new e(o,s,a)},e.prototype.updateChild=function(e,t){var n=ht(e);if(null===n)return t;(0,r.assert)(".priority"!==ht(e)||1===dt(e),".priority must be the last token in a path");var i=this.getImmediateChild(n).updateChild(pt(e),t);return this.updateImmediateChild(n,i)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(cn,function(a,s){n[a]=s.val(t),r++,o&&e.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),!t&&o&&i<2*r){var a=[];for(var s in n)a[s]=n[s];return a}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+tn(this.getPriority().val())+":"),this.forEachChild(cn,function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":g(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Ut(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new Ut(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new Ut(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,Ut.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,Ut.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===gn?-1:0},e.prototype.withIndex=function(t){if(t===Qt||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===Qt||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(cn),r=t.getIterator(cn),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===Qt?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),yn=function(e){function t(){return e.call(this,new Kt($t),vn.EMPTY_NODE,_n.Default)||this}return(0,i.__extends)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return vn.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(vn),gn=new yn;Object.defineProperties(Ut,{MIN:{value:new Ut(R,vn.EMPTY_NODE)},MAX:{value:new Ut(A,gn)}}),Vt.__EMPTY_NODE=vn.EMPTY_NODE,rn.__childrenNodeConstructor=vn,Jt(gn),an(gn);var mn=!0;function Cn(e,t){if(void 0===t&&(t=null),null===e)return vn.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,r.assert)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new rn(e,Cn(t));if(e instanceof Array||!mn){var n=vn.EMPTY_NODE;return L(e,function(t,i){if((0,r.contains)(e,t)&&"."!==t.substring(0,1)){var o=Cn(i);!o.isLeafNode()&&o.isEmpty()||(n=n.updateImmediateChild(t,o))}}),n.updatePriority(Cn(t))}var i=[],o=!1;if(L(e,function(e,t){if("."!==e.substring(0,1)){var n=Cn(t);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new Ut(e,n)))}}),0===i.length)return vn.EMPTY_NODE;var a=pn(i,Gt,function(e){return e.name},$t);if(o){var s=pn(i,cn.getCompare());return new vn(a,Cn(t),new _n({".priority":s},{".priority":cn}))}return new vn(a,Cn(t),_n.Default)}on(Cn);var wn=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,(0,r.assert)(!mt(t)&&".priority"!==ht(t),"Can't create PathIndex with empty path or .priority key"),n}return(0,i.__extends)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?D(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=Cn(e),r=vn.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ut(t,r)},t.prototype.maxPost=function(){var e=vn.EMPTY_NODE.updateChild(this.indexPath_,gn);return new Ut(A,e)},t.prototype.toString=function(){return vt(this.indexPath_,0).join("/")},t}(Bt),bn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?D(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return Ut.MIN},t.prototype.maxPost=function(){return Ut.MAX},t.prototype.makePost=function(e,t){var n=Cn(e);return new Ut(t,n)},t.prototype.toString=function(){return".value"},t}(Bt),Tn=new bn,kn="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",In="-",En="z",Sn=786,Pn=function(){var e=0,t=[];return function(n){var i,o=n===e;e=n;var a=new Array(8);for(i=7;i>=0;i--)a[i]=kn.charAt(n%64),n=Math.floor(n/64);(0,r.assert)(0===n,"Cannot push at time == 0");var s=a.join("");if(o){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)s+=kn.charAt(t[i]);return(0,r.assert)(20===s.length,"nextPushId: Length should be 20."),s}}(),xn=function(e){if(e===""+H)return In;var t=z(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<Sn)return n.push(In),n.join("");for(var i=n.length-1;i>=0&&n[i]===En;)i--;if(-1===i)return A;var o=n[i],a=kn.charAt(kn.indexOf(o)+1);return n[i]=a,n.slice(0,i+1).join("")},Nn=function(e){if(e===""+Q)return R;var t=z(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return n[n.length-1]===In?1===n.length?""+H:(delete n[n.length-1],n.join("")):(n[n.length-1]=kn.charAt(kn.indexOf(n[n.length-1])-1),n.join("")+En.repeat(Sn-n.length))};function Rn(e){return{type:"value",snapshotNode:e}}function An(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Dn(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function On(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}function Mn(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}var qn=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,i,o,a){(0,r.assert)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(i).equals(n.getChild(i))&&s.isEmpty()===n.isEmpty()?e:(null!=a&&(n.isEmpty()?e.hasChild(t)?a.trackChildChange(Dn(t,s)):(0,r.assert)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?a.trackChildChange(An(t,n)):a.trackChildChange(On(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(cn,function(e,r){t.hasChild(e)||n.trackChildChange(Dn(e,r))}),t.isLeafNode()||t.forEachChild(cn,function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(On(t,r,i))}else n.trackChildChange(An(t,r))})),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?vn.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),Fn=function(){function e(t){this.indexedFilter_=new qn(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new Ut(t,n))||(n=vn.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=vn.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(vn.EMPTY_NODE);var i=this;return t.forEachChild(cn,function(e,t){i.matches(new Ut(e,t))||(r=r.updateImmediateChild(e,vn.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),Ln=function(){function e(e){this.rangedFilter_=new Fn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new Ut(t,n))||(n=vn.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=vn.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=vn.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(vn.EMPTY_NODE);var s=void 0,u=void 0,l=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();l=function(e,t){return c(t,e)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();o=0;for(var h=!1;i.hasNext();){a=i.getNext();!h&&l(s,a)<=0&&(h=!0),h&&o<this.limit_&&l(a,u)<=0?o++:r=r.updateImmediateChild(a.name,vn.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,i,o){var a;if(this.reverse_){var s=this.index_.getCompare();a=function(e,t){return s(t,e)}}else a=this.index_.getCompare();var u=e;(0,r.assert)(u.numChildren()===this.limit_,"");var l=new Ut(t,n),c=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(u.hasChild(t)){for(var d=u.getImmediateChild(t),p=i.getChildAfterChild(this.index_,c,this.reverse_);null!=p&&(p.name===t||u.hasChild(p.name));)p=i.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:a(p,l);if(h&&!n.isEmpty()&&f>=0)return null!=o&&o.trackChildChange(On(t,n,d)),u.updateImmediateChild(t,n);null!=o&&o.trackChildChange(Dn(t,d));var _=u.updateImmediateChild(t,vn.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=o&&o.trackChildChange(An(p.name,p.node)),_.updateImmediateChild(p.name,p.node)):_}return n.isEmpty()?e:h&&a(c,l)>=0?(null!=o&&(o.trackChildChange(Dn(c.name,c.node)),o.trackChildChange(An(t,n))),u.updateImmediateChild(t,n).updateImmediateChild(c.name,vn.EMPTY_NODE)):e},e}(),Wn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=cn}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return(0,r.assert)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return(0,r.assert)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:R},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return(0,r.assert)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return(0,r.assert)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:A},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return(0,r.assert)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===cn},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function jn(e){return e.loadsAllData()?new qn(e.getIndex()):e.hasLimit()?new Ln(e):new Fn(e)}function Un(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}function Bn(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}function Vn(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Qn(e,t,n){var r;if(e.index_===Qt)"string"==typeof t&&(t=xn(t)),r=Vn(e,t,n);else{r=Vn(e,t,null==n?A:xn(n))}return r.startAfterSet_=!0,r}function Hn(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function zn(e,t,n){var r;return e.index_===Qt?("string"==typeof t&&(t=Nn(t)),r=Hn(e,t,n)):r=Hn(e,t,null==n?R:Nn(n)),r.endBeforeSet_=!0,r}function Yn(e,t){var n=e.copy();return n.index_=t,n}function Kn(e){var t,n={};return e.isDefault()?n:(e.index_===cn?t="$priority":e.index_===Tn?t="$value":e.index_===Qt?t="$key":((0,r.assert)(e.index_ instanceof wn,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,r.stringify)(t),e.startSet_&&(n.startAt=(0,r.stringify)(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+(0,r.stringify)(e.indexStartName_))),e.endSet_&&(n.endAt=(0,r.stringify)(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+(0,r.stringify)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n)}function Gn(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==cn&&(t.i=e.index_.toString()),t}var $n=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.repoInfo_=t,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=k("p:rest:"),o.listens_={},o}return(0,i.__extends)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:((0,r.assert)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},t.prototype.listen=function(e,n,i,o){var a=this,s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);var u=t.getListenId_(e,i),l={};this.listens_[u]=l;var c=Kn(e._queryParams);this.restRequest_(s+".json",c,function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&a.onDataUpdate_(s,n,!1,i),(0,r.safeGet)(a.listens_,u)===l)&&o(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=Kn(e._queryParams),i=e._path.toString(),o=new r.Deferred;return this.restRequest_(i+".json",n,function(e,n){var r=n;404===e&&(r=null,e=null),null===e?(t.onDataUpdate_(i,r,!1,null),o.resolve(r)):o.reject(new Error(r))}),o.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var o=this;return void 0===t&&(t={}),t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(a){var s=(0,i.__read)(a,2),u=s[0],l=s[1];u&&u.accessToken&&(t.auth=u.accessToken),l&&l.token&&(t.ac=l.token);var c=(o.repoInfo_.secure?"https://":"http://")+o.repoInfo_.host+e+"?ns="+o.repoInfo_.namespace+(0,r.querystring)(t);o.log_("Sending REST request for "+c);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(n&&4===h.readyState){o.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);var e=null;if(h.status>=200&&h.status<300){try{e=(0,r.jsonEval)(h.responseText)}catch(t){S("Failed to parse JSON response for "+c+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&S("Got unsuccessful REST response for "+c+" Status: "+h.status),n(h.status);n=null}},h.open("GET",c,!0),h.send()})},t}(it),Jn=function(){function e(){this.rootNode_=vn.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}();function Xn(){return{value:null,children:new Map}}function Zn(e,t,n){if(mt(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=ht(t);e.children.has(r)||e.children.set(r,Xn()),Zn(e.children.get(r),t=pt(t),n)}}function er(e,t){if(mt(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;var n=e.value;return e.value=null,n.forEachChild(cn,function(t,n){Zn(e,new lt(t),n)}),er(e,t)}if(e.children.size>0){var r=ht(t);if(t=pt(t),e.children.has(r))er(e.children.get(r),t)&&e.children.delete(r);return 0===e.children.size}return!0}function tr(e,t,n){null!==e.value?n(t,e.value):nr(e,function(e,r){tr(r,new lt(t.toString()+"/"+e),n)})}function nr(e,t){e.children.forEach(function(e,n){t(n,e)})}var rr,ir=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=(0,i.__assign)({},e);return this.last_&&L(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t},e}(),or=1e4,ar=3e4,sr=3e5,ur=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ir(e);var n=or+(ar-or)*Math.random();G(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},i=!1;L(t,function(t,o){o>0&&(0,r.contains)(e.statsToReport_,t)&&(n[t]=o,i=!0)}),i&&this.server_.reportStats(n),G(this.reportStats_.bind(this),Math.floor(2*Math.random()*sr))},e}();function lr(e,t){e.statsToReport_[t]=!0}function cr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function hr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function dr(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(rr||(rr={}));var pr,fr=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=rr.ACK_USER_WRITE,this.source=cr()}return e.prototype.operationForChild=function(t){if(mt(this.path)){if(null!=this.affectedTree.value)return(0,r.assert)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new lt(t));return new e(ct(),n,this.revert)}return(0,r.assert)(ht(this.path)===t,"operationForChild called for unrelated child."),new e(pt(this.path),this.affectedTree,this.revert)},e}(),_r=function(){function e(e,t){this.source=e,this.path=t,this.type=rr.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return mt(this.path)?new e(this.source,ct()):new e(this.source,pt(this.path))},e}(),vr=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=rr.OVERWRITE}return e.prototype.operationForChild=function(t){return mt(this.path)?new e(this.source,ct(),this.snap.getImmediateChild(t)):new e(this.source,pt(this.path),this.snap)},e}(),yr=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=rr.MERGE}return e.prototype.operationForChild=function(t){if(mt(this.path)){var n=this.children.subtree(new lt(t));return n.isEmpty()?null:n.value?new vr(this.source,ct(),n.value):new e(this.source,ct(),n)}return(0,r.assert)(ht(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,pt(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),gr=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(mt(e))return this.isFullyInitialized()&&!this.filtered_;var t=ht(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),mr=function(){return function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}();function Cr(e,t,n,r){var i=[],o=[];return t.forEach(function(t){"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(Mn(t.childName,t.snapshotNode))}),wr(e,i,"child_removed",t,r,n),wr(e,i,"child_added",t,r,n),wr(e,i,"child_moved",o,r,n),wr(e,i,"child_changed",t,r,n),wr(e,i,"value",t,r,n),i}function wr(e,t,n,r,i,o){var a=r.filter(function(e){return e.type===n});a.sort(function(t,n){return Tr(e,t,n)}),a.forEach(function(n){var r=br(e,n,o);i.forEach(function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function br(e,t,n){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_),t)}function Tr(e,t,n){if(null==t.childName||null==n.childName)throw(0,r.assertionError)("Should only compare child_ events.");var i=new Ut(t.childName,t.snapshotNode),o=new Ut(n.childName,n.snapshotNode);return e.index_.compare(i,o)}function kr(e,t){return{eventCache:e,serverCache:t}}function Ir(e,t,n,r){return kr(new gr(t,n,r),e.serverCache)}function Er(e,t,n,r){return kr(e.eventCache,new gr(t,n,r))}function Sr(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Pr(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var xr=function(){return pr||(pr=new Kt(O)),pr},Nr=function(){function e(e,t){void 0===t&&(t=xr()),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return L(t,function(e,t){n=n.set(new lt(e),t)}),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:ct(),value:this.value};if(mt(e))return null;var n=ht(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(pt(e),t);return null!=i?{path:gt(new lt(n),i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},e.prototype.subtree=function(t){if(mt(t))return this;var n=ht(t),r=this.children.get(n);return null!==r?r.subtree(pt(t)):new e(null)},e.prototype.set=function(t,n){if(mt(t))return new e(n,this.children);var r=ht(t),i=(this.children.get(r)||new e(null)).set(pt(t),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(mt(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=ht(t),r=this.children.get(n);if(r){var i=r.remove(pt(t)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new e(null):new e(this.value,o)}return this},e.prototype.get=function(e){if(mt(e))return this.value;var t=ht(e),n=this.children.get(t);return n?n.get(pt(e)):null},e.prototype.setTree=function(t,n){if(mt(t))return n;var r=ht(t),i=(this.children.get(r)||new e(null)).setTree(pt(t),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(ct(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(gt(e,r),t)}),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,ct(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(mt(e))return null;var i=ht(e),o=this.children.get(i);return o?o.findOnPath_(pt(e),gt(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,ct(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(mt(t))return this;this.value&&r(n,this.value);var i=ht(t),o=this.children.get(i);return o?o.foreachOnPath_(pt(t),gt(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(ct(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(gt(e,n),t)}),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})},e}(),Rr=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new Nr(null))},e}();function Ar(e,t,n){if(mt(t))return new Rr(new Nr(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,a=Ct(i,t);return o=o.updateChild(a,n),new Rr(e.writeTree_.set(i,o))}var s=new Nr(n),u=e.writeTree_.setTree(t,s);return new Rr(u)}function Dr(e,t,n){var r=e;return L(n,function(e,n){r=Ar(r,gt(t,e),n)}),r}function Or(e,t){if(mt(t))return Rr.empty();var n=e.writeTree_.setTree(t,new Nr(null));return new Rr(n)}function Mr(e,t){return null!=qr(e,t)}function qr(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ct(n.path,t)):null}function Fr(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(cn,function(e,n){t.push(new Ut(e,n))}):e.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new Ut(e,n.value))}),t}function Lr(e,t){if(mt(t))return e;var n=qr(e,t);return new Rr(null!=n?new Nr(n):e.writeTree_.subtree(t))}function Wr(e){return e.writeTree_.isEmpty()}function jr(e,t){return Ur(ct(),e.writeTree_,t)}function Ur(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var i=null;return t.children.inorderTraversal(function(t,o){".priority"===t?((0,r.assert)(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):n=Ur(gt(e,t),o,n)}),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(gt(e,".priority"),i)),n}function Br(e,t){return hi(t,e)}function Vr(e,t,n,i,o){(0,r.assert)(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(e.visibleWrites=Ar(e.visibleWrites,t,n)),e.lastWriteId=i}function Qr(e,t,n,i){(0,r.assert)(i>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:i,visible:!0}),e.visibleWrites=Dr(e.visibleWrites,t,n),e.lastWriteId=i}function Hr(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}function zr(e,t){var n=e.allWrites.findIndex(function(e){return e.writeId===t});(0,r.assert)(n>=0,"removeWrite called with nonexistent writeId.");var i=e.allWrites[n];e.allWrites.splice(n,1);for(var o=i.visible,a=!1,s=e.allWrites.length-1;o&&s>=0;){var u=e.allWrites[s];u.visible&&(s>=n&&Yr(u,i.path)?o=!1:Tt(i.path,u.path)&&(a=!0)),s--}if(o){if(a)return Kr(e),!0;i.snap?e.visibleWrites=Or(e.visibleWrites,i.path):L(i.children,function(t){e.visibleWrites=Or(e.visibleWrites,gt(i.path,t))});return!0}return!1}function Yr(e,t){if(e.snap)return Tt(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&Tt(gt(e.path,n),t))return!0;return!1}function Kr(e){e.visibleWrites=$r(e.allWrites,Gr,ct()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function Gr(e){return e.visible}function $r(e,t,n){for(var i=Rr.empty(),o=0;o<e.length;++o){var a=e[o];if(t(a)){var s=a.path,u=void 0;if(a.snap)Tt(n,s)?i=Ar(i,u=Ct(n,s),a.snap):Tt(s,n)&&(u=Ct(s,n),i=Ar(i,ct(),a.snap.getChild(u)));else{if(!a.children)throw(0,r.assertionError)("WriteRecord should have .snap or .children");if(Tt(n,s))i=Dr(i,u=Ct(n,s),a.children);else if(Tt(s,n))if(mt(u=Ct(s,n)))i=Dr(i,ct(),a.children);else{var l=(0,r.safeGet)(a.children,ht(u));if(l){var c=l.getChild(pt(u));i=Ar(i,ct(),c)}}}}}return i}function Jr(e,t,n,r,i){if(r||i){var o=Lr(e.visibleWrites,t);if(!i&&Wr(o))return n;if(i||null!=n||Mr(o,ct())){return jr($r(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Tt(e.path,t)||Tt(t,e.path))},t),n||vn.EMPTY_NODE)}return null}var a=qr(e.visibleWrites,t);if(null!=a)return a;var s=Lr(e.visibleWrites,t);return Wr(s)?n:null!=n||Mr(s,ct())?jr(s,n||vn.EMPTY_NODE):null}function Xr(e,t,n){var r=vn.EMPTY_NODE,i=qr(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(cn,function(e,t){r=r.updateImmediateChild(e,t)}),r;if(n){var o=Lr(e.visibleWrites,t);return n.forEachChild(cn,function(e,t){var n=jr(Lr(o,new lt(e)),t);r=r.updateImmediateChild(e,n)}),Fr(o).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}return Fr(Lr(e.visibleWrites,t)).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}function Zr(e,t,n,i,o){(0,r.assert)(i||o,"Either existingEventSnap or existingServerSnap must exist");var a=gt(t,n);if(Mr(e.visibleWrites,a))return null;var s=Lr(e.visibleWrites,a);return Wr(s)?o.getChild(n):jr(s,o.getChild(n))}function ei(e,t,n,r){var i=gt(t,n),o=qr(e.visibleWrites,i);return null!=o?o:r.isCompleteForChild(n)?jr(Lr(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}function ti(e,t){return qr(e.visibleWrites,t)}function ni(e,t,n,r,i,o,a){var s,u=Lr(e.visibleWrites,t),l=qr(u,ct());if(null!=l)s=l;else{if(null==n)return[];s=jr(u,n)}if((s=s.withIndex(a)).isEmpty()||s.isLeafNode())return[];for(var c=[],h=a.getCompare(),d=o?s.getReverseIteratorFrom(r,a):s.getIteratorFrom(r,a),p=d.getNext();p&&c.length<i;)0!==h(p,r)&&c.push(p),p=d.getNext();return c}function ri(){return{visibleWrites:Rr.empty(),allWrites:[],lastWriteId:-1}}function ii(e,t,n,r){return Jr(e.writeTree,e.treePath,t,n,r)}function oi(e,t){return Xr(e.writeTree,e.treePath,t)}function ai(e,t,n,r){return Zr(e.writeTree,e.treePath,t,n,r)}function si(e,t){return ti(e.writeTree,gt(e.treePath,t))}function ui(e,t,n,r,i,o){return ni(e.writeTree,e.treePath,t,n,r,i,o)}function li(e,t,n){return ei(e.writeTree,e.treePath,t,n)}function ci(e,t){return hi(gt(e.treePath,t),e.writeTree)}function hi(e,t){return{treePath:e,writeTree:t}}var di=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;(0,r.assert)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,r.assert)(".priority"!==n,"Only non-priority child changes can be tracked.");var i=this.changeMap.get(n);if(i){var o=i.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,On(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,Dn(n,i.oldSnap));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,An(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw(0,r.assertionError)("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,On(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),pi=function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}(),fi=new pi,_i=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new gr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return li(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Pr(this.viewCache_),i=ui(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]},e}();function vi(e){return{filter:e}}function yi(e,t){(0,r.assert)(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),(0,r.assert)(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function gi(e,t,n,i,o){var a,s,u=new di;if(n.type===rr.OVERWRITE){var l=n;l.source.fromUser?a=bi(e,t,l.path,l.snap,i,o,u):((0,r.assert)(l.source.fromServer,"Unknown source."),s=l.source.tagged||t.serverCache.isFiltered()&&!mt(l.path),a=wi(e,t,l.path,l.snap,i,o,s,u))}else if(n.type===rr.MERGE){var c=n;c.source.fromUser?a=ki(e,t,c.path,c.children,i,o,u):((0,r.assert)(c.source.fromServer,"Unknown source."),s=c.source.tagged||t.serverCache.isFiltered(),a=Ei(e,t,c.path,c.children,i,o,s,u))}else if(n.type===rr.ACK_USER_WRITE){var h=n;a=h.revert?xi(e,t,h.path,i,o,u):Si(e,t,h.path,h.affectedTree,i,o,u)}else{if(n.type!==rr.LISTEN_COMPLETE)throw(0,r.assertionError)("Unknown operation type: "+n.type);a=Pi(e,t,n.path,i,u)}var d=u.getChanges();return mi(t,a,d),{viewCache:a,changes:d}}function mi(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Sr(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Rn(Sr(t)))}}function Ci(e,t,n,i,o,a){var s=t.eventCache;if(null!=si(i,n))return t;var u=void 0,l=void 0;if(mt(n))if((0,r.assert)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var c=Pr(t),h=oi(i,c instanceof vn?c:vn.EMPTY_NODE);u=e.filter.updateFullNode(t.eventCache.getNode(),h,a)}else{var d=ii(i,Pr(t));u=e.filter.updateFullNode(t.eventCache.getNode(),d,a)}else{var p=ht(n);if(".priority"===p){(0,r.assert)(1===dt(n),"Can't have a priority with additional path components");var f=s.getNode(),_=ai(i,n,f,l=t.serverCache.getNode());u=null!=_?e.filter.updatePriority(f,_):s.getNode()}else{var v=pt(n),y=void 0;if(s.isCompleteForChild(p)){l=t.serverCache.getNode();var g=ai(i,n,s.getNode(),l);y=null!=g?s.getNode().getImmediateChild(p).updateChild(v,g):s.getNode().getImmediateChild(p)}else y=li(i,p,t.serverCache);u=null!=y?e.filter.updateChild(s.getNode(),p,y,v,o,a):s.getNode()}}return Ir(t,u,s.isFullyInitialized()||mt(n),e.filter.filtersNodes())}function wi(e,t,n,r,i,o,a,s){var u,l=t.serverCache,c=a?e.filter:e.filter.getIndexedFilter();if(mt(n))u=c.updateFullNode(l.getNode(),r,null);else if(c.filtersNodes()&&!l.isFiltered()){var h=l.getNode().updateChild(n,r);u=c.updateFullNode(l.getNode(),h,null)}else{var d=ht(n);if(!l.isCompleteForPath(n)&&dt(n)>1)return t;var p=pt(n),f=l.getNode().getImmediateChild(d).updateChild(p,r);u=".priority"===d?c.updatePriority(l.getNode(),f):c.updateChild(l.getNode(),d,f,p,fi,null)}var _=Er(t,u,l.isFullyInitialized()||mt(n),c.filtersNodes());return Ci(e,_,n,i,new _i(i,_,o),s)}function bi(e,t,n,r,i,o,a){var s,u,l=t.eventCache,c=new _i(i,t,o);if(mt(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,a),s=Ir(t,u,!0,e.filter.filtersNodes());else{var h=ht(n);if(".priority"===h)u=e.filter.updatePriority(t.eventCache.getNode(),r),s=Ir(t,u,l.isFullyInitialized(),l.isFiltered());else{var d=pt(n),p=l.getNode().getImmediateChild(h),f=void 0;if(mt(d))f=r;else{var _=c.getCompleteChild(h);f=null!=_?".priority"===ft(d)&&_.getChild(yt(d)).isEmpty()?_:_.updateChild(d,r):vn.EMPTY_NODE}if(p.equals(f))s=t;else s=Ir(t,e.filter.updateChild(l.getNode(),h,f,d,c,a),l.isFullyInitialized(),e.filter.filtersNodes())}}return s}function Ti(e,t){return e.eventCache.isCompleteForChild(t)}function ki(e,t,n,r,i,o,a){var s=t;return r.foreach(function(r,u){var l=gt(n,r);Ti(t,ht(l))&&(s=bi(e,s,l,u,i,o,a))}),r.foreach(function(r,u){var l=gt(n,r);Ti(t,ht(l))||(s=bi(e,s,l,u,i,o,a))}),s}function Ii(e,t,n){return n.foreach(function(e,n){t=t.updateChild(e,n)}),t}function Ei(e,t,n,r,i,o,a,s){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,l=t;u=mt(n)?r:new Nr(null).setTree(n,r);var c=t.serverCache.getNode();return u.children.inorderTraversal(function(n,r){if(c.hasChild(n)){var u=t.serverCache.getNode().getImmediateChild(n),h=Ii(e,u,r);l=wi(e,l,new lt(n),h,i,o,a,s)}}),u.children.inorderTraversal(function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!c.hasChild(n)&&!u){var h=t.serverCache.getNode().getImmediateChild(n),d=Ii(e,h,r);l=wi(e,l,new lt(n),d,i,o,a,s)}}),l}function Si(e,t,n,r,i,o,a){if(null!=si(i,n))return t;var s=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(mt(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return wi(e,t,n,u.getNode().getChild(n),i,o,s,a);if(mt(n)){var l=new Nr(null);return u.getNode().forEachChild(Qt,function(e,t){l=l.set(new lt(e),t)}),Ei(e,t,n,l,i,o,s,a)}return t}var c=new Nr(null);return r.foreach(function(e,t){var r=gt(n,e);u.isCompleteForPath(r)&&(c=c.set(e,u.getNode().getChild(r)))}),Ei(e,t,n,c,i,o,s,a)}function Pi(e,t,n,r,i){var o=t.serverCache;return Ci(e,Er(t,o.getNode(),o.isFullyInitialized()||mt(n),o.isFiltered()),n,r,fi,i)}function xi(e,t,n,i,o,a){var s;if(null!=si(i,n))return t;var u=new _i(i,t,o),l=t.eventCache.getNode(),c=void 0;if(mt(n)||".priority"===ht(n)){var h=void 0;if(t.serverCache.isFullyInitialized())h=ii(i,Pr(t));else{var d=t.serverCache.getNode();(0,r.assert)(d instanceof vn,"serverChildren would be complete if leaf node"),h=oi(i,d)}h=h,c=e.filter.updateFullNode(l,h,a)}else{var p=ht(n),f=li(i,p,t.serverCache);null==f&&t.serverCache.isCompleteForChild(p)&&(f=l.getImmediateChild(p)),(c=null!=f?e.filter.updateChild(l,p,f,pt(n),u,a):t.eventCache.getNode().hasChild(p)?e.filter.updateChild(l,p,vn.EMPTY_NODE,pt(n),u,a):l).isEmpty()&&t.serverCache.isFullyInitialized()&&(s=ii(i,Pr(t))).isLeafNode()&&(c=e.filter.updateFullNode(c,s,a))}return s=t.serverCache.isFullyInitialized()||null!=si(i,ct()),Ir(t,c,s,e.filter.filtersNodes())}var Ni,Ri=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_._queryParams,r=new qn(n.getIndex()),i=jn(n);this.processor_=vi(i);var o=t.serverCache,a=t.eventCache,s=r.updateFullNode(vn.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(vn.EMPTY_NODE,a.getNode(),null),l=new gr(s,o.isFullyInitialized(),r.filtersNodes()),c=new gr(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=kr(c,l),this.eventGenerator_=new mr(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function Ai(e){return e.viewCache_.serverCache.getNode()}function Di(e){return Sr(e.viewCache_)}function Oi(e,t){var n=Pr(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!mt(t)&&!n.getImmediateChild(ht(t)).isEmpty())?n.getChild(t):null}function Mi(e){return 0===e.eventRegistrations_.length}function qi(e,t){e.eventRegistrations_.push(t)}function Fi(e,t,n){var i=[];if(n){(0,r.assert)(null==t,"A cancel should cancel all event registrations.");var o=e.query._path;e.eventRegistrations_.forEach(function(e){var t=e.createCancelEvent(n,o);t&&i.push(t)})}if(t){for(var a=[],s=0;s<e.eventRegistrations_.length;++s){var u=e.eventRegistrations_[s];if(u.matches(t)){if(t.hasAnyCallback()){a=a.concat(e.eventRegistrations_.slice(s+1));break}}else a.push(u)}e.eventRegistrations_=a}else e.eventRegistrations_=[];return i}function Li(e,t,n,i){t.type===rr.MERGE&&null!==t.source.queryId&&((0,r.assert)(Pr(e.viewCache_),"We should always have a full cache before handling merges"),(0,r.assert)(Sr(e.viewCache_),"Missing event cache, even though we have a server cache"));var o=e.viewCache_,a=gi(e.processor_,o,t,n,i);return yi(e.processor_,a.viewCache),(0,r.assert)(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,ji(e,a.changes,a.viewCache.eventCache.getNode(),null)}function Wi(e,t){var n=e.viewCache_.eventCache,r=[];n.getNode().isLeafNode()||n.getNode().forEachChild(cn,function(e,t){r.push(An(e,t))});return n.isFullyInitialized()&&r.push(Rn(n.getNode())),ji(e,r,n.getNode(),t)}function ji(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return Cr(e.eventGenerator_,t,n,i)}var Ui,Bi=function(){return function(){this.views=new Map}}();function Vi(e){(0,r.assert)(!Ni,"__referenceConstructor has already been defined"),Ni=e}function Qi(){return(0,r.assert)(Ni,"Reference.ts has not been loaded"),Ni}function Hi(e){return 0===e.views.size}function zi(e,t,n,o){var a,s,u=t.source.queryId;if(null!==u){var l=e.views.get(u);return(0,r.assert)(null!=l,"SyncTree gave us an op for an invalid query."),Li(l,t,n,o)}var c=[];try{for(var h=(0,i.__values)(e.views.values()),d=h.next();!d.done;d=h.next()){l=d.value;c=c.concat(Li(l,t,n,o))}}catch(p){a={error:p}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}return c}function Yi(e,t,n,r,i){var o=t._queryIdentifier,a=e.views.get(o);if(!a){var s=ii(n,i?r:null),u=!1;s?u=!0:r instanceof vn?(s=oi(n,r),u=!1):(s=vn.EMPTY_NODE,u=!1);var l=kr(new gr(s,u,!1),new gr(r,i,!1));return new Ri(t,l)}return a}function Ki(e,t,n,r,i,o){var a=Yi(e,t,r,i,o);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,a),qi(a,n),Wi(a,n)}function Gi(e,t,n,r){var o,a,s=t._queryIdentifier,u=[],l=[],c=eo(e);if("default"===s)try{for(var h=(0,i.__values)(e.views.entries()),d=h.next();!d.done;d=h.next()){var p=(0,i.__read)(d.value,2),f=p[0],_=p[1];l=l.concat(Fi(_,n,r)),Mi(_)&&(e.views.delete(f),_.query._queryParams.loadsAllData()||u.push(_.query))}}catch(v){o={error:v}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}else(_=e.views.get(s))&&(l=l.concat(Fi(_,n,r)),Mi(_)&&(e.views.delete(s),_.query._queryParams.loadsAllData()||u.push(_.query)));return c&&!eo(e)&&u.push(new(Qi())(t._repo,t._path)),{removed:u,events:l}}function $i(e){var t,n,r=[];try{for(var o=(0,i.__values)(e.views.values()),a=o.next();!a.done;a=o.next()){var s=a.value;s.query._queryParams.loadsAllData()||r.push(s)}}catch(u){t={error:u}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function Ji(e,t){var n,r,o=null;try{for(var a=(0,i.__values)(e.views.values()),s=a.next();!s.done;s=a.next()){var u=s.value;o=o||Oi(u,t)}}catch(l){n={error:l}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o}function Xi(e,t){if(t._queryParams.loadsAllData())return to(e);var n=t._queryIdentifier;return e.views.get(n)}function Zi(e,t){return null!=Xi(e,t)}function eo(e){return null!=to(e)}function to(e){var t,n;try{for(var r=(0,i.__values)(e.views.values()),o=r.next();!o.done;o=r.next()){var a=o.value;if(a.query._queryParams.loadsAllData())return a}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}function no(e){(0,r.assert)(!Ui,"__referenceConstructor has already been defined"),Ui=e}function ro(){return(0,r.assert)(Ui,"Reference.ts has not been loaded"),Ui}var io=1,oo=function(){return function(e){this.listenProvider_=e,this.syncPointTree_=new Nr(null),this.pendingWriteTree_=ri(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}();function ao(e,t,n,r,i){return Vr(e.pendingWriteTree_,t,n,r,i),i?Co(e,new vr(cr(),t,n)):[]}function so(e,t,n,r){Qr(e.pendingWriteTree_,t,n,r);var i=Nr.fromObject(n);return Co(e,new yr(cr(),t,i))}function uo(e,t,n){void 0===n&&(n=!1);var r=Hr(e.pendingWriteTree_,t);if(zr(e.pendingWriteTree_,t)){var i=new Nr(null);return null!=r.snap?i=i.set(ct(),!0):L(r.children,function(e){i=i.set(new lt(e),!0)}),Co(e,new fr(r.path,i,n))}return[]}function lo(e,t,n){return Co(e,new vr(hr(),t,n))}function co(e,t,n){var r=Nr.fromObject(n);return Co(e,new yr(hr(),t,r))}function ho(e,t){return Co(e,new _r(hr(),t))}function po(e,t,n){var r=Eo(e,n);if(r){var i=So(r),o=i.path,a=i.queryId,s=Ct(o,t);return Po(e,o,new _r(dr(a),s))}return[]}function fo(e,t,n,r){var i=t._path,o=e.syncPointTree_.get(i),a=[];if(o&&("default"===t._queryIdentifier||Zi(o,t))){var s=Gi(o,t,n,r);Hi(o)&&(e.syncPointTree_=e.syncPointTree_.remove(i));var u=s.removed;a=s.events;var l=-1!==u.findIndex(function(e){return e._queryParams.loadsAllData()}),c=e.syncPointTree_.findOnPath(i,function(e,t){return eo(t)});if(l&&!c){var h=e.syncPointTree_.subtree(i);if(!h.isEmpty())for(var d=xo(h),p=0;p<d.length;++p){var f=d[p],_=f.query,v=To(e,f);e.listenProvider_.startListening(No(_),ko(e,_),v.hashFn,v.onComplete)}}if(!c&&u.length>0&&!r)if(l){e.listenProvider_.stopListening(No(t),null)}else u.forEach(function(t){var n=e.queryToTagMap.get(Io(t));e.listenProvider_.stopListening(No(t),n)});Ro(e,u)}return a}function _o(e,t,n,r){var i=Eo(e,r);if(null!=i){var o=So(i),a=o.path,s=o.queryId,u=Ct(a,t);return Po(e,a,new vr(dr(s),u,n))}return[]}function vo(e,t,n,r){var i=Eo(e,r);if(i){var o=So(i),a=o.path,s=o.queryId,u=Ct(a,t),l=Nr.fromObject(n);return Po(e,a,new yr(dr(s),u,l))}return[]}function yo(e,t,n){var i=t._path,o=null,a=!1;e.syncPointTree_.foreachOnPath(i,function(e,t){var n=Ct(e,i);o=o||Ji(t,n),a=a||eo(t)});var s,u=e.syncPointTree_.get(i);(u?(a=a||eo(u),o=o||Ji(u,ct())):(u=new Bi,e.syncPointTree_=e.syncPointTree_.set(i,u)),null!=o)?s=!0:(s=!1,o=vn.EMPTY_NODE,e.syncPointTree_.subtree(i).foreachChild(function(e,t){var n=Ji(t,ct());n&&(o=o.updateImmediateChild(e,n))}));var l=Zi(u,t);if(!l&&!t._queryParams.loadsAllData()){var c=Io(t);(0,r.assert)(!e.queryToTagMap.has(c),"View does not exist, but we have a tag");var h=Ao();e.queryToTagMap.set(c,h),e.tagToQueryMap.set(h,c)}var d=Ki(u,t,n,Br(e.pendingWriteTree_,i),o,s);if(!l&&!a){var p=Xi(u,t);d=d.concat(Do(e,t,p))}return d}function go(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,function(e,n){var r=Ji(n,Ct(e,t));if(r)return r});return Jr(r,t,i,n,!0)}function mo(e,t){var n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,function(e,t){var i=Ct(e,n);r=r||Ji(t,i)});var i=e.syncPointTree_.get(n);i?r=r||Ji(i,ct()):(i=new Bi,e.syncPointTree_=e.syncPointTree_.set(n,i));var o=null!=r,a=o?new gr(r,!0,!1):null;return Di(Yi(i,t,Br(e.pendingWriteTree_,t._path),o?a.getNode():vn.EMPTY_NODE,o))}function Co(e,t){return wo(t,e.syncPointTree_,null,Br(e.pendingWriteTree_,ct()))}function wo(e,t,n,r){if(mt(e.path))return bo(e,t,n,r);var i=t.get(ct());null==n&&null!=i&&(n=Ji(i,ct()));var o=[],a=ht(e.path),s=e.operationForChild(a),u=t.children.get(a);if(u&&s){var l=n?n.getImmediateChild(a):null,c=ci(r,a);o=o.concat(wo(s,u,l,c))}return i&&(o=o.concat(zi(i,e,r,n))),o}function bo(e,t,n,r){var i=t.get(ct());null==n&&null!=i&&(n=Ji(i,ct()));var o=[];return t.children.inorderTraversal(function(t,i){var a=n?n.getImmediateChild(t):null,s=ci(r,t),u=e.operationForChild(t);u&&(o=o.concat(bo(u,i,a,s)))}),i&&(o=o.concat(zi(i,e,r,n))),o}function To(e,t){var n=t.query,r=ko(e,n);return{hashFn:function(){return(Ai(t)||vn.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?po(e,n._path,r):ho(e,n._path);var i=B(t,n);return fo(e,n,null,i)}}}function ko(e,t){var n=Io(t);return e.queryToTagMap.get(n)}function Io(e){return e._path.toString()+"$"+e._queryIdentifier}function Eo(e,t){return e.tagToQueryMap.get(t)}function So(e){var t=e.indexOf("$");return(0,r.assert)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new lt(e.substr(0,t))}}function Po(e,t,n){var i=e.syncPointTree_.get(t);return(0,r.assert)(i,"Missing sync point for query tag that we're tracking"),zi(i,n,Br(e.pendingWriteTree_,t),null)}function xo(e){return e.fold(function(e,t,n){if(t&&eo(t))return[to(t)];var r=[];return t&&(r=$i(t)),L(n,function(e,t){r=r.concat(t)}),r})}function No(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(ro())(e._repo,e._path):e}function Ro(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var i=Io(r),o=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(o)}}}function Ao(){return io++}function Do(e,t,n){var i=t._path,o=ko(e,t),a=To(e,n),s=e.listenProvider_.startListening(No(t),o,a.hashFn,a.onComplete),u=e.syncPointTree_.subtree(i);if(o)(0,r.assert)(!eo(u.value),"If we're adding a query, it shouldn't be shadowed");else for(var l=u.fold(function(e,t,n){if(!mt(e)&&t&&eo(t))return[to(t).query];var r=[];return t&&(r=r.concat($i(t).map(function(e){return e.query}))),L(n,function(e,t){r=r.concat(t)}),r}),c=0;c<l.length;++c){var h=l[c];e.listenProvider_.stopListening(No(h),ko(e,h))}return s}var Oo=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),Mo=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=gt(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return go(this.syncTree_,this.path_)},e}(),qo=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Fo=function(e,t,n){return e&&"object"==typeof e?((0,r.assert)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Lo(e[".sv"],t,n):"object"==typeof e[".sv"]?Wo(e[".sv"],t):void(0,r.assert)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Lo=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:(0,r.assert)(!1,"Unexpected server value: "+e)}},Wo=function(e,t,n){e.hasOwnProperty("increment")||(0,r.assert)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var i=e.increment;"number"!=typeof i&&(0,r.assert)(!1,"Unexpected increment value: "+i);var o=t.node();if((0,r.assert)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;var a=o.getValue();return"number"!=typeof a?i:a+i},jo=function(e,t,n,r){return Bo(t,new Mo(n,e),r)},Uo=function(e,t,n){return Bo(e,new Oo(t),n)};function Bo(e,t,n){var r,i=e.getPriority().val(),o=Fo(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var a=e,s=Fo(a.getValue(),t,n);return s!==a.getValue()||o!==a.getPriority().val()?new rn(s,Cn(o)):e}var u=e;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new rn(o))),u.forEachChild(cn,function(e,i){var o=Bo(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))}),r}var Vo=function(){return function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n}}();function Qo(e,t){for(var n=t instanceof lt?t:new lt(t),i=e,o=ht(n);null!==o;){var a=(0,r.safeGet)(i.node.children,o)||{children:{},childCount:0};i=new Vo(o,i,a),o=ht(n=pt(n))}return i}function Ho(e){return e.node.value}function zo(e,t){e.node.value=t,Zo(e)}function Yo(e){return e.node.childCount>0}function Ko(e){return void 0===Ho(e)&&!Yo(e)}function Go(e,t){L(e.node.children,function(n,r){t(new Vo(n,e,r))})}function $o(e,t,n,r){n&&!r&&t(e),Go(e,function(e){$o(e,t,!0,r)}),n&&r&&t(e)}function Jo(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return!0;r=r.parent}return!1}function Xo(e){return new lt(null===e.parent?e.name:Xo(e.parent)+"/"+e.name)}function Zo(e){null!==e.parent&&ea(e.parent,e.name,e)}function ea(e,t,n){var i=Ko(n),o=(0,r.contains)(e.node.children,t);i&&o?(delete e.node.children[t],e.node.childCount--,Zo(e)):i||o||(e.node.children[t]=n.node,e.node.childCount++,Zo(e))}var ta=/[\[\].#$\/\u0000-\u001F\u007F]/,na=/[\[\].#$\u0000-\u001F\u007F]/,ra=10485760,ia=function(e){return"string"==typeof e&&0!==e.length&&!ta.test(e)},oa=function(e){return"string"==typeof e&&0!==e.length&&!na.test(e)},aa=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),oa(e)},sa=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!x(e)||e&&"object"==typeof e&&(0,r.contains)(e,".sv")},ua=function(e,t,n,i){i&&void 0===t||la((0,r.errorPrefix)(e,"value"),t,n)},la=function(e,t,n){var i=n instanceof lt?new kt(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Pt(i));if("function"==typeof t)throw new Error(e+"contains a function "+Pt(i)+" with contents = "+t.toString());if(x(t))throw new Error(e+"contains "+t.toString()+" "+Pt(i));if("string"==typeof t&&t.length>ra/3&&(0,r.stringLength)(t)>ra)throw new Error(e+"contains a string greater than "+ra+" utf8 bytes "+Pt(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var o=!1,a=!1;if(L(t,function(t,n){if(".value"===t)o=!0;else if(".priority"!==t&&".sv"!==t&&(a=!0,!ia(t)))throw new Error(e+" contains an invalid key ("+t+") "+Pt(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');It(i,t),la(e,n,i),Et(i)}),o&&a)throw new Error(e+' contains ".value" child '+Pt(i)+" in addition to actual children.")}},ca=function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=vt(r=t[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ia(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(wt);var a=null;for(n=0;n<t.length;n++){if(r=t[n],null!==a&&Tt(a,r))throw new Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}},ha=function(e,t,n,i){if(!i||void 0!==t){var o=(0,r.errorPrefix)(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(o+" must be an object containing the children to replace.");var a=[];L(t,function(e,t){var r=new lt(e);if(la(o,t,gt(n,r)),".priority"===ft(r)&&!sa(t))throw new Error(o+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(r)}),ca(o,a)}},da=function(e,t,n){if(!n||void 0!==t){if(x(t))throw new Error((0,r.errorPrefix)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!sa(t))throw new Error((0,r.errorPrefix)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},pa=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,r.errorPrefix)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},fa=function(e,t,n,i){if(!(i&&void 0===n||ia(n)))throw new Error((0,r.errorPrefix)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},_a=function(e,t,n,i){if(!(i&&void 0===n||oa(n)))throw new Error((0,r.errorPrefix)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},va=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),_a(e,t,n,r)},ya=function(e,t){if(".info"===ht(t))throw new Error(e+" failed = Can't modify data under /.info/")},ga=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!ia(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!aa(n))throw new Error((0,r.errorPrefix)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ma=function(e,t,n,i){if((!i||void 0!==n)&&"boolean"!=typeof n)throw new Error((0,r.errorPrefix)(e,t)+"must be a boolean.")},Ca=function(){return function(){this.eventLists_=[],this.recursionDepth_=0}}();function wa(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||bt(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function ba(e,t,n){wa(e,n),ka(e,function(e){return bt(e,t)})}function Ta(e,t,n){wa(e,n),ka(e,function(e){return Tt(e,t)||Tt(t,e)})}function ka(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];if(i)t(i.path)?(Ia(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function Ia(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();C&&T("event: "+n.toString()),Y(r)}}}var Ea="repo_interrupt",Sa=25,Pa=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ca,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xn(),this.transactionQueueTree_=new Vo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function xa(e,t,n){if(e.stats_=ve(e.repoInfo_),e.forceRestClient_||K())e.server_=new $n(e.repoInfo_,function(t,n,r,i){Aa(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(function(){return Oa(e,!0)},0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,r.stringify)(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}e.persistentConnection_=new jt(e.repoInfo_,t,function(t,n,r,i){Aa(e,t,n,r,i)},function(t){Oa(e,t)},function(t){Ma(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(function(t){e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(function(t){e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=ye(e.repoInfo_,function(){return new ur(e.stats_,e.server_)}),e.infoData_=new Jn,e.infoSyncTree_=new oo({startListening:function(t,n,r,i){var o=[],a=e.infoData_.getNode(t._path);return a.isEmpty()||(o=lo(e.infoSyncTree_,t._path,a),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),qa(e,"connected",!1),e.serverSyncTree_=new oo({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,function(n,r){var o=i(n,r);Ta(e.eventQueue_,t._path,o)}),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function Na(e){var t=e.infoData_.getNode(new lt(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Ra(e){return qo({timestamp:Na(e)})}function Aa(e,t,n,i,o){e.dataUpdateCount++;var a=new lt(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var s=[];if(o)if(i){var u=(0,r.map)(n,function(e){return Cn(e)});s=vo(e.serverSyncTree_,a,u,o)}else{var l=Cn(n);s=_o(e.serverSyncTree_,a,l,o)}else if(i){var c=(0,r.map)(n,function(e){return Cn(e)});s=co(e.serverSyncTree_,a,c)}else{var h=Cn(n);s=lo(e.serverSyncTree_,a,h)}var d=a;s.length>0&&(d=is(e,a)),Ta(e.eventQueue_,d,s)}function Da(e,t){e.interceptServerDataCallback_=t}function Oa(e,t){qa(e,"connected",t),!1===t&&Ua(e)}function Ma(e,t){L(t,function(t,n){qa(e,t,n)})}function qa(e,t,n){var r=new lt("/.info/"+t),i=Cn(n);e.infoData_.updateSnapshot(r,i);var o=lo(e.infoSyncTree_,r,i);Ta(e.eventQueue_,r,o)}function Fa(e){return e.nextWriteId_++}function La(e,t){var n=mo(e.serverSyncTree_,t);return null!=n?Promise.resolve(n):e.server_.get(t).then(function(n){var r=Cn(n).withIndex(t._queryParams.getIndex()),i=lo(e.serverSyncTree_,t._path,r);return ba(e.eventQueue_,t._path,i),Promise.resolve(r)},function(n){return Xa(e,"get for query "+(0,r.stringify)(t)+" failed: "+n),Promise.reject(new Error(n))})}function Wa(e,t,n,r,i){Xa(e,"set",{path:t.toString(),value:n,priority:r});var o=Ra(e),a=Cn(n,r),s=go(e.serverSyncTree_,t),u=Uo(a,s,o),l=Fa(e),c=ao(e.serverSyncTree_,t,u,l,!0);wa(e.eventQueue_,c),e.server_.put(t.toString(),a.val(!0),function(n,r){var o="ok"===n;o||S("set at "+t+" failed: "+n);var a=uo(e.serverSyncTree_,l,!o);Ta(e.eventQueue_,t,a),Za(e,i,n,r)});var h=cs(e,t);is(e,h),Ta(e.eventQueue_,h,[])}function ja(e,t,n,r){Xa(e,"update",{path:t.toString(),value:n});var i=!0,o=Ra(e),a={};if(L(n,function(n,r){i=!1,a[n]=jo(gt(t,n),Cn(r),e.serverSyncTree_,o)}),i)T("update() called with empty data.  Don't do anything."),Za(e,r,"ok",void 0);else{var s=Fa(e),u=so(e.serverSyncTree_,t,a,s);wa(e.eventQueue_,u),e.server_.merge(t.toString(),n,function(n,i){var o="ok"===n;o||S("update at "+t+" failed: "+n);var a=uo(e.serverSyncTree_,s,!o),u=a.length>0?is(e,t):t;Ta(e.eventQueue_,u,a),Za(e,r,n,i)}),L(n,function(n){var r=cs(e,gt(t,n));is(e,r)}),Ta(e.eventQueue_,t,[])}}function Ua(e){Xa(e,"onDisconnectEvents");var t=Ra(e),n=Xn();tr(e.onDisconnect_,ct(),function(r,i){var o=jo(r,i,e.serverSyncTree_,t);Zn(n,r,o)});var r=[];tr(n,ct(),function(t,n){r=r.concat(lo(e.serverSyncTree_,t,n));var i=cs(e,t);is(e,i)}),e.onDisconnect_=Xn(),Ta(e.eventQueue_,ct(),r)}function Ba(e,t,n){e.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&er(e.onDisconnect_,t),Za(e,n,r,i)})}function Va(e,t,n,r){var i=Cn(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),function(n,o){"ok"===n&&Zn(e.onDisconnect_,t,i),Za(e,r,n,o)})}function Qa(e,t,n,r,i){var o=Cn(n,r);e.server_.onDisconnectPut(t.toString(),o.val(!0),function(n,r){"ok"===n&&Zn(e.onDisconnect_,t,o),Za(e,i,n,r)})}function Ha(e,t,n,i){if((0,r.isEmpty)(n))return T("onDisconnect().update() called with empty data.  Don't do anything."),void Za(e,i,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,function(r,o){"ok"===r&&L(n,function(n,r){var i=Cn(r);Zn(e.onDisconnect_,gt(t,n),i)}),Za(e,i,r,o)})}function za(e,t,n){var r;r=".info"===ht(t._path)?yo(e.infoSyncTree_,t,n):yo(e.serverSyncTree_,t,n),ba(e.eventQueue_,t._path,r)}function Ya(e,t,n){var r;r=".info"===ht(t._path)?fo(e.infoSyncTree_,t,n):fo(e.serverSyncTree_,t,n),ba(e.eventQueue_,t._path,r)}function Ka(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Ea)}function Ga(e){e.persistentConnection_&&e.persistentConnection_.resume(Ea)}function $a(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var n;t?(e.statsListener_||(e.statsListener_=new ir(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var r=Object.keys(n).reduce(function(e,t){return Math.max(t.length,e)},0);L(n,function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)})}}function Ja(e,t){e.stats_.incrementCounter(t),lr(e.statsReporter_,t)}function Xa(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),T.apply(void 0,(0,i.__spreadArray)([r],(0,i.__read)(t)))}function Za(e,t,n,r){t&&Y(function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var o=new Error(i);o.code=e,t(o)}})}function es(e,t,n,i,o,a){Xa(e,"transaction on "+t);var s={path:t,update:n,onComplete:i,status:null,order:y(),applyLocally:a,retryCount:0,unwatcher:o,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=ts(e,t,void 0);s.currentInputSnapshot=u;var l=s.update(u.val());if(void 0===l)s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete&&s.onComplete(null,!1,s.currentInputSnapshot);else{la("transaction failed: Data returned ",l,s.path),s.status=0;var c=Qo(e.transactionQueueTree_,t),h=Ho(c)||[];h.push(s),zo(c,h);var d=void 0;if("object"==typeof l&&null!==l&&(0,r.contains)(l,".priority"))d=(0,r.safeGet)(l,".priority"),(0,r.assert)(sa(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else d=(go(e.serverSyncTree_,t)||vn.EMPTY_NODE).getPriority().val();var p=Ra(e),f=Cn(l,d),_=Uo(f,u,p);s.currentOutputSnapshotRaw=f,s.currentOutputSnapshotResolved=_,s.currentWriteId=Fa(e);var v=ao(e.serverSyncTree_,t,_,s.currentWriteId,s.applyLocally);Ta(e.eventQueue_,t,v),ns(e,e.transactionQueueTree_)}}function ts(e,t,n){return go(e.serverSyncTree_,t,n)||vn.EMPTY_NODE}function ns(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||ls(e,t),Ho(t)){var n=ss(e,t);(0,r.assert)(n.length>0,"Sending zero length transaction queue"),n.every(function(e){return 0===e.status})&&rs(e,Xo(t),n)}else Yo(t)&&Go(t,function(t){ns(e,t)})}function rs(e,t,n){for(var i=n.map(function(e){return e.currentWriteId}),o=ts(e,t,i),a=o,s=o.hash(),u=0;u<n.length;u++){var l=n[u];(0,r.assert)(0===l.status,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=1,l.retryCount++;var c=Ct(t,l.path);a=a.updateChild(c,l.currentOutputSnapshotRaw)}var h=a.val(!0),d=t;e.server_.put(d.toString(),h,function(r){Xa(e,"transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=function(t){n[t].status=2,i=i.concat(uo(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push(function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)}),n[t].unwatcher()},s=0;s<n.length;s++)a(s);ls(e,Qo(e.transactionQueueTree_,t)),ns(e,e.transactionQueueTree_),Ta(e.eventQueue_,t,i);for(s=0;s<o.length;s++)Y(o[s])}else{if("datastale"===r)for(s=0;s<n.length;s++)3===n[s].status?n[s].status=4:n[s].status=0;else{S("transaction at "+d.toString()+" failed: "+r);for(s=0;s<n.length;s++)n[s].status=4,n[s].abortReason=r}is(e,t)}},s)}function is(e,t){var n=as(e,t),r=Xo(n);return os(e,ss(e,n),r),r}function os(e,t,n){if(0!==t.length){for(var i=[],o=[],a=t.filter(function(e){return 0===e.status}).map(function(e){return e.currentWriteId}),s=function(s){var u,l,c=t[s],h=Ct(n,c.path),d=!1;if((0,r.assert)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)d=!0,u=c.abortReason,o=o.concat(uo(e.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=Sa)d=!0,u="maxretry",o=o.concat(uo(e.serverSyncTree_,c.currentWriteId,!0));else{var p=ts(e,c.path,a);c.currentInputSnapshot=p;var f=t[s].update(p.val());if(void 0!==f){la("transaction failed: Data returned ",f,c.path);var _=Cn(f);"object"==typeof f&&null!=f&&(0,r.contains)(f,".priority")||(_=_.updatePriority(p.getPriority()));var v=c.currentWriteId,y=Ra(e),g=Uo(_,p,y);c.currentOutputSnapshotRaw=_,c.currentOutputSnapshotResolved=g,c.currentWriteId=Fa(e),a.splice(a.indexOf(v),1),o=(o=o.concat(ao(e.serverSyncTree_,c.path,g,c.currentWriteId,c.applyLocally))).concat(uo(e.serverSyncTree_,v,!0))}else d=!0,u="nodata",o=o.concat(uo(e.serverSyncTree_,c.currentWriteId,!0))}Ta(e.eventQueue_,n,o),o=[],d&&(t[s].status=2,l=t[s].unwatcher,setTimeout(l,Math.floor(0)),t[s].onComplete&&("nodata"===u?i.push(function(){return t[s].onComplete(null,!1,t[s].currentInputSnapshot)}):i.push(function(){return t[s].onComplete(new Error(u),!1,null)})))},u=0;u<t.length;u++)s(u);ls(e,e.transactionQueueTree_);for(u=0;u<i.length;u++)Y(i[u]);ns(e,e.transactionQueueTree_)}}function as(e,t){var n,r=e.transactionQueueTree_;for(n=ht(t);null!==n&&void 0===Ho(r);)r=Qo(r,n),n=ht(t=pt(t));return r}function ss(e,t){var n=[];return us(e,t,n),n.sort(function(e,t){return e.order-t.order}),n}function us(e,t,n){var r=Ho(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);Go(t,function(t){us(e,t,n)})}function ls(e,t){var n=Ho(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,zo(t,n.length>0?n:void 0)}Go(t,function(t){ls(e,t)})}function cs(e,t){var n=Xo(as(e,t)),r=Qo(e.transactionQueueTree_,t);return Jo(r,function(t){hs(e,t)}),hs(e,r),$o(r,function(t){hs(e,t)}),n}function hs(e,t){var n=Ho(t);if(n){for(var i=[],o=[],a=-1,s=0;s<n.length;s++)3===n[s].status||(1===n[s].status?((0,r.assert)(a===s-1,"All SENT items should be at beginning of queue."),a=s,n[s].status=3,n[s].abortReason="set"):((0,r.assert)(0===n[s].status,"Unexpected transaction status in abort"),n[s].unwatcher(),o=o.concat(uo(e.serverSyncTree_,n[s].currentWriteId,!0)),n[s].onComplete&&i.push(n[s].onComplete.bind(null,new Error("set"),!1,null))));-1===a?zo(t,void 0):n.length=a+1,Ta(e.eventQueue_,Xo(t),o);for(s=0;s<i.length;s++)Y(i[s])}}function ds(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}t+="/"+i}return t}function ps(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var o=(0,i.__values)(e.split("&")),a=o.next();!a.done;a=o.next()){var s=a.value;if(0!==s.length){var u=s.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):S("Invalid query segment '"+s+"' in query '"+e+"'")}}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}var fs=function(e,t){var n=_s(e),r=n.namespace;"firebase.com"===n.domain&&E(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||E("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||P();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ce(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new lt(n.pathString)}},_s=function(e){var t="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof e){var l=e.indexOf("//");l>=0&&(s=e.substring(0,l-1),e=e.substring(l+2));var c=e.indexOf("/");-1===c&&(c=e.length);var h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(c,h)),c<h&&(i=ds(e.substring(c,h)));var d=ps(e.substring(Math.min(e.length,h)));(l=t.indexOf(":"))>=0?(a="https"===s||"wss"===s,u=parseInt(t.substring(l+1),10)):l=t.length;var p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var f=t.indexOf(".");r=t.substring(0,f).toLowerCase(),n=t.substring(f+1),o=r}"ns"in d&&(o=d.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},vs=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+(0,r.stringify)(this.snapshot.exportVal())},e}(),ys=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),gs=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return(0,r.assert)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),ms=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new r.Deferred;return Ba(this._repo,this._path,e.wrapCallback(function(){})),e.promise},e.prototype.remove=function(){ya("OnDisconnect.remove",this._path);var e=new r.Deferred;return Va(this._repo,this._path,null,e.wrapCallback(function(){})),e.promise},e.prototype.set=function(e){ya("OnDisconnect.set",this._path),ua("OnDisconnect.set",e,this._path,!1);var t=new r.Deferred;return Va(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},e.prototype.setWithPriority=function(e,t){ya("OnDisconnect.setWithPriority",this._path),ua("OnDisconnect.setWithPriority",e,this._path,!1),da("OnDisconnect.setWithPriority",t,!1);var n=new r.Deferred;return Qa(this._repo,this._path,e,t,n.wrapCallback(function(){})),n.promise},e.prototype.update=function(e){ya("OnDisconnect.update",this._path),ha("OnDisconnect.update",e,this._path,!1);var t=new r.Deferred;return Ha(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},e}(),Cs=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return mt(this._path)?null:ft(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new ks(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=Gn(this._queryParams),t=q(e);return"{}"===t?"default":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return Gn(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!((t=(0,r.getModularInstance)(t))instanceof e))return!1;var n=this._repo===t._repo,i=bt(this._path,t._path),o=this._queryIdentifier===t._queryIdentifier;return n&&i&&o},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+_t(this._path)},e}();function ws(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function bs(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Qt){var i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==R)throw new Error(i);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==A)throw new Error(i);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===cn){if(null!=t&&!sa(t)||null!=n&&!sa(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,r.assert)(e.getIndex()instanceof wn||e.getIndex()===Tn,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ts(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var ks=function(e){function t(t,n){return e.call(this,t,n,new Wn,!1)||this}return(0,i.__extends)(t,e),Object.defineProperty(t.prototype,"parent",{get:function(){var e=yt(this._path);return null===e?null:new t(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),t}(Cs),Is=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(t){var n=new lt(t),r=Ps(this.ref,t);return new e(this._node.getChild(n),r,cn)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,function(r,i){return t(new e(i,Ps(n.ref,r),cn))})},e.prototype.hasChild=function(e){var t=new lt(e);return!this._node.getChild(t).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function Es(e,t){return(e=(0,r.getModularInstance)(e))._checkNotDeleted("ref"),void 0!==t?Ps(e._root,t):e._root}function Ss(e,t){(e=(0,r.getModularInstance)(e))._checkNotDeleted("refFromURL");var n=fs(t,e._repo.repoInfo_.nodeAdmin);ga("refFromURL",n);var i=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||i.host===e._repo.repoInfo_.host||E("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+e._repo.repoInfo_.host+")"),Es(e,n.path.toString())}function Ps(e,t){return null===ht((e=(0,r.getModularInstance)(e))._path)?va("child","path",t,!1):_a("child","path",t,!1),new ks(e._repo,gt(e._path,t))}function xs(e,t){e=(0,r.getModularInstance)(e),ya("push",e._path),ua("push",t,e._path,!0);var n,i=Na(e._repo),o=Pn(i),a=Ps(e,o),s=Ps(e,o);return n=null!=t?Rs(s,t).then(function(){return s}):Promise.resolve(s),a.then=n.then.bind(n),a.catch=n.then.bind(n,void 0),a}function Ns(e){return ya("remove",e._path),Rs(e,null)}function Rs(e,t){e=(0,r.getModularInstance)(e),ya("set",e._path),ua("set",t,e._path,!1);var n=new r.Deferred;return Wa(e._repo,e._path,t,null,n.wrapCallback(function(){})),n.promise}function As(e,t){e=(0,r.getModularInstance)(e),ya("setPriority",e._path),da("setPriority",t,!1);var n=new r.Deferred;return Wa(e._repo,gt(e._path,".priority"),t,null,n.wrapCallback(function(){})),n.promise}function Ds(e,t,n){if(ya("setWithPriority",e._path),ua("setWithPriority",t,e._path,!1),da("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var i=new r.Deferred;return Wa(e._repo,e._path,t,n,i.wrapCallback(function(){})),i.promise}function Os(e,t){ha("update",t,e._path,!1);var n=new r.Deferred;return ja(e._repo,e._path,t,n.wrapCallback(function(){})),n.promise}function Ms(e){return La((e=(0,r.getModularInstance)(e))._repo,e).then(function(t){return new Is(t,new ks(e._repo,e._path),e._queryParams.getIndex())})}var qs=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new vs("value",this,new Is(e.snapshotNode,new ks(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new ys(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),Fs=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new ys(this,e,t):null},e.prototype.createEvent=function(e,t){(0,r.assert)(null!=e.childName,"Child events should have a childName.");var n=Ps(new ks(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new vs(e.type,this,new Is(e.snapshotNode,n,i),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&(this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function Ls(e,t,n,r,i){var o;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){var a=n,s=function(t,n){Ya(e._repo,e,l),a(t,n)};s.userCallback=n.userCallback,s.context=n.context,n=s}var u=new gs(n,o||void 0),l="value"===t?new qs(u):new Fs(t,u);return za(e._repo,e,l),function(){return Ya(e._repo,e,l)}}function Ws(e,t,n,r){return Ls(e,"value",t,n,r)}function js(e,t,n,r){return Ls(e,"child_added",t,n,r)}function Us(e,t,n,r){return Ls(e,"child_changed",t,n,r)}function Bs(e,t,n,r){return Ls(e,"child_moved",t,n,r)}function Vs(e,t,n,r){return Ls(e,"child_removed",t,n,r)}function Qs(e,t,n){var r=null,i=n?new gs(n):null;"value"===t?r=new qs(i):t&&(r=new Fs(t,i)),Ya(e._repo,e,r)}var Hs=function(){return function(){}}(),zs=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ua("endAt",this._value,e._path,!0);var t=Hn(e._queryParams,this._value,this._key);if(Ts(t),bs(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Cs(e._repo,e._path,t,e._orderByCalled)},t}(Hs);function Ys(e,t){return fa("endAt","key",t,!0),new zs(e,t)}var Ks=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ua("endBefore",this._value,e._path,!1);var t=zn(e._queryParams,this._value,this._key);if(Ts(t),bs(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Cs(e._repo,e._path,t,e._orderByCalled)},t}(Hs);function Gs(e,t){return fa("endBefore","key",t,!0),new Ks(e,t)}var $s=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ua("startAt",this._value,e._path,!0);var t=Vn(e._queryParams,this._value,this._key);if(Ts(t),bs(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Cs(e._repo,e._path,t,e._orderByCalled)},t}(Hs);function Js(e,t){return void 0===e&&(e=null),fa("startAt","key",t,!0),new $s(e,t)}var Xs=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ua("startAfter",this._value,e._path,!1);var t=Qn(e._queryParams,this._value,this._key);if(Ts(t),bs(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Cs(e._repo,e._path,t,e._orderByCalled)},t}(Hs);function Zs(e,t){return fa("startAfter","key",t,!0),new Xs(e,t)}var eu=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,i.__extends)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Cs(e._repo,e._path,Un(e._queryParams,this._limit),e._orderByCalled)},t}(Hs);function tu(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new eu(e)}var nu=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,i.__extends)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Cs(e._repo,e._path,Bn(e._queryParams,this._limit),e._orderByCalled)},t}(Hs);function ru(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new nu(e)}var iu=function(e){function t(t){var n=e.call(this)||this;return n._path=t,n}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ws(e,"orderByChild");var t=new lt(this._path);if(mt(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new wn(t),r=Yn(e._queryParams,n);return bs(r),new Cs(e._repo,e._path,r,!0)},t}(Hs);function ou(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return _a("orderByChild","path",e,!1),new iu(e)}var au=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ws(e,"orderByKey");var t=Yn(e._queryParams,Qt);return bs(t),new Cs(e._repo,e._path,t,!0)},t}(Hs);function su(){return new au}var uu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ws(e,"orderByPriority");var t=Yn(e._queryParams,cn);return bs(t),new Cs(e._repo,e._path,t,!0)},t}(Hs);function lu(){return new uu}var cu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype._apply=function(e){ws(e,"orderByValue");var t=Yn(e._queryParams,Tn);return bs(t),new Cs(e._repo,e._path,t,!0)},t}(Hs);function hu(){return new cu}var du=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,i.__extends)(t,e),t.prototype._apply=function(e){if(ua("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new zs(this._value,this._key)._apply(new $s(this._value,this._key)._apply(e))},t}(Hs);function pu(e,t){return fa("equalTo","key",t,!0),new du(e,t)}function fu(e){for(var t,n,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];var s=(0,r.getModularInstance)(e);try{for(var u=(0,i.__values)(o),l=u.next();!l.done;l=u.next()){s=l.value._apply(s)}}catch(c){t={error:c}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return s}Vi(ks),no(ks);var _u="FIREBASE_DATABASE_EMULATOR_HOST",vu={},yu=!1;function gu(e,t,n,r){e.repoInfo_=new ce(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}function mu(t,n,r,i,o){var a=i||t.options.databaseURL;void 0===a&&(t.options.projectId||E("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),T("Using default host for project ",t.options.projectId),a=t.options.projectId+"-default-rtdb.firebaseio.com");var s,u=fs(a,o),l=u.repoInfo,c=void 0;void 0!==e&&(c=e.env[_u]),c?(s=!0,a="http://"+c+"?ns="+l.namespace,l=(u=fs(a,o)).repoInfo):s=!u.repoInfo.secure;var h=o&&s?new X(X.OWNER):new J(t.name,t.options,n);ga("Invalid Firebase Database URL",u),mt(u.path)||E("Database URL must point to the root of a Firebase Database (not including a child path).");var d=wu(l,t,h,new $(t.name,r));return new Tu(d,t)}function Cu(e,t){var n=vu[t];n&&n[e.key]===e||E("Database "+t+"("+e.repoInfo_+") has already been deleted."),Ka(e),delete n[e.key]}function wu(e,t,n,r){var i=vu[t.name];i||(i={},vu[t.name]=i);var o=i[e.toURLString()];return o&&E("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new Pa(e,yu,n,r),i[e.toURLString()]=o,o}function bu(e){yu=e}var Tu=function(){function e(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(xa(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new ks(this._repo,ct())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){return null!==this._rootInternal&&(Cu(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&E("Cannot call "+e+" on a deleted database.")},e}();function ku(e,t,n,i){void 0===i&&(i={}),(e=(0,r.getModularInstance)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&E("Cannot call useEmulator() after instance has already been initialized.");var o=e._repoInternal,a=void 0;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&E('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new X(X.OWNER);else if(i.mockUserToken){var s=(0,r.createMockUserToken)(i.mockUserToken,e.app.options.projectId);a=new X(s)}gu(o,t,n,a)}function Iu(e){(e=(0,r.getModularInstance)(e))._checkNotDeleted("goOffline"),Ka(e._repo)}function Eu(e){(e=(0,r.getModularInstance)(e))._checkNotDeleted("goOnline"),Ga(e._repo)}var Su={".sv":"timestamp"};function Pu(){return Su}function xu(e){return{".sv":{increment:e}}}var Nu=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}();function Ru(e,t,n){var i;if(e=(0,r.getModularInstance)(e),ya("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var o=null===(i=null==n?void 0:n.applyLocally)||void 0===i||i,a=new r.Deferred,s=Ws(e,function(){});return es(e._repo,e._path,t,function(t,n,r){var i=null;t?a.reject(t):(i=new Is(r,new ks(e._repo,e._path),cn),a.resolve(new Nu(n,i)))},s,o),a.promise}var Au=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){(0,r.validateArgCount)("OnDisconnect.cancel",0,1,arguments.length),(0,r.validateCallback)("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},e.prototype.remove=function(e){(0,r.validateArgCount)("OnDisconnect.remove",0,1,arguments.length),(0,r.validateCallback)("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},e.prototype.set=function(e,t){(0,r.validateArgCount)("OnDisconnect.set",1,2,arguments.length),(0,r.validateCallback)("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},e.prototype.setWithPriority=function(e,t,n){(0,r.validateArgCount)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,r.validateCallback)("OnDisconnect.setWithPriority","onComplete",n,!0);var i=this._delegate.setWithPriority(e,t);return n&&i.then(function(){return n(null)},function(e){return n(e)}),i},e.prototype.update=function(e,t){if((0,r.validateArgCount)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,S("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,r.validateCallback)("OnDisconnect.update","onComplete",t,!0);var o=this._delegate.update(e);return t&&o.then(function(){return t(null)},function(e){return t(e)}),o},e}();exports.OnDisconnect=Au;var Du=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return(0,r.validateArgCount)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),Ou=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return(0,r.validateArgCount)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return(0,r.validateArgCount)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return(0,r.validateArgCount)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return(0,r.validateArgCount)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(t){return(0,r.validateArgCount)("DataSnapshot.child",0,1,arguments.length),t=String(t),_a("DataSnapshot.child","path",t,!1),new e(this._database,this._delegate.child(t))},e.prototype.hasChild=function(e){return(0,r.validateArgCount)("DataSnapshot.hasChild",1,1,arguments.length),_a("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},e.prototype.getPriority=function(){return(0,r.validateArgCount)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return(0,r.validateArgCount)("DataSnapshot.forEach",1,1,arguments.length),(0,r.validateCallback)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(function(r){return t(new e(n._database,r))})},e.prototype.hasChildren=function(){return(0,r.validateArgCount)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return(0,r.validateArgCount)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return(0,r.validateArgCount)("DataSnapshot.ref",0,0,arguments.length),new qu(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}();exports.DataSnapshot=Ou;var Mu=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,i,o){var a,s=this;(0,r.validateArgCount)("Query.on",2,4,arguments.length),(0,r.validateCallback)("Query.on","callback",n,!1);var u=e.getCancelAndContextArgs_("Query.on",i,o),l=function(e,t){n.call(u.context,new Ou(s.database,e),t)};l.userCallback=n,l.context=u.context;var c=null===(a=u.cancel)||void 0===a?void 0:a.bind(u.context);switch(t){case"value":return Ws(this._delegate,l,c),n;case"child_added":return js(this._delegate,l,c),n;case"child_removed":return Vs(this._delegate,l,c),n;case"child_changed":return Us(this._delegate,l,c),n;case"child_moved":return Bs(this._delegate,l,c),n;default:throw new Error((0,r.errorPrefix)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if((0,r.validateArgCount)("Query.off",0,3,arguments.length),pa("Query.off",e,!0),(0,r.validateCallback)("Query.off","callback",t,!0),(0,r.validateContextObject)("Query.off","context",n,!0),t){var i=function(){};i.userCallback=t,i.context=n,Qs(this._delegate,e,i)}else Qs(this._delegate,e)},e.prototype.get=function(){var e=this;return Ms(this._delegate).then(function(t){return new Ou(e.database,t)})},e.prototype.once=function(t,n,i,o){var a=this;(0,r.validateArgCount)("Query.once",1,4,arguments.length),(0,r.validateCallback)("Query.once","callback",n,!0);var s=e.getCancelAndContextArgs_("Query.once",i,o),u=new r.Deferred,l=function(e,t){var r=new Ou(a.database,e);n&&n.call(s.context,r,t),u.resolve(r)};l.userCallback=n,l.context=s.context;var c=function(e){s.cancel&&s.cancel.call(s.context,e),u.reject(e)};switch(t){case"value":Ws(this._delegate,l,c,{onlyOnce:!0});break;case"child_added":js(this._delegate,l,c,{onlyOnce:!0});break;case"child_removed":Vs(this._delegate,l,c,{onlyOnce:!0});break;case"child_changed":Us(this._delegate,l,c,{onlyOnce:!0});break;case"child_moved":Bs(this._delegate,l,c,{onlyOnce:!0});break;default:throw new Error((0,r.errorPrefix)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return u.promise},e.prototype.limitToFirst=function(t){return(0,r.validateArgCount)("Query.limitToFirst",1,1,arguments.length),new e(this.database,fu(this._delegate,tu(t)))},e.prototype.limitToLast=function(t){return(0,r.validateArgCount)("Query.limitToLast",1,1,arguments.length),new e(this.database,fu(this._delegate,ru(t)))},e.prototype.orderByChild=function(t){return(0,r.validateArgCount)("Query.orderByChild",1,1,arguments.length),new e(this.database,fu(this._delegate,ou(t)))},e.prototype.orderByKey=function(){return(0,r.validateArgCount)("Query.orderByKey",0,0,arguments.length),new e(this.database,fu(this._delegate,su()))},e.prototype.orderByPriority=function(){return(0,r.validateArgCount)("Query.orderByPriority",0,0,arguments.length),new e(this.database,fu(this._delegate,lu()))},e.prototype.orderByValue=function(){return(0,r.validateArgCount)("Query.orderByValue",0,0,arguments.length),new e(this.database,fu(this._delegate,hu()))},e.prototype.startAt=function(t,n){return void 0===t&&(t=null),(0,r.validateArgCount)("Query.startAt",0,2,arguments.length),new e(this.database,fu(this._delegate,Js(t,n)))},e.prototype.startAfter=function(t,n){return void 0===t&&(t=null),(0,r.validateArgCount)("Query.startAfter",0,2,arguments.length),new e(this.database,fu(this._delegate,Zs(t,n)))},e.prototype.endAt=function(t,n){return void 0===t&&(t=null),(0,r.validateArgCount)("Query.endAt",0,2,arguments.length),new e(this.database,fu(this._delegate,Ys(t,n)))},e.prototype.endBefore=function(t,n){return void 0===t&&(t=null),(0,r.validateArgCount)("Query.endBefore",0,2,arguments.length),new e(this.database,fu(this._delegate,Gs(t,n)))},e.prototype.equalTo=function(t,n){return(0,r.validateArgCount)("Query.equalTo",1,2,arguments.length),new e(this.database,fu(this._delegate,pu(t,n)))},e.prototype.toString=function(){return(0,r.validateArgCount)("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return(0,r.validateArgCount)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if((0,r.validateArgCount)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var i={cancel:void 0,context:void 0};if(t&&n)i.cancel=t,(0,r.validateCallback)(e,"cancel",i.cancel,!0),i.context=n,(0,r.validateContextObject)(e,"context",i.context,!0);else if(t)if("object"==typeof t&&null!==t)i.context=t;else{if("function"!=typeof t)throw new Error((0,r.errorPrefix)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");i.cancel=t}return i},Object.defineProperty(e.prototype,"ref",{get:function(){return new qu(this.database,new ks(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}();exports.Query=Mu;var qu=function(e){function t(t,n){var r=e.call(this,t,new Cs(n._repo,n._path,new Wn,!1))||this;return r.database=t,r._delegate=n,r}return(0,i.__extends)(t,e),t.prototype.getKey=function(){return(0,r.validateArgCount)("Reference.key",0,0,arguments.length),this._delegate.key},t.prototype.child=function(e){return(0,r.validateArgCount)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new t(this.database,Ps(this._delegate,e))},t.prototype.getParent=function(){(0,r.validateArgCount)("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new t(this.database,e):null},t.prototype.getRoot=function(){return(0,r.validateArgCount)("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)},t.prototype.set=function(e,t){(0,r.validateArgCount)("Reference.set",1,2,arguments.length),(0,r.validateCallback)("Reference.set","onComplete",t,!0);var n=Rs(this._delegate,e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},t.prototype.update=function(e,t){if((0,r.validateArgCount)("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,S("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ya("Reference.update",this._delegate._path),(0,r.validateCallback)("Reference.update","onComplete",t,!0);var o=Os(this._delegate,e);return t&&o.then(function(){return t(null)},function(e){return t(e)}),o},t.prototype.setWithPriority=function(e,t,n){(0,r.validateArgCount)("Reference.setWithPriority",2,3,arguments.length),(0,r.validateCallback)("Reference.setWithPriority","onComplete",n,!0);var i=Ds(this._delegate,e,t);return n&&i.then(function(){return n(null)},function(e){return n(e)}),i},t.prototype.remove=function(e){(0,r.validateArgCount)("Reference.remove",0,1,arguments.length),(0,r.validateCallback)("Reference.remove","onComplete",e,!0);var t=Ns(this._delegate);return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},t.prototype.transaction=function(e,t,n){var i=this;(0,r.validateArgCount)("Reference.transaction",1,3,arguments.length),(0,r.validateCallback)("Reference.transaction","transactionUpdate",e,!1),(0,r.validateCallback)("Reference.transaction","onComplete",t,!0),ma("Reference.transaction","applyLocally",n,!0);var o=Ru(this._delegate,e,{applyLocally:n}).then(function(e){return new Du(e.committed,new Ou(i.database,e.snapshot))});return t&&o.then(function(e){return t(null,e.committed,e.snapshot)},function(e){return t(e,!1,null)}),o},t.prototype.setPriority=function(e,t){(0,r.validateArgCount)("Reference.setPriority",1,2,arguments.length),(0,r.validateCallback)("Reference.setPriority","onComplete",t,!0);var n=As(this._delegate,e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},t.prototype.push=function(e,n){var i=this;(0,r.validateArgCount)("Reference.push",0,2,arguments.length),(0,r.validateCallback)("Reference.push","onComplete",n,!0);var o=xs(this._delegate,e),a=o.then(function(e){return new t(i.database,e)});n&&a.then(function(){return n(null)},function(e){return n(e)});var s=new t(this.database,o);return s.then=a.then.bind(a),s.catch=a.catch.bind(a,void 0),s},t.prototype.onDisconnect=function(){return ya("Reference.onDisconnect",this._delegate._path),new Au(new ms(this._delegate._repo,this._delegate._path))},Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Mu);exports.Reference=qu;var Fu=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),ku(this._delegate,e,t,n)},e.prototype.ref=function(e){if((0,r.validateArgCount)("database.ref",0,1,arguments.length),e instanceof qu){var t=Ss(this._delegate,e.toString());return new qu(this,t)}t=Es(this._delegate,e);return new qu(this,t)},e.prototype.refFromURL=function(e){(0,r.validateArgCount)("database.refFromURL",1,1,arguments.length);var t=Ss(this._delegate,e);return new qu(this,t)},e.prototype.goOffline=function(){return(0,r.validateArgCount)("database.goOffline",0,0,arguments.length),Iu(this._delegate)},e.prototype.goOnline=function(){return(0,r.validateArgCount)("database.goOnline",0,0,arguments.length),Eu(this._delegate)},e.ServerValue={TIMESTAMP:Pu(),increment:function(e){return xu(e)}},e}();exports.Database=Fu;var Lu=function(){Ue.forceDisallow(),qe.forceAllow()},Wu=function(){qe.forceDisallow()},ju=function(){return Ue.isAvailable()},Uu=function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},Bu=function(e,t){$a(e._delegate._repo,t)},Vu=function(e,t){Ja(e._delegate._repo,t)},Qu=function(e){return e._delegate._repo.dataUpdateCount},Hu=function(e,t){return Da(e._delegate._repo,t)};function zu(e){var t=e.app,r=e.url,i=e.version,o=e.customAuthImpl,a=e.namespace,s=e.nodeAdmin,u=void 0!==s&&s;c(i);var l=new n.Provider("auth-internal",new n.ComponentContainer("database-standalone"));return l.setComponent(new n.Component("auth-internal",function(){return o},"PRIVATE")),{instance:new Fu(mu(t,l,void 0,r,u),t),namespace:a}}var Yu=Object.freeze({__proto__:null,forceLongPolling:Lu,forceWebSockets:Wu,isWebSocketsAvailable:ju,setSecurityDebugCallback:Uu,stats:Bu,statsIncrementCounter:Vu,dataUpdateCount:Qu,interceptServerData:Hu,initStandalone:zu}),Ku=jt;jt.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},jt.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Gu=rt,$u=function(e){var t=jt.prototype.put;return jt.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){jt.prototype.put=t}},Ju=ce,Xu=function(e){return e._delegate._queryIdentifier},Zu=function(e){bu(e)},el=Object.freeze({__proto__:null,DataConnection:Ku,RealTimeConnection:Gu,hijackHash:$u,ConnectionTarget:Ju,queryIdentifier:Xu,forceRestClient:Zu}),tl=Fu.ServerValue;function nl(e){c(e.SDK_VERSION);var t=e.INTERNAL.registerComponent(new n.Component("database",function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new Fu(mu(r,i,o,n),r)},"PUBLIC").setServiceProps({Reference:qu,Query:Mu,Database:Fu,DataSnapshot:Ou,enableLogging:b,INTERNAL:Yu,ServerValue:tl,TEST_ACCESS:el}).setMultipleInstances(!0));e.registerVersion(s,u),(0,r.isNodeSdk)()&&(module.exports=t)}exports.ServerValue=tl,nl(t.default);
},{"@firebase/app":"Q47K","@firebase/component":"KLrb","@firebase/util":"gYkb","tslib":"CvJj","@firebase/logger":"srlT","process":"g5IB"}],"VoiF":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStatEventTarget=exports.createWebChannelTransport=exports.XhrIo=exports.WebChannel=exports.Stat=exports.FetchXmlHttpFactory=exports.EventType=exports.Event=exports.ErrorCode=exports.default=void 0;var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,e)};function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&t[i],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}var r,s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},o=o||{},h=s||self;function a(){}function l(t){var i=typeof t;return"array"==(i="object"!=i?i:t?Array.isArray(t)?"array":i:"null")||"object"==i&&"number"==typeof t.length}function u(t){var i=typeof t;return"object"==i&&null!=t||"function"==i}function c(t){return Object.prototype.hasOwnProperty.call(t,f)&&t[f]||(t[f]=++g)}var f="closure_uid_"+(1e9*Math.random()>>>0),g=0;function p(t,i,e){return t.call.apply(t.bind,arguments)}function v(t,i,e){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,n),t.apply(i,e)}}return function(){return t.apply(i,arguments)}}function d(t,i,e){return(d=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?p:v).apply(null,arguments)}function y(t,i){var e=Array.prototype.slice.call(arguments,1);return function(){var i=e.slice();return i.push.apply(i,arguments),t.apply(this,i)}}function m(t,i){function e(){}e.prototype=i.prototype,t.Z=i.prototype,t.prototype=new e,t.prototype.constructor=t,t.Vb=function(t,e,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[e].apply(t,r)}}function b(){this.s=this.s,this.o=this.o}var w=0,T={};b.prototype.s=!1,b.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0!=w)){var t=c(this);delete T[t]}},b.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var E=Array.prototype.indexOf?function(t,i){return Array.prototype.indexOf.call(t,i,void 0)}:function(t,i){if("string"==typeof t)return"string"!=typeof i||1!=i.length?-1:t.indexOf(i,0);for(var e=0;e<t.length;e++)if(e in t&&t[e]===i)return e;return-1},S=Array.prototype.forEach?function(t,i,e){Array.prototype.forEach.call(t,i,e)}:function(t,i,e){for(var n=t.length,r="string"==typeof t?t.split(""):t,s=0;s<n;s++)s in r&&i.call(e,r[s],s,t)};function x(t){t:{for(var i=Ne,e=t.length,n="string"==typeof t?t.split(""):t,r=0;r<e;r++)if(r in n&&i.call(void 0,n[r],r,t)){i=r;break t}i=-1}return 0>i?null:"string"==typeof t?t.charAt(i):t[i]}function j(t){return Array.prototype.concat.apply([],arguments)}function C(t){var i=t.length;if(0<i){for(var e=Array(i),n=0;n<i;n++)e[n]=t[n];return e}return[]}function I(t){return/^[\s\xa0]*$/.test(t)}var A,R=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function O(t,i){return-1!=t.indexOf(i)}function P(t,i){return t<i?-1:t>i?1:0}t:{var D=h.navigator;if(D){var M=D.userAgent;if(M){A=M;break t}}A=""}function L(t,i,e){for(var n in t)i.call(e,t[n],n,t)}function X(t){var i={};for(var e in t)i[e]=t[e];return i}var H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(t,i){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var s=0;s<H.length;s++)e=H[s],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function k(t){return k[" "](t),t}function B(t){var i=Z;return Object.prototype.hasOwnProperty.call(i,9)?i[9]:i[9]=t(9)}k[" "]=a;var F,N=O(A,"Opera"),U=O(A,"Trident")||O(A,"MSIE"),K=O(A,"Edge"),Y=K||U,G=O(A,"Gecko")&&!(O(A.toLowerCase(),"webkit")&&!O(A,"Edge"))&&!(O(A,"Trident")||O(A,"MSIE"))&&!O(A,"Edge"),J=O(A.toLowerCase(),"webkit")&&!O(A,"Edge");function W(){var t=h.document;return t?t.documentMode:void 0}t:{var V="",$=function(){var t=A;return G?/rv:([^\);]+)(\)|;)/.exec(t):K?/Edge\/([\d\.]+)/.exec(t):U?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):J?/WebKit\/(\S+)/.exec(t):N?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if($&&(V=$?$[1]:""),U){var q=W();if(null!=q&&q>parseFloat(V)){F=String(q);break t}}F=V}var z,Z={};function Q(){return B(function(){for(var t=0,i=R(String(F)).split("."),e=R("9").split("."),n=Math.max(i.length,e.length),r=0;0==t&&r<n;r++){var s=i[r]||"",o=e[r]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==s[0].length&&0==o[0].length)break;t=P(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||P(0==s[2].length,0==o[2].length)||P(s[2],o[2]),s=s[3],o=o[3]}while(0==t)}return 0<=t})}if(h.document&&U){var tt=W();z=tt||(parseInt(F,10)||void 0)}else z=void 0;var it=z,et=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,i=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",a,i),h.removeEventListener("test",a,i)}catch(e){}return t}();function nt(t,i){this.type=t,this.g=this.target=i,this.defaultPrevented=!1}function rt(t,i){if(nt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var e=this.type=t.type,n=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=i,i=t.relatedTarget){if(G){t:{try{k(i.nodeName);var r=!0;break t}catch(s){}r=!1}r||(i=null)}}else"mouseover"==e?i=t.fromElement:"mouseout"==e&&(i=t.toElement);this.relatedTarget=i,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:st[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&rt.Z.h.call(this)}}nt.prototype.h=function(){this.defaultPrevented=!0},m(rt,nt);var st={2:"touch",3:"pen",4:"mouse"};rt.prototype.h=function(){rt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ot="closure_listenable_"+(1e6*Math.random()|0),ht=0;function at(t,i,e,n,r){this.listener=t,this.proxy=null,this.src=i,this.type=e,this.capture=!!n,this.ia=r,this.key=++ht,this.ca=this.fa=!1}function lt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ut(t){this.src=t,this.g={},this.h=0}function ct(t,i){var e=i.type;if(e in t.g){var n,r=t.g[e],s=E(r,i);(n=0<=s)&&Array.prototype.splice.call(r,s,1),n&&(lt(i),0==t.g[e].length&&(delete t.g[e],t.h--))}}function ft(t,i,e,n){for(var r=0;r<t.length;++r){var s=t[r];if(!s.ca&&s.listener==i&&s.capture==!!e&&s.ia==n)return r}return-1}ut.prototype.add=function(t,i,e,n,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=ft(t,i,n,r);return-1<o?(i=t[o],e||(i.fa=!1)):((i=new at(i,this.src,s,!!n,r)).fa=e,t.push(i)),i};var gt="closure_lm_"+(1e6*Math.random()|0),pt={};function vt(t,i,e,n,r){if(n&&n.once)return mt(t,i,e,n,r);if(Array.isArray(i)){for(var s=0;s<i.length;s++)vt(t,i[s],e,n,r);return null}return e=jt(e),t&&t[ot]?t.N(i,e,u(n)?!!n.capture:!!n,r):dt(t,i,e,!1,n,r)}function dt(t,i,e,n,r,s){if(!i)throw Error("Invalid event type");var o=u(r)?!!r.capture:!!r,h=St(t);if(h||(t[gt]=h=new ut(t)),(e=h.add(i,e,n,o,s)).proxy)return e;if(n=yt(),e.proxy=n,n.src=t,n.listener=e,t.addEventListener)et||(r=o),void 0===r&&(r=!1),t.addEventListener(i.toString(),n,r);else if(t.attachEvent)t.attachEvent(Tt(i.toString()),n);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(n)}return e}function yt(){var t=Et;return function i(e){return t.call(i.src,i.listener,e)}}function mt(t,i,e,n,r){if(Array.isArray(i)){for(var s=0;s<i.length;s++)mt(t,i[s],e,n,r);return null}return e=jt(e),t&&t[ot]?t.O(i,e,u(n)?!!n.capture:!!n,r):dt(t,i,e,!0,n,r)}function bt(t,i,e,n,r){if(Array.isArray(i))for(var s=0;s<i.length;s++)bt(t,i[s],e,n,r);else n=u(n)?!!n.capture:!!n,e=jt(e),t&&t[ot]?(t=t.i,(i=String(i).toString())in t.g&&(-1<(e=ft(s=t.g[i],e,n,r))&&(lt(s[e]),Array.prototype.splice.call(s,e,1),0==s.length&&(delete t.g[i],t.h--)))):t&&(t=St(t))&&(i=t.g[i.toString()],t=-1,i&&(t=ft(i,e,n,r)),(e=-1<t?i[t]:null)&&wt(e))}function wt(t){if("number"!=typeof t&&t&&!t.ca){var i=t.src;if(i&&i[ot])ct(i.i,t);else{var e=t.type,n=t.proxy;i.removeEventListener?i.removeEventListener(e,n,t.capture):i.detachEvent?i.detachEvent(Tt(e),n):i.addListener&&i.removeListener&&i.removeListener(n),(e=St(i))?(ct(e,t),0==e.h&&(e.src=null,i[gt]=null)):lt(t)}}}function Tt(t){return t in pt?pt[t]:pt[t]="on"+t}function Et(t,i){if(t.ca)t=!0;else{i=new rt(i,this);var e=t.listener,n=t.ia||t.src;t.fa&&wt(t),t=e.call(n,i)}return t}function St(t){return(t=t[gt])instanceof ut?t:null}var xt="__closure_events_fn_"+(1e9*Math.random()>>>0);function jt(t){return"function"==typeof t?t:(t[xt]||(t[xt]=function(i){return t.handleEvent(i)}),t[xt])}function Ct(){b.call(this),this.i=new ut(this),this.P=this,this.I=null}function It(t,i){var e,n=t.I;if(n)for(e=[];n;n=n.I)e.push(n);if(t=t.P,n=i.type||i,"string"==typeof i)i=new nt(i,t);else if(i instanceof nt)i.target=i.target||t;else{var r=i;_(i=new nt(n,t),r)}if(r=!0,e)for(var s=e.length-1;0<=s;s--){var o=i.g=e[s];r=At(o,n,!0,i)&&r}if(r=At(o=i.g=t,n,!0,i)&&r,r=At(o,n,!1,i)&&r,e)for(s=0;s<e.length;s++)r=At(o=i.g=e[s],n,!1,i)&&r}function At(t,i,e,n){if(!(i=t.i.g[String(i)]))return!0;i=i.concat();for(var r=!0,s=0;s<i.length;++s){var o=i[s];if(o&&!o.ca&&o.capture==e){var h=o.listener,a=o.ia||o.src;o.fa&&ct(t.i,o),r=!1!==h.call(a,n)&&r}}return r&&!n.defaultPrevented}m(Ct,b),Ct.prototype[ot]=!0,Ct.prototype.removeEventListener=function(t,i,e,n){bt(this,t,i,e,n)},Ct.prototype.M=function(){if(Ct.Z.M.call(this),this.i){var t,i=this.i;for(t in i.g){for(var e=i.g[t],n=0;n<e.length;n++)lt(e[n]);delete i.g[t],i.h--}}this.I=null},Ct.prototype.N=function(t,i,e,n){return this.i.add(String(t),i,!1,e,n)},Ct.prototype.O=function(t,i,e,n){return this.i.add(String(t),i,!0,e,n)};var Rt=h.JSON.stringify;function Ot(){var t=Bt,i=null;return t.g&&(i=t.g,t.g=t.g.next,t.g||(t.h=null),i.next=null),i}var Pt,Dt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,i){var e=Mt.get();e.set(t,i),this.h?this.h.next=e:this.g=e,this.h=e},t}(),Mt=new(function(){function t(t,i){this.i=t,this.j=i,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},t}())(function(){return new Lt},function(t){return t.reset()}),Lt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,i){this.h=t,this.g=i,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Xt(t){h.setTimeout(function(){throw t},0)}function Ht(t,i){Pt||_t(),kt||(Pt(),kt=!0),Bt.add(t,i)}function _t(){var t=h.Promise.resolve(void 0);Pt=function(){t.then(Ft)}}var kt=!1,Bt=new Dt;function Ft(){for(var t;t=Ot();){try{t.h.call(t.g)}catch(e){Xt(e)}var i=Mt;i.j(t),100>i.h&&(i.h++,t.next=i.g,i.g=t)}kt=!1}function Nt(t,i){Ct.call(this),this.h=t||1,this.g=i||h,this.j=d(this.kb,this),this.l=Date.now()}function Ut(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Kt(t,i,e){if("function"==typeof t)e&&(t=d(t,e));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=d(t.handleEvent,t)}return 2147483647<Number(i)?-1:h.setTimeout(t,i||0)}function Yt(t){t.g=Kt(function(){t.g=null,t.i&&(t.i=!1,Yt(t))},t.j);var i=t.h;t.h=null,t.m.apply(null,i)}m(Nt,Ct),(r=Nt.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),It(this,"tick"),this.da&&(Ut(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Nt.Z.M.call(this),Ut(this),delete this.g};var Gt=function(t){function i(i,e){var n=t.call(this)||this;return n.m=i,n.j=e,n.h=null,n.i=!1,n.g=null,n}return e(i,t),i.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Yt(this)},i.prototype.M=function(){t.prototype.M.call(this),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},i}(b);function Jt(t){b.call(this),this.h=t,this.g={}}m(Jt,b);var Wt=[];function Vt(t,i,e,n){Array.isArray(e)||(e&&(Wt[0]=e.toString()),e=Wt);for(var r=0;r<e.length;r++){var s=vt(i,e[r],n||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function $t(t){L(t.g,function(t,i){this.g.hasOwnProperty(i)&&wt(t)},t),t.g={}}function qt(){this.g=!0}function zt(t,i,e,n,r,s){t.info(function(){if(t.g)if(s)for(var o="",h=s.split("&"),a=0;a<h.length;a++){var l=h[a].split("=");if(1<l.length){var u=l[0];l=l[1];var c=u.split("_");o=2<=c.length&&"type"==c[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+i+"\n"+e+"\n"+o})}function Zt(t,i,e,n,r,s,o){t.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+i+"\n"+e+"\n"+s+" "+o})}function Qt(t,i,e,n){t.info(function(){return"XMLHTTP TEXT ("+i+"): "+ii(t,e)+(n?" "+n:"")})}function ti(t,i){t.info(function(){return"TIMEOUT: "+i})}function ii(t,i){if(!t.g)return i;if(!i)return null;try{var e=JSON.parse(i);if(e)for(t=0;t<e.length;t++)if(Array.isArray(e[t])){var n=e[t];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return Rt(e)}catch(h){return i}}Jt.prototype.M=function(){Jt.Z.M.call(this),$t(this)},Jt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qt.prototype.Aa=function(){this.g=!1},qt.prototype.info=function(){};var ei={},ni=null;function ri(){return ni=ni||new Ct}function si(t){nt.call(this,ei.Ma,t)}function oi(t){var i=ri();It(i,new si(i,t))}function hi(t,i){nt.call(this,ei.STAT_EVENT,t),this.stat=i}function ai(t){var i=ri();It(i,new hi(i,t))}function li(t,i){nt.call(this,ei.Na,t),this.size=i}function ui(t,i){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){t()},i)}ei.Ma="serverreachability",m(si,nt),ei.STAT_EVENT="statevent",m(hi,nt),ei.Na="timingevent",m(li,nt);var ci={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},fi={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function gi(){}function pi(t){return t.h||(t.h=t.i())}function vi(){}gi.prototype.h=null;var di,yi={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function mi(){nt.call(this,"d")}function bi(){nt.call(this,"c")}function wi(){}function Ti(t,i,e,n){this.l=t,this.j=i,this.m=e,this.X=n||1,this.V=new Jt(this),this.P=Si,t=Y?125:void 0,this.W=new Nt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ei}function Ei(){this.i=null,this.g="",this.h=!1}m(mi,nt),m(bi,nt),m(wi,gi),wi.prototype.g=function(){return new XMLHttpRequest},wi.prototype.i=function(){return{}},di=new wi;var Si=45e3,xi={},ji={};function Ci(t,i,e){t.K=1,t.v=zi(Gi(i)),t.s=e,t.U=!0,Ii(t,null)}function Ii(t,i){t.F=Date.now(),Pi(t),t.A=Gi(t.v);var e=t.A,n=t.X;Array.isArray(n)||(n=[String(n)]),fe(e.h,"t",n),t.C=0,e=t.l.H,t.h=new Ei,t.g=bn(t.l,e?i:null,!t.s),0<t.O&&(t.L=new Gt(d(t.Ia,t,t.g),t.O)),Vt(t.V,t.g,"readystatechange",t.gb),i=t.H?X(t.H):{},t.s?(t.u||(t.u="POST"),i["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,i)):(t.u="GET",t.g.ea(t.A,t.u,null,i)),oi(1),zt(t.j,t.u,t.A,t.m,t.X,t.s)}function Ai(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Ri(t,i,e){for(var n,r=!0;!t.I&&t.C<e.length;){if((n=Oi(t,e))==ji){4==i&&(t.o=4,ai(14),r=!1),Qt(t.j,t.m,null,"[Incomplete Response]");break}if(n==xi){t.o=4,ai(15),Qt(t.j,t.m,e,"[Invalid Chunk]"),r=!1;break}Qt(t.j,t.m,n,null),Hi(t,n)}Ai(t)&&n!=ji&&n!=xi&&(t.h.g="",t.C=0),4!=i||0!=e.length||t.h.h||(t.o=1,ai(16),r=!1),t.i=t.i&&r,r?0<e.length&&!t.aa&&(t.aa=!0,(i=t.l).g==t&&i.$&&!i.L&&(i.h.info("Great, no buffering proxy detected. Bytes received: "+e.length),cn(i),i.L=!0,ai(11))):(Qt(t.j,t.m,e,"[Invalid Chunked Response]"),Xi(t),Li(t))}function Oi(t,i){var e=t.C,n=i.indexOf("\n",e);return-1==n?ji:(e=Number(i.substring(e,n)),isNaN(e)?xi:(n+=1)+e>i.length?ji:(i=i.substr(n,e),t.C=n+e,i))}function Pi(t){t.Y=Date.now()+t.P,Di(t,t.P)}function Di(t,i){if(null!=t.B)throw Error("WatchDog timer not null");t.B=ui(d(t.eb,t),i)}function Mi(t){t.B&&(h.clearTimeout(t.B),t.B=null)}function Li(t){0==t.l.G||t.I||pn(t.l,t)}function Xi(t){Mi(t);var i=t.L;i&&"function"==typeof i.na&&i.na(),t.L=null,Ut(t.W),$t(t.V),t.g&&(i=t.g,t.g=null,i.abort(),i.na())}function Hi(t,i){try{var e=t.l;if(0!=e.G&&(e.g==t||we(e.i,t)))if(e.I=t.N,!t.J&&we(e.i,t)&&3==e.G){try{var n=e.Ca.g.parse(i)}catch(s){n=null}if(Array.isArray(n)&&3==n.length){var r=n;if(0==r[0]){t:if(!e.u){if(e.g){if(!(e.g.F+3e3<t.F))break t;gn(e),tn(e)}un(e),ai(18)}}else e.ta=r[1],0<e.ta-e.U&&37500>r[2]&&e.N&&0==e.A&&!e.v&&(e.v=ui(d(e.ab,e),6e3));if(1>=be(e.i)&&e.ka){try{e.ka()}catch(s){}e.ka=void 0}}else dn(e,11)}else if((t.J||e.g==t)&&gn(e),!I(i))for(r=e.Ca.g.parse(i),i=0;i<r.length;i++){var s=r[i];if(e.U=s[0],s=s[1],2==e.G)if("c"==s[0]){e.J=s[1],e.la=s[2];var o=s[3];null!=o&&(e.ma=o,e.h.info("VER="+e.ma));var h=s[4];null!=h&&(e.za=h,e.h.info("SVER="+e.za));var a=s[5];null!=a&&"number"==typeof a&&0<a&&(n=1.5*a,e.K=n,e.h.info("backChannelRequestTimeoutMs_="+n)),n=e;var l=t.g;if(l){var u=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(u){var c=n.i;!c.g&&(O(u,"spdy")||O(u,"quic")||O(u,"h2"))&&(c.j=c.l,c.g=new Set,c.h&&(Te(c,c.h),c.h=null))}if(n.D){var f=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(n.sa=f,qi(n.F,n.D,f))}}e.G=3,e.j&&e.j.xa(),e.$&&(e.O=Date.now()-t.F,e.h.info("Handshake RTT: "+e.O+"ms"));var g=t;if((n=e).oa=mn(n,n.H?n.la:null,n.W),g.J){Ee(n.i,g);var p=g,v=n.K;v&&p.setTimeout(v),p.B&&(Mi(p),Pi(p)),n.g=g}else ln(n);0<e.l.length&&rn(e)}else"stop"!=s[0]&&"close"!=s[0]||dn(e,7);else 3==e.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?dn(e,7):Qe(e):"noop"!=s[0]&&e.j&&e.j.wa(s),e.A=0)}oi(4)}catch(s){}}function _i(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(l(t)){for(var i=[],e=t.length,n=0;n<e;n++)i.push(t[n]);return i}for(n in i=[],e=0,t)i[e++]=t[n];return i}function ki(t,i){if(t.forEach&&"function"==typeof t.forEach)t.forEach(i,void 0);else if(l(t)||"string"==typeof t)S(t,i,void 0);else{if(t.T&&"function"==typeof t.T)var e=t.T();else if(t.R&&"function"==typeof t.R)e=void 0;else if(l(t)||"string"==typeof t){e=[];for(var n=t.length,r=0;r<n;r++)e.push(r)}else for(r in e=[],n=0,t)e[n++]=r;r=(n=_i(t)).length;for(var s=0;s<r;s++)i.call(void 0,n[s],e&&e[s],t)}}function Bi(t,i){this.h={},this.g=[],this.i=0;var e=arguments.length;if(1<e){if(e%2)throw Error("Uneven number of arguments");for(var n=0;n<e;n+=2)this.set(arguments[n],arguments[n+1])}else if(t)if(t instanceof Bi)for(e=t.T(),n=0;n<e.length;n++)this.set(e[n],t.get(e[n]));else for(n in t)this.set(n,t[n])}function Fi(t){if(t.i!=t.g.length){for(var i=0,e=0;i<t.g.length;){var n=t.g[i];Ni(t.h,n)&&(t.g[e++]=n),i++}t.g.length=e}if(t.i!=t.g.length){var r={};for(e=i=0;i<t.g.length;)Ni(r,n=t.g[i])||(t.g[e++]=n,r[n]=1),i++;t.g.length=e}}function Ni(t,i){return Object.prototype.hasOwnProperty.call(t,i)}(r=Ti.prototype).setTimeout=function(t){this.P=t},r.gb=function(t){t=t.target;var i=this.L;i&&3==We(t)?i.l():this.Ia(t)},r.Ia=function(t){try{if(t==this.g)t:{var i=We(this.g),e=this.g.Da(),n=this.g.ba();if(!(3>i)&&(3!=i||Y||this.g&&(this.h.h||this.g.ga()||Ve(this.g)))){this.I||4!=i||7==e||oi(8==e||0>=n?3:2),Mi(this);var r=this.g.ba();this.N=r;i:if(Ai(this)){var s=Ve(this.g);t="";var o=s.length,a=4==We(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Xi(this),Li(this);var l="";break i}this.h.i=new h.TextDecoder}for(e=0;e<o;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:a&&e==o-1});s.splice(0,o),this.h.g+=t,this.C=0,l=this.h.g}else l=this.g.ga();if(this.i=200==r,Zt(this.j,this.u,this.A,this.m,this.X,i,r),this.i){if(this.$&&!this.J){i:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(u)){var f=u;break i}}f=null}if(!(r=f)){this.i=!1,this.o=3,ai(12),Xi(this),Li(this);break t}Qt(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Hi(this,r)}this.U?(Ri(this,i,l),Y&&this.i&&3==i&&(Vt(this.V,this.W,"tick",this.fb),this.W.start())):(Qt(this.j,this.m,l,null),Hi(this,l)),4==i&&Xi(this),this.i&&!this.I&&(4==i?pn(this.l,this):(this.i=!1,Pi(this)))}else 400==r&&0<l.indexOf("Unknown SID")?(this.o=3,ai(12)):(this.o=0,ai(13)),Xi(this),Li(this)}}}catch(i){}},r.fb=function(){if(this.g){var t=We(this.g),i=this.g.ga();this.C<i.length&&(Mi(this),Ri(this,t,i),this.i&&4!=t&&Pi(this))}},r.cancel=function(){this.I=!0,Xi(this)},r.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(ti(this.j,this.A),2!=this.K&&(oi(3),ai(17)),Xi(this),this.o=2,Li(this)):Di(this,this.Y-t)},(r=Bi.prototype).R=function(){Fi(this);for(var t=[],i=0;i<this.g.length;i++)t.push(this.h[this.g[i]]);return t},r.T=function(){return Fi(this),this.g.concat()},r.get=function(t,i){return Ni(this.h,t)?this.h[t]:i},r.set=function(t,i){Ni(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=i},r.forEach=function(t,i){for(var e=this.T(),n=0;n<e.length;n++){var r=e[n],s=this.get(r);t.call(i,s,r,this)}};var Ui=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ki(t,i){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n=t[e].indexOf("="),r=null;if(0<=n){var s=t[e].substring(0,n);r=t[e].substring(n+1)}else s=t[e];i(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Yi(t,i){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Yi){this.g=void 0!==i?i:t.g,Ji(this,t.j),this.s=t.s,Wi(this,t.i),Vi(this,t.m),this.l=t.l,i=t.h;var e=new ae;e.i=i.i,i.g&&(e.g=new Bi(i.g),e.h=i.h),$i(this,e),this.o=t.o}else t&&(e=String(t).match(Ui))?(this.g=!!i,Ji(this,e[1]||"",!0),this.s=te(e[2]||""),Wi(this,e[3]||"",!0),Vi(this,e[4]),this.l=te(e[5]||"",!0),$i(this,e[6]||"",!0),this.o=te(e[7]||"")):(this.g=!!i,this.h=new ae(null,this.g))}function Gi(t){return new Yi(t)}function Ji(t,i,e){t.j=e?te(i,!0):i,t.j&&(t.j=t.j.replace(/:$/,""))}function Wi(t,i,e){t.i=e?te(i,!0):i}function Vi(t,i){if(i){if(i=Number(i),isNaN(i)||0>i)throw Error("Bad port number "+i);t.m=i}else t.m=null}function $i(t,i,e){i instanceof ae?(t.h=i,pe(t.h,t.g)):(e||(i=ie(i,oe)),t.h=new ae(i,t.g))}function qi(t,i,e){t.h.set(i,e)}function zi(t){return qi(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Zi(t){return t instanceof Yi?Gi(t):new Yi(t,void 0)}function Qi(t,i,e,n){var r=new Yi(null,void 0);return t&&Ji(r,t),i&&Wi(r,i),e&&Vi(r,e),n&&(r.l=n),r}function te(t,i){return t?i?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ie(t,i,e){return"string"==typeof t?(t=encodeURI(t).replace(i,ee),e&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ee(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Yi.prototype.toString=function(){var t=[],i=this.j;i&&t.push(ie(i,ne,!0),":");var e=this.i;return(e||"file"==i)&&(t.push("//"),(i=this.s)&&t.push(ie(i,ne,!0),"@"),t.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.m)&&t.push(":",String(e))),(e=this.l)&&(this.i&&"/"!=e.charAt(0)&&t.push("/"),t.push(ie(e,"/"==e.charAt(0)?se:re,!0))),(e=this.h.toString())&&t.push("?",e),(e=this.o)&&t.push("#",ie(e,he)),t.join("")};var ne=/[#\/\?@]/g,re=/[#\?:]/g,se=/[#\?]/g,oe=/[#\?@]/g,he=/#/g;function ae(t,i){this.h=this.g=null,this.i=t||null,this.j=!!i}function le(t){t.g||(t.g=new Bi,t.h=0,t.i&&Ki(t.i,function(i,e){t.add(decodeURIComponent(i.replace(/\+/g," ")),e)}))}function ue(t,i){le(t),i=ge(t,i),Ni(t.g.h,i)&&(t.i=null,t.h-=t.g.get(i).length,Ni((t=t.g).h,i)&&(delete t.h[i],t.i--,t.g.length>2*t.i&&Fi(t)))}function ce(t,i){return le(t),i=ge(t,i),Ni(t.g.h,i)}function fe(t,i,e){ue(t,i),0<e.length&&(t.i=null,t.g.set(ge(t,i),C(e)),t.h+=e.length)}function ge(t,i){return i=String(i),t.j&&(i=i.toLowerCase()),i}function pe(t,i){i&&!t.j&&(le(t),t.i=null,t.g.forEach(function(t,i){var e=i.toLowerCase();i!=e&&(ue(this,i),fe(this,e,t))},t)),t.j=i}(r=ae.prototype).add=function(t,i){le(this),this.i=null,t=ge(this,t);var e=this.g.get(t);return e||this.g.set(t,e=[]),e.push(i),this.h+=1,this},r.forEach=function(t,i){le(this),this.g.forEach(function(e,n){S(e,function(e){t.call(i,e,n,this)},this)},this)},r.T=function(){le(this);for(var t=this.g.R(),i=this.g.T(),e=[],n=0;n<i.length;n++)for(var r=t[n],s=0;s<r.length;s++)e.push(i[n]);return e},r.R=function(t){le(this);var i=[];if("string"==typeof t)ce(this,t)&&(i=j(i,this.g.get(ge(this,t))));else{t=this.g.R();for(var e=0;e<t.length;e++)i=j(i,t[e])}return i},r.set=function(t,i){return le(this),this.i=null,ce(this,t=ge(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[i]),this.h+=1,this},r.get=function(t,i){return t&&0<(t=this.R(t)).length?String(t[0]):i},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],i=this.g.T(),e=0;e<i.length;e++){var n=i[e],r=encodeURIComponent(String(n));n=this.R(n);for(var s=0;s<n.length;s++){var o=r;""!==n[s]&&(o+="="+encodeURIComponent(String(n[s]))),t.push(o)}}return this.i=t.join("&")};var ve=function(){return function(t,i){this.h=t,this.g=i}}();function de(t){this.l=t||ye,h.PerformanceNavigationTiming?t=0<(t=h.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(h.g&&h.g.Ea&&h.g.Ea()&&h.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ye=10;function me(t){return!!t.h||!!t.g&&t.g.size>=t.j}function be(t){return t.h?1:t.g?t.g.size:0}function we(t,i){return t.h?t.h==i:!!t.g&&t.g.has(i)}function Te(t,i){t.g?t.g.add(i):t.h=i}function Ee(t,i){t.h&&t.h==i?t.h=null:t.g&&t.g.has(i)&&t.g.delete(i)}function Se(t){var i,e;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var s=n(t.g.values()),o=s.next();!o.done;o=s.next()){var h=o.value;r=r.concat(h.D)}}catch(a){i={error:a}}finally{try{o&&!o.done&&(e=s.return)&&e.call(s)}finally{if(i)throw i.error}}return r}return C(t.i)}function xe(){}function je(){this.g=new xe}function Ce(t,i,e){var n=e||"";try{ki(t,function(t,e){var r=t;u(t)&&(r=Rt(t)),i.push(n+e+"="+encodeURIComponent(r))})}catch(r){throw i.push(n+"type="+encodeURIComponent("_badmap")),r}}function Ie(t,i){var e=new qt;if(h.Image){var n=new Image;n.onload=y(Ae,e,n,"TestLoadImage: loaded",!0,i),n.onerror=y(Ae,e,n,"TestLoadImage: error",!1,i),n.onabort=y(Ae,e,n,"TestLoadImage: abort",!1,i),n.ontimeout=y(Ae,e,n,"TestLoadImage: timeout",!1,i),h.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=t}else i(!1)}function Ae(t,i,e,n,r){try{i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null,r(n)}catch(s){}}function Re(t){this.l=t.$b||null,this.j=t.ib||!1}function Oe(t,i){Ct.call(this),this.D=t,this.u=i,this.m=void 0,this.readyState=Pe,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}de.prototype.cancel=function(){var t,i;if(this.i=Se(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var e=n(this.g.values()),r=e.next();!r.done;r=e.next()){r.value.cancel()}}catch(s){t={error:s}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(t)throw t.error}}this.g.clear()}},xe.prototype.stringify=function(t){return h.JSON.stringify(t,void 0)},xe.prototype.parse=function(t){return h.JSON.parse(t,void 0)},m(Re,gi),Re.prototype.g=function(){return new Oe(this.l,this.j)},Re.prototype.i=function(t){return function(){return t}}({}),m(Oe,Ct);var Pe=0;function De(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Me(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Le(t)}function Le(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(r=Oe.prototype).open=function(t,i){if(this.readyState!=Pe)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=i,this.readyState=1,Le(this)},r.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var i={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(i.body=t),(this.D||h).fetch(new Request(this.B,i)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Me(this)),this.readyState=Pe},r.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Le(this)),this.g&&(this.readyState=3,Le(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==h.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;De(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var i=t.value?t.value:new Uint8Array(0);(i=this.A.decode(i,{stream:!t.done}))&&(this.response=this.responseText+=i)}t.done?Me(this):Le(this),3==this.readyState&&De(this)}},r.Ua=function(t){this.g&&(this.response=this.responseText=t,Me(this))},r.Ta=function(t){this.g&&(this.response=t,Me(this))},r.ha=function(){this.g&&Me(this)},r.setRequestHeader=function(t,i){this.v.append(t,i)},r.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],i=this.h.entries(),e=i.next();!e.done;)e=e.value,t.push(e[0]+": "+e[1]),e=i.next();return t.join("\r\n")},Object.defineProperty(Oe.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Xe=h.JSON.parse;function He(t){Ct.call(this),this.headers=new Bi,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=_e,this.K=this.L=!1}m(He,Ct);var _e="",ke=/^https?$/i,Be=["POST","PUT"];function Fe(t){return U&&Q()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}function Ne(t){return"content-type"==t.toLowerCase()}function Ue(t,i){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=i,t.m=5,Ke(t),Ge(t)}function Ke(t){t.D||(t.D=!0,It(t,"complete"),It(t,"error"))}function Ye(t){if(t.h&&void 0!==o&&(!t.C[1]||4!=We(t)||2!=t.ba()))if(t.v&&4==We(t))Kt(t.Fa,0,t);else if(It(t,"readystatechange"),4==We(t)){t.h=!1;try{var i,e=t.ba();t:switch(e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break t;default:n=!1}if(!(i=n)){var r;if(r=0===e){var s=String(t.H).match(Ui)[1]||null;if(!s&&h.self&&h.self.location){var a=h.self.location.protocol;s=a.substr(0,a.length-1)}r=!ke.test(s?s.toLowerCase():"")}i=r}if(i)It(t,"complete"),It(t,"success");else{t.m=6;try{var l=2<We(t)?t.g.statusText:""}catch(u){l=""}t.j=l+" ["+t.ba()+"]",Ke(t)}}finally{Ge(t)}}}function Ge(t,i){if(t.g){Je(t);var e=t.g,n=t.C[0]?a:null;t.g=null,t.C=null,i||It(t,"ready");try{e.onreadystatechange=n}catch(r){}}}function Je(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(h.clearTimeout(t.A),t.A=null)}function We(t){return t.g?t.g.readyState:0}function Ve(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case _e:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(i){return null}}function $e(t){var i="";return L(t,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),i}function qe(t,i,e){t:{for(n in e){var n=!1;break t}n=!0}n||(e=$e(e),"string"==typeof t?null!=e&&encodeURIComponent(String(e)):qi(t,i,e))}function ze(t,i,e){return e&&e.internalChannelParams&&e.internalChannelParams[t]||i}function Ze(t){this.za=0,this.l=[],this.h=new qt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ze("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ze("baseRetryDelayMs",5e3,t),this.$a=ze("retryDelaySeedMs",1e4,t),this.Ya=ze("forwardChannelMaxRetries",2,t),this.ra=ze("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new de(t&&t.concurrentRequestLimit),this.Ca=new je,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Qe(t){if(en(t),3==t.G){var i=t.V++,e=Gi(t.F);qi(e,"SID",t.J),qi(e,"RID",i),qi(e,"TYPE","terminate"),hn(t,e),(i=new Ti(t,t.h,i,void 0)).K=2,i.v=zi(Gi(e)),e=!1,h.navigator&&h.navigator.sendBeacon&&(e=h.navigator.sendBeacon(i.v.toString(),"")),!e&&h.Image&&((new Image).src=i.v,e=!0),e||(i.g=bn(i.l,null),i.g.ea(i.v)),i.F=Date.now(),Pi(i)}yn(t)}function tn(t){t.g&&(cn(t),t.g.cancel(),t.g=null)}function en(t){tn(t),t.u&&(h.clearTimeout(t.u),t.u=null),gn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&h.clearTimeout(t.m),t.m=null)}function nn(t,i){t.l.push(new ve(t.Za++,i)),3==t.G&&rn(t)}function rn(t){me(t.i)||t.m||(t.m=!0,Ht(t.Ha,t),t.C=0)}function sn(t,i){return!(be(t.i)>=t.i.j-(t.m?1:0))&&(t.m?(t.l=i.D.concat(t.l),!0):!(1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya))&&(t.m=ui(d(t.Ha,t,i),vn(t,t.C)),t.C++,!0))}function on(t,i){var e;e=i?i.m:t.V++;var n=Gi(t.F);qi(n,"SID",t.J),qi(n,"RID",e),qi(n,"AID",t.U),hn(t,n),t.o&&t.s&&qe(n,t.o,t.s),e=new Ti(t,t.h,e,t.C+1),null===t.o&&(e.H=t.s),i&&(t.l=i.D.concat(t.l)),i=an(t,e,1e3),e.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Te(t.i,e),Ci(e,n,i)}function hn(t,i){t.j&&ki({},function(t,e){qi(i,e,t)})}function an(t,i,e){e=Math.min(t.l.length,e);var n=t.j?d(t.j.Oa,t.j,t):null;t:for(var r=t.l,s=-1;;){var o=["count="+e];-1==s?0<e?(s=r[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);for(var h=!0,a=0;a<e;a++){var l=r[a].h,u=r[a].g;if(0>(l-=s))s=Math.max(0,r[a].h-100),h=!1;else try{Ce(u,o,"req"+l+"_")}catch(c){n&&n(u)}}if(h){n=o.join("&");break t}}return t=t.l.splice(0,e),i.D=t,n}function ln(t){t.g||t.u||(t.Y=1,Ht(t.Ga,t),t.A=0)}function un(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=ui(d(t.Ga,t),vn(t,t.A)),t.A++,!0)}function cn(t){null!=t.B&&(h.clearTimeout(t.B),t.B=null)}function fn(t){t.g=new Ti(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var i=Gi(t.oa);qi(i,"RID","rpc"),qi(i,"SID",t.J),qi(i,"CI",t.N?"0":"1"),qi(i,"AID",t.U),hn(t,i),qi(i,"TYPE","xmlhttp"),t.o&&t.s&&qe(i,t.o,t.s),t.K&&t.g.setTimeout(t.K);var e=t.g;t=t.la,e.K=1,e.v=zi(Gi(i)),e.s=null,e.U=!0,Ii(e,t)}function gn(t){null!=t.v&&(h.clearTimeout(t.v),t.v=null)}function pn(t,i){var e=null;if(t.g==i){gn(t),cn(t),t.g=null;var n=2}else{if(!we(t.i,i))return;e=i.D,Ee(t.i,i),n=1}if(t.I=i.N,0!=t.G)if(i.i)if(1==n){e=i.s?i.s.length:0,i=Date.now()-i.F;var r=t.C;It(n=ri(),new li(n,e,i,r)),rn(t)}else ln(t);else if(3==(r=i.o)||0==r&&0<t.I||!(1==n&&sn(t,i)||2==n&&un(t)))switch(e&&0<e.length&&(i=t.i,i.i=i.i.concat(e)),r){case 1:dn(t,5);break;case 4:dn(t,10);break;case 3:dn(t,6);break;default:dn(t,2)}}function vn(t,i){var e=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(e*=2),e*i}function dn(t,i){if(t.h.info("Error code "+i),2==i){var e=null;t.j&&(e=null);var n=d(t.jb,t);e||(e=new Yi("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||Ji(e,"https"),zi(e)),Ie(e.toString(),n)}else ai(2);t.G=0,t.j&&t.j.va(i),yn(t),en(t)}function yn(t){t.G=0,t.I=-1,t.j&&(0==Se(t.i).length&&0==t.l.length||(t.i.i.length=0,C(t.l),t.l.length=0),t.j.ua())}function mn(t,i,e){var n=Zi(e);if(""!=n.i)i&&Wi(n,i+"."+n.i),Vi(n,n.m);else{var r=h.location;n=Qi(r.protocol,i?i+"."+r.hostname:r.hostname,+r.port,e)}return t.aa&&L(t.aa,function(t,i){qi(n,i,t)}),i=t.D,e=t.sa,i&&e&&qi(n,i,e),qi(n,"VER",t.ma),hn(t,n),n}function bn(t,i,e){if(i&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(i=e&&t.Ba&&!t.qa?new He(new Re({ib:!0})):new He(t.qa)).L=t.H,i}function wn(){}function Tn(){if(U&&!(10<=Number(it)))throw Error("Environmental error: no available transport.")}function En(t,i){Ct.call(this),this.g=new Ze(i),this.l=t,this.h=i&&i.messageUrlParams||null,t=i&&i.messageHeaders||null,i&&i.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=i&&i.initMessageHeaders||null,i&&i.messageContentType&&(t?t["X-WebChannel-Content-Type"]=i.messageContentType:t={"X-WebChannel-Content-Type":i.messageContentType}),i&&i.ya&&(t?t["X-WebChannel-Client-Profile"]=i.ya:t={"X-WebChannel-Client-Profile":i.ya}),this.g.P=t,(t=i&&i.httpHeadersOverwriteParam)&&!I(t)&&(this.g.o=t),this.A=i&&i.supportsCrossDomainXhr||!1,this.v=i&&i.sendRawJson||!1,(i=i&&i.httpSessionIdParam)&&!I(i)&&(this.g.D=i,null!==(t=this.h)&&i in t&&(i in(t=this.h)&&delete t[i])),this.j=new jn(this)}function Sn(t){mi.call(this);var i=t.__sm__;if(i){t:{for(var e in i){t=e;break t}t=void 0}(this.i=t)&&(t=this.i,i=null!==i&&t in i?i[t]:void 0),this.data=i}else this.data=t}function xn(){bi.call(this),this.status=1}function jn(t){this.g=t}(r=He.prototype).ea=function(t,i,e,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);i=i?i.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():di.g(),this.C=this.u?pi(this.u):pi(di),this.g.onreadystatechange=d(this.Fa,this);try{this.F=!0,this.g.open(i,String(t),!0),this.F=!1}catch(s){return void Ue(this,s)}t=e||"";var r=new Bi(this.headers);n&&ki(n,function(t,i){r.set(i,t)}),n=x(r.T()),e=h.FormData&&t instanceof h.FormData,!(0<=E(Be,i))||n||e||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach(function(t,i){this.g.setRequestHeader(i,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Je(this),0<this.B&&((this.K=Fe(this.g))?(this.g.timeout=this.B,this.g.ontimeout=d(this.pa,this)):this.A=Kt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){Ue(this,s)}},r.pa=function(){void 0!==o&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,It(this,"timeout"),this.abort(8))},r.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,It(this,"complete"),It(this,"abort"),Ge(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ge(this,!0)),He.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?Ye(this):this.cb())},r.cb=function(){Ye(this)},r.ba=function(){try{return 2<We(this)?this.g.status:-1}catch(t){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Qa=function(t){if(this.g){var i=this.g.responseText;return t&&0==i.indexOf(t)&&(i=i.substring(t.length)),Xe(i)}},r.Da=function(){return this.m},r.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=Ze.prototype).ma=8,r.G=1,r.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(i){}},r.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var i=new Ti(this,this.h,t,void 0),e=this.s;if(this.P&&(e?_(e=X(e),this.P):e=this.P),null===this.o&&(i.H=e),this.ja)t:{for(var n=0,r=0;r<this.l.length;r++){var s=this.l[r];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(n+=s)){n=r;break t}if(4096===n||r===this.l.length-1){n=r+1;break t}}n=1e3}else n=1e3;n=an(this,i,n),qi(r=Gi(this.F),"RID",t),qi(r,"CVER",22),this.D&&qi(r,"X-HTTP-Session-Id",this.D),hn(this,r),this.o&&e&&qe(r,this.o,e),Te(this.i,i),this.Ra&&qi(r,"TYPE","init"),this.ja?(qi(r,"$req",n),qi(r,"SID","null"),i.$=!0,Ci(i,r,null)):Ci(i,r,n),this.G=2}}else 3==this.G&&(t?on(this,t):0==this.l.length||me(this.i)||on(this))},r.Ga=function(){if(this.u=null,fn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=ui(d(this.bb,this),t)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ai(10),tn(this),fn(this))},r.ab=function(){null!=this.v&&(this.v=null,tn(this),un(this),ai(19))},r.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ai(2)):(this.h.info("Failed to ping google.com"),ai(1))},(r=wn.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},Tn.prototype.g=function(t,i){return new En(t,i)},m(En,Ct),En.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,i=this.l,e=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Ht(d(t.hb,t,i))),ai(0),t.W=i,t.aa=e||{},t.N=t.X,t.F=mn(t,null,t.W),rn(t)},En.prototype.close=function(){Qe(this.g)},En.prototype.u=function(t){if("string"==typeof t){var i={};i.__data__=t,nn(this.g,i)}else this.v?((i={}).__data__=Rt(t),nn(this.g,i)):nn(this.g,t)},En.prototype.M=function(){this.g.j=null,delete this.j,Qe(this.g),delete this.g,En.Z.M.call(this)},m(Sn,mi),m(xn,bi),m(jn,wn),jn.prototype.xa=function(){It(this.g,"a")},jn.prototype.wa=function(t){It(this.g,new Sn(t))},jn.prototype.va=function(t){It(this.g,new xn(t))},jn.prototype.ua=function(){It(this.g,"b")},Tn.prototype.createWebChannel=Tn.prototype.g,En.prototype.send=En.prototype.u,En.prototype.open=En.prototype.m,En.prototype.close=En.prototype.close,ci.NO_ERROR=0,ci.TIMEOUT=8,ci.HTTP_ERROR=6,fi.COMPLETE="complete",vi.EventType=yi,yi.OPEN="a",yi.CLOSE="b",yi.ERROR="c",yi.MESSAGE="d",Ct.prototype.listen=Ct.prototype.N,He.prototype.listenOnce=He.prototype.O,He.prototype.getLastError=He.prototype.La,He.prototype.getLastErrorCode=He.prototype.Da,He.prototype.getStatus=He.prototype.ba,He.prototype.getResponseJson=He.prototype.Qa,He.prototype.getResponseText=He.prototype.ga,He.prototype.send=He.prototype.ea;var Cn=function(){return new Tn};exports.createWebChannelTransport=Cn;var In=function(){return ri()};exports.getStatEventTarget=In;var An=ci;exports.ErrorCode=An;var Rn=fi;exports.EventType=Rn;var On=ei;exports.Event=On;var Pn={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20};exports.Stat=Pn;var Dn=Re;exports.FetchXmlHttpFactory=Dn;var Mn=vi;exports.WebChannel=Mn;var Ln=He;exports.XhrIo=Ln;var Xn={createWebChannelTransport:Cn,getStatEventTarget:In,ErrorCode:An,EventType:Rn,Event:On,Stat:Pn,FetchXmlHttpFactory:Dn,WebChannel:Mn,XhrIo:Ln},Hn=Xn;exports.default=Hn;
},{}],"UymH":[function(require,module,exports) {
var process = require("process");
var t=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Q=ac,exports.c=Tc,exports.u=Sc,exports.z=exports.t=exports.s=exports.r=exports.q=exports.o=exports.n=exports.j=exports.a=exports.Z=exports.X=exports.W=exports.U=exports.T=exports.M=exports.E=exports.C=void 0;var e=require("tslib"),n=require("@firebase/util"),r=require("@firebase/logger"),i=require("@firebase/webchannel-wrapper");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();s.o=-1;var a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},u=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,e.__extends)(n,t),n}(Error),c=new r.Logger("@firebase/firestore");function h(){return c.logLevel}function f(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(c.logLevel<=r.LogLevel.DEBUG){var o=n.map(p);c.debug.apply(c,(0,e.__spreadArray)(["Firestore (8.8.1): "+t],o))}}function l(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(c.logLevel<=r.LogLevel.ERROR){var o=n.map(p);c.error.apply(c,(0,e.__spreadArray)(["Firestore (8.8.1): "+t],o))}}function d(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(c.logLevel<=r.LogLevel.WARN){var o=n.map(p);c.warn.apply(c,(0,e.__spreadArray)(["Firestore (8.8.1): "+t],o))}}function p(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function y(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.8.1) INTERNAL ASSERTION FAILED: "+t;throw l(e),new Error(e)}function v(t,e){t||y()}function m(t,e){return t}function g(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var _=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=g(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function w(t,e){return t<e?-1:t>e?1:0}function b(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function I(t){return t+"\0"}var E=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new u(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new u(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new u(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new u(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?w(this.nanoseconds,t.nanoseconds):w(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),T=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new E(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function S(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function N(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function D(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}exports.M=E;var A=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&y(),void 0===n?n=t.length-e:n>t.length-e&&y(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),x=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.prototype.canonicalString=function(){return this.toArray().join("/")},n.prototype.toString=function(){return this.canonicalString()},n.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new u(a.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new n(r)},n.emptyPath=function(){return new n([])},n}(A),k=/^[_a-zA-Z][_a-zA-Z0-9]*$/,C=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.isValidIdentifier=function(t){return k.test(t)},n.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},n.prototype.toString=function(){return this.canonicalString()},n.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},n.keyField=function(){return new n(["__name__"])},n.fromServerFormat=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new u(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},s=!1;i<t.length;){var c=t[i];if("\\"===c){if(i+1===t.length)throw new u(a.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var h=t[i+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new u(a.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,i+=2}else"`"===c?(s=!s,i++):"."!==c||s?(r+=c,i++):(o(),i++)}if(o(),s)throw new u(a.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.emptyPath=function(){return new n([])},n}(A),R=function(){function t(t){this.fields=t,t.sort(C.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return b(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),L=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return w(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();L.EMPTY_BYTE_STRING=new L("");var O=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function P(t){if(v(!!t),"string"==typeof t){var e=0,n=O.exec(t);if(v(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:M(t.seconds),nanos:M(t.nanos)}}function M(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function F(t){return"string"==typeof t?L.fromBase64String(t):L.fromUint8Array(t)}function V(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function q(t){var e=t.mapValue.fields.__previous_value__;return V(e)?q(e):e}function U(t){var e=P(t.mapValue.fields.__local_write_time__.timestampValue);return new E(e.seconds,e.nanos)}function B(t){return null==t}function j(t){return 0===t&&1/t==-1/0}function K(t){return"number"==typeof t&&Number.isInteger(t)&&!j(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Q=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(x.fromString(e))},t.fromName=function(e){return new t(x.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===x.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return x.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new x(e.slice()))},t}();function G(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?V(t)?4:10:y()}function z(t,e){var n=G(t);if(n!==G(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return U(t).isEqual(U(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=P(t.timestampValue),r=P(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return F(t.bytesValue).isEqual(F(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return M(t.geoPointValue.latitude)===M(e.geoPointValue.latitude)&&M(t.geoPointValue.longitude)===M(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return M(t.integerValue)===M(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=M(t.doubleValue),r=M(e.doubleValue);return n===r?j(n)===j(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return b(t.arrayValue.values||[],e.arrayValue.values||[],z);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(S(n)!==S(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!z(n[i],r[i])))return!1;return!0}(t,e);default:return y()}}function W(t,e){return void 0!==(t.values||[]).find(function(t){return z(t,e)})}function H(t,e){var n=G(t),r=G(e);if(n!==r)return w(n,r);switch(n){case 0:return 0;case 1:return w(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=M(t.integerValue||t.doubleValue),r=M(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Y(t.timestampValue,e.timestampValue);case 4:return Y(U(t),U(e));case 5:return w(t.stringValue,e.stringValue);case 6:return function(t,e){var n=F(t),r=F(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=w(n[i],r[i]);if(0!==o)return o}return w(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=w(M(t.latitude),M(e.latitude));return 0!==n?n:w(M(t.longitude),M(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=H(n[i],r[i]);if(o)return o}return w(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=w(r[s],o[s]);if(0!==a)return a;var u=H(n[r[s]],i[o[s]]);if(0!==u)return u}return w(r.length,o.length)}(t.mapValue,e.mapValue);default:throw y()}}function Y(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return w(t,e);var n=P(t),r=P(e),i=w(n.seconds,r.seconds);return 0!==i?i:w(n.nanos,r.nanos)}function $(t){return X(t)}function X(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=P(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?F(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Q.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=X(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+X(t.fields[o])}return e+"}"}(t.mapValue):y();var e,n}function J(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Z(t){return!!t&&"integerValue"in t}function tt(t){return!!t&&"arrayValue"in t}function et(t){return!!t&&"nullValue"in t}function nt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function rt(t){return!!t&&"mapValue"in t}function it(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==o(t.timestampValue))return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return N(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=it(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=it(t.arrayValue.values[r]);return n}return Object.assign({},t)}var ot=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!rt(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=it(e)},t.prototype.setAll=function(t){var e=this,n=C.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=it(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());rt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return z(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];rt(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){N(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},t.prototype.clone=function(){return new t(it(this.value))},t}();function st(t){var e=[];return N(t.fields,function(t,n){var r=new C([t]);if(rt(n)){var i=st(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)}),new R(e)}var at=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,T.min(),ot.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,ot.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,ot.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ot.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ot.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),ut=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ct(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new ut(t,e,n,r,i,o,s)}function ht(t){var e=m(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+$(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),B(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Et(e.startAt)),e.endAt&&(n+="|ub:",n+=Et(e.endAt)),e.h=n}return e.h}function ft(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!St(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!z(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Dt(t.startAt,e.startAt)&&Dt(t.endAt,e.endAt)}function lt(t){return Q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var dt=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,e.__extends)(n,t),n.create=function(t,e,r){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,r):new pt(t,e,r):"array-contains"===e?new gt(t,r):"in"===e?new _t(t,r):"not-in"===e?new wt(t,r):"array-contains-any"===e?new bt(t,r):new n(t,e,r)},n.l=function(t,e,n){return"in"===e?new yt(t,n):new vt(t,n)},n.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(H(e,this.value)):null!==e&&G(this.value)===G(e)&&this.m(H(e,this.value))},n.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return y()}},n.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}(function(){}),pt=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Q.fromName(r.referenceValue),i}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=Q.comparator(t.key,this.key);return this.m(e)},n}(dt),yt=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=mt("in",n),r}return(0,e.__extends)(n,t),n.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},n}(dt),vt=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=mt("not-in",n),r}return(0,e.__extends)(n,t),n.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},n}(dt);function mt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Q.fromName(t.referenceValue)})}var gt=function(t){function n(e,n){return t.call(this,e,"array-contains",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=t.data.field(this.field);return tt(e)&&W(e.arrayValue,this.value)},n}(dt),_t=function(t){function n(e,n){return t.call(this,e,"in",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&W(this.value.arrayValue,e)},n}(dt),wt=function(t){function n(e,n){return t.call(this,e,"not-in",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){if(W(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!W(this.value.arrayValue,e)},n}(dt),bt=function(t){function n(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!tt(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return W(e.value.arrayValue,t)})},n}(dt),It=function(t,e){this.position=t,this.before=e};function Et(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return $(t)}).join(",")}var Tt=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function St(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Nt(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Q.comparator(Q.fromName(s.referenceValue),n.key):H(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Dt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!z(t.position[n],e.position[n]))return!1;return!0}var At=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function xt(t,e,n,r,i,o,s,a){return new At(t,e,n,r,i,o,s,a)}function kt(t){return new At(t)}function Ct(t){return!B(t.limit)&&"F"===t.limitType}function Rt(t){return!B(t.limit)&&"L"===t.limitType}function Lt(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ot(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Pt(t){return null!==t.collectionGroup}function Mt(t){var e=m(t);if(null===e.p){e.p=[];var n=Ot(e),r=Lt(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Tt(n)),e.p.push(new Tt(C.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Tt(C.keyField(),u))}}}return e.p}function Ft(t){var e=m(t);if(!e.T)if("F"===e.limitType)e.T=ct(e.path,e.collectionGroup,Mt(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Mt(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Tt(o.field,s))}var a=e.endAt?new It(e.endAt.position,!e.endAt.before):null,u=e.startAt?new It(e.startAt.position,!e.startAt.before):null;e.T=ct(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Vt(t,e,n){return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function qt(t,e){return ft(Ft(t),Ft(e))&&t.limitType===e.limitType}function Ut(t){return ht(Ft(t))+"|lt:"+t.limitType}function Bt(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+$(e.value);var e}).join(", ")+"]"),B(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Et(t.startAt)),t.endAt&&(e+=", endAt: "+Et(t.endAt)),"Target("+e+")"}(Ft(t))+"; limitType="+t.limitType+")"}function jt(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Q.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Nt(t.startAt,Mt(t),e)||t.endAt&&Nt(t.endAt,Mt(t),e))}(t,e)}function Kt(t){return function(e,n){for(var r=!1,i=0,o=Mt(t);i<o.length;i++){var s=o[i],a=Qt(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Qt(t,e,n){var r=t.field.isKeyField()?Q.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?H(r,i):y()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return y()}}function Gt(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:j(e)?"-0":e}}function zt(t){return{integerValue:""+t}}function Wt(t,e){return K(e)?zt(e):Gt(t,e)}var Ht=function(){this._=void 0};function Yt(t,e,n){return t instanceof Jt?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Zt?te(t,e):t instanceof ee?ne(t,e):function(t,e){var n=Xt(t,e),r=ie(n)+ie(t.A);return Z(n)&&Z(t.A)?zt(r):Gt(t.R,r)}(t,e)}function $t(t,e,n){return t instanceof Zt?te(t,e):t instanceof ee?ne(t,e):n}function Xt(t,e){return t instanceof re?Z(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var Jt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n}(Ht),Zt=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,e.__extends)(n,t),n}(Ht);function te(t,e){for(var n=oe(e),r=function(t){n.some(function(e){return z(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ee=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,e.__extends)(n,t),n}(Ht);function ne(t,e){for(var n=oe(e),r=function(t){n=n.filter(function(e){return!z(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var re=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,e.__extends)(n,t),n}(Ht);function ie(t){return M(t.integerValue||t.doubleValue)}function oe(t){return tt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var se=function(t,e){this.field=t,this.transform=e},ae=function(t,e){this.version=t,this.transformResults=e},ue=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ce(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var he=function(){};function fe(t,e,n){t instanceof ve?function(t,e,n){var r=t.value.clone(),i=_e(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof me?function(t,e,n){if(ce(t.precondition,e)){var r=_e(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ge(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function le(t,e,n){t instanceof ve?function(t,e,n){if(ce(t.precondition,e)){var r=t.value.clone(),i=we(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ye(e),r).setHasLocalMutations()}}(t,e,n):t instanceof me?function(t,e,n){if(ce(t.precondition,e)){var r=we(t.fieldTransforms,n,e),i=e.data;i.setAll(ge(t)),i.setAll(r),e.convertToFoundDocument(ye(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){ce(t.precondition,e)&&e.convertToNoDocument(T.min())}(t,e)}function de(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Xt(o.transform,s||null);null!=a&&(null==n&&(n=ot.empty()),n.set(o.field,a))}return n||null}function pe(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&b(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Zt&&e instanceof Zt||t instanceof ee&&e instanceof ee?b(t.elements,e.elements,z):t instanceof re&&e instanceof re?z(t.A,e.A):t instanceof Jt&&e instanceof Jt}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ye(t){return t.isFoundDocument()?t.version:T.min()}var ve=function(t){function n(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,e.__extends)(n,t),n}(he),me=function(t){function n(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,e.__extends)(n,t),n}(he);function ge(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function _e(t,e,n){var r=new Map;v(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,$t(s,a,n[i]))}return r}function we(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Yt(a,u,e))}return r}var be,Ie,Ee=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,e.__extends)(n,t),n}(he),Te=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,e.__extends)(n,t),n}(he),Se=function(t){this.count=t};function Ne(t){switch(t){case a.OK:return y();case a.CANCELLED:case a.UNKNOWN:case a.DEADLINE_EXCEEDED:case a.RESOURCE_EXHAUSTED:case a.INTERNAL:case a.UNAVAILABLE:case a.UNAUTHENTICATED:return!1;case a.INVALID_ARGUMENT:case a.NOT_FOUND:case a.ALREADY_EXISTS:case a.PERMISSION_DENIED:case a.FAILED_PRECONDITION:case a.ABORTED:case a.OUT_OF_RANGE:case a.UNIMPLEMENTED:case a.DATA_LOSS:return!0;default:return y()}}function De(t){if(void 0===t)return l("GRPC error has no .code"),a.UNKNOWN;switch(t){case be.OK:return a.OK;case be.CANCELLED:return a.CANCELLED;case be.UNKNOWN:return a.UNKNOWN;case be.DEADLINE_EXCEEDED:return a.DEADLINE_EXCEEDED;case be.RESOURCE_EXHAUSTED:return a.RESOURCE_EXHAUSTED;case be.INTERNAL:return a.INTERNAL;case be.UNAVAILABLE:return a.UNAVAILABLE;case be.UNAUTHENTICATED:return a.UNAUTHENTICATED;case be.INVALID_ARGUMENT:return a.INVALID_ARGUMENT;case be.NOT_FOUND:return a.NOT_FOUND;case be.ALREADY_EXISTS:return a.ALREADY_EXISTS;case be.PERMISSION_DENIED:return a.PERMISSION_DENIED;case be.FAILED_PRECONDITION:return a.FAILED_PRECONDITION;case be.ABORTED:return a.ABORTED;case be.OUT_OF_RANGE:return a.OUT_OF_RANGE;case be.UNIMPLEMENTED:return a.UNIMPLEMENTED;case be.DATA_LOSS:return a.DATA_LOSS;default:return y()}}(Ie=be||(be={}))[Ie.OK=0]="OK",Ie[Ie.CANCELLED=1]="CANCELLED",Ie[Ie.UNKNOWN=2]="UNKNOWN",Ie[Ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ie[Ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ie[Ie.NOT_FOUND=5]="NOT_FOUND",Ie[Ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ie[Ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ie[Ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ie[Ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ie[Ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ie[Ie.ABORTED=10]="ABORTED",Ie[Ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ie[Ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ie[Ie.INTERNAL=13]="INTERNAL",Ie[Ie.UNAVAILABLE=14]="UNAVAILABLE",Ie[Ie.DATA_LOSS=15]="DATA_LOSS";var Ae=function(){function t(t,e){this.comparator=t,this.root=e||ke.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ke.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ke.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new xe(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new xe(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new xe(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new xe(this.root,t,this.comparator,!0)},t}(),xe=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ke=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw y();if(this.right.isRed())throw y();var t=this.left.check();if(t!==this.right.check())throw y();return t+(this.isRed()?0:1)},t}();ke.EMPTY=null,ke.RED=!0,ke.BLACK=!1,ke.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw y()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ke(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Ce=function(){function t(t){this.comparator=t,this.data=new Ae(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Re(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Re(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Re=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Le=new Ae(Q.comparator);function Oe(){return Le}var Pe=new Ae(Q.comparator);function Me(){return Pe}var Fe=new Ae(Q.comparator);function Ve(){return Fe}var qe=new Ce(Q.comparator);function Ue(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=qe,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Be=new Ce(w);function je(){return Be}var Ke=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Qe.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(T.min(),r,je(),Oe(),Ue())},t}(),Qe=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(L.EMPTY_BYTE_STRING,n,Ue(),Ue(),Ue())},t}(),Ge=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ze=function(t,e){this.targetId=t,this.V=e},We=function(t,e,n,r){void 0===n&&(n=L.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},He=function(){function t(){this.S=0,this.D=Xe(),this.C=L.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Ue(),e=Ue(),n=Ue();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:y()}}),new Qe(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Xe()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Ye=function(){function t(t){this.W=t,this.G=new Map,this.H=Oe(),this.J=$e(),this.Y=new Ce(w)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:y()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(lt(i))if(0===n){var o=new Q(i.path);this.tt(e,o,at.newNoDocument(o,T.min()))}else v(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&lt(o.target)){var s=new Q(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,at.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Ue();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ke(t,n,this.Y,this.H,r);return this.H=Oe(),this.J=$e(),this.Y=new Ce(w),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new He,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ce(w),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||f("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new He),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function $e(){return new Ae(Q.comparator)}function Xe(){return new Ae(Q.comparator)}var Je={asc:"ASCENDING",desc:"DESCENDING"},Ze={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tn=function(t,e){this.databaseId=t,this.I=e};function en(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function nn(t,e){return t.I?e.toBase64():e.toUint8Array()}function rn(t,e){return en(t,e.toTimestamp())}function on(t){return v(!!t),T.fromTimestamp(function(t){var e=P(t);return new E(e.seconds,e.nanos)}(t))}function sn(t,e){return function(t){return new x(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function an(t){var e=x.fromString(t);return v(Cn(e)),e}function un(t,e){return sn(t.databaseId,e.path)}function cn(t,e){var n=an(e);if(n.get(1)!==t.databaseId.projectId)throw new u(a.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new u(a.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Q(dn(n))}function hn(t,e){return sn(t.databaseId,e)}function fn(t){var e=an(t);return 4===e.length?x.emptyPath():dn(e)}function ln(t){return new x(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function dn(t){return v(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function pn(t,e,n){return{name:un(t,e),fields:n.value.mapValue.fields}}function yn(t,e,n){var r=cn(t,e.name),i=on(e.updateTime),o=new ot({mapValue:{fields:e.fields}}),s=at.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function vn(t,e){var n;if(e instanceof ve)n={update:pn(t,e.key,e.value)};else if(e instanceof Ee)n={delete:un(t,e.key)};else if(e instanceof me)n={update:pn(t,e.key,e.data),updateMask:kn(e.fieldMask)};else{if(!(e instanceof Te))return y();n={verify:un(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Jt)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Zt)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ee)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof re)return{fieldPath:e.field.canonicalString(),increment:n.A};throw y()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:rn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:y()}(t,e.precondition)),n}function mn(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?ue.updateTime(on(t.updateTime)):void 0!==t.exists?ue.exists(t.exists):ue.none()}(e.currentDocument):ue.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;if("setToServerValue"in e)v("REQUEST_TIME"===e.setToServerValue),n=new Jt;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Zt(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new ee(i)}else"increment"in e?n=new re(t,e.increment):y();var o=C.fromServerFormat(e.fieldPath);return new se(o,n)}(t,e)}):[];if(e.update){e.update.name;var i=cn(t,e.update.name),o=new ot({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new R(e.map(function(t){return C.fromServerFormat(t)}))}(e.updateMask);return new me(i,o,s,n,r)}return new ve(i,o,n,r)}if(e.delete){var a=cn(t,e.delete);return new Ee(a,n)}if(e.verify){var u=cn(t,e.verify);return new Te(u,n)}return y()}function gn(t,e){return{documents:[hn(t,e.path)]}}function _n(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=hn(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=hn(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(nt(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NAN"}};if(et(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(nt(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NOT_NAN"}};if(et(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nn(t.field),op:Sn(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Nn(t.field),direction:Tn(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||B(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=In(e.startAt)),e.endAt&&(n.structuredQuery.endAt=In(e.endAt)),n}function wn(t){var e=fn(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){v(1===r);var s=n.from[0];s.allDescendants?i=s.collectionId:e=e.child(s.collectionId)}var a=[];n.where&&(a=bn(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(t){return function(t){return new Tt(Dn(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var c=null;n.limit&&(c=function(t){var e;return B(e="object"==o(t)?t.value:t)?null:e}(n.limit));var h=null;n.startAt&&(h=En(n.startAt));var f=null;return n.endAt&&(f=En(n.endAt)),xt(e,i,u,a,c,"F",h,f)}function bn(t){return t?void 0!==t.unaryFilter?[xn(t)]:void 0!==t.fieldFilter?[An(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return bn(t)}).reduce(function(t,e){return t.concat(e)}):y():[]}function In(t){return{before:t.before,values:t.position}}function En(t){var e=!!t.before,n=t.values||[];return new It(n,e)}function Tn(t){return Je[t]}function Sn(t){return Ze[t]}function Nn(t){return{fieldPath:t.canonicalString()}}function Dn(t){return C.fromServerFormat(t.fieldPath)}function An(t){return dt.create(Dn(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return y()}}(t.fieldFilter.op),t.fieldFilter.value)}function xn(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Dn(t.unaryFilter.field);return dt.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Dn(t.unaryFilter.field);return dt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Dn(t.unaryFilter.field);return dt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Dn(t.unaryFilter.field);return dt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return y()}}function kn(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function Cn(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Rn(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=On(e)),e=Ln(t.get(n),e);return On(e)}function Ln(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function On(t){return t+""}function Pn(t){var e=t.length;if(v(e>=2),2===e)return v(""===t.charAt(0)&&""===t.charAt(1)),x.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&y(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:y()}o=s+2}return new x(r)}var Mn=function(t,e){this.seconds=t,this.nanoseconds=e},Fn=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Fn.store="owner",Fn.key="owner";var Vn=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Vn.store="mutationQueues",Vn.keyPath="userId";var qn=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};qn.store="mutations",qn.keyPath="batchId",qn.userMutationsIndex="userMutationsIndex",qn.userMutationsKeyPath=["userId","batchId"];var Un=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Rn(e)]},t.key=function(t,e,n){return[t,Rn(e),n]},t}();Un.store="documentMutations",Un.PLACEHOLDER=new Un;var Bn=function(t,e){this.path=t,this.readTime=e},jn=function(t,e){this.path=t,this.version=e},Kn=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Kn.store="remoteDocuments",Kn.readTimeIndex="readTimeIndex",Kn.readTimeIndexPath="readTime",Kn.collectionReadTimeIndex="collectionReadTimeIndex",Kn.collectionReadTimeIndexPath=["parentPath","readTime"];var Qn=function(t){this.byteSize=t};Qn.store="remoteDocumentGlobal",Qn.key="remoteDocumentGlobalKey";var Gn=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Gn.store="targets",Gn.keyPath="targetId",Gn.queryTargetsIndexName="queryTargetsIndex",Gn.queryTargetsKeyPath=["canonicalId","targetId"];var zn=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};zn.store="targetDocuments",zn.keyPath=["targetId","path"],zn.documentTargetsIndex="documentTargetsIndex",zn.documentTargetsKeyPath=["path","targetId"];var Wn=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Wn.key="targetGlobalKey",Wn.store="targetGlobal";var Hn=function(t,e){this.collectionId=t,this.parent=e};Hn.store="collectionParents",Hn.keyPath=["collectionId","parent"];var Yn=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Yn.store="clientMetadata",Yn.keyPath="clientId";var $n=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};$n.store="bundles",$n.keyPath="bundleId";var Xn=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Xn.store="namedQueries",Xn.keyPath="name";var Jn=(0,e.__spreadArray)((0,e.__spreadArray)([],(0,e.__spreadArray)((0,e.__spreadArray)([],(0,e.__spreadArray)((0,e.__spreadArray)([],(0,e.__spreadArray)((0,e.__spreadArray)([],[Vn.store,qn.store,Un.store,Kn.store,Gn.store,Fn.store,Wn.store,zn.store]),[Yn.store])),[Qn.store])),[Hn.store])),[$n.store,Xn.store]),Zn="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",tr=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),er=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},nr=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),rr=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new er,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new sr(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=fr(e.target.error);n.ft.reject(new sr(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new sr(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(f("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ur(e)},t}(),ir=function(){function r(t,e,i){this.name=t,this.version=e,this.wt=i,12.2===r._t((0,n.getUA)())&&l("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return r.delete=function(t){return f("SimpleDb","Removing database:",t),cr(window.indexedDB.deleteDatabase(t)).toPromise()},r.yt=function(){if("undefined"==typeof indexedDB)return!1;if(r.gt())return!0;var t=(0,n.getUA)(),e=r._t(t),i=0<e&&e<10,o=r.Et(t),s=0<o&&o<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||s)},r.gt=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Tt)},r.It=function(t,e){return t.store(e)},r._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},r.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},r.prototype.At=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.db?[3,2]:(f("SimpleDb","Opening database:",this.name),n=this,[4,new Promise(function(e,n){var i=indexedDB.open(r.name,r.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){n(new sr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var r=e.target.error;"VersionError"===r.name?n(new u(a.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new sr(t,r))},i.onupgradeneeded=function(t){f("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;r.wt.Rt(e,i.transaction,t.oldVersion,r.version).next(function(){f("SimpleDb","Database upgrade to version "+r.version+" complete")})}})]);case 1:n.db=e.sent(),e.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return r.bt(t)}),this.db)]}})})},r.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},r.prototype.runTransaction=function(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var s,a,u,c,h;return(0,e.__generator)(this,function(l){switch(l.label){case 0:s="readonly"===n,a=0,u=function(){var n,o,u,h,l;return(0,e.__generator)(this,function(e){switch(e.label){case 0:++a,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,c.At(t)];case 2:return c.db=e.sent(),n=rr.open(c.db,t,s?"readonly":"readwrite",r),o=i(n).catch(function(t){return n.abort(t),nr.reject(t)}).toPromise(),u={},o.catch(function(){}),[4,n.dt];case 3:return[2,(u.value=(e.sent(),o),u)];case 4:return h=e.sent(),l="FirebaseError"!==h.name&&a<3,f("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),c.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}})},c=this,l.label=1;case 1:return[5,u()];case 2:if("object"==o(h=l.sent()))return[2,h.value];l.label=3;case 3:return[3,1];case 4:return[2]}})})},r.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},r}(),or=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return cr(this.Pt.delete())},t}(),sr=function(t){function n(e,n){var r=this;return(r=t.call(this,a.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,e.__extends)(n,t),n}(u);function ar(t){return"IndexedDbTransactionError"===t.name}var ur=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(f("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(f("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),cr(n)},t.prototype.add=function(t){return f("SimpleDb","ADD",this.store.name,t,t),cr(this.store.add(t))},t.prototype.get=function(t){var e=this;return cr(this.store.get(t)).next(function(n){return void 0===n&&(n=null),f("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return f("SimpleDb","DELETE",this.store.name,t),cr(this.store.delete(t))},t.prototype.count=function(){return f("SimpleDb","COUNT",this.store.name),cr(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){f("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new nr(function(n,r){e.onerror=function(t){var e=fr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new nr(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new or(i),s=e(i.primaryKey,i.value,o);if(s instanceof nr){var a=s.catch(function(t){return o.done(),nr.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return nr.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function cr(t){return new nr(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=fr(t.target.error);n(e)}})}var hr=!1;function fr(t){var e=ir._t((0,n.getUA)());if(e>=12.2&&e<13){var r="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(r)>=0){var i=new u("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+r+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return hr||(hr=!0,setTimeout(function(){throw i},0)),i}}return t}var lr=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,e.__extends)(n,t),n}(tr);function dr(t,e){var n=m(t);return ir.It(n.Mt,e)}var pr=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&fe(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&le(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&le(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(T.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ue())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&b(this.mutations,t.mutations,function(t,e){return pe(t,e)})&&b(this.baseMutations,t.baseMutations,function(t,e){return pe(t,e)})},t}(),yr=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){v(e.mutations.length===r.length);for(var i=Ve(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),vr=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=T.min()),void 0===o&&(o=T.min()),void 0===s&&(s=L.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),mr=function(t){this.Lt=t};function gr(t,e){if(e.document)return yn(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Q.fromSegments(e.noDocument.path),r=Er(e.noDocument.readTime),i=at.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Q.fromSegments(e.unknownDocument.path);return r=Er(e.unknownDocument.version),at.newUnknownDocument(o,r)}return y()}function _r(t,e,n){var r=wr(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:un(t,e.key),fields:e.data.value.mapValue.fields,updateTime:en(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Kn(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Ir(e.version);return s=e.hasCommittedMutations,new Kn(null,new Bn(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Ir(e.version);return new Kn(new jn(c,h),null,null,!0,r,i)}return y()}function wr(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function br(t){var e=new E(t[0],t[1]);return T.fromTimestamp(e)}function Ir(t){var e=t.toTimestamp();return new Mn(e.seconds,e.nanoseconds)}function Er(t){var e=new E(t.seconds,t.nanoseconds);return T.fromTimestamp(e)}function Tr(t,e){for(var n=(e.baseMutations||[]).map(function(e){return mn(t.Lt,e)}),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map(function(e){return mn(t.Lt,e)}),a=E.fromMillis(e.localWriteTimeMs);return new pr(e.batchId,a,n,s)}function Sr(t){var e,n,r=Er(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Er(t.lastLimboFreeSnapshotVersion):T.min();return void 0!==t.query.documents?(v(1===(n=t.query).documents.length),e=Ft(kt(fn(n.documents[0])))):e=function(t){return Ft(wn(t))}(t.query),new vr(e,t.targetId,0,t.lastListenSequenceNumber,r,i,L.fromBase64String(t.resumeToken))}function Nr(t,e){var n,r=Ir(e.snapshotVersion),i=Ir(e.lastLimboFreeSnapshotVersion);n=lt(e.target)?gn(t.Lt,e.target):_n(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Gn(e.targetId,ht(e.target),r,o,e.sequenceNumber,i,n)}function Dr(t){var e=wn({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Vt(e,e.limit,"L"):e}var Ar=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return xr(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Er(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return xr(t).put({bundleId:(n=e).id,createTime:Ir(on(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return kr(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Dr(e.bundledQuery),readTime:Er(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return kr(t).put(function(t){return{name:t.name,readTime:Ir(on(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function xr(t){return dr(t,$n.store)}function kr(t){return dr(t,Xn.store)}var Cr=function(){function t(){this.Bt=new Rr}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),nr.resolve()},t.prototype.getCollectionParents=function(t,e){return nr.resolve(this.Bt.getEntries(e))},t}(),Rr=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ce(x.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ce(x.comparator)).toArray()},t}(),Lr=function(){function t(){this.qt=new Rr}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:Rn(i)};return Or(t).put(o)}return nr.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[I(e),""],!1,!0);return Or(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Pn(o.parent))}return n})},t}();function Or(t){return dr(t,Hn.store)}var Pr={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Mr=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Fr(t,e,n){var r=t.store(qn.store),i=t.store(Un.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){v(1===a)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],d=Un.key(e,l.key.path,n.batchId);o.push(i.delete(d)),c.push(l.key)}return nr.waitFor(o).next(function(){return c})}function Vr(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw y();e=t.noDocument}return JSON.stringify(e).length}Mr.DEFAULT_COLLECTION_PERCENTILE=10,Mr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mr.DEFAULT=new Mr(41943040,Mr.DEFAULT_COLLECTION_PERCENTILE,Mr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mr.DISABLED=new Mr(-1,0,0);var qr=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return v(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Br(t).$t({index:qn.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=jr(t),s=Br(t);return s.add({}).next(function(a){v("number"==typeof a);for(var u=new pr(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return vn(t.Lt,e)}),i=n.mutations.map(function(e){return vn(t.Lt,e)});return new qn(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],f=new Ce(function(t,e){return w(t.canonicalString(),e.canonicalString())}),l=0,d=r;l<d.length;l++){var p=d[l],y=Un.key(i.userId,p.key.path,a);f=f.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Un.PLACEHOLDER))}return f.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),nr.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Br(t).get(e).next(function(t){return t?(v(t.userId===n.userId),Tr(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?nr.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Br(t).$t({index:qn.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(v(e.batchId>=r),o=Tr(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Br(t).$t({index:qn.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Br(t).Nt(qn.userMutationsIndex,n).next(function(t){return t.map(function(t){return Tr(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Un.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return jr(t).$t({range:i},function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Pn(u);if(a===n.userId&&e.path.isEqual(h))return Br(t).get(c).next(function(t){if(!t)throw y();v(t.userId===n.userId),o.push(Tr(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ce(w),i=[];return e.forEach(function(e){var o=Un.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=jr(t).$t({range:s},function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Pn(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(a)}),nr.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Un.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Ce(w);return jr(t).$t({range:s},function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Pn(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Br(t).get(e).next(function(t){if(null===t)throw y();v(t.userId===n.userId),r.push(Tr(n.R,t))}))}),nr.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Fr(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),nr.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return nr.resolve();var r=IDBKeyRange.lowerBound(Un.prefixForUser(e.userId)),i=[];return jr(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Pn(t[1]);i.push(o)}else r.done()}).next(function(){v(0===i.length)})})},t.prototype.containsKey=function(t,e){return Ur(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Kr(t).get(this.userId).next(function(t){return t||new Vn(e.userId,-1,"")})},t}();function Ur(t,e,n){var r=Un.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return jr(t).$t({range:o,kt:!0},function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()}).next(function(){return s})}function Br(t){return dr(t,qn.store)}function jr(t){return dr(t,Un.store)}function Kr(t){return dr(t,Vn.store)}var Qr=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Gr=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Qr(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return T.fromTimestamp(new E(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return zr(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return v(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return zr(t).$t(function(s,a){var u=Sr(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return nr.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return zr(t).$t(function(t,n){var r=Sr(n);e(r)})},t.prototype.Xt=function(t){return Wr(t).get(Wn.key).next(function(t){return v(null!==t),t})},t.prototype.Zt=function(t,e){return Wr(t).put(Wn.key,e)},t.prototype.te=function(t,e){return zr(t).put(Nr(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=ht(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return zr(t).$t({range:r,index:Gn.queryTargetsIndexName},function(t,n,r){var o=Sr(n);ft(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Hr(t);return e.forEach(function(e){var s=Rn(e.path);i.push(o.put(new zn(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),nr.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Hr(t);return nr.forEach(e,function(e){var o=Rn(e.path);return nr.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Hr(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Hr(t),i=Ue();return r.$t({range:n,kt:!0},function(t,e,n){var r=Pn(t[1]),o=new Q(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Rn(e.path),r=IDBKeyRange.bound([n],[I(n)],!1,!0),i=0;return Hr(t).$t({index:zn.documentTargetsIndex,kt:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return zr(t).get(e).next(function(t){return t?Sr(t):null})},t}();function zr(t){return dr(t,Gn.store)}function Wr(t){return dr(t,Wn.store)}function Hr(t){return dr(t,zn.store)}function Yr(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){if(t.code!==a.FAILED_PRECONDITION||t.message!==Zn)throw t;return f("LocalStore","Unexpectedly lost primary lease"),[2]})})}function $r(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=w(n,i);return 0===s?w(r,o):s}var Xr=function(){function t(t){this.ne=t,this.buffer=new Ce($r),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();$r(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Jr=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var n=this,r=this.oe?3e5:6e4;f("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:this.ce=null,this.oe=!0,e.label=1;case 1:return e.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return e.sent(),[3,7];case 3:return ar(n=e.sent())?(f("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n),[3,6]):[3,4];case 4:return[4,Yr(n)];case 5:e.sent(),e.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return e.sent(),[2]}})})})},t}(),Zr=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return nr.resolve(s.o);var r=new Xr(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(f("LruGarbageCollector","Garbage collection skipped; disabled"),nr.resolve(Pr)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(f("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Pr):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,i,o,s,a,u,c,l=this,d=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>l.params.maximumSequenceNumbersToCollect?(f("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.maximumSequenceNumbersToCollect+" from "+e),i=l.params.maximumSequenceNumbersToCollect):i=e,s=Date.now(),l.nthSequenceNumber(t,i)}).next(function(r){return n=r,a=Date.now(),l.removeTargets(t,n,e)}).next(function(e){return o=e,u=Date.now(),l.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),h()<=r.LogLevel.DEBUG&&f("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-d)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-d)+"ms"),nr.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},t}(),ti=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Zr(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return ei(t,n)},t.prototype.removeReference=function(t,e,n){return ei(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return ei(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Kr(t).Ot(function(r){return Ur(t,r,e).next(function(t){return t&&(n=!0),nr.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Hr(t).delete([0,Rn(s.path)])})});i.push(u)}}).next(function(){return nr.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return ei(t,e)},t.prototype.we=function(t,e){var n,r=Hr(t),i=s.o;return r.$t({index:zn.documentTargetsIndex},function(t,r){var o=t[0];t[1];var a=r.path,u=r.sequenceNumber;0===o?(i!==s.o&&e(new Q(Pn(n)),i),i=u,n=a):i=s.o}).next(function(){i!==s.o&&e(new Q(Pn(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function ei(t,e){return Hr(t).put(function(t,e){return new zn(0,Rn(t.path),e)}(e,t.currentSequenceNumber))}var ni=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){N(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}})},t.prototype.isEmpty=function(){return D(this.inner)},t}(),ri=function(){function t(){this.changes=new ni(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:T.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:at.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?nr.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),ii=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ai(t).put(ui(e),n)},t.prototype.removeEntry=function(t,e){var n=ai(t),r=ui(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return ai(t).get(ui(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return ai(t).get(ui(e)).next(function(t){return{document:n.ye(e,t),size:Vr(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Oe();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Oe(),i=new Ae(Q.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Vr(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return nr.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ai(t).$t({range:r},function(t,e,r){for(var s=Q.fromSegments(t);o&&Q.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Oe(),o=e.path.length+1,s={};if(n.isEqual(T.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=wr(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Kn.collectionReadTimeIndex}return ai(t).$t(s,function(t,n,s){if(t.length===o){var a=gr(r.R,n);e.path.isPrefixOf(a.key.path)?jt(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new oi(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return si(t).get(Qn.key).next(function(t){return v(!!t),t})},t.prototype.me=function(t,e){return si(t).put(Qn.key,e)},t.prototype.ye=function(t,e){if(e){var n=gr(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(T.min()))return n}return at.newInvalidDocument(t)},t}(),oi=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ni(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,e.__extends)(n,t),n.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ce(function(t,e){return w(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=_r(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Vr(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=_r(e.Ie.R,at.newNoDocument(o,T.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),nr.waitFor(n)},n.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},n.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},n}(ri);function si(t){return dr(t,Qn.store)}function ai(t){return dr(t,Kn.store)}function ui(t){return t.path.toArray()}var ci=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;v(n<r&&n>=0&&r<=11);var o=new rr("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Fn.store)}(t),function(t){t.createObjectStore(Vn.store,{keyPath:Vn.keyPath}),t.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Un.store)}(t),hi(t),function(t){t.createObjectStore(Kn.store)}(t));var s=nr.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(zn.store),t.deleteObjectStore(Gn.store),t.deleteObjectStore(Wn.store)}(t),hi(t)),s=s.next(function(){return t=o.store(Wn.store),e=new Wn(0,0,T.min().toTimestamp(),0),t.put(Wn.key,e);var t,e})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(qn.store).Nt().next(function(n){t.deleteObjectStore(qn.store),t.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0});var r=e.store(qn.store),i=n.map(function(t){return r.put(t)});return nr.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Yn.store,{keyPath:Yn.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Qn.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Kn.store);e.createIndex(Kn.readTimeIndex,Kn.readTimeIndexPath,{unique:!1}),e.createIndex(Kn.collectionReadTimeIndex,Kn.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore($n.store,{keyPath:$n.keyPath})}(t),function(t){t.createObjectStore(Xn.store,{keyPath:Xn.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Kn.store).$t(function(t,n){e+=Vr(n)}).next(function(){var n=new Qn(e);return t.store(Qn.store).put(Qn.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Vn.store),r=t.store(qn.store);return n.Nt().next(function(n){return nr.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(qn.userMutationsIndex,i).next(function(r){return nr.forEach(r,function(r){v(r.userId===n.userId);var i=Tr(e.R,r);return Fr(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(zn.store),n=t.store(Kn.store);return t.store(Wn.store).get(Wn.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new x(n),s=[0,Rn(o)];r.push(e.get(s).next(function(n){return n?nr.resolve():function(n){return e.put(new zn(0,Rn(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return nr.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Hn.store,{keyPath:Hn.keyPath});var n=e.store(Hn.store),r=new Rr,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Rn(i)})}};return e.store(Kn.store).$t({kt:!0},function(t,e){var n=new x(t);return i(n.popLast())}).next(function(){return e.store(Un.store).$t({kt:!0},function(t,e){t[0];var n=t[1];t[2];var r=Pn(n);return i(r.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Gn.store);return n.$t(function(t,r){var i=Sr(r),o=Nr(e.R,i);return n.put(o)})},t}();function hi(t){t.createObjectStore(zn.store,{keyPath:zn.keyPath}).createIndex(zn.documentTargetsIndex,zn.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Gn.store,{keyPath:Gn.keyPath}).createIndex(Gn.queryTargetsIndexName,Gn.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wn.store)}var fi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",li=function(){function t(e,n,r,i,o,s,c,h,f,d){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=c,this.De=f,this.Ce=d,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new u(a.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ti(this,i),this.Le=n+"main",this.R=new mr(h),this.Be=new ir(this.Le,11,new ci(this.R)),this.qe=new Gr(this.referenceDelegate,this.R),this.Ut=new Lr,this.Ue=function(t,e){return new ii(t,e)}(this.R,this.Ut),this.Ke=new Ar,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===d&&l("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new u(a.FAILED_PRECONDITION,fi);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new s(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var n=this;return this.Me=function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return this.started?[2,t(r)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var n=this;this.Be.vt(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return null===r.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return pi(e).put(new Yn(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(ar(e))return f("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return f("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return di(t).get(Fn.key).next(function(t){return nr.resolve(e.tn(t))})},t.prototype.en=function(t){return pi(t).delete(this.clientId)},t.prototype.nn=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=dr(t,Yn.store);return e.Nt().next(function(t){var n=o.rn(t,18e5),r=t.filter(function(t){return-1===n.indexOf(t)});return nr.forEach(r,function(t){return e.delete(t.clientId)}).next(function(){return r})})}).catch(function(){return[]})]);case 1:if(t=e.sent(),this.Qe)for(n=0,r=t;n<r.length;n++)i=r[n],this.Qe.removeItem(this.on(i.clientId));e.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?nr.resolve(!0):di(t).get(Fn.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new u(a.FAILED_PRECONDITION,fi);return!1}}return!(!e.networkEnabled||!e.inForeground)||pi(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&f("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Fn.store,Yn.store],function(e){var n=new lr(e,s.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return pi(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return qr.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;f("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,Jn,function(o){return i=new lr(o,r.Ne?r.Ne.next():s.o),"readwrite-primary"===e?r.Je(i).next(function(t){return!!t||r.Ye(i)}).next(function(e){if(!e)throw l("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable(function(){return r.Me(!1)}),new u(a.FAILED_PRECONDITION,Zn);return n(i)}).next(function(t){return r.Ze(i).next(function(){return t})}):r.dn(i).next(function(){return n(i)})}).then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return di(t).get(Fn.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new u(a.FAILED_PRECONDITION,fi)})},t.prototype.Ze=function(t){var e=new Fn(this.clientId,this.allowTabSynchronization,Date.now());return di(t).put(Fn.key,e)},t.yt=function(){return ir.yt()},t.prototype.Xe=function(t){var e=this,n=di(t);return n.get(Fn.key).next(function(t){return e.tn(t)?(f("IndexedDbPersistence","Releasing primary lease."),n.delete(Fn.key)):nr.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(l("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),(0,n.isSafari)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return f("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return l("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){l("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function di(t){return dr(t,Fn.store)}function pi(t){return dr(t,Yn.store)}function yi(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var vi=function(t,e){this.progress=t,this.wn=e},mi=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Pt(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Q(e)).next(function(t){var e=Me();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Me();return this.Ut.getCollectionParents(t,i).next(function(s){return nr.forEach(s,function(s){var a=function(t,e){return new At(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return i=e,o.Rn(t,i,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=at.newInvalidDocument(c),r=r.insert(c,h)),le(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){jt(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Ue(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof me&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),gi=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ue(),i=Ue(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),_i=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(T.min())?this.Dn(t,e):this.Sn.pn(t,i).next(function(s){var a=o.Cn(e,s);return(Ct(e)||Rt(e))&&o.Nn(e.limitType,a,i,n)?o.Dn(t,e):(h()<=r.LogLevel.DEBUG&&f("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Bt(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return a.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new Ce(Kt(t));return e.forEach(function(e,r){jt(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return h()<=r.LogLevel.DEBUG&&f("QueryEngine","Using full collection scan to execute query:",Bt(e)),this.Sn.getDocumentsMatchingQuery(t,e,T.min())},t}(),wi=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ae(w),this.kn=new ni(function(t){return ht(t)},ft),this.$n=T.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new mi(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function bi(t,e,n,r){return new wi(t,e,n,r)}function Ii(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=r._n,o=r.Mn,[4,r.persistence.runTransaction("Handle user change","readonly",function(t){var e;return r._n.getAllMutationBatches(t).next(function(s){return e=s,i=r.persistence.getMutationQueue(n),o=new mi(r.On,i,r.persistence.getIndexManager()),i.getAllMutationBatches(t)}).next(function(n){for(var r=[],i=[],s=Ue(),a=0,u=e;a<u.length;a++){var c=u[a];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var d=0,p=n;d<p.length;d++){var y=p[d];i.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return o.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:r,addedBatchIds:i}})})})];case 1:return s=e.sent(),[2,(r._n=i,r.Mn=o,r.xn.Vn(r.Mn),s)]}})})}function Ei(t,e){var n=m(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=nr.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);v(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Ti(t){var e=m(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Si(t,e){var n=m(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return v(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=Oe();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Ni(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(T.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return nr.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Ni(t,e,n,r,i){var o=Ue();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Oe();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(T.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):f("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Di(t,e){var n=m(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Ai(t,e){var n=m(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?(r=i,nr.resolve(r)):n.qe.allocateTargetId(t).next(function(i){return r=new vr(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function xi(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=m(t),o=i.Fn.get(n),s=r?"readwrite":"readwrite-primary",e.label=1;case 1:return e.trys.push([1,4,,5]),r?[3,3]:[4,i.persistence.runTransaction("Release target",s,function(t){return i.persistence.referenceDelegate.removeTarget(t,o)})];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!ar(a=e.sent()))throw a;return f("LocalStore","Failed to update sequence numbers for target "+n+": "+a),[3,5];case 5:return i.Fn=i.Fn.remove(n),i.kn.delete(o.target),[2]}})})}function ki(t,e,n){var r=m(t),i=T.min(),o=Ue();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=m(t),i=r.kn.get(n);return void 0!==i?nr.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Ft(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:T.min(),n?o:Ue())}).next(function(t){return{documents:t,Bn:o}})})}function Ci(t,e){var n=m(t),r=m(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function Ri(t){var e=m(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=m(t),i=Oe(),o=wr(n),s=ai(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Kn.readTimeIndex,range:a},function(t,e){var n=gr(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:br(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn,r=t.readTime;return e.$n=r,n})}function Li(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){return[2,(n=m(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=ai(t),n=T.min();return e.$t({index:Kn.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=br(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){n.$n=t})]})})}function Oi(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h,f,l,d,p;return(0,e.__generator)(this,function(e){switch(e.label){case 0:for(o=m(t),s=Ue(),a=Oe(),u=Ve(),c=0,h=r;c<h.length;c++)f=h[c],l=n.qn(f.metadata.name),f.document&&(s=s.add(l)),a=a.insert(l,n.Un(f)),u=u.insert(l,n.Kn(f.metadata.readTime));return d=o.On.newChangeBuffer({trackRemovals:!0}),[4,Ai(o,function(t){return Ft(kt(x.fromString("__bundle__/docs/"+t)))}(i))];case 1:return p=e.sent(),[2,o.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Ni(t,d,a,T.min(),u).next(function(e){return d.apply(t),e}).next(function(e){return o.qe.removeMatchingKeysForTargetId(t,p.targetId).next(function(){return o.qe.addMatchingKeys(t,s,p.targetId)}).next(function(){return o.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Pi(t,n,r){return void 0===r&&(r=Ue()),(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Ai(t,Ft(Dr(n.bundledQuery)))];case 1:return i=e.sent(),[2,(o=m(t)).persistence.runTransaction("Save named query","readwrite",function(t){var e=on(n.readTime);if(i.snapshotVersion.compareTo(e)>=0)return o.Ke.saveNamedQuery(t,n);var s=i.withResumeToken(L.EMPTY_BYTE_STRING,e);return o.Fn=o.Fn.insert(s.targetId,s),o.qe.updateTargetData(t,s).next(function(){return o.qe.removeMatchingKeysForTargetId(t,i.targetId)}).next(function(){return o.qe.addMatchingKeys(t,r,i.targetId)}).next(function(){return o.Ke.saveNamedQuery(t,n)})})]}})})}var Mi=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return nr.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:on(n.createTime)}),nr.resolve()},t.prototype.getNamedQuery=function(t,e){return nr.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Dr(t.bundledQuery),readTime:on(t.readTime)}}(e)),nr.resolve()},t}(),Fi=function(){function t(){this.Wn=new Ce(Vi.Gn),this.zn=new Ce(Vi.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Vi(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Vi(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Q(new x([])),r=new Vi(n,t),i=new Vi(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Q(new x([])),n=new Vi(e,t),r=new Vi(e,t+1),i=Ue();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Vi(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Vi=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Q.comparator(t.key,e.key)||w(t.ns,e.ns)},t.Hn=function(t,e){return w(t.ns,e.ns)||Q.comparator(t.key,e.key)},t}(),qi=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ce(Vi.Gn)}return t.prototype.checkEmpty=function(t){return nr.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new pr(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Vi(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return nr.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return nr.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return nr.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return nr.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return nr.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Vi(e,0),i=new Vi(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),nr.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ce(w);return e.forEach(function(t){var e=new Vi(t,0),i=new Vi(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),nr.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Q.isDocumentKey(i)||(i=i.child(""));var o=new Vi(new Q(i),0),s=new Ce(w);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),nr.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;v(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return nr.forEach(e.mutations,function(i){var o=new Vi(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Vi(e,0),r=this.rs.firstAfterOrEqual(n);return nr.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,nr.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Ui=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ae(Q.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return nr.resolve(n?n.document.clone():at.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Oe();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():at.newInvalidDocument(t))}),nr.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Oe(),i=new Q(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||jt(e,c)&&(r=r.insert(c.key,c.clone()))}return nr.resolve(r)},t.prototype.fs=function(t,e){return nr.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Bi(this)},t.prototype.getSize=function(t){return nr.resolve(this.size)},t}(),Bi=function(t){function n(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,e.__extends)(n,t),n.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),nr.waitFor(n)},n.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},n}(ri),ji=function(){function t(t){this.persistence=t,this.ds=new ni(function(t){return ht(t)},ft),this.lastRemoteSnapshotVersion=T.min(),this.highestTargetId=0,this.ws=0,this._s=new Fi,this.targetCount=0,this.ys=Qr.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),nr.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return nr.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return nr.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),nr.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),nr.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Qr(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,nr.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),nr.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,nr.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),nr.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return nr.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return nr.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),nr.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),nr.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),nr.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return nr.resolve(n)},t.prototype.containsKey=function(t,e){return nr.resolve(this._s.containsKey(e))},t}(),Ki=function(){function t(t,e){var n=this;this.gs={},this.Ne=new s(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new ji(this),this.Ut=new Cr,this.Ue=function(t,e){return new Ui(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new mr(e),this.Ke=new Mi(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new qi(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;f("MemoryPersistence","Starting transaction:",t);var i=new Qi(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return nr.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Qi=function(t){function n(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,e.__extends)(n,t),n}(tr),Gi=function(){function t(t){this.persistence=t,this.As=new Fi,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw y()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),nr.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),nr.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),nr.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nr.forEach(this.vs,function(r){var i=Q.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return nr.or([function(){return nr.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),zi=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Wi(t,e){return"firestore_clients_"+t+"_"+e}function Hi(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Yi(t,e){return"firestore_targets_"+t+"_"+e}zi.UNAUTHENTICATED=new zi(null),zi.GOOGLE_CREDENTIALS=new zi("google-credentials-uid"),zi.FIRST_PARTY=new zi("first-party-uid");var $i=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,s=JSON.parse(r),a="object"==o(s)&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==o(s.error));return a&&s.error&&(a="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(i=new u(s.error.code,s.error.message)),a?new t(e,n,s.state,i):(l("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Xi=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),s="object"==o(i)&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==o(i.error));return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new u(i.error.code,i.error.message)),s?new t(e,i.state,r):(l("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ji=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==o(r)&&r.activeTargetIds instanceof Array,s=je(),a=0;i&&a<r.activeTargetIds.length;++a)i=K(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new t(e,s):(l("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Zi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==o(n)&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(l("SharedClientState","Failed to parse online state: "+e),null)},t}(),to=function(){function t(){this.activeTargetIds=je()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),eo=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Ae(w),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Wi(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new to),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,s,a,u,c,h,f,l=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=e.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Ns&&(o=this.getItem(Wi(this.persistenceKey,i)))&&(s=Ji.Vs(i,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)f=h[c],this.Fs(f);return this.$s=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Yi(this.persistenceKey,t));if(n){var r=Xi.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Yi(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return f("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){f("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){f("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(f("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Os)return void l("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var t,n,i,o,a,u;return(0,e.__generator)(this,function(e){if(this.started){if(null!==r.key)if(this.Ls.test(r.key)){if(null==r.newValue)return t=this.ti(r.key),[2,this.ei(t,null)];if(n=this.ni(r.key,r.newValue))return[2,this.ei(n.clientId,n)]}else if(this.Bs.test(r.key)){if(null!==r.newValue&&(i=this.si(r.key,r.newValue)))return[2,this.ii(i)]}else if(this.qs.test(r.key)){if(null!==r.newValue&&(o=this.ri(r.key,r.newValue)))return[2,this.oi(o)]}else if(r.key===this.Us){if(null!==r.newValue&&(a=this.js(r.newValue)))return[2,this.Ws(a)]}else if(r.key===this.Ms)(u=function(t){var e=s.o;if(null!=t)try{var n=JSON.parse(t);v("number"==typeof n),e=n}catch(t){l("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(r.newValue))!==s.o&&this.sequenceNumberHandler(u);else if(r.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(r);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new $i(this.currentUser,t,e,n),i=Hi(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Hi(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=Yi(this.persistenceKey,t),i=new Xi(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Ji.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return $i.Vs(new zi(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Xi.Vs(r,e)},t.prototype.js=function(t){return Zi.Vs(t)},t.prototype.ii=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(f("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=je();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),no=function(){function t(){this.li=new to,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new to,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),ro=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),io=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){f("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){f("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),oo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},so=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),ao=function(t){function r(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,e.__extends)(r,t),r.prototype.ki=function(t,e,n,r){return new Promise(function(o,s){var c=new i.XhrIo;c.listenOnce(i.EventType.COMPLETE,function(){try{switch(c.getLastErrorCode()){case i.ErrorCode.NO_ERROR:var e=c.getResponseJson();f("Connection","XHR received:",JSON.stringify(e)),o(e);break;case i.ErrorCode.TIMEOUT:f("Connection",'RPC "'+t+'" timed out'),s(new u(a.DEADLINE_EXCEEDED,"Request time out"));break;case i.ErrorCode.HTTP_ERROR:var n=c.getStatus();if(f("Connection",'RPC "'+t+'" failed with status:',n,"response text:",c.getResponseText()),n>0){var r=c.getResponseJson().error;if(r&&r.status&&r.message){var h=function(t){var e=r.status.toLowerCase().replace(/_/g,"-");return Object.values(a).indexOf(e)>=0?e:a.UNKNOWN}();s(new u(h,r.message))}else s(new u(a.UNKNOWN,"Server responded with status "+c.getStatus()))}else s(new u(a.UNAVAILABLE,"Connection failed."));break;default:y()}}finally{f("Connection",'RPC "'+t+'" completed.')}});var h=JSON.stringify(r);c.send(e,"POST",h,n,15)})},r.prototype.Oi=function(t,e){var r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=(0,i.createWebChannelTransport)(),s=(0,i.getStatEventTarget)(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(c.xmlHttpFactory=new i.FetchXmlHttpFactory({})),this.Fi(c.initMessageHeaders,e),(0,n.isMobileCordova)()||(0,n.isReactNative)()||(0,n.isElectron)()||(0,n.isIE)()||(0,n.isUWP)()||(0,n.isBrowserExtension)()||(c.httpHeadersOverwriteParam="$httpHeaders");var h=r.join("");f("Connection","Creating WebChannel: "+h,c);var l=o.createWebChannel(h,c),p=!1,y=!1,m=new so({Ei:function(t){y?f("Connection","Not sending because WebChannel is closed:",t):(p||(f("Connection","Opening WebChannel transport."),l.open(),p=!0),f("Connection","WebChannel sending:",t),l.send(t))},Ti:function(){return l.close()}}),g=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return g(l,i.WebChannel.EventType.OPEN,function(){y||f("Connection","WebChannel transport opened.")}),g(l,i.WebChannel.EventType.CLOSE,function(){y||(y=!0,f("Connection","WebChannel transport closed"),m.Vi())}),g(l,i.WebChannel.EventType.ERROR,function(t){y||(y=!0,d("Connection","WebChannel transport errored:",t),m.Vi(new u(a.UNAVAILABLE,"The operation could not be completed")))}),g(l,i.WebChannel.EventType.MESSAGE,function(t){var e;if(!y){var n=t.data[0];v(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){f("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=be[o];if(void 0!==e)return De(e)}(),c=i.message;void 0===s&&(s=a.INTERNAL,c="Unknown error status: "+o+" with message "+i.message),y=!0,m.Vi(new u(s,c)),l.close()}else f("Connection","WebChannel received:",n),m.Si(n)}}),g(s,i.Event.STAT_EVENT,function(t){t.stat===i.Stat.PROXY?f("Connection","Detected buffering proxy"):t.stat===i.Stat.NOPROXY&&f("Connection","Detected no buffering proxy")}),setTimeout(function(){m.Pi()},0),m},r}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);f("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return f("RestConnection","Received: ",t),t},function(e){throw d("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.8.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=oo[t];return this.Di+"/v1/"+e+":"+n},t}());function uo(){return"undefined"!=typeof window?window:null}function co(){return"undefined"!=typeof document?document:null}function ho(t){return new tn(t,!0)}var fo=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&f("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),lo=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new fo(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():n&&n.code===a.RESOURCE_EXHAUSTED?(l(n.toString()),l("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):n&&n.code===a.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(n)];case 1:return e.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new u(a.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return f("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(f("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),po=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,e.__extends)(n,t),n.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},n.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:y()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(v(void 0===e||"string"==typeof e),L.fromBase64String(e||"")):(v(void 0===e||e instanceof Uint8Array),L.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(c=e.targetChange.cause)&&function(t){var e=void 0===t.code?a.UNKNOWN:De(t.code);return new u(e,t.message||"")}(c);n=new We(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=cn(t,r.document.name),o=on(r.document.updateTime);var c=new ot({mapValue:{fields:r.document.fields}}),h=(s=at.newFoundDocument(i,o,c),r.targetIds||[]),f=r.removedTargetIds||[];n=new Ge(h,f,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=cn(t,r.document),o=r.readTime?on(r.readTime):T.min(),c=at.newNoDocument(i,o),s=r.removedTargetIds||[],n=new Ge([],s,c.key,c);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=cn(t,r.document),o=r.removedTargetIds||[],n=new Ge([],o,i,null);else{if(!("filter"in e))return y();e.filter;var l=e.filter;l.targetId,r=l.count||0,i=new Se(r),o=l.targetId,n=new ze(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return T.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?T.min():e.readTime?on(e.readTime):T.min()}(t);return this.listener._r(e,n)},n.prototype.mr=function(t){var e={};e.database=ln(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=lt(r)?{documents:gn(t,r)}:{query:_n(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=nn(t,e.resumeToken):e.snapshotVersion.compareTo(T.min())>0&&(n.readTime=en(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return y()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},n.prototype.yr=function(t){var e={};e.database=ln(this.R),e.removeTarget=t,this.cr(e)},n}(lo),yo=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},n.prototype.ar=function(){this.gr&&this.Er([])},n.prototype.wr=function(t){return this.Hi.Oi("Write",t)},n.prototype.onMessage=function(t){if(v(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(v(void 0!==e),t.map(function(t){return function(t,e){var n=t.updateTime?on(t.updateTime):on(e);return n.isEqual(T.min())&&(n=on(e)),new ae(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=on(t.commitTime);return this.listener.Tr(n,e)}return v(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},n.prototype.Ar=function(){var t={};t.database=ln(this.R),this.cr(t)},n.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return vn(e.R,t)})};this.cr(n)},n}(lo),vo=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,e.__extends)(n,t),n.prototype.br=function(){if(this.Rr)throw new u(a.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===a.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new u(a.UNKNOWN,t.toString())})},n.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===a.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new u(a.UNKNOWN,t.toString())})},n.prototype.terminate=function(){this.Rr=!0},n}(function(){}),mo=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(l(e),this.Vr=!1):f("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),go=function(t,n,r,i,o){var s=this;this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=o,this.Lr.di(function(t){r.enqueueAndForget(function(){return(0,e.__awaiter)(s,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return Do(this)?(f("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(n=m(t)).Or.add(4),[4,wo(n)];case 1:return e.sent(),n.Br.set("Unknown"),n.Or.delete(4),[4,_o(n)];case 2:return e.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new mo(r,i)};function _o(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(!Do(t))return[3,4];n=0,r=t.Mr,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}function wo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:n=0,r=t.Mr,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}function bo(t,e){var n=m(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),No(n)?So(n):jo(n).er()&&Eo(n,e))}function Io(t,e){var n=m(t),r=jo(n);n.$r.delete(e),r.er()&&To(n,e),0===n.$r.size&&(r.er()?r.ir():Do(n)&&n.Br.set("Unknown"))}function Eo(t,e){t.qr.U(e.targetId),jo(t).mr(e)}function To(t,e){t.qr.U(e),jo(t).yr(e)}function So(t){t.qr=new Ye({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),jo(t).start(),t.Br.Sr()}function No(t){return Do(t)&&!jo(t).tr()&&t.$r.size>0}function Do(t){return 0===m(t).Or.size}function Ao(t){t.qr=void 0}function xo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return t.$r.forEach(function(e,n){Eo(t,e)}),[2]})})}function ko(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return Ao(t),No(t)?(t.Br.Nr(n),So(t)):t.Br.set("Unknown"),[2]})})}function Co(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s;return(0,e.__generator)(this,function(a){switch(a.label){case 0:if(t.Br.set("Online"),!(n instanceof We&&2===n.state&&n.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=n.cause,i=0,o=n.targetIds,e.label=1;case 1:return i<o.length?(s=o[i],t.$r.has(s)?[4,t.remoteSyncer.rejectListen(s,r)]:[3,3]):[3,5];case 2:e.sent(),t.$r.delete(s),t.qr.removeTarget(s),e.label=3;case 3:e.label=4;case 4:return i++,[3,1];case 5:return[2]}})})}(t,n)];case 2:return a.sent(),[3,5];case 3:return i=a.sent(),f("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),i),[4,Ro(t,i)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(n instanceof Ge?t.qr.X(n):n instanceof ze?t.qr.rt(n):t.qr.et(n),r.isEqual(T.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,Ti(t.localStore)];case 8:return o=a.sent(),r.compareTo(o)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(L.EMPTY_BYTE_STRING,n.snapshotVersion)),To(t,e);var r=new vr(n.target,e,1,n.sequenceNumber);Eo(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,r)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return f("RemoteStore","Failed to raise snapshot:",s=a.sent()),[4,Ro(t,s)];case 12:return a.sent(),[3,13];case 13:return[2]}})})}function Ro(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i=this;return(0,e.__generator)(this,function(o){switch(o.label){case 0:if(!ar(n))throw n;return t.Or.add(1),[4,wo(t)];case 1:return o.sent(),t.Br.set("Offline"),r||(r=function(){return Ti(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return f("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return e.sent(),t.Or.delete(1),[4,_o(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Lo(t,e){return e().catch(function(n){return Ro(t,n,e)})}function Oo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:n=m(t),r=Ko(n),i=n.kr.length>0?n.kr[n.kr.length-1].batchId:-1,e.label=1;case 1:if(!function(t){return Do(t)&&t.kr.length<10}(n))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,Di(n.localStore,i)];case 3:return null===(o=e.sent())?(0===n.kr.length&&r.ir(),[3,7]):(i=o.batchId,function(t,e){t.kr.push(e);var n=Ko(t);n.er()&&n.pr&&n.Er(e.mutations)}(n,o),[3,6]);case 4:return s=e.sent(),[4,Ro(n,s)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return Po(n)&&Mo(n),[2]}})})}function Po(t){return Do(t)&&!Ko(t).tr()&&t.kr.length>0}function Mo(t){Ko(t).start()}function Fo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return Ko(t).Ar(),[2]})})}function Vo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return(0,e.__generator)(this,function(e){for(n=Ko(t),r=0,i=t.kr;r<i.length;r++)o=i[r],n.Er(o.mutations);return[2]})})}function qo(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i=t.kr.shift(),o=yr.from(i,n,r),[4,Lo(t,function(){return t.remoteSyncer.applySuccessfulWrite(o)})];case 1:return e.sent(),[4,Oo(t)];case 2:return e.sent(),[2]}})})}function Uo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(r){switch(r.label){case 0:return n&&Ko(t).pr?[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return Ne(i=n.code)&&i!==a.ABORTED?(r=t.kr.shift(),Ko(t).sr(),[4,Lo(t,function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)})]):[3,3];case 1:return e.sent(),[4,Oo(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})}(t,n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return Po(t)&&Mo(t),[2]}})})}function Bo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),n?(r.Or.delete(2),[4,_o(r)]):[3,2];case 1:return e.sent(),[3,5];case 2:return n?[3,4]:(r.Or.add(2),[4,wo(r)]);case 3:e.sent(),r.Br.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}})})}function jo(t){var n=this;return t.Ur||(t.Ur=function(t,e,n){var r=m(t);return r.br(),new po(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:xo.bind(null,t),Ri:ko.bind(null,t),_r:Co.bind(null,t)}),t.Mr.push(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r?(t.Ur.sr(),No(t)?So(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Ao(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Ko(t){var n=this;return t.Kr||(t.Kr=function(t,e,n){var r=m(t);return r.br(),new yo(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Fo.bind(null,t),Ri:Uo.bind(null,t),Ir:Vo.bind(null,t),Tr:qo.bind(null,t)}),t.Mr.push(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r?(t.Kr.sr(),[4,Oo(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(f("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Qo=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new er,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new u(a.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Go(t,e){if(l("AsyncQueue",e+": "+t),ar(t))return new u(a.UNAVAILABLE,e+": "+t);throw t}var zo=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Q.comparator(e.key,n.key)}:function(t,e){return Q.comparator(t.key,e.key)},this.keyedMap=Me(),this.sortedSet=new Ae(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Wo=function(){function t(){this.Qr=new Ae(Q.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):y():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Ho=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,zo.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qt(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Yo=function(){this.Wr=void 0,this.listeners=[]},$o=function(){this.queries=new ni(function(t){return Ut(t)},qt),this.onlineState="Unknown",this.Gr=new Set};function Xo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(r=m(t),i=n.query,o=!1,(s=r.queries.get(i))||(o=!0,s=new Yo),!o)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),a=s,[4,r.onListen(i)];case 2:return a.Wr=e.sent(),[3,4];case 3:return u=e.sent(),c=Go(u,"Initialization of query '"+Bt(n.query)+"' failed"),[2,void n.onError(c)];case 4:return r.queries.set(i,s),s.listeners.push(n),n.zr(r.onlineState),s.Wr&&n.Hr(s.Wr)&&es(r),[2]}})})}function Jo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,e.__generator)(this,function(e){return r=m(t),i=n.query,o=!1,(s=r.queries.get(i))&&(a=s.listeners.indexOf(n))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(r.queries.delete(i),r.onUnlisten(i))]:[2]})})}function Zo(t,e){for(var n=m(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&es(n)}function ts(t,e,n){var r=m(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function es(t){t.Gr.forEach(function(t){t.next()})}var ns=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ho(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Ho.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),rs=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),is=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return cn(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?yn(this.R,t.document,!1):at.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return on(t)},t}(),os=function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=ss(t)}return t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new is(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ue()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Oi(this.localStore,new is(this.R),this.documents,this.ro.id)];case 1:t=e.sent(),n=this.co(this.documents),r=0,i=this.queries,e.label=2;case 2:return r<i.length?(o=i[r],[4,Pi(this.localStore,o,n.get(o.name))]):[3,5];case 3:e.sent(),e.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new vi(Object.assign({},this.progress),t))]}})})},t}();function ss(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var as=function(t){this.key=t},us=function(t){this.key=t},cs=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ue(),this.mutatedKeys=Ue(),this.lo=Kt(t),this.fo=new zo(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Wo,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Ct(this.query)&&i.size===this.query.limit?i.last():null,c=Rt(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),f=jt(n.query,e)?e:null,l=!!h&&n.mutatedKeys.has(h.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),p=!1;h&&f?h.data.isEqual(f.data)?l!==d&&(r.track({type:3,doc:f}),p=!0):n.yo(h,f)||(r.track({type:2,doc:f}),p=!0,(u&&n.lo(f,u)>0||c&&n.lo(f,c)<0)&&(a=!0)):!h&&f?(r.track({type:0,doc:f}),p=!0):h&&!f&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(f?(s=s.add(f),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),Ct(this.query)||Rt(this.query))for(;s.size>this.query.limit;){var h=Ct(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return y()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Ho(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Wo,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ue(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new us(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new as(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ue();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Ho.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),hs=function(t,e,n){this.query=t,this.targetId=e,this.view=n},fs=function(t){this.key=t,this.bo=!1},ls=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ni(function(t){return Ut(t)},qt),this.Vo=new Map,this.So=new Set,this.Do=new Ae(Q.comparator),this.Co=new Map,this.No=new Fi,this.xo={},this.Fo=new Map,this.ko=Qr.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function ds(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=js(t),(s=r.Po.get(n))?(i=s.targetId,r.sharedClientState.addLocalQueryTarget(i),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,Ai(r.localStore,Ft(n))];case 2:return a=e.sent(),u=r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.targetId,[4,ps(r,n,i,"current"===u)];case 3:o=e.sent(),r.isPrimaryClient&&bo(r.remoteStore,a),e.label=4;case 4:return[2,o]}})})}function ps(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h;return(0,e.__generator)(this,function(f){switch(f.label){case 0:return t.Oo=function(n,r,i){return function(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(o=n.view._o(r)).Nn?[4,ki(t.localStore,n.query,!1).then(function(t){var e=t.documents;return n.view._o(e,o)})]:[3,2];case 1:o=e.sent(),e.label=2;case 2:return s=i&&i.targetChanges.get(n.targetId),a=n.view.applyChanges(o,t.isPrimaryClient,s),[2,(Ds(t,n.targetId,a.To),a.snapshot)]}})})}(t,n,r,i)},[4,ki(t.localStore,n,!0)];case 1:return o=f.sent(),s=new cs(n,o.Bn),a=s._o(o.documents),u=Qe.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),c=s.applyChanges(a,t.isPrimaryClient,u),Ds(t,r,c.To),h=new hs(n,r,s),[2,(t.Po.set(n,h),t.Vo.has(r)?t.Vo.get(r).push(n):t.Vo.set(r,[n]),c.snapshot)]}})})}function ys(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=r.Po.get(n),(o=r.Vo.get(i.targetId)).length>1?[2,(r.Vo.set(i.targetId,o.filter(function(t){return!qt(t,n)})),void r.Po.delete(n))]:r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)?[3,2]:[4,xi(r.localStore,i.targetId,!1).then(function(){r.sharedClientState.clearQueryState(i.targetId),Io(r.remoteStore,i.targetId),Ss(r,i.targetId)}).catch(Yr)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return Ss(r,i.targetId),[4,xi(r.localStore,i.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}})})}function vs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=Ks(t),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,function(t,e){var n,r=m(t),i=E.now(),o=e.reduce(function(t,e){return t.add(e.key)},Ue());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=de(c,n.get(c.key));null!=h&&s.push(new me(c.key,h,st(h.value.mapValue),ue.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(i.localStore,n)];case 2:return o=e.sent(),i.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ae(w)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(i,o.batchId,r),[4,ks(i,o.changes)];case 3:return e.sent(),[4,Oo(i.remoteStore)];case 4:return e.sent(),[3,6];case 5:return s=e.sent(),a=Go(s,"Failed to persist write"),r.reject(a),[3,6];case 6:return[2]}})})}function ms(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Si(r.localStore,n)];case 2:return i=e.sent(),n.targetChanges.forEach(function(t,e){var n=r.Co.get(e);n&&(v(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?n.bo=!0:t.modifiedDocuments.size>0?v(n.bo):t.removedDocuments.size>0&&(v(n.bo),n.bo=!1))}),[4,ks(r,i,n)];case 3:return e.sent(),[3,6];case 4:return[4,Yr(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function gs(t,e,n){var r=m(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=m(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&es(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function _s(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(i=m(t)).sharedClientState.updateQueryState(n,"rejected",r),o=i.Co.get(n),(s=o&&o.key)?(a=(a=new Ae(Q.comparator)).insert(s,at.newNoDocument(s,T.min())),u=Ue().add(s),c=new Ke(T.min(),new Map,new Ce(w),a,u),[4,ms(i,c)]):[3,2];case 1:return e.sent(),i.Do=i.Do.remove(s),i.Co.delete(n),xs(i),[3,4];case 2:return[4,xi(i.localStore,n,!1).then(function(){return Ss(i,n,r)}).catch(Yr)];case 3:e.sent(),e.label=4;case 4:return[2]}})})}function ws(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),i=n.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Ei(r.localStore,n)];case 2:return o=e.sent(),Ts(r,i,null),Es(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),[4,ks(r,o)];case 3:return e.sent(),[3,6];case 4:return[4,Yr(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function bs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=m(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,function(t,e){var n=m(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return v(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(i.localStore,n)];case 2:return o=e.sent(),Ts(i,n,r),Es(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),[4,ks(i,o)];case 3:return e.sent(),[3,6];case 4:return[4,Yr(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function Is(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:Do((r=m(t)).remoteStore)||f("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(t){var e=m(r.localStore);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}()];case 2:return-1===(i=e.sent())?[2,void n.resolve()]:((o=r.Fo.get(i)||[]).push(n),r.Fo.set(i,o),[3,4]);case 3:return s=e.sent(),a=Go(s,"Initialization of waitForPendingWrites() operation failed"),n.reject(a),[3,4];case 4:return[2]}})})}function Es(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Ts(t,e,n){var r=m(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Ss(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Ns(t,e)})}function Ns(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Io(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),xs(t))}function Ds(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof as?(t.No.addReference(o.key,e),As(t,o)):o instanceof us?(f("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Ns(t,o.key)):y()}}function As(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(f("SyncEngine","New document in limbo: "+n),t.So.add(r),xs(t))}function xs(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Q(x.fromString(e)),r=t.ko.next();t.Co.set(r,new fs(n)),t.Do=t.Do.insert(n,r),bo(t.remoteStore,new vr(Ft(kt(n.path)),r,2,s.o))}}function ks(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,e.__generator)(this,function(u){switch(u.label){case 0:return i=m(t),o=[],s=[],a=[],i.Po.isEmpty()?[3,3]:(i.Po.forEach(function(t,e){a.push(i.Oo(e,n,r).then(function(t){if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),o.push(t);var n=gi.Pn(e.targetId,t);s.push(n)}}))}),[4,Promise.all(a)]);case 1:return u.sent(),i.vo._r(o),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return nr.forEach(n,function(e){return nr.forEach(e.bn,function(n){return r.persistence.referenceDelegate.addReference(t,e.targetId,n)}).next(function(){return nr.forEach(e.vn,function(n){return r.persistence.referenceDelegate.removeReference(t,e.targetId,n)})})})})];case 2:return e.sent(),[3,4];case 3:if(!ar(i=e.sent()))throw i;return f("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,s=n;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=r.Fn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),r.Fn=r.Fn.insert(u,l));return[2]}})})}(i.localStore,s)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}function Cs(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(r=m(t)).currentUser.isEqual(n)?[3,3]:(f("SyncEngine","User change. New user:",n.toKey()),[4,Ii(r.localStore,n)]);case 1:return i=e.sent(),r.currentUser=n,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new u(a.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),[4,ks(r,i.Ln)];case 2:e.sent(),e.label=3;case 3:return[2]}})})}function Rs(t,e){var n=m(t),r=n.Co.get(e);if(r&&r.bo)return Ue().add(r.key);var i=Ue(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function Ls(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,ki((r=m(t)).localStore,n.query,!0)];case 1:return i=e.sent(),o=n.view.Ao(i),[2,(r.isPrimaryClient&&Ds(r,n.targetId,o.To),o)]}})})}function Os(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){return[2,Ri((n=m(t)).localStore).then(function(t){return ks(n,t)})]})})}function Ps(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,function(t,e){var n=m(t),r=m(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):nr.resolve(null)})})}((o=m(t)).localStore,n)];case 1:return null===(s=e.sent())?[3,6]:"pending"!==r?[3,3]:[4,Oo(o.remoteStore)];case 2:return e.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(Ts(o,n,i||null),Es(o,n),function(t,e){m(m(t)._n).Gt(e)}(o.localStore,n)):y(),e.label=4;case 4:return[4,ks(o,s)];case 5:return e.sent(),[3,7];case 6:f("SyncEngine","Cannot apply mutation batch with id: "+n),e.label=7;case 7:return[2]}})})}function Ms(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return js(r=m(t)),Ks(r),!0!==n||!0===r.$o?[3,3]:(i=r.sharedClientState.getAllActiveQueryTargets(),[4,Fs(r,i.toArray())]);case 1:return o=e.sent(),r.$o=!0,[4,Bo(r.remoteStore,!0)];case 2:for(e.sent(),s=0,a=o;s<a.length;s++)u=a[s],bo(r.remoteStore,u);return[3,7];case 3:return!1!==n||!1===r.$o?[3,7]:(c=[],h=Promise.resolve(),r.Vo.forEach(function(t,e){r.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then(function(){return Ss(r,e),xi(r.localStore,e,!0)}),Io(r.remoteStore,e)}),[4,h]);case 4:return e.sent(),[4,Fs(r,c)];case 5:return e.sent(),function(t){var e=m(r);e.Co.forEach(function(t,n){Io(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Ae(Q.comparator)}(),r.$o=!1,[4,Bo(r.remoteStore,!1)];case 6:e.sent(),e.label=7;case 7:return[2]}})})}function Fs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,f,l,d,p,y,v;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=m(t),i=[],o=[],s=0,a=n,e.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=r.Vo.get(u))&&0!==h.length?[4,Ai(r.localStore,Ft(h[0]))]:[3,7]):[3,13];case 2:c=e.sent(),f=0,l=h,e.label=3;case 3:return f<l.length?(d=l[f],p=r.Po.get(d),[4,Ls(r,p)]):[3,6];case 4:(y=e.sent()).snapshot&&o.push(y.snapshot),e.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Ci(r.localStore,u)];case 8:return v=e.sent(),[4,Ai(r.localStore,v)];case 9:return c=e.sent(),[4,ps(r,Vs(v),u,!1)];case 10:e.sent(),e.label=11;case 11:i.push(c),e.label=12;case 12:return s++,[3,1];case 13:return[2,(r.vo._r(o),i)]}})})}function Vs(t){return xt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function qs(t){var e=m(t);return m(m(e.localStore).persistence).fn()}function Us(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(o=m(t)).$o?(f("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Vo.has(n))return[3,8];switch(r){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Ri(o.localStore)];case 3:return s=e.sent(),a=Ke.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),[4,ks(o,s,a)];case 4:return e.sent(),[3,8];case 5:return[4,xi(o.localStore,n,!0)];case 6:return e.sent(),Ss(o,n,i),[3,8];case 7:y(),e.label=8;case 8:return[2]}})})}function Bs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,d,p;return(0,e.__generator)(this,function(y){switch(y.label){case 0:if(!(i=js(t)).$o)return[3,10];o=0,s=n,y.label=1;case 1:return o<s.length?(a=s[o],i.Vo.has(a)?(f("SyncEngine","Adding an already active target "+a),[3,5]):[4,Ci(i.localStore,a)]):[3,6];case 2:return u=y.sent(),[4,Ai(i.localStore,u)];case 3:return c=y.sent(),[4,ps(i,Vs(u),c.targetId,!1)];case 4:y.sent(),bo(i.remoteStore,c),y.label=5;case 5:return o++,[3,1];case 6:h=function(t){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i.Vo.has(t)?[4,xi(i.localStore,t,!1).then(function(){Io(i.remoteStore,t),Ss(i,t)}).catch(Yr)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},l=0,d=r,y.label=7;case 7:return l<d.length?(p=d[l],[5,h(p)]):[3,10];case 8:y.sent(),y.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function js(t){var e=m(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=ms.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Rs.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_s.bind(null,e),e.vo._r=Zo.bind(null,e.eventManager),e.vo.Mo=ts.bind(null,e.eventManager),e}function Ks(t){var e=m(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ws.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bs.bind(null,e),e}function Qs(t,n,r){var i=m(t);(function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,14,,15]),[4,n.getMetadata()];case 1:return i=e.sent(),[4,function(t,e){var n=m(t),r=on(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",function(t){return n.Ke.getBundleMetadata(t,e.id)}).then(function(t){return!!t&&t.createTime.compareTo(r)>=0})}(t.localStore,i)];case 2:return e.sent()?[4,n.close()]:[3,4];case 3:return[2,(e.sent(),void r._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(i)))];case 4:return r._updateProgress(ss(i)),o=new os(i,t.localStore,n.R),[4,n.Lo()];case 5:s=e.sent(),e.label=6;case 6:return s?[4,o.oo(s)]:[3,10];case 7:return(a=e.sent())&&r._updateProgress(a),[4,n.Lo()];case 8:s=e.sent(),e.label=9;case 9:return[3,6];case 10:return[4,o.complete()];case 11:return u=e.sent(),[4,ks(t,u.wn,void 0)];case 12:return e.sent(),[4,function(t,e){var n=m(t);return n.persistence.runTransaction("Save bundle","readwrite",function(t){return n.Ke.saveBundleMetadata(t,e)})}(t.localStore,i)];case 13:return e.sent(),r._completeWith(u.progress),[3,15];case 14:return d("SyncEngine","Loading bundle failed with "+(c=e.sent())),r._failWith(c),[3,15];case 15:return[2]}})})})(i,n,r).then(function(){i.sharedClientState.notifyBundleLoaded()})}var Gs=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.R=ho(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return bi(this.persistence,new _i,t.initialUser,this.R)},t.prototype.qo=function(t){return new Ki(Gi.bs,this.R)},t.prototype.Bo=function(t){return new no},t.prototype.terminate=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),zs=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,e.__extends)(n,t),n.prototype.initialize=function(n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return e.sent(),[4,Li(this.localStore)];case 2:return e.sent(),[4,this.Qo.initialize(this,n)];case 3:return e.sent(),[4,Ks(this.Qo.syncEngine)];case 4:return e.sent(),[4,Oo(this.Qo.remoteStore)];case 5:return e.sent(),[2]}})})},n.prototype.Ko=function(t){return bi(this.persistence,new _i,t.initialUser,this.R)},n.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Jr(e,t.asyncQueue)},n.prototype.qo=function(t){var e=yi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Mr.withCacheSize(this.cacheSizeBytes):Mr.DEFAULT;return new li(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,uo(),co(),this.R,this.sharedClientState,!!this.forceOwnership)},n.prototype.Bo=function(t){return new no},n}(Gs),Ws=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,e.__extends)(n,t),n.prototype.initialize=function(n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i=this;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Qo.syncEngine,this.sharedClientState instanceof eo?(this.sharedClientState.syncEngine={ui:Ps.bind(null,r),ai:Us.bind(null,r),hi:Bs.bind(null,r),fn:qs.bind(null,r),ci:Os.bind(null,r)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(t){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Ms(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},n.prototype.Bo=function(t){var e=uo();if(!eo.yt(e))throw new u(a.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=yi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new eo(e,t.asyncQueue,n,t.clientId,t.initialUser)},n}(zs),Hs=function(){function t(){}return t.prototype.initialize=function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return gs(r.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Cs.bind(null,this.syncEngine),[4,Bo(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new $o},t.prototype.createDatastore=function(t){var e,n=ho(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new ao(e));return function(t,e,n){return new vo(t,r,n)}(t.credentials,0,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return gs(s.syncEngine,t,0)},o=io.yt()?new io:new ro,new go(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new ls(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=m(t),f("RemoteStore","RemoteStore shutting down."),n.Or.add(5),[4,wo(n)];case 1:return e.sent(),n.Lr.shutdown(),n.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}();function Ys(t,n){void 0===n&&(n=10240);var r=0;return{read:function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){return r<t.byteLength?(i={value:t.slice(r,r+n),done:!1},[2,(r+=n,i)]):[2,{done:!0}]})})},cancel:function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var $s=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Xs=function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new er,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}return t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.Jo()];case 1:return null===(t=e.sent())?[2,null]:(n=this.zo.decode(t),r=Number(n),isNaN(r)&&this.Yo("length string ("+n+") is not valid number"),[4,this.Xo(r)]);case 2:return i=e.sent(),[2,new rs(JSON.parse(i),t.length+r)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(e.sent())return[3,3];e.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),n)])}})})},t.prototype.Xo=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:e.sent()&&this.Yo("Reached the end of bundle when more is expected."),e.label=2;case 2:return[3,0];case 3:return n=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),n)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.Go.read()];case 1:return(t=e.sent()).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),[2,t.done]}})})},t}(),Js=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new u(a.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,a,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=ln(r.R)+"/documents",o={documents:n.map(function(t){return un(r.R,t)})},[4,r.$i("BatchGetDocuments",i,o)];case 1:return s=e.sent(),a=new Map,s.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){v(!!e.found),e.found.name,e.found.updateTime;var n=cn(t,e.found.name),r=on(e.found.updateTime),i=new ot({mapValue:{fields:e.found.fields}});return at.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){v(!!e.missing),v(!!e.readTime);var n=cn(t,e.missing),r=on(e.readTime);return at.newNoDocument(n,r)}(t,e):y()}(r.R,t);a.set(e.key.toString(),e)}),u=[],[2,(n.forEach(function(t){var e=a.get(t.toString());v(!!e),u.push(e)}),u)]}})})}(this.datastore,t)];case 1:return[2,((n=i.sent()).forEach(function(t){return r.recordVersion(t)}),n)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Ee(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n=this;return(0,e.__generator)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,e){var r=Q.fromPath(e);n.mutations.push(new Te(r,n.precondition(r)))}),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=m(t),i=ln(r.R)+"/documents",o={writes:n.map(function(t){return vn(r.R,t)})},[4,r.Ni("Commit",i,o)];case 1:return e.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return r.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw y();e=T.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new u(a.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ue.updateTime(e):ue.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(T.min()))throw new u(a.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ue.updateTime(e)}return ue.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),Zs=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new fo(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){var t,n,r=this;return(0,e.__generator)(this,function(e){return t=new Js(this.datastore),(n=this.sc(t))&&n.then(function(e){r.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){r.deferred.resolve(e)}).catch(function(t){r.ic(t)})})}).catch(function(t){r.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!B(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ne(e)}return!1},t}(),ta=function(){function t(t,n,r){var i=this;this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=zi.UNAUTHENTICATED,this.clientId=_.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(n,function(t){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return f("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new u(a.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new er;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){var t,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return t=e.sent(),r=Go(t,"Failed to shutdown persistence"),n.reject(r),[3,6];case 6:return[2]}})})}),n.promise},t}();function ea(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o=this;return(0,e.__generator)(this,function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),f("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return r=s.sent(),[4,n.initialize(r)];case 2:return s.sent(),i=r.initialUser,t.setCredentialChangeListener(function(t){return(0,e.__awaiter)(o,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i.isEqual(t)?[3,2]:[4,Ii(n.localStore,t)];case 1:e.sent(),i=t,e.label=2;case 2:return[2]}})})}),n.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=n,[2]}})})}function na(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ra(t)];case 1:return r=o.sent(),f("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return i=o.sent(),[4,n.initialize(r,i)];case 3:return o.sent(),t.setCredentialChangeListener(function(t){return function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(r=m(t)).asyncQueue.verifyOperationInProgress(),f("RemoteStore","RemoteStore received new credentials"),i=Do(r),r.Or.add(3),[4,wo(r)];case 1:return e.sent(),i&&r.Br.set("Unknown"),[4,r.remoteSyncer.handleCredentialChange(n)];case 2:return e.sent(),r.Or.delete(3),[4,_o(r)];case 3:return e.sent(),[2]}})})}(n.remoteStore,t)}),t.onlineComponents=n,[2]}})})}function ra(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(f("FirestoreClient","Using default OfflineComponentProvider"),[4,ea(t,new Gs)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function ia(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(f("FirestoreClient","Using default OnlineComponentProvider"),[4,na(t,new Hs)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function oa(t){return ra(t).then(function(t){return t.persistence})}function sa(t){return ra(t).then(function(t){return t.localStore})}function aa(t){return ia(t).then(function(t){return t.remoteStore})}function ua(t){return ia(t).then(function(t){return t.syncEngine})}function ca(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,ia(t)];case 1:return n=e.sent(),[2,((r=n.eventManager).onListen=ds.bind(null,n.syncEngine),r.onUnlisten=ys.bind(null,n.syncEngine),r)]}})})}function ha(t,n,r){var i=this;void 0===r&&(r={});var o=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i=function(t,e,n,r,i){var o=new $s({next:function(o){e.enqueueAndForget(function(){return Jo(t,s)});var c=o.docs.has(n);!c&&o.fromCache?i.reject(new u(a.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&o.fromCache&&r&&"server"===r.source?i.reject(new u(a.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new ns(kt(n.path),o,{includeMetadataChanges:!0,so:!0});return Xo(t,s)},[4,ca(t)];case 1:return[2,i.apply(void 0,[e.sent(),t.asyncQueue,n,r,o])]}})})}),o.promise}function fa(t,n,r){var i=this;void 0===r&&(r={});var o=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i=function(t,e,n,r,i){var o=new $s({next:function(n){e.enqueueAndForget(function(){return Jo(t,s)}),n.fromCache&&"server"===r.source?i.reject(new u(a.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new ns(n,o,{includeMetadataChanges:!0,so:!0});return Xo(t,s)},[4,ca(t)];case 1:return[2,i.apply(void 0,[e.sent(),t.asyncQueue,n,r,o])]}})})}),o.promise}var la=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},da=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),pa=new Map,ya=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},va=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(zi.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),ma=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),ga=function(){function t(t){var e=this;this.currentUser=zi.UNAUTHENTICATED,this.oc=new er,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){f("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(f("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(f("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(v("string"==typeof n.accessToken),new ya(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,n){var r=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,n(this.currentUser)];case 2:return t.sent(),this.changeListener=n,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return v(null===t||"string"==typeof t),new zi(t)},t}(),_a=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=zi.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),wa=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new _a(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(zi.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ba(t,e,n){if(!n)throw new u(a.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ia(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new u(a.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Ea(t,e,n,r){if(!0===e&&!0===r)throw new u(a.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Ta(t){if(!Q.isDocumentKey(t))throw new u(a.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Sa(t){if(Q.isDocumentKey(t))throw new u(a.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Na(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==o(t)){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":y()}function Da(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new u(a.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Na(t);throw new u(a.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Aa(t,e){if(e<=0)throw new u(a.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var xa=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new u(a.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new u(a.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Ea("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),ka=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xa({}),this._settingsFrozen=!1,t instanceof da?(this._databaseId=t,this._credentials=new va):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new u(a.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new da(t.options.projectId)}(t),this._credentials=new ga(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new u(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new u(a.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xa(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new va;switch(t.type){case"gapi":var e=t.client;return v(!("object"!=o(e)||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new wa(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new u(a.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=pa.get(this))&&(f("ComponentProvider","Removing Datastore"),pa.delete(this),t.terminate()),Promise.resolve();var t},t}(),Ca=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new La(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Ra=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),La=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,kt(r))||this)._path=r,i.type="collection",i}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Ca(this.firestore,null,new Q(t))},enumerable:!1,configurable:!0}),n.prototype.withConverter=function(t){return new n(this.firestore,t,this._path)},n}(Ra);function Oa(t,r){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(t=(0,n.getModularInstance)(t),ba("collection","path",r),t instanceof ka)return Sa(i=x.fromString.apply(x,(0,e.__spreadArray)([r],o))),new La(t,null,i);if(!(t instanceof Ca||t instanceof La))throw new u(a.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Sa(i=x.fromString.apply(x,(0,e.__spreadArray)([t.path],o)).child(x.fromString(r))),new La(t.firestore,null,i)}function Pa(t,r){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(t=(0,n.getModularInstance)(t),1===arguments.length&&(r=_.u()),ba("doc","path",r),t instanceof ka)return Ta(i=x.fromString.apply(x,(0,e.__spreadArray)([r],o))),new Ca(t,null,new Q(i));if(!(t instanceof Ca||t instanceof La))throw new u(a.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ta(i=t._path.child(x.fromString.apply(x,(0,e.__spreadArray)([r],o)))),new Ca(t.firestore,t instanceof La?t.converter:null,new Q(i))}function Ma(t,e){return t=(0,n.getModularInstance)(t),e=(0,n.getModularInstance)(e),(t instanceof Ca||t instanceof La)&&(e instanceof Ca||e instanceof La)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Fa(t,e){return t=(0,n.getModularInstance)(t),e=(0,n.getModularInstance)(e),t instanceof Ra&&e instanceof Ra&&t.firestore===e.firestore&&qt(t._query,e._query)&&t.converter===e.converter}var Va=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new fo(this,"async_queue_retry"),this.Ic=function(){var e=co();e&&f("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=co();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=co();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new er;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(0===this.wc.length)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return e.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!ar(t=e.sent()))throw t;return f("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return n.bc()}),e.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,l("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Qo.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&y()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function qa(t){return function(t,e){if("object"!=o(t)||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var s=i[r];if(s in n&&"function"==typeof n[s])return!0}return!1}(t)}var Ua=function(){function t(){this._progressObserver={},this._taskCompletionResolver=new er,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},t}(),Ba=-1,ja=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Va,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,e.__extends)(n,t),n.prototype._terminate=function(){return this._firestoreClient||Qa(this),this._firestoreClient.terminate()},n}(ka);function Ka(t){return t._firestoreClient||Qa(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Qa(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new la(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ta(t._credentials,t._queue,r)}function Ga(t,n,r){var i=this,o=new er;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,ea(t,r)];case 1:return e.sent(),[4,na(t,n)];case 2:return e.sent(),o.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===a.FAILED_PRECONDITION||t.code===a.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(i=e.sent()))throw i;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),o.reject(i),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function za(t){if(t._initialized||t._terminated)throw new u(a.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}exports.T=ja,exports.E=Ba;var Wa=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new u(a.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new C(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Ha=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(L.fromBase64String(e))}catch(e){throw new u(a.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(L.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Ya=function(t){this._methodName=t},$a=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new u(a.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new u(a.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return w(this._lat,t._lat)||w(this._long,t._long)},t}(),Xa=/^__.*__$/,Ja=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new me(t,this.data,this.fieldMask,e,this.fieldTransforms):new ve(t,this.data,e,this.fieldTransforms)},t}(),Za=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new me(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function tu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw y()}}exports.C=$a;var eu=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Fc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,kc:!0})},t.prototype.Lc=function(t){return bu(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(tu(this.Nc)&&Xa.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),nu=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||ho(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new eu({Nc:t,methodName:e,qc:n,path:C.emptyPath(),kc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function ru(t){var e=t._freezeSettings(),n=ho(t._databaseId);return new nu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function iu(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);mu("Data must be an object, but it was:",s,r);var c,h,f=yu(r,s);if(o.merge)c=new R(s.fieldMask),h=s.fieldTransforms;else if(o.mergeFields){for(var l=[],d=0,p=o.mergeFields;d<p.length;d++){var y=gu(e,p[d],n);if(!s.contains(y))throw new u(a.INVALID_ARGUMENT,"Field '"+y+"' is specified in your field mask but missing from your input data.");Iu(l,y)||l.push(y)}c=new R(l),h=s.fieldTransforms.filter(function(t){return c.covers(t.field)})}else c=null,h=s.fieldTransforms;return new Ja(new ot(f),c,h)}var ou=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(Ya);function su(t,e,n){return new eu({Nc:3,qc:e.settings.qc,methodName:t._methodName,kc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var au=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){return new se(t.path,new Jt)},n.prototype.isEqual=function(t){return t instanceof n},n}(Ya),uu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){var e=su(this,t,!0),n=this.Kc.map(function(t){return pu(t,e)}),r=new Zt(n);return new se(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Ya),cu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){var e=su(this,t,!0),n=this.Kc.map(function(t){return pu(t,e)}),r=new ee(n);return new se(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Ya),hu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return(0,e.__extends)(n,t),n.prototype._toFieldTransform=function(t){var e=new re(t.R,Wt(t.R,this.Qc));return new se(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(Ya);function fu(t,e,r,i){var o=t.Uc(1,e,r);mu("Data must be an object, but it was:",o,i);var s=[],a=ot.empty();N(i,function(t,i){var u=wu(e,t,r);i=(0,n.getModularInstance)(i);var c=o.Oc(u);if(i instanceof ou)s.push(u);else{var h=pu(i,c);null!=h&&(s.push(u),a.set(u,h))}});var u=new R(s);return new Za(a,u,o.fieldTransforms)}function lu(t,e,r,i,o,s){var c=t.Uc(1,e,r),h=[gu(e,i,r)],f=[o];if(s.length%2!=0)throw new u(a.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var l=0;l<s.length;l+=2)h.push(gu(e,s[l])),f.push(s[l+1]);for(var d=[],p=ot.empty(),y=h.length-1;y>=0;--y)if(!Iu(d,h[y])){var v=h[y],m=f[y];m=(0,n.getModularInstance)(m);var g=c.Oc(v);if(m instanceof ou)d.push(v);else{var _=pu(m,g);null!=_&&(d.push(v),p.set(v,_))}}var w=new R(d);return new Za(p,w,c.fieldTransforms)}function du(t,e,n,r){return void 0===r&&(r=!1),pu(n,t.Uc(r?4:3,e))}function pu(t,e){if(vu(t=(0,n.getModularInstance)(t)))return mu("Unsupported field value:",e,t),yu(t,e);if(t instanceof Ya)return function(t,e){if(!tu(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.kc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=pu(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,n.getModularInstance)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Wt(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var r=E.fromDate(t);return{timestampValue:en(e.R,r)}}if(t instanceof E)return r=new E(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:en(e.R,r)};if(t instanceof $a)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ha)return{bytesValue:nn(e.R,t._byteString)};if(t instanceof Ca){r=e.databaseId;var i=t.firestore._databaseId;if(!i.isEqual(r))throw e.Lc("Document reference is for database "+i.projectId+"/"+i.database+" but should be for database "+r.projectId+"/"+r.database);return{referenceValue:sn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Na(t))}(t,e)}function yu(t,e){var n={};return D(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):N(t,function(t,r){var i=pu(r,e.Fc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function vu(t){return!("object"!=o(t)||null===t||t instanceof Array||t instanceof Date||t instanceof E||t instanceof $a||t instanceof Ha||t instanceof Ca||t instanceof Ya)}function mu(t,e,n){if(!vu(n)||!function(t){return"object"==o(t)&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Na(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function gu(t,e,r){if((e=(0,n.getModularInstance)(e))instanceof Wa)return e._internalPath;if("string"==typeof e)return wu(t,e);throw bu("Field path arguments must be of type string or FieldPath.",t,!1,void 0,r)}var _u=new RegExp("[~\\*/\\[\\]]");function wu(t,n,r){if(n.search(_u)>=0)throw bu("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,r);try{return(new(Wa.bind.apply(Wa,(0,e.__spreadArray)([void 0],n.split(".")))))._internalPath}catch(i){throw bu("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,r)}}function bu(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,c="Function "+e+"() called with invalid data";n&&(c+=" (via `toFirestore()`)");var h="";return(o||s)&&(h+=" (found",o&&(h+=" in field "+r),s&&(h+=" in document "+i),h+=")"),new u(a.INVALID_ARGUMENT,(c+=". ")+t+h)}function Iu(t,e){return t.some(function(t){return t.isEqual(e)})}var Eu=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Ca(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Tu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Su("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Tu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.data=function(){return t.prototype.data.call(this)},n}(Eu);function Su(t,e){return"string"==typeof e?wu(t,e):e instanceof Wa?e._internalPath:e._delegate._internalPath}var Nu=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Du=function(t){function n(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,e.__extends)(n,t),n.prototype.exists=function(){return t.prototype.exists.call(this)},n.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Au(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},n.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Su("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},n}(Eu),Au=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},n}(Du),xu=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Nu(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Au(n._firestore,n._userDataWriter,r.key,r,new Nu(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new u(a.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Au(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Nu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Au(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Nu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:ku(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function ku(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return y()}}function Cu(t,e){return t instanceof Du&&e instanceof Du?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof xu&&e instanceof xu&&t._firestore===e._firestore&&Fa(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Ru(t){if(Rt(t)&&0===t.explicitOrderBy.length)throw new u(a.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Lu=function(){};function Ou(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){t=i[r]._apply(t)}return t}var Pu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=ru(t.firestore),n=function(t,e,n,r,i,o,s){var c;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new u(a.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){ju(s,o);for(var h=[],f=0,l=s;f<l.length;f++){var d=l[f];h.push(Bu(r,t,d))}c={arrayValue:{values:h}}}else c=Bu(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||ju(s,o),c=du(n,"where",s,"in"===o||"not-in"===o);var p=dt.create(i,o,c);return function(t,e){if(e.g()){var n=Ot(t);if(null!==n&&!n.isEqual(e.field))throw new u(a.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Lt(t);null!==r&&Ku(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new u(a.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new u(a.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,p),p}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Ra(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},n}(Lu),Mu=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new u(a.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new u(a.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Tt(e,n);return function(t,e){if(null===Lt(t)){var n=Ot(t);null!==n&&Ku(t,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Ra(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new At(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},n}(Lu),Fu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){return new Ra(t.firestore,t.converter,Vt(t._query,this.Hc,this.Jc))},n}(Lu),Vu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=Uu(t,this.type,this.Yc,this.Xc);return new Ra(t.firestore,t.converter,function(t,e){return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},n}(Lu),qu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,e.__extends)(n,t),n.prototype._apply=function(t){var e=Uu(t,this.type,this.Yc,this.Xc);return new Ra(t.firestore,t.converter,function(t,e){return new At(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},n}(Lu);function Uu(t,e,r,i){if(r[0]=(0,n.getModularInstance)(r[0]),r[0]instanceof Eu)return function(t,e,n,r,i){if(!r)throw new u(a.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,c=Mt(t);s<c.length;s++){var h=c[s];if(h.field.isKeyField())o.push(J(e,r.key));else{var f=r.data.field(h.field);if(V(f))throw new u(a.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){var l=h.field.canonicalString();throw new u(a.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+l+"' (used as the orderBy) does not exist.")}o.push(f)}}return new It(o,i)}(t._query,t.firestore._databaseId,e,r[0]._document,i);var s=ru(t.firestore);return function(t,e,n,r,i,s){var c=t.explicitOrderBy;if(i.length>c.length)throw new u(a.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var h=[],f=0;f<i.length;f++){var l=i[f];if(c[f].field.isKeyField()){if("string"!=typeof l)throw new u(a.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+o(l));if(!Pt(t)&&-1!==l.indexOf("/"))throw new u(a.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+l+"' contains a slash.");var d=t.path.child(x.fromString(l));if(!Q.isDocumentKey(d))throw new u(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+d+"' is not because it contains an odd number of segments.");var p=new Q(d);h.push(J(e,p))}else{var y=du(n,r,l);h.push(y)}}return new It(h,s)}(t._query,t.firestore._databaseId,s,e,r,i)}function Bu(t,e,r){if("string"==typeof(r=(0,n.getModularInstance)(r))){if(""===r)throw new u(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pt(e)&&-1!==r.indexOf("/"))throw new u(a.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+r+"' contains a '/' character.");var i=e.path.child(x.fromString(r));if(!Q.isDocumentKey(i))throw new u(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+i+"' is not because it has an odd number of segments ("+i.length+").");return J(t,new Q(i))}if(r instanceof Ca)return J(t,r._key);throw new u(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Na(r)+".")}function ju(t,e){if(!Array.isArray(t)||0===t.length)throw new u(a.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new u(a.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ku(t,e,n){if(!n.isEqual(e))throw new u(a.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Qu=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),G(t)){case 0:return null;case 1:return t.booleanValue;case 2:return M(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(F(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw y()}},t.prototype.convertObject=function(t,e){var n=this,r={};return N(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new $a(M(t.latitude),M(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=q(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(U(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=P(t);return new E(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=x.fromString(t);v(Cn(n));var r=new da(n.get(1),n.get(3)),i=new Q(n.popFirst(5));return r.isEqual(e)||l("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Gu(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var zu=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,e.__extends)(n,t),n.prototype.convertBytes=function(t){return new Ha(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ca(this.firestore,null,e)},n}(Qu),Wu=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=ru(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Hu(t,this._firestore),i=Gu(r.converter,e,n),o=iu(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,ue.none())),this},t.prototype.update=function(t,e,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,a=Hu(t,this._firestore);return s="string"==typeof(e=(0,n.getModularInstance)(e))||e instanceof Wa?lu(this._dataReader,"WriteBatch.update",a._key,e,r,i):fu(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(s.toMutation(a._key,ue.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Hu(t,this._firestore);return this._mutations=this._mutations.concat(new Ee(e._key,ue.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new u(a.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Hu(t,e){if((t=(0,n.getModularInstance)(t)).firestore!==e)throw new u(a.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Yu=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,e.__extends)(n,t),n.prototype.convertBytes=function(t){return new Ha(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ca(this.firestore,null,e)},n}(Qu);function $u(t,e,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];t=Da(t,Ca);var s=Da(t.firestore,ja),a=ru(s);return Ju(s,[("string"==typeof(e=(0,n.getModularInstance)(e))||e instanceof Wa?lu(a,"updateDoc",t._key,e,r,i):fu(a,"updateDoc",t._key,e)).toMutation(t._key,ue.exists(!0))])}function Xu(t){for(var r,i,s,a=[],u=1;u<arguments.length;u++)a[u-1]=arguments[u];t=(0,n.getModularInstance)(t);var c={includeMetadataChanges:!1},h=0;"object"!=o(a[h])||qa(a[h])||(c=a[h],h++);var f,l,d,p={includeMetadataChanges:c.includeMetadataChanges};if(qa(a[h])){var y=a[h];a[h]=null===(r=y.next)||void 0===r?void 0:r.bind(y),a[h+1]=null===(i=y.error)||void 0===i?void 0:i.bind(y),a[h+2]=null===(s=y.complete)||void 0===s?void 0:s.bind(y)}if(t instanceof Ca)l=Da(t.firestore,ja),d=kt(t._key.path),f={next:function(e){a[h]&&a[h](Zu(l,t,e))},error:a[h+1],complete:a[h+2]};else{var v=Da(t,Ra);l=Da(v.firestore,ja),d=v._query;var m=new Yu(l);f={next:function(t){a[h]&&a[h](new xu(l,m,v,t))},error:a[h+1],complete:a[h+2]},Ru(t._query)}return function(t,n,r,i){var o=this,s=new $s(f),a=new ns(n,s,r);return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(o,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Xo,[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),a])]}})})}),function(){s.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(o,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Jo,[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),a])]}})})})}}(Ka(l),d,p)}function Ju(t,n){return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=vs,[4,ua(t)];case 1:return[2,r.apply(void 0,[e.sent(),n,i])]}})})}),i.promise}(Ka(t),n)}function Zu(t,e,n){var r=n.docs.get(e._key),i=new Yu(t);return new Du(t,i,e._key,r,new Nu(n.hasPendingWrites,n.fromCache),e.converter)}var tc=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,e.__extends)(n,t),n.prototype.get=function(e){var n=this,r=Hu(e,this._firestore),i=new Yu(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Du(n._firestore,i,r._key,t._document,new Nu(!1,!1),r.converter)})},n}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=ru(t)}return t.prototype.get=function(t){var e=this,n=Hu(t,this._firestore),r=new zu(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return y();var i=t[0];if(i.isFoundDocument())return new Eu(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Eu(e._firestore,r,n._key,null,n.converter);throw y()})},t.prototype.set=function(t,e,n){var r=Hu(t,this._firestore),i=Gu(r.converter,e,n),o=iu(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,a=Hu(t,this._firestore);return s="string"==typeof(e=(0,n.getModularInstance)(e))||e instanceof Wa?lu(this._dataReader,"Transaction.update",a._key,e,r,i):fu(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=Hu(t,this._firestore);return this._transaction.delete(e._key),this},t}());function ec(){if("undefined"==typeof Uint8Array)throw new u(a.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function nc(){if("undefined"==typeof atob)throw new u(a.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var rc=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return nc(),new t(Ha.fromBase64String(e))},t.fromUint8Array=function(e){return ec(),new t(Ha.fromUint8Array(e))},t.prototype.toBase64=function(){return nc(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return ec(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),ic=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){za(t=Da(t,ja));var n=Ka(t),r=t._freezeSettings(),i=new Hs;return Ga(n,i,new zs(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){za(t=Da(t,ja));var e=Ka(t),n=t._freezeSettings(),r=new Hs;return Ga(e,r,new Ws(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var n=this;if(t._initialized&&!t._terminated)throw new u(a.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new er;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return ir.yt()?(n=t+"main",[4,ir.delete(n)]):[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(yi(t._databaseId,t._persistenceKey))];case 1:return i.sent(),r.resolve(),[3,3];case 2:return n=i.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise}(t._delegate)},t}(),oc=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof da||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||d("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,r){void 0===r&&(r={}),function(t,e,r,i){void 0===i&&(i={});var o=(t=Da(t,ka))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&d("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+r,ssl:!1})),i.mockUserToken){var s=(0,n.createMockUserToken)(i.mockUserToken),c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new u(a.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new ma(new ya(s,new zi(c)))}}(this._delegate,t,e,r)},t.prototype.enableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,oa(t)];case 1:return n=e.sent(),[4,aa(t)];case 2:return r=e.sent(),[2,(n.setNetworkEnabled(!0),function(t){var e=m(r);return e.Or.delete(0),_o(e)}())]}})})})}(Ka(Da(this._delegate,ja)))},t.prototype.disableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(i){switch(i.label){case 0:return[4,oa(t)];case 1:return n=i.sent(),[4,aa(t)];case 2:return r=i.sent(),[2,(n.setNetworkEnabled(!1),function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(n=m(t)).Or.add(0),[4,wo(n)];case 1:return e.sent(),n.Br.set("Offline"),[2]}})})}(r))]}})})})}(Ka(Da(this._delegate,ja)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Ea("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var n=this,r=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Is,[4,ua(t)];case 1:return[2,n.apply(void 0,[e.sent(),r])]}})})}),r.promise}(Ka(Da(this._delegate,ja)))},t.prototype.onSnapshotsInSync=function(t){return function(t,n){return function(t,n){var r=this,i=new $s(n);return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=function(t,e){m(t).Gr.add(e),e.next()},[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),i])]}})})}),function(){i.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=function(t,e){m(t).Gr.delete(e)},[4,ca(t)];case 1:return[2,n.apply(void 0,[e.sent(),i])]}})})})}}(Ka(t=Da(t,ja)),qa(n)?n:{next:n})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new u(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wc(this,Oa(this._delegate,t))}catch(t){throw lc(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new fc(this,Pa(this._delegate,t))}catch(t){throw lc(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new mc(this,function(t,e){if(t=Da(t,ka),ba("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new u(a.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Ra(t,null,function(t){return new At(x.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw lc(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var n=this;return function(t,n){return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,function(t){return ia(t).then(function(t){return t.datastore})}(t)];case 1:return r=e.sent(),new Zs(t.asyncQueue,r,n,i).run(),[2]}})})}),i.promise}(Ka(t),function(e){return n(new tc(t,e))})}(this._delegate,function(e){return t(new uc(n,e))})},t.prototype.batch=function(){var t=this;return Ka(this._delegate),new cc(new Wu(this._delegate,function(e){return Ju(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new u(a.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new u(a.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),sc=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,e.__extends)(n,t),n.prototype.convertBytes=function(t){return new rc(new Ha(t))},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return fc.eu(e,this.firestore,null)},n}(Qu);function ac(t){var e;e=t,c.setLogLevel(e)}exports.U=oc,exports.q=ic,exports.a=rc;var uc=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new sc(t)}return t.prototype.get=function(t){var e=this,n=bc(t);return this._delegate.get(n).then(function(t){return new yc(e._firestore,new Du(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=bc(t);return n?(Ia("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=bc(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,(0,e.__spreadArray)([a,n,r],o)),this},t.prototype.delete=function(t){var e=bc(t);return this._delegate.delete(e),this},t}(),cc=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=bc(t);return n?(Ia("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=bc(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,(0,e.__spreadArray)([a,n,r],o)),this},t.prototype.delete=function(t){var e=bc(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),hc=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Au(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new vc(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new sc(e),n),i.set(n,o)),o},t}();exports.W=cc,exports.j=uc,hc.su=new WeakMap;var fc=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sc(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new u(a.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Ca(n._delegate,r,new Q(e)))},t.eu=function(e,n,r){return new t(n,new Ca(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new wc(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new wc(this.firestore,Oa(this._delegate,t))}catch(t){throw lc(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,n.getModularInstance)(t))instanceof Ca&&Ma(this._delegate,t)},t.prototype.set=function(t,e){e=Ia("DocumentReference.set",e);try{return function(t,e,n){t=Da(t,Ca);var r=Da(t.firestore,ja),i=Gu(t.converter,e,n);return Ju(r,[iu(ru(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,ue.none())])}(this._delegate,t,e)}catch(t){throw lc(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return 1===arguments.length?$u(this._delegate,t):$u.apply(void 0,(0,e.__spreadArray)([this._delegate,t,n],r))}catch(t){throw lc(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Ju(Da((t=this._delegate).firestore,ja),[new Ee(t._key,ue.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=dc(e),i=pc(e,function(e){return new yc(t.firestore,new Du(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Xu(this._delegate,r,i)},t.prototype.get=function(t){var n=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Da(t,Ca);var n=Da(t.firestore,ja),r=Ka(n),i=new Yu(n);return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return r=function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,function(t,e){var n=m(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,n)];case 1:return(o=e.sent()).isFoundDocument()?r.resolve(o):o.isNoDocument()?r.resolve(null):r.reject(new u(a.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=e.sent(),o=Go(i,"Failed to get document '"+n+" from cache"),r.reject(o),[3,3];case 3:return[2]}})})},[4,sa(t)];case 1:return[2,r.apply(void 0,[o.sent(),n,i])]}})})}),i.promise}(r,t._key).then(function(e){return new Du(n,i,t._key,e,new Nu(null!==e&&e.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Da(t,Ca);var e=Da(t.firestore,ja);return ha(Ka(e),t._key,{source:"server"}).then(function(n){return Zu(e,t,n)})}(this._delegate):function(t){t=Da(t,Ca);var e=Da(t.firestore,ja);return ha(Ka(e),t._key).then(function(n){return Zu(e,t,n)})}(this._delegate)).then(function(t){return new yc(n.firestore,new Du(n.firestore._delegate,n._userDataWriter,t._key,t._document,t.metadata,n._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(hc.nu(this.firestore,e)):this._delegate.withConverter(null))},t}();function lc(t,e,n){return t.message=t.message.replace(e,n),t}function dc(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==o(r)&&!qa(r))return r}return{}}function pc(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=qa(t[0])?t[0]:qa(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}exports.z=fc;var yc=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new fc(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Cu(this._delegate,t._delegate)},t}(),vc=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.data=function(t){return this._delegate.data(t)},n}(yc),mc=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sc(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Ou(this._delegate,function(t,e,n){var r=e,i=Su("where",t);return new Pu(i,r,n)}(e,n,r)))}catch(e){throw lc(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Ou(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Su("orderBy",t);return new Mu(r,n)}(e,n)))}catch(e){throw lc(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Ou(this._delegate,function(t){return Aa("limit",t),new Fu("limit",t,"F")}(e)))}catch(e){throw lc(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Ou(this._delegate,function(t){return Aa("limitToLast",t),new Fu("limitToLast",t,"L")}(e)))}catch(e){throw lc(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vu("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw lc(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vu("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw lc(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qu("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw lc(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ou(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qu("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw lc(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Fa(this._delegate,t._delegate)},t.prototype.get=function(t){var n=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Da(t,Ra);var n=Da(t.firestore,ja),r=Ka(n),i=new Yu(n);return function(t,n){var r=this,i=new er;return t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return r=function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,ki(t,n,!0)];case 1:return u=e.sent(),i=new cs(n,u.Bn),o=i._o(u.documents),s=i.applyChanges(o,!1),r.resolve(s.snapshot),[3,3];case 2:return a=e.sent(),u=Go(a,"Failed to execute query '"+n+" against cache"),r.reject(u),[3,3];case 3:return[2]}})})},[4,sa(t)];case 1:return[2,r.apply(void 0,[o.sent(),n,i])]}})})}),i.promise}(r,t._query).then(function(e){return new xu(n,i,t,e)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Da(t,Ra);var e=Da(t.firestore,ja),n=Ka(e),r=new Yu(e);return fa(n,t._query,{source:"server"}).then(function(n){return new xu(e,r,t,n)})}(this._delegate):function(t){t=Da(t,Ra);var e=Da(t.firestore,ja),n=Ka(e),r=new Yu(e);return Ru(t._query),fa(n,t._query).then(function(n){return new xu(e,r,t,n)})}(this._delegate)).then(function(t){return new _c(n.firestore,new xu(n.firestore._delegate,n._userDataWriter,n._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=dc(e),i=pc(e,function(e){return new _c(t.firestore,new xu(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Xu(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(hc.nu(this.firestore,e)):this._delegate.withConverter(null))},t}(),gc=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new vc(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),_c=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new mc(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new vc(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new gc(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new vc(n._firestore,r))})},t.prototype.isEqual=function(t){return Cu(this._delegate,t._delegate)},t}(),wc=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new fc(this.firestore,t):null},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){try{return new fc(this.firestore,void 0===t?Pa(this._delegate):Pa(this._delegate,t))}catch(t){throw lc(t,"doc()","CollectionReference.doc()")}},n.prototype.add=function(t){var e=this;return function(t,e){var n=Da(t.firestore,ja),r=Pa(t),i=Gu(t.converter,e);return Ju(n,[iu(ru(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,ue.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new fc(e.firestore,t)})},n.prototype.isEqual=function(t){return Ma(this._delegate,t._delegate)},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(hc.nu(this.firestore,t)):this._delegate.withConverter(null))},n}(mc);function bc(t){return Da(t,Ca)}exports.s=wc,exports.n=_c,exports.t=mc,exports.Z=vc,exports.X=yc;var Ic=function(){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(Wa.bind.apply(Wa,(0,e.__spreadArray)([void 0],t)))}return t.documentId=function(){return new t(C.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,n.getModularInstance)(t))instanceof Wa&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Ec=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new au("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new ou("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new uu("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cu("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=new hu("increment",e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();function Tc(t){return function(t,n){var r=Ka(t=Da(t,ja)),i=new Ua;return function(t,n,r,i){var o=this,s=function(t,e){return function(t,e){return new Xs(t,e)}(function(t,e){if(t instanceof Uint8Array)return Ys(t,e);if(t instanceof ArrayBuffer)return Ys(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?(new TextEncoder).encode(t):t),e)}(r,ho(n));t.asyncQueue.enqueueAndForget(function(){return(0,e.__awaiter)(o,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=Qs,[4,ua(t)];case 1:return n.apply(void 0,[e.sent(),s,i]),[2]}})})})}(r,t._databaseId,n,i),i}(this._delegate,t)}function Sc(t){var n,r,i=this;return(n=this._delegate,r=t,function(t,n){var r=this;return t.asyncQueue.enqueue(function(){return(0,e.__awaiter)(r,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=function(t,e){var n=m(t);return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Ke.getNamedQuery(t,e)})},[4,sa(t)];case 1:return[2,r.apply(void 0,[e.sent(),n])]}})})})}(Ka(n=Da(n,ja)),r).then(function(t){return t?new Ra(n,null,t.query):null})).then(function(t){return t?new mc(i,t):null})}exports.o=Ec,exports.r=Ic;
},{"tslib":"CvJj","@firebase/util":"gYkb","@firebase/logger":"srlT","@firebase/webchannel-wrapper":"VoiF","process":"g5IB"}],"PaOZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerFirestore=o;var e=i(require("@firebase/app")),r=require("./prebuilt-29191f3d-bed1a14c.js"),t=require("@firebase/component");function i(e){return e&&e.__esModule?e:{default:e}}require("tslib"),require("@firebase/util"),require("@firebase/logger"),require("@firebase/webchannel-wrapper");var n={Firestore:r.U,GeoPoint:r.C,Timestamp:r.M,Blob:r.a,Transaction:r.j,WriteBatch:r.W,DocumentReference:r.z,DocumentSnapshot:r.X,Query:r.t,QueryDocumentSnapshot:r.Z,QuerySnapshot:r.n,CollectionReference:r.s,FieldPath:r.r,FieldValue:r.o,setLogLevel:r.Q,CACHE_SIZE_UNLIMITED:r.E};function o(e){!function(e,i){e.INTERNAL.registerComponent(new t.Component("firestore",function(e){return function(e,t){return new r.U(e,new r.T(e,t),new r.q)}(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},n)))}(e),e.registerVersion("@firebase/firestore","2.3.10")}o(e.default);
},{"@firebase/app":"Q47K","./prebuilt-29191f3d-bed1a14c.js":"UymH","@firebase/component":"KLrb","tslib":"CvJj","@firebase/util":"gYkb","@firebase/logger":"srlT","@firebase/webchannel-wrapper":"VoiF"}],"GivO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerBundle=r;var e=require("./prebuilt-29191f3d-bed1a14c.js");function r(r){r.prototype.loadBundle=e.c,r.prototype.namedQuery=e.u}require("tslib"),require("@firebase/util"),require("@firebase/logger"),require("@firebase/webchannel-wrapper"),r(e.U);
},{"./prebuilt-29191f3d-bed1a14c.js":"UymH","tslib":"CvJj","@firebase/util":"gYkb","@firebase/logger":"srlT","@firebase/webchannel-wrapper":"VoiF"}],"LER0":[function(require,module,exports) {
"use strict";var e=r(require("@firebase/app")),t=require("tslib"),n=require("@firebase/component");function r(e){return e&&e.__esModule?e:{default:e}}var i={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},o=function(e){function n(t,r,i){var o=e.call(this,r)||this;return Object.setPrototypeOf(o,n.prototype),o.code=t,o.details=i,o}return(0,t.__extends)(n,e),n}(Error);function a(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function s(e,t,n){var r=a(e),s=r,u=void 0;try{var c=t&&t.error;if(c){var l=c.status;if("string"==typeof l){if(!i[l])return new o("internal","internal");r=i[l],s=l}var d=c.message;"string"==typeof d&&(s=d),void 0!==(u=c.details)&&(u=n.decode(u))}}catch(f){}return"ok"===r?null:new o(r,s,u)}var u=function(){function e(e,t){var n=this;this.auth=null,this.messaging=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(function(e){return n.auth=e},function(){}),this.messaging||t.get().then(function(e){return n.messaging=e},function(){})}return e.prototype.getAuthToken=function(){return(0,t.__awaiter)(this,void 0,void 0,function(){var e;return(0,t.__generator)(this,function(t){switch(t.label){case 0:if(!this.auth)return[2,void 0];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 3:return t.sent(),[2,void 0];case 4:return[2]}})})},e.prototype.getInstanceIdToken=function(){return(0,t.__awaiter)(this,void 0,void 0,function(){return(0,t.__generator)(this,function(e){switch(e.label){case 0:if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.messaging.getToken()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},e.prototype.getContext=function(){return(0,t.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},e}(),c="type.googleapis.com/google.protobuf.Int64Value",l="type.googleapis.com/google.protobuf.UInt64Value";function d(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}var f=function(){function e(){}return e.prototype.encode=function(e){var t=this;if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(function(e){return t.encode(e)});if("function"==typeof e||"object"==typeof e)return d(e,function(e){return t.encode(e)});throw new Error("Data cannot be encoded in JSON: "+e)},e.prototype.decode=function(e){var t=this;if(null==e)return e;if(e["@type"])switch(e["@type"]){case c:case l:var n=Number(e.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+e);return n;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(function(e){return t.decode(e)}):"function"==typeof e||"object"==typeof e?d(e,function(e){return t.decode(e)}):e},e}();function h(e){var t,n=new Promise(function(n,r){t=setTimeout(function(){r(new o("deadline-exceeded","deadline-exceeded"))},e)});return{timer:t,promise:n}}var p=function(){function e(e,t,n,r,i,o){var a=this;void 0===i&&(i="us-central1"),this.app_=e,this.appCheckProvider=r,this.fetchImpl=o,this.serializer=new f,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return Promise.resolve(a.deleteService())}},this.contextProvider=new u(t,n),this.cancelAllRequests=new Promise(function(e){a.deleteService=function(){return e()}});try{var s=new URL(i);this.customDomain=s.origin,this.region="us-central1"}catch(c){this.customDomain=null,this.region=i}}return Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),e.prototype._url=function(e){var t=this.app_.options.projectId;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+t+"/"+this.region+"/"+e:null!==this.customDomain?this.customDomain+"/"+e:"https://"+this.region+"-"+t+".cloudfunctions.net/"+e},e.prototype.useEmulator=function(e,t){this.emulatorOrigin="http://"+e+":"+t},e.prototype.useFunctionsEmulator=function(e){this.emulatorOrigin=e},e.prototype.httpsCallable=function(e,t){var n=this;return function(r){return n.call(e,r,t||{})}},e.prototype.postJSON=function(e,n,r){return(0,t.__awaiter)(this,void 0,void 0,function(){var i,o,a;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return r["Content-Type"]="application/json",[4,this.getAppCheckToken()];case 1:null!==(i=t.sent())&&(r["X-Firebase-AppCheck"]=i),t.label=2;case 2:return t.trys.push([2,4,,5]),[4,this.fetchImpl(e,{method:"POST",body:JSON.stringify(n),headers:r})];case 3:return o=t.sent(),[3,5];case 4:return t.sent(),[2,{status:0,json:null}];case 5:a=null,t.label=6;case 6:return t.trys.push([6,8,,9]),[4,o.json()];case 7:return a=t.sent(),[3,9];case 8:return t.sent(),[3,9];case 9:return[2,{status:o.status,json:a}]}})})},e.prototype.getAppCheckToken=function(){return(0,t.__awaiter)(this,void 0,void 0,function(){var e;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return(e=this.appCheckProvider.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:return[2,t.sent().token];case 2:return[2,null]}})})},e.prototype.call=function(e,n,r){return(0,t.__awaiter)(this,void 0,void 0,function(){var i,a,u,c,l,d,f,p,v,m,_;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return i=this._url(e),n=this.serializer.encode(n),a={data:n},u={},[4,this.contextProvider.getContext()];case 1:return(c=t.sent()).authToken&&(u.Authorization="Bearer "+c.authToken),c.instanceIdToken&&(u["Firebase-Instance-ID-Token"]=c.instanceIdToken),l=r.timeout||7e4,d=h(l),f=d.timer,p=d.promise,[4,Promise.race([g(f,this.postJSON(i,a,u)),p,g(f,this.cancelAllRequests)])];case 2:if(!(v=t.sent()))throw new o("cancelled","Firebase Functions instance was deleted.");if(m=s(v.status,v.json,this.serializer))throw m;if(!v.json)throw new o("internal","Response is not valid JSON object.");if(void 0===(_=v.json.data)&&(_=v.json.result),void 0===_)throw new o("internal","Response is missing data field.");return[2,{data:this.serializer.decode(_)}]}})})},e}();function g(e,n){return(0,t.__awaiter)(this,void 0,void 0,function(){var r;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return[4,n];case 1:return r=t.sent(),clearTimeout(e),[2,r]}})})}var v="functions";function m(e,t){var r={Functions:p};e.INTERNAL.registerComponent(new n.Component(v,function(e,n){var r=n.instanceIdentifier,i=e.getProvider("app").getImmediate(),o=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal"),s=e.getProvider("messaging");return new p(i,o,s,a,r,t)},"PUBLIC").setServiceProps(r).setMultipleInstances(!0))}var _="@firebase/functions",w="0.6.14";m(e.default,fetch.bind(self)),e.default.registerVersion(_,w);
},{"@firebase/app":"Q47K","tslib":"CvJj","@firebase/component":"KLrb"}],"qwql":[function(require,module,exports) {
var define;
var global = arguments[3];
var e,t=arguments[3];!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof e&&e.amd?e(["exports"],n):n((t=t||self).idb={})}(this,function(e){"use strict";function t(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(e,n,o){var r,i=new Promise(function(i,u){t(r=e[n].apply(e,o)).then(i,u)});return i.request=r,i}function o(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return n(this[t],r,arguments)})})}function i(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function u(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[t],(o=n(e,r,arguments)).then(function(e){if(e)return new s(e,o.request)});var e,o})})}function c(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function p(e){this._store=e}function a(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function d(e){this._db=e}o(c,"_index",["name","keyPath","multiEntry","unique"]),r(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),u(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(s,"_cursor",["direction","key","primaryKey","value"]),r(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(s.prototype[e]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,o),t(n._request).then(function(e){if(e)return new s(e,n._request)})})})}),p.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},p.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},o(p,"_store",["name","keyPath","indexNames","autoIncrement"]),r(p,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),u(p,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(p,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new p(this._tx.objectStore.apply(this._tx,arguments))},o(a,"_tx",["objectStoreNames","mode"]),i(a,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new p(this._db.createObjectStore.apply(this._db,arguments))},o(f,"_db",["name","version","objectStoreNames"]),i(f,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},o(d,"_db",["name","version","objectStoreNames"]),i(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[p,c].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}})})}),[c,p].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})}),e.openDb=function(e,t,o){var r=n(indexedDB,"open",[e,t]),i=r.request;return i&&(i.onupgradeneeded=function(e){o&&o(new f(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new d(e)})},e.deleteDb=function(e){return n(indexedDB,"deleteDatabase",[e])},Object.defineProperty(e,"__esModule",{value:!0})});
},{}],"cfFX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerInstallations=Ie;var e=i(require("@firebase/app")),t=require("@firebase/component"),r=require("tslib"),n=require("@firebase/util"),a=require("idb");function i(e){return e&&e.__esModule?e:{default:e}}var s,o="@firebase/installations",u="0.4.31",c=1e4,f="w:"+u,l="FIS_v2",d="https://firebaseinstallations.googleapis.com/v1",p=36e5,g="installations",v="Installations",h=((s={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',s["not-registered"]="Firebase Installation is not registered.",s["installation-not-found"]="Firebase Installation not found.",s["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',s["app-offline"]="Could not process request. Application offline.",s["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",s),_=new n.ErrorFactory(g,v,h);function w(e){return e instanceof n.FirebaseError&&e.code.includes("request-failed")}function m(e){var t=e.projectId;return d+"/projects/"+t+"/installations"}function b(e){return{token:e.token,requestStatus:2,expiresIn:k(e.expiresIn),creationTime:Date.now()}}function y(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,t.json()];case 1:return n=r.sent(),a=n.error,[2,_.create("request-failed",{requestName:e,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})]}})})}function S(e){var t=e.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function C(e,t){var r=t.refreshToken,n=S(e);return n.append("Authorization",I(r)),n}function T(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,e()];case 1:return(t=r.sent()).status>=500&&t.status<600?[2,e()]:[2,t]}})})}function k(e){return Number(e.replace("s","000"))}function I(e){return l+" "+e}function q(e,t){var n=t.fid;return(0,r.__awaiter)(this,void 0,void 0,function(){var t,a,i,s,o,u;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return t=m(e),a=S(e),i={fid:n,authVersion:l,appId:e.appId,sdkVersion:f},s={method:"POST",headers:a,body:JSON.stringify(i)},[4,T(function(){return fetch(t,s)})];case 1:return(o=r.sent()).ok?[4,o.json()]:[3,3];case 2:return u=r.sent(),[2,{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:b(u.authToken)}];case 3:return[4,y("Create Installation",o)];case 4:throw r.sent()}})})}function P(e){return new Promise(function(t){setTimeout(t,e)})}function j(e){return btoa(String.fromCharCode.apply(String,(0,r.__spreadArray)([],(0,r.__read)(e)))).replace(/\+/g,"-").replace(/\//g,"_")}var E=/^[cdef][\w-]{21}$/,D="";function N(){try{var e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=x(e);return E.test(t)?t:D}catch(s){return D}}function x(e){return j(e).substr(0,22)}function A(e){return e.appName+"!"+e.appId}var L=new Map;function F(e,t){var r=A(e);V(r,t),$(r,t)}function M(e,t){z();var r=A(e),n=L.get(r);n||(n=new Set,L.set(r,n)),n.add(t)}function O(e,t){var r=A(e),n=L.get(r);n&&(n.delete(t),0===n.size&&L.delete(r),B())}function V(e,t){var n,a,i=L.get(e);if(i)try{for(var s=(0,r.__values)(i),o=s.next();!o.done;o=s.next()){(0,o.value)(t)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}}function $(e,t){var r=z();r&&r.postMessage({key:e,fid:t}),B()}var K=null;function z(){return!K&&"BroadcastChannel"in self&&((K=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(e){V(e.data.key,e.data.fid)}),K}function B(){0===L.size&&K&&(K.close(),K=null)}var J="firebase-installations-database",R=1,U="firebase-installations-store",G=null;function H(){return G||(G=(0,a.openDb)(J,R,function(e){switch(e.oldVersion){case 0:e.createObjectStore(U)}})),G}function Q(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a,i,s,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=A(e),[4,H()];case 1:return a=r.sent(),i=a.transaction(U,"readwrite"),[4,(s=i.objectStore(U)).get(n)];case 2:return o=r.sent(),[4,s.put(t,n)];case 3:return r.sent(),[4,i.complete];case 4:return r.sent(),o&&o.fid===t.fid||F(e,t.fid),[2,t]}})})}function W(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return t=A(e),[4,H()];case 1:return n=r.sent(),[4,(a=n.transaction(U,"readwrite")).objectStore(U).delete(t)];case 2:return r.sent(),[4,a.complete];case 3:return r.sent(),[2]}})})}function X(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a,i,s,o,u;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=A(e),[4,H()];case 1:return a=r.sent(),i=a.transaction(U,"readwrite"),[4,(s=i.objectStore(U)).get(n)];case 2:return o=r.sent(),void 0!==(u=t(o))?[3,4]:[4,s.delete(n)];case 3:return r.sent(),[3,6];case 4:return[4,s.put(u,n)];case 5:r.sent(),r.label=6;case 6:return[4,i.complete];case 7:return r.sent(),!u||o&&o.fid===u.fid||F(e,u.fid),[2,u]}})})}function Y(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,X(e,function(r){var n=Z(r),a=ee(e,n);return t=a.registrationPromise,a.installationEntry})];case 1:return(n=r.sent()).fid!==D?[3,3]:(a={},[4,t]);case 2:return[2,(a.installationEntry=r.sent(),a)];case 3:return[2,{installationEntry:n,registrationPromise:t}]}})})}function Z(e){return ae(e||{fid:N(),registrationStatus:0})}function ee(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(_.create("app-offline"))};var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:r,registrationPromise:te(e,r)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:re(e)}:{installationEntry:t}}function te(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,7]),[4,q(e,t)];case 1:return n=r.sent(),[2,Q(e,n)];case 2:return w(a=r.sent())&&409===a.customData.serverCode?[4,W(e)]:[3,4];case 3:return r.sent(),[3,6];case 4:return[4,Q(e,{fid:t.fid,registrationStatus:0})];case 5:r.sent(),r.label=6;case 6:throw a;case 7:return[2]}})})}function re(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,a,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,ne(e)];case 1:t=r.sent(),r.label=2;case 2:return 1!==t.registrationStatus?[3,5]:[4,P(100)];case 3:return r.sent(),[4,ne(e)];case 4:return t=r.sent(),[3,2];case 5:return 0!==t.registrationStatus?[3,7]:[4,Y(e)];case 6:return n=r.sent(),a=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,a];case 7:return[2,t]}})})}function ne(e){return X(e,function(e){if(!e)throw _.create("installation-not-found");return ae(e)})}function ae(e){return ie(e)?{fid:e.fid,registrationStatus:0}:e}function ie(e){return 1===e.registrationStatus&&e.registrationTime+c<Date.now()}function se(e,t){var n=e.appConfig,a=e.platformLoggerProvider;return(0,r.__awaiter)(this,void 0,void 0,function(){var e,i,s,o,u,c,l;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return e=oe(n,t),i=C(n,t),(s=a.getImmediate({optional:!0}))&&i.append("x-firebase-client",s.getPlatformInfoString()),o={installation:{sdkVersion:f}},u={method:"POST",headers:i,body:JSON.stringify(o)},[4,T(function(){return fetch(e,u)})];case 1:return(c=r.sent()).ok?[4,c.json()]:[3,3];case 2:return l=r.sent(),[2,b(l)];case 3:return[4,y("Generate Auth Token",c)];case 4:throw r.sent()}})})}function oe(e,t){var r=t.fid;return m(e)+"/"+r+"/authTokens:generate"}function ue(e,t){return void 0===t&&(t=!1),(0,r.__awaiter)(this,void 0,void 0,function(){var n,a,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,X(e.appConfig,function(r){if(!de(r))throw _.create("not-registered");var a=r.authToken;if(!t&&pe(a))return r;if(1===a.requestStatus)return n=ce(e,t),r;if(!navigator.onLine)throw _.create("app-offline");var i=ve(r);return n=le(e,i),i})];case 1:return a=r.sent(),n?[4,n]:[3,3];case 2:return i=r.sent(),[3,4];case 3:i=a.authToken,r.label=4;case 4:return[2,i]}})})}function ce(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,fe(e.appConfig)];case 1:n=r.sent(),r.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,P(100)];case 3:return r.sent(),[4,fe(e.appConfig)];case 4:return n=r.sent(),[3,2];case 5:return 0===(a=n.authToken).requestStatus?[2,ue(e,t)]:[2,a]}})})}function fe(e){return X(e,function(e){if(!de(e))throw _.create("not-registered");return he(e.authToken)?(0,r.__assign)((0,r.__assign)({},e),{authToken:{requestStatus:0}}):e})}function le(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a,i;return(0,r.__generator)(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,8]),[4,se(e,t)];case 1:return n=s.sent(),i=(0,r.__assign)((0,r.__assign)({},t),{authToken:n}),[4,Q(e.appConfig,i)];case 2:return s.sent(),[2,n];case 3:return!w(a=s.sent())||401!==a.customData.serverCode&&404!==a.customData.serverCode?[3,5]:[4,W(e.appConfig)];case 4:return s.sent(),[3,7];case 5:return i=(0,r.__assign)((0,r.__assign)({},t),{authToken:{requestStatus:0}}),[4,Q(e.appConfig,i)];case 6:s.sent(),s.label=7;case 7:throw a;case 8:return[2]}})})}function de(e){return void 0!==e&&2===e.registrationStatus}function pe(e){return 2===e.requestStatus&&!ge(e)}function ge(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+p}function ve(e){var t={requestStatus:1,requestTime:Date.now()};return(0,r.__assign)((0,r.__assign)({},e),{authToken:t})}function he(e){return 1===e.requestStatus&&e.requestTime+c<Date.now()}function _e(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,Y(e.appConfig)];case 1:return t=r.sent(),n=t.installationEntry,(a=t.registrationPromise)?a.catch(console.error):ue(e).catch(console.error),[2,n.fid]}})})}function we(e,t){return void 0===t&&(t=!1),(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,me(e.appConfig)];case 1:return r.sent(),[4,ue(e,t)];case 2:return[2,r.sent().token]}})})}function me(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,Y(e)];case 1:return(t=r.sent().registrationPromise)?[4,t]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})}function be(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a,i,s;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=ye(e,t),a=C(e,t),i={method:"DELETE",headers:a},[4,T(function(){return fetch(n,i)})];case 1:return(s=r.sent()).ok?[3,3]:[4,y("Delete Installation",s)];case 2:throw r.sent();case 3:return[2]}})})}function ye(e,t){var r=t.fid;return m(e)+"/"+r}function Se(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,X(t=e.appConfig,function(e){if(!e||0!==e.registrationStatus)return e})];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw _.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw _.create("app-offline");case 3:return[4,be(t,n)];case 4:return r.sent(),[4,W(t)];case 5:r.sent(),r.label=6;case 6:return[2]}})})}function Ce(e,t){var r=e.appConfig;return M(r,t),function(){O(r,t)}}function Te(e){var t,n;if(!e||!e.options)throw ke("App Configuration");if(!e.name)throw ke("App Name");try{for(var a=(0,r.__values)(["projectId","apiKey","appId"]),i=a.next();!i.done;i=a.next()){var s=i.value;if(!e.options[s])throw ke(s)}}catch(o){t={error:o}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function ke(e){return _.create("missing-app-config-values",{valueName:e})}function Ie(e){e.INTERNAL.registerComponent(new t.Component("installations",function(e){var t=e.getProvider("app").getImmediate(),r={appConfig:Te(t),platformLoggerProvider:e.getProvider("platform-logger")};return{app:t,getId:function(){return _e(r)},getToken:function(e){return we(r,e)},delete:function(){return Se(r)},onIdChange:function(e){return Ce(r,e)}}},"PUBLIC")),e.registerVersion(o,u)}Ie(e.default);
},{"@firebase/app":"Q47K","@firebase/component":"KLrb","tslib":"CvJj","@firebase/util":"gYkb","idb":"qwql"}],"VjMm":[function(require,module,exports) {
"use strict";require("@firebase/installations");var e,t=require("@firebase/component"),n=require("@firebase/util"),r=require("tslib"),i=require("idb"),o=s(require("@firebase/app"));function s(e){return e&&e.__esModule?e:{default:e}}var a,c=((e={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',e["only-available-in-window"]="This method is available in a Window context.",e["only-available-in-sw"]="This method is available in a service worker context.",e["permission-default"]="The notification permission was not granted and dismissed instead.",e["permission-blocked"]="The notification permission was not granted and blocked instead.",e["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",e["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",e["token-subscribe-failed"]="A problem occurred while subscribing the user to FCM: {$errorInfo}",e["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",e["token-unsubscribe-failed"]="A problem occurred while unsubscribing the user from FCM: {$errorInfo}",e["token-update-failed"]="A problem occurred while updating the user from FCM: {$errorInfo}",e["token-update-no-token"]="FCM returned no token when updating the user to push.",e["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",e["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",e["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",e["invalid-vapid-key"]="The public VAPID key must be a string.",e["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",e),u=new n.ErrorFactory("messaging","Messaging",c),l="/firebase-messaging-sw.js",d="/firebase-cloud-messaging-push-scope",p="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",f="https://fcmregistrations.googleapis.com/v1",h="FCM_MSG",g="FirebaseMessaging: ",v="google.c.a.e",b="google.c.a.c_id",w="google.c.a.ts",y="google.c.a.c_l",_=1e3,m=3e3;function k(e){var t=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,(0,r.__spreadArray)([],(0,r.__read)(t)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function S(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}!function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(a||(a={}));var M="fcm_token_details_db",T=5,K="fcm_token_object_Store";function I(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,o=this;return(0,r.__generator)(this,function(s){switch(s.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(t=s.sent(),!t.map(function(e){return e.name}).includes(M))return[2,null];s.label=2;case 2:return n=null,[4,(0,i.openDb)(M,T,function(t){return(0,r.__awaiter)(o,void 0,void 0,function(){var i,o,s,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return t.oldVersion<2?[2]:t.objectStoreNames.contains(K)?[4,(i=t.transaction.objectStore(K)).index("fcmSenderId").get(e)]:[2];case 1:return o=r.sent(),[4,i.clear()];case 2:if(r.sent(),!o)return[2];if(2===t.oldVersion){if(!(s=o).auth||!s.p256dh||!s.endpoint)return[2];n={token:s.fcmToken,createTime:null!==(a=s.createTime)&&void 0!==a?a:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:k(s.vapidKey)}}}else 3===t.oldVersion?n={token:(s=o).fcmToken,createTime:s.createTime,subscriptionOptions:{auth:k(s.auth),p256dh:k(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:k(s.vapidKey)}}:4===t.oldVersion&&(n={token:(s=o).fcmToken,createTime:s.createTime,subscriptionOptions:{auth:k(s.auth),p256dh:k(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:k(s.vapidKey)}});return[2]}})})})];case 3:return s.sent().close(),[4,(0,i.deleteDb)(M)];case 4:return s.sent(),[4,(0,i.deleteDb)("fcm_vapid_details_db")];case 5:return s.sent(),[4,(0,i.deleteDb)("undefined")];case 6:return s.sent(),[2,C(n)?n:null]}})})}function C(e){if(!e||!e.subscriptionOptions)return!1;var t=e.subscriptionOptions;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}var D="firebase-messaging-database",O=1,P="firebase-messaging-store",E=null;function N(){return E||(E=(0,i.openDb)(D,O,function(e){switch(e.oldVersion){case 0:e.createObjectStore(P)}})),E}function R(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return t=A(e),[4,N()];case 1:return[4,r.sent().transaction(P).objectStore(P).get(t)];case 2:return(n=r.sent())?[2,n]:[3,3];case 3:return[4,I(e.appConfig.senderId)];case 4:return(i=r.sent())?[4,j(e,i)]:[3,6];case 5:return r.sent(),[2,i];case 6:return[2]}})})}function j(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=A(e),[4,N()];case 1:return i=r.sent(),[4,(o=i.transaction(P,"readwrite")).objectStore(P).put(t,n)];case 2:return r.sent(),[4,o.complete];case 3:return r.sent(),[2,t]}})})}function x(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return t=A(e),[4,N()];case 1:return n=r.sent(),[4,(i=n.transaction(P,"readwrite")).objectStore(P).delete(t)];case 2:return r.sent(),[4,i.complete];case 3:return r.sent(),[2]}})})}function A(e){return e.appConfig.appId}function W(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,c;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,B(e)];case 1:n=r.sent(),i=F(t),o={method:"POST",headers:n,body:JSON.stringify(i)},r.label=2;case 2:return r.trys.push([2,5,,6]),[4,fetch(V(e.appConfig),o)];case 3:return[4,r.sent().json()];case 4:return s=r.sent(),[3,6];case 5:throw a=r.sent(),u.create("token-subscribe-failed",{errorInfo:a});case 6:if(s.error)throw c=s.error.message,u.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw u.create("token-subscribe-no-token");return[2,s.token]}})})}function H(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,c;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,B(e)];case 1:n=r.sent(),i=F(t.subscriptionOptions),o={method:"PATCH",headers:n,body:JSON.stringify(i)},r.label=2;case 2:return r.trys.push([2,5,,6]),[4,fetch(V(e.appConfig)+"/"+t.token,o)];case 3:return[4,r.sent().json()];case 4:return s=r.sent(),[3,6];case 5:throw a=r.sent(),u.create("token-update-failed",{errorInfo:a});case 6:if(s.error)throw c=s.error.message,u.create("token-update-failed",{errorInfo:c});if(!s.token)throw u.create("token-update-no-token");return[2,s.token]}})})}function U(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,B(e)];case 1:n=r.sent(),i={method:"DELETE",headers:n},r.label=2;case 2:return r.trys.push([2,5,,6]),[4,fetch(V(e.appConfig)+"/"+t,i)];case 3:return[4,r.sent().json()];case 4:if((o=r.sent()).error)throw s=o.error.message,u.create("token-unsubscribe-failed",{errorInfo:s});return[3,6];case 5:throw a=r.sent(),u.create("token-unsubscribe-failed",{errorInfo:a});case 6:return[2]}})})}function V(e){var t=e.projectId;return f+"/projects/"+t+"/registrations"}function B(e){var t=e.appConfig,n=e.installations;return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return e=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":"FIS "+e})]}})})}function F(e){var t=e.p256dh,n=e.auth,r=e.endpoint,i=e.vapidKey,o={web:{endpoint:r,auth:n,p256dh:t}};return i!==p&&(o.web.applicationPubKey=i),o}var L=6048e5;function q(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:if("granted"!==Notification.permission)throw u.create("permission-blocked");return[4,z(t,n)];case 1:return i=r.sent(),[4,R(e)];case 2:return o=r.sent(),s={vapidKey:n,swScope:t.scope,endpoint:i.endpoint,auth:k(i.getKey("auth")),p256dh:k(i.getKey("p256dh"))},o?[3,3]:[2,J(e,s)];case 3:if(Q(o.subscriptionOptions,s))return[3,8];r.label=4;case 4:return r.trys.push([4,6,,7]),[4,U(e,o.token)];case 5:return r.sent(),[3,7];case 6:return a=r.sent(),console.warn(a),[3,7];case 7:return[2,J(e,s)];case 8:return Date.now()>=o.createTime+L?[2,$({token:o.token,createTime:Date.now(),subscriptionOptions:s},e,t)]:[2,o.token];case 9:return[2]}})})}function G(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,R(e)];case 1:return(n=r.sent())?[4,U(e,n.token)]:[3,4];case 2:return r.sent(),[4,x(e)];case 3:r.sent(),r.label=4;case 4:return[4,t.pushManager.getSubscription()];case 5:return(i=r.sent())?[2,i.unsubscribe()]:[2,!0]}})})}function $(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s;return(0,r.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,5]),[4,H(t,e)];case 1:return i=a.sent(),o=(0,r.__assign)((0,r.__assign)({},e),{token:i,createTime:Date.now()}),[4,j(t,o)];case 2:return a.sent(),[2,i];case 3:return s=a.sent(),[4,G(t,n)];case 4:throw a.sent(),s;case 5:return[2]}})})}function J(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,W(e,t)];case 1:return n=r.sent(),i={token:n,createTime:Date.now(),subscriptionOptions:t},[4,j(e,i)];case 2:return r.sent(),[2,i.token]}})})}function z(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,e.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:S(t)})]}})})}function Q(e,t){var n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,o=t.p256dh===e.p256dh;return n&&r&&i&&o}function X(e){var t={from:e.from,collapseKey:e.collapse_key};return Y(t,e),Z(t,e),ee(t,e),t}function Y(e,t){if(t.notification){e.notification={};var n=t.notification.title;n&&(e.notification.title=n);var r=t.notification.body;r&&(e.notification.body=r);var i=t.notification.image;i&&(e.notification.image=i)}}function Z(e,t){t.data&&(e.data=t.data)}function ee(e,t){if(t.fcmOptions){e.fcmOptions={};var n=t.fcmOptions.link;n&&(e.fcmOptions.link=n);var r=t.fcmOptions.analytics_label;r&&(e.fcmOptions.analyticsLabel=r)}}function te(e){return"object"==typeof e&&!!e&&b in e}function ne(e){return new Promise(function(t){setTimeout(t,e)})}var re=function(){function e(e){var t=this;this.firebaseDependencies=e,this.isOnBackgroundMessageUsed=null,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",function(e){e.waitUntil(t.onPush(e))}),self.addEventListener("pushsubscriptionchange",function(e){e.waitUntil(t.onSubChange(e))}),self.addEventListener("notificationclick",function(e){e.waitUntil(t.onNotificationClick(e))})}return Object.defineProperty(e.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),e.prototype.setBackgroundMessageHandler=function(e){if(this.isOnBackgroundMessageUsed=!1,!e||"function"!=typeof e)throw u.create("invalid-bg-handler");this.bgMessageHandler=e},e.prototype.onBackgroundMessage=function(e){var t=this;return this.isOnBackgroundMessageUsed=!0,this.bgMessageHandler=e,function(){t.bgMessageHandler=null}},e.prototype.getToken=function(){var e,t;return(0,r.__awaiter)(this,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return this.vapidKey?[3,2]:[4,R(this.firebaseDependencies)];case 1:n=r.sent(),this.vapidKey=null!==(t=null===(e=null==n?void 0:n.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==t?t:p,r.label=2;case 2:return[2,q(this.firebaseDependencies,self.registration,this.vapidKey)]}})})},e.prototype.deleteToken=function(){return G(this.firebaseDependencies,self.registration)},e.prototype.requestPermission=function(){throw u.create("only-available-in-window")},e.prototype.usePublicVapidKey=function(e){if(null!==this.vapidKey)throw u.create("use-vapid-key-after-get-token");if("string"!=typeof e||0===e.length)throw u.create("invalid-vapid-key");this.vapidKey=e},e.prototype.useServiceWorker=function(){throw u.create("only-available-in-window")},e.prototype.onMessage=function(){throw u.create("only-available-in-window")},e.prototype.onTokenRefresh=function(){throw u.create("only-available-in-window")},e.prototype.onPush=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,i,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(t=oe(e))?[4,ue()]:(console.debug(g+"failed to get parsed MessagePayload from the PushEvent. Skip handling the push."),[2]);case 1:return ae(n=r.sent())?[2,ce(n,t)]:(i=!1,t.notification?[4,le(ie(t))]:[3,3]);case 2:r.sent(),i=!0,r.label=3;case 3:return!0===i&&!1===this.isOnBackgroundMessageUsed?[2]:(this.bgMessageHandler&&(o=X(t),"function"==typeof this.bgMessageHandler?this.bgMessageHandler(o):this.bgMessageHandler.next(o)),[4,ne(_)]);case 4:return r.sent(),[2]}})})},e.prototype.onSubChange=function(e){var t,n;return(0,r.__awaiter)(this,void 0,void 0,function(){var i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return e.newSubscription?[3,2]:[4,G(this.firebaseDependencies,self.registration)];case 1:return r.sent(),[2];case 2:return[4,R(this.firebaseDependencies)];case 3:return i=r.sent(),[4,G(this.firebaseDependencies,self.registration)];case 4:return r.sent(),[4,q(this.firebaseDependencies,self.registration,null!==(n=null===(t=null==i?void 0:i.subscriptionOptions)||void 0===t?void 0:t.vapidKey)&&void 0!==n?n:p)];case 5:return r.sent(),[2]}})})},e.prototype.onNotificationClick=function(e){var t,n;return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,c,u;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(i=null===(n=null===(t=e.notification)||void 0===t?void 0:t.data)||void 0===n?void 0:n[h])?e.action?[2]:(e.stopImmediatePropagation(),e.notification.close(),(o=de(i))?(s=new URL(o,self.location.href),c=new URL(self.location.origin),s.host!==c.host?[2]:[4,se(s)]):[2]):[2];case 1:return(u=r.sent())?[3,4]:[4,self.clients.openWindow(o)];case 2:return u=r.sent(),[4,ne(m)];case 3:return r.sent(),[3,6];case 4:return[4,u.focus()];case 5:u=r.sent(),r.label=6;case 6:return u?(i.messageType=a.NOTIFICATION_CLICKED,i.isFirebaseMessaging=!0,[2,u.postMessage(i)]):[2]}})})},e}();function ie(e){var t,n=(0,r.__assign)({},e.notification);return n.data=((t={})[h]=e,t),n}function oe(e){var t=e.data;if(!t)return null;try{return t.json()}catch(n){return null}}function se(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,i,o,s,a,c;return(0,r.__generator)(this,function(u){switch(u.label){case 0:return[4,ue()];case 1:t=u.sent();try{for(n=(0,r.__values)(t),i=n.next();!i.done;i=n.next())if(o=i.value,s=new URL(o.url,self.location.href),e.host===s.host)return[2,o]}catch(l){a={error:l}}finally{try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(a)throw a.error}}return[2,null]}})})}function ae(e){return e.some(function(e){return"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")})}function ce(e,t){var n,i;t.isFirebaseMessaging=!0,t.messageType=a.PUSH_RECEIVED;try{for(var o=(0,r.__values)(e),s=o.next();!s.done;s=o.next()){s.value.postMessage(t)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}function ue(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function le(e){var t,n=e.actions,r=Notification.maxActions;return n&&r&&n.length>r&&console.warn("This browser only supports "+r+" actions. The remaining actions will not be displayed."),self.registration.showNotification(null!==(t=e.title)&&void 0!==t?t:"",e)}function de(e){var t,n,r,i=null!==(n=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==n?n:null===(r=e.notification)||void 0===r?void 0:r.click_action;return i||(te(e.data)?self.location.origin:null)}var pe=function(){function e(e){var t=this;this.firebaseDependencies=e,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",function(e){return t.messageEventListener(e)})}return Object.defineProperty(e.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),e.prototype.messageEventListener=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(t=e.data).isFirebaseMessaging?(this.onMessageCallback&&t.messageType===a.PUSH_RECEIVED&&("function"==typeof this.onMessageCallback?this.onMessageCallback(he(Object.assign({},t))):this.onMessageCallback.next(Object.assign({},t))),te(n=t.data)&&"1"===n[v]?[4,this.logEvent(t.messageType,n)]:[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},e.prototype.getVapidKey=function(){return this.vapidKey},e.prototype.getSwReg=function(){return this.swRegistration},e.prototype.getToken=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return"default"!==Notification.permission?[3,2]:[4,Notification.requestPermission()];case 1:t.sent(),t.label=2;case 2:if("granted"!==Notification.permission)throw u.create("permission-blocked");return[4,this.updateVapidKey(null==e?void 0:e.vapidKey)];case 3:return t.sent(),[4,this.updateSwReg(null==e?void 0:e.serviceWorkerRegistration)];case 4:return t.sent(),[2,q(this.firebaseDependencies,this.swRegistration,this.vapidKey)]}})})},e.prototype.updateVapidKey=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){return e?this.vapidKey=e:this.vapidKey||(this.vapidKey=p),[2]})})},e.prototype.updateSwReg=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return e||this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:t.sent(),t.label=2;case 2:if(!e&&this.swRegistration)return[2];if(!(e instanceof ServiceWorkerRegistration))throw u.create("invalid-sw-registration");return this.swRegistration=e,[2]}})})},e.prototype.registerDefaultSw=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,t;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=this,[4,navigator.serviceWorker.register(l,{scope:d})];case 1:return e.swRegistration=n.sent(),this.swRegistration.update().catch(function(){}),[3,3];case 2:throw t=n.sent(),u.create("failed-service-worker-registration",{browserErrorMessage:t.message});case 3:return[2]}})})},e.prototype.deleteToken=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:e.sent(),e.label=2;case 2:return[2,G(this.firebaseDependencies,this.swRegistration)]}})})},e.prototype.requestPermission=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(t){switch(t.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?u.create("permission-blocked"):u.create("permission-default")}})})},e.prototype.usePublicVapidKey=function(e){if(null!==this.vapidKey)throw u.create("use-vapid-key-after-get-token");if("string"!=typeof e||0===e.length)throw u.create("invalid-vapid-key");this.vapidKey=e},e.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw u.create("invalid-sw-registration");if(this.swRegistration)throw u.create("use-sw-after-get-token");this.swRegistration=e},e.prototype.onMessage=function(e){var t=this;return this.onMessageCallback=e,function(){t.onMessageCallback=null}},e.prototype.setBackgroundMessageHandler=function(){throw u.create("only-available-in-sw")},e.prototype.onBackgroundMessage=function(){throw u.create("only-available-in-sw")},e.prototype.onTokenRefresh=function(){return function(){}},e.prototype.logEvent=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=fe(e),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return r.sent().logEvent(n,{message_id:t[b],message_name:t[y],message_time:t[w],message_device_time:Math.floor(Date.now()/1e3)}),[2]}})})},e}();function fe(e){switch(e){case a.NOTIFICATION_CLICKED:return"notification_open";case a.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function he(e){return delete e.messageType,delete e.isFirebaseMessaging,e}function ge(e){var t,n;if(!e||!e.options)throw ve("App Configuration Object");if(!e.name)throw ve("App Name");var i=e.options;try{for(var o=(0,r.__values)(["projectId","apiKey","appId","messagingSenderId"]),s=o.next();!s.done;s=o.next()){var a=s.value;if(!i[a])throw ve(a)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return{appName:e.name,projectId:i.projectId,apiKey:i.apiKey,appId:i.appId,senderId:i.messagingSenderId}}function ve(e){return u.create("missing-app-config-values",{valueName:e})}var be="messaging";function we(e){var t=e.getProvider("app").getImmediate(),n={app:t,appConfig:ge(t),installations:e.getProvider("installations").getImmediate(),analyticsProvider:e.getProvider("analytics-internal")};if(!_e())throw u.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new re(n):new pe(n)}var ye={isSupported:_e};function _e(){return self&&"ServiceWorkerGlobalScope"in self?ke():me()}function me(){return"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function ke(){return"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}o.default.INTERNAL.registerComponent(new t.Component(be,we,"PUBLIC").setServiceProps(ye));
},{"@firebase/installations":"cfFX","@firebase/component":"KLrb","@firebase/util":"gYkb","tslib":"CvJj","idb":"qwql","@firebase/app":"Q47K"}],"raud":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerStorage=Dt;var e=o(require("@firebase/app")),t=require("tslib"),n=require("@firebase/util"),r=require("@firebase/component");function o(e){return e&&e.__esModule?e:{default:e}}var i="firebasestorage.googleapis.com",a="storageBucket",s=12e4,u=6e5,c=function(e){function n(t,r){var o=e.call(this,l(t),"Firebase Storage: "+r+" ("+l(t)+")")||this;return o.customData={serverResponse:null},o._baseMessage=o.message,Object.setPrototypeOf(o,n.prototype),o}return(0,t.__extends)(n,e),n.prototype._codeEquals=function(e){return l(e)===this.code},Object.defineProperty(n.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=this._baseMessage+"\n"+this.customData.serverResponse:this.message=this._baseMessage},enumerable:!1,configurable:!0}),n}(n.FirebaseError);function l(e){return"storage/"+e}function h(){return new c("unknown","An unknown error occurred, please check the error payload for server response.")}function f(e){return new c("object-not-found","Object '"+e+"' does not exist.")}function p(e){return new c("quota-exceeded","Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function d(){return new c("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again.")}function _(){return new c("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function g(e){return new c("unauthorized","User does not have permission to access '"+e+"'.")}function v(){return new c("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function b(){return new c("canceled","User canceled the upload/download.")}function m(e){return new c("invalid-url","Invalid URL '"+e+"'.")}function y(e){return new c("invalid-default-bucket","Invalid default bucket '"+e+"'.")}function w(){return new c("no-default-bucket","No default bucket found. Did you set the '"+a+"' property when initializing the app?")}function R(){return new c("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function k(){return new c("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function T(){return new c("no-download-url","The given file does not have any download URLs.")}function x(e){return new c("invalid-argument",e)}function O(){return new c("app-deleted","The Firebase app was deleted.")}function P(e){return new c("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function U(e,t){return new c("invalid-format","String does not match format '"+e+"': "+t)}function S(e){throw new c("internal-error","Internal error: "+e)}function C(e){return atob(e)}var E={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},A=function(){return function(e,t){this.data=e,this.contentType=t||null}}();function I(e,t){switch(e){case E.RAW:return new A(j(t));case E.BASE64:case E.BASE64URL:return new A(M(e,t));case E.DATA_URL:return new A(B(t),N(t))}throw h()}function j(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else t.push(239,191,189);else 56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function q(e){var t;try{t=decodeURIComponent(e)}catch(n){throw U(E.DATA_URL,"Malformed data URL.")}return j(t)}function M(e,t){switch(e){case E.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw U(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case E.BASE64URL:var o=-1!==t.indexOf("+"),i=-1!==t.indexOf("/");if(o||i)throw U(e,"Invalid character '"+(o?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=C(t)}catch(c){throw U(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var L=function(){return function(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw U(E.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=t[1]||null;null!=n&&(this.base64=z(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}();function B(e){var t=new L(e);return t.base64?M(E.BASE64,t.rest):q(t.rest)}function N(e){return new L(e).contentType}function z(e,t){return!!(e.length>=t.length)&&e.substring(e.length-t.length)===t}var F,D={STATE_CHANGED:"state_changed"},H={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function G(e){switch(e){case"running":case"pausing":case"canceling":return H.RUNNING;case"paused":return H.PAUSED;case"success":return H.SUCCESS;case"canceled":return H.CANCELED;case"error":default:return H.ERROR}}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(F||(F={}));var W=function(){function e(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=F.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=F.ABORT,t()}),e.xhr_.addEventListener("error",function(){e.errorCode_=F.NETWORK_ERROR,t()}),e.xhr_.addEventListener("load",function(){t()})})}return e.prototype.send=function(e,t,n,r){if(this.sent_)throw S("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(var o in r)r.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,r[o].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},e.prototype.getErrorCode=function(){if(!this.sent_)throw S("cannot .getErrorCode() before sending");return this.errorCode_},e.prototype.getStatus=function(){if(!this.sent_)throw S("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}},e.prototype.getResponseText=function(){if(!this.sent_)throw S("cannot .getResponseText() before sending");return this.xhr_.responseText},e.prototype.abort=function(){this.xhr_.abort()},e.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)},e.prototype.addUploadProgressListener=function(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)},e.prototype.removeUploadProgressListener=function(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)},e}();function X(){return new W}var V=function(){function e(){}return e.prototype.createConnection=function(){return X()},e}(),K=function(){function e(e,t){this.bucket=e,this.path_=t}return Object.defineProperty(e.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),e.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)},e.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},e.makeFromBucketSpec=function(t,n){var r;try{r=e.makeFromUrl(t,n)}catch(o){return new e(t,"")}if(""===r.path)return r;throw y(t)},e.makeFromUrl=function(t,n){var r=null;var o=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");function a(e){e.path_=decodeURIComponent(e.path)}for(var s=n.replace(/[.]/g,"\\."),u=[{regex:o,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+s+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:a},{regex:new RegExp("^https?://"+(n===i?"(?:storage.googleapis.com|storage.cloud.google.com)":n)+"/([A-Za-z0-9.\\-_]+)/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:a}],c=0;c<u.length;c++){var l=u[c],h=l.regex.exec(t);if(h){var f=h[l.indices.bucket],p=h[l.indices.path];p||(p=""),r=new e(f,p),l.postModify(r);break}}if(null==r)throw m(t);return r},e}(),Z=function(){function e(e){this.promise_=Promise.reject(e)}return e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){},e}();function $(e,n,r){var o=1,i=null,a=!1,s=0;function u(){return 2===s}var c=!1;function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c||(c=!0,n.apply(null,e))}function h(t){i=setTimeout(function(){i=null,e(f,u())},t)}function f(e){for(var n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];c||(e?l.call.apply(l,(0,t.__spreadArray)([null,e],r)):u()||a?l.call.apply(l,(0,t.__spreadArray)([null,e],r)):(o<64&&(o*=2),1===s?(s=2,n=0):n=1e3*(o+Math.random()),h(n)))}var p=!1;function d(e){p||(p=!0,c||(null!==i?(e||(s=2),clearTimeout(i),h(0)):e||(s=1)))}return h(0),setTimeout(function(){a=!0,d(!0)},r),d}function J(e){e(!1)}function Y(e){return void 0!==e}function Q(e){return"function"==typeof e}function ee(e){return"object"==typeof e&&!Array.isArray(e)}function te(e){return"string"==typeof e||e instanceof String}function ne(e){return re()&&e instanceof Blob}function re(){return"undefined"!=typeof Blob}function oe(e,t,n,r){if(r<t)throw x("Invalid value for '"+e+"'. Expected "+t+" or greater.");if(r>n)throw x("Invalid value for '"+e+"'. Expected "+n+" or less.")}function ie(e,t){var n=t.match(/^(\w+):\/\/.+/),r=t;return null==(null==n?void 0:n[1])&&(r="https://"+t),r+"/v0"+e}function ae(e){var t=encodeURIComponent,n="?";for(var r in e){if(e.hasOwnProperty(r))n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1)}var se=function(){function e(e,t,n,r,o,i,a,s,u,c,l){var h=this;this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=o.slice(),this.additionalRetryCodes_=i.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=l,this.promise_=new Promise(function(e,t){h.resolve_=e,h.reject_=t,h.start_()})}return e.prototype.start_=function(){var e=this;function t(t,n){var r,o=e.resolve_,i=e.reject_,a=n.connection;if(n.wasSuccessCode)try{var s=e.callback_(a,a.getResponseText());Y(s)?o(s):o()}catch(u){i(u)}else null!==a?((r=h()).serverResponse=a.getResponseText(),e.errorCallback_?i(e.errorCallback_(a,r)):i(r)):n.canceled?i(r=e.appDelete_?O():b()):i(r=v())}this.canceled_?t(0,new ue(!1,null,!0)):this.backoffId_=$(function(t,n){if(n)t(!1,new ue(!1,null,!0));else{var r=e.pool_.createConnection();e.pendingConnection_=r,null!==e.progressCallback_&&r.addUploadProgressListener(o),r.send(e.url_,e.method_,e.body_,e.headers_).then(function(){null!==e.progressCallback_&&r.removeUploadProgressListener(o),e.pendingConnection_=null;var n=r.getErrorCode()===F.NO_ERROR,i=r.getStatus();if(n&&!e.isRetryStatusCode_(i)){var a=-1!==e.successCodes_.indexOf(i);t(!0,new ue(a,r))}else{var s=r.getErrorCode()===F.ABORT;t(!1,new ue(!1,null,s))}})}function o(t){var n=t.loaded,r=t.lengthComputable?t.total:-1;null!==e.progressCallback_&&e.progressCallback_(n,r)}},t,this.timeout_)},e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&J(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()},e.prototype.isRetryStatusCode_=function(e){var t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r},e}(),ue=function(){return function(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}();function ce(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}function le(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}function he(e,t){t&&(e["X-Firebase-GMPID"]=t)}function fe(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}function pe(e,t,n,r,o,i){var a=ae(e.urlParams),s=e.url+a,u=Object.assign({},e.headers);return he(u,t),ce(u,n),le(u,i),fe(u,r),new se(s,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,o)}function de(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function _e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=de();if(void 0!==n){for(var r=new n,o=0;o<e.length;o++)r.append(e[o]);return r.getBlob()}if(re())return new Blob(e);throw new c("unsupported-environment","This browser doesn't seem to support creating Blobs")}function ge(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}var ve=function(){function e(e,t){var n=0,r="";ne(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}return e.prototype.size=function(){return this.size_},e.prototype.type=function(){return this.type_},e.prototype.slice=function(t,n){if(ne(this.data_)){var r=ge(this.data_,t,n);return null===r?null:new e(r)}return new e(new Uint8Array(this.data_.buffer,t,n-t),!0)},e.getBlob=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(re()){var r=t.map(function(t){return t instanceof e?t.data_:t});return new e(_e.apply(null,r))}var o=t.map(function(e){return te(e)?I(E.RAW,e).data:e.data_}),i=0;o.forEach(function(e){i+=e.byteLength});var a=new Uint8Array(i),s=0;return o.forEach(function(e){for(var t=0;t<e.length;t++)a[s++]=e[t]}),new e(a,!0)},e.prototype.uploadData=function(){return this.data_},e}();function be(e){var t;try{t=JSON.parse(e)}catch(n){return null}return ee(t)?t:null}function me(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}function ye(e,t){var n=t.split("/").filter(function(e){return e.length>0}).join("/");return 0===e.length?n:e+"/"+n}function we(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Re(e,t){return t}var ke=function(){return function(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Re}}(),Te=null;function xe(e){return!te(e)||e.length<2?e:we(e)}function Oe(){if(Te)return Te;var e=[];e.push(new ke("bucket")),e.push(new ke("generation")),e.push(new ke("metageneration")),e.push(new ke("name","fullPath",!0));var t=new ke("name");t.xform=function(e,t){return xe(t)},e.push(t);var n=new ke("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new ke("timeCreated")),e.push(new ke("updated")),e.push(new ke("md5Hash",null,!0)),e.push(new ke("cacheControl",null,!0)),e.push(new ke("contentDisposition",null,!0)),e.push(new ke("contentEncoding",null,!0)),e.push(new ke("contentLanguage",null,!0)),e.push(new ke("contentType",null,!0)),e.push(new ke("metadata","customMetadata",!0)),Te=e}function Pe(e,t){Object.defineProperty(e,"ref",{get:function(){var n=e.bucket,r=e.fullPath,o=new K(n,r);return t._makeStorageReference(o)}})}function Ue(e,t,n){for(var r={type:"file"},o=n.length,i=0;i<o;i++){var a=n[i];r[a.local]=a.xform(r,t[a.server])}return Pe(r,e),r}function Se(e,t,n){var r=be(t);return null===r?null:Ue(e,r,n)}function Ce(e,t,n){var r=be(t);if(null===r)return null;if(!te(r.downloadTokens))return null;var o=r.downloadTokens;if(0===o.length)return null;var i=encodeURIComponent;return o.split(",").map(function(t){var r=e.bucket,o=e.fullPath;return ie("/b/"+i(r)+"/o/"+i(o),n)+ae({alt:"media",token:t})})[0]}function Ee(e,t){for(var n={},r=t.length,o=0;o<r;o++){var i=t[o];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}var Ae="prefixes",Ie="items";function je(e,t,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[Ae])for(var o=0,i=n[Ae];o<i.length;o++){var a=i[o].replace(/\/$/,""),s=e._makeStorageReference(new K(t,a));r.prefixes.push(s)}if(n[Ie])for(var u=0,c=n[Ie];u<c.length;u++){var l=c[u];s=e._makeStorageReference(new K(t,l.name));r.items.push(s)}return r}function qe(e,t,n){var r=be(n);return null===r?null:je(e,t,r)}var Me=function(){return function(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function Le(e){if(!e)throw h()}function Be(e,t){return function(n,r){var o=Se(e,r,t);return Le(null!==o),o}}function Ne(e,t){return function(n,r){var o=qe(e,t,r);return Le(null!==o),o}}function ze(e,t){return function(n,r){var o=Se(e,r,t);return Le(null!==o),Ce(o,r,e.host)}}function Fe(e){return function(t,n){var r;return(r=401===t.getStatus()?t.getResponseText().includes("Firebase App Check token is invalid")?_():d():402===t.getStatus()?p(e.bucket):403===t.getStatus()?g(e.path):n).serverResponse=n.serverResponse,r}}function De(e){var t=Fe(e);return function(n,r){var o=t(n,r);return 404===n.getStatus()&&(o=f(e.path)),o.serverResponse=r.serverResponse,o}}function He(e,t,n){var r=ie(t.fullServerUrl(),e.host),o=e.maxOperationRetryTime,i=new Me(r,"GET",Be(e,n),o);return i.errorHandler=De(t),i}function Ge(e,t,n,r,o){var i={};t.isRoot?i.prefix="":i.prefix=t.path+"/",n&&n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),o&&(i.maxResults=o);var a=ie(t.bucketOnlyServerUrl(),e.host),s=e.maxOperationRetryTime,u=new Me(a,"GET",Ne(e,t.bucket),s);return u.urlParams=i,u.errorHandler=Fe(t),u}function We(e,t,n){var r=ie(t.fullServerUrl(),e.host),o=e.maxOperationRetryTime,i=new Me(r,"GET",ze(e,n),o);return i.errorHandler=De(t),i}function Xe(e,t,n,r){var o=ie(t.fullServerUrl(),e.host),i=Ee(n,r),a=e.maxOperationRetryTime,s=new Me(o,"PATCH",Be(e,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=i,s.errorHandler=De(t),s}function Ve(e,t){var n=ie(t.fullServerUrl(),e.host),r=e.maxOperationRetryTime;var o=new Me(n,"DELETE",function(e,t){},r);return o.successCodes=[200,204],o.errorHandler=De(t),o}function Ke(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function Ze(e,t,n){var r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=Ke(null,t)),r}function $e(e,t,n,r,o){var i=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var s=function(){for(var e="",t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+s;var u=Ze(t,r,o),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Ee(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",l="\r\n--"+s+"--",h=ve.getBlob(c,r,l);if(null===h)throw R();var f={name:u.fullPath},p=ie(i,e.host),d=e.maxUploadRetryTime,_=new Me(p,"POST",Be(e,n),d);return _.urlParams=f,_.headers=a,_.body=h.uploadData(),_.errorHandler=Fe(t),_}var Je=function(){return function(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}();function Ye(e,t){var n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(r){Le(!1)}return Le(!!n&&-1!==(t||["active"]).indexOf(n)),n}function Qe(e,t,n,r,o){var i=t.bucketOnlyServerUrl(),a=Ze(t,r,o),s={name:a.fullPath},u=ie(i,e.host),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},l=Ee(a,n),h=e.maxUploadRetryTime;var f=new Me(u,"POST",function(e){var t;Ye(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){Le(!1)}return Le(te(t)),t},h);return f.urlParams=s,f.headers=c,f.body=l,f.errorHandler=Fe(t),f}function et(e,t,n,r){var o=e.maxUploadRetryTime,i=new Me(n,"POST",function(e){var t=Ye(e,["active","final"]),n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(i){Le(!1)}n||Le(!1);var o=Number(n);return Le(!isNaN(o)),new Je(o,r.size(),"final"===t)},o);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=Fe(t),i}var tt=262144;function nt(e,t,n,r,o,i,a,s){var u=new Je(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw k();var c=u.total-u.current,l=c;o>0&&(l=Math.min(l,o));var h=u.current,f=h+l,p={"X-Goog-Upload-Command":l===c?"upload, finalize":"upload","X-Goog-Upload-Offset":""+u.current},d=r.slice(h,f);if(null===d)throw R();var _=t.maxUploadRetryTime,g=new Me(n,"POST",function(e,n){var o,a=Ye(e,["active","final"]),s=u.current+l,c=r.size();return o="final"===a?Be(t,i)(e,n):null,new Je(s,c,"final"===a,o)},_);return g.headers=p,g.body=d.uploadData(),g.progressCallback=s||null,g.errorHandler=Fe(e),g}var rt=function(){return function(e,t,n){if(Q(e)||null!=t||null!=n)this.next=e,this.error=t,this.complete=n;else{var r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}}}();function ot(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Promise.resolve().then(function(){return e.apply(void 0,t)})}}var it=function(){function e(e,t,n){var r=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=Oe(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(e){r._request=void 0,r._chunkMultiplier=1,e._codeEquals("canceled")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=e,r._transition("error"))},this._metadataErrorHandler=function(e){r._request=void 0,e._codeEquals("canceled")?r.completeTransitions_():(r._error=e,r._transition("error"))},this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t,r._start()}),this._promise.then(null,function(){})}return e.prototype._makeProgressCallback=function(){var e=this,t=this._transferred;return function(n){return e._updateProgress(t+n)}},e.prototype._shouldDoResumable=function(e){return e.size()>262144},e.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},e.prototype._resolveToken=function(e){var t=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(n){var r=n[0],o=n[1];switch(t._state){case"running":e(r,o);break;case"canceling":t._transition("canceled");break;case"pausing":t._transition("paused")}})},e.prototype._createResumable=function(){var e=this;this._resolveToken(function(t,n){var r=Qe(e._ref.storage,e._ref._location,e._mappings,e._blob,e._metadata),o=e._ref.storage._makeRequest(r,t,n);e._request=o,o.getPromise().then(function(t){e._request=void 0,e._uploadUrl=t,e._needToFetchStatus=!1,e.completeTransitions_()},e._errorHandler)})},e.prototype._fetchStatus=function(){var e=this,t=this._uploadUrl;this._resolveToken(function(n,r){var o=et(e._ref.storage,e._ref._location,t,e._blob),i=e._ref.storage._makeRequest(o,n,r);e._request=i,i.getPromise().then(function(t){t=t,e._request=void 0,e._updateProgress(t.current),e._needToFetchStatus=!1,t.finalized&&(e._needToFetchMetadata=!0),e.completeTransitions_()},e._errorHandler)})},e.prototype._continueUpload=function(){var e=this,t=tt*this._chunkMultiplier,n=new Je(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken(function(o,i){var a;try{a=nt(e._ref._location,e._ref.storage,r,e._blob,t,e._mappings,n,e._makeProgressCallback())}catch(u){return e._error=u,void e._transition("error")}var s=e._ref.storage._makeRequest(a,o,i);e._request=s,s.getPromise().then(function(t){e._increaseMultiplier(),e._request=void 0,e._updateProgress(t.current),t.finalized?(e._metadata=t.metadata,e._transition("success")):e.completeTransitions_()},e._errorHandler)})},e.prototype._increaseMultiplier=function(){tt*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},e.prototype._fetchMetadata=function(){var e=this;this._resolveToken(function(t,n){var r=He(e._ref.storage,e._ref._location,e._mappings),o=e._ref.storage._makeRequest(r,t,n);e._request=o,o.getPromise().then(function(t){e._request=void 0,e._metadata=t,e._transition("success")},e._metadataErrorHandler)})},e.prototype._oneShotUpload=function(){var e=this;this._resolveToken(function(t,n){var r=$e(e._ref.storage,e._ref._location,e._mappings,e._blob,e._metadata),o=e._ref.storage._makeRequest(r,t,n);e._request=o,o.getPromise().then(function(t){e._request=void 0,e._metadata=t,e._updateProgress(e._blob.size()),e._transition("success")},e._errorHandler)})},e.prototype._updateProgress=function(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()},e.prototype._transition=function(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=b(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}},e.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(e.prototype,"snapshot",{get:function(){var e=G(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t,n,r){var o=this,i=new rt(t,n,r);return this._addObserver(i),function(){o._removeObserver(i)}},e.prototype.then=function(e,t){return this._promise.then(e,t)},e.prototype.catch=function(e){return this.then(null,e)},e.prototype._addObserver=function(e){this._observers.push(e),this._notifyObserver(e)},e.prototype._removeObserver=function(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)},e.prototype._notifyObservers=function(){var e=this;this._finishPromise(),this._observers.slice().forEach(function(t){e._notifyObserver(t)})},e.prototype._finishPromise=function(){if(void 0!==this._resolve){var e=!0;switch(G(this._state)){case H.SUCCESS:ot(this._resolve.bind(null,this.snapshot))();break;case H.CANCELED:case H.ERROR:ot(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}},e.prototype._notifyObserver=function(e){switch(G(this._state)){case H.RUNNING:case H.PAUSED:e.next&&ot(e.next.bind(e,this.snapshot))();break;case H.SUCCESS:e.complete&&ot(e.complete.bind(e))();break;case H.CANCELED:case H.ERROR:e.error&&ot(e.error.bind(e,this._error))();break;default:e.error&&ot(e.error.bind(e,this._error))()}},e.prototype.resume=function(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e},e.prototype.pause=function(){var e="running"===this._state;return e&&this._transition("pausing"),e},e.prototype.cancel=function(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e},e}(),at=function(){function e(e,t){this._service=e,this._location=t instanceof K?t:K.makeFromUrl(t,e.host)}return e.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},e.prototype._newRef=function(t,n){return new e(t,n)},Object.defineProperty(e.prototype,"root",{get:function(){var e=new K(this._location.bucket,"");return this._newRef(this._service,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return we(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=me(this._location.path);if(null===t)return null;var n=new K(this._location.bucket,t);return new e(this._service,n)},enumerable:!1,configurable:!0}),e.prototype._throwIfRoot=function(e){if(""===this._location.path)throw P(e)},e}();function st(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new it(e,new ve(t),n)}function ut(e){var t={prefixes:[],items:[]};return ct(e,t).then(function(){return t})}function ct(e,n,r){return(0,t.__awaiter)(this,void 0,void 0,function(){var o,i,a;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return[4,lt(e,{pageToken:r})];case 1:return o=t.sent(),(i=n.prefixes).push.apply(i,o.prefixes),(a=n.items).push.apply(a,o.items),null==o.nextPageToken?[3,3]:[4,ct(e,n,o.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function lt(e,n){return(0,t.__awaiter)(this,void 0,void 0,function(){var r,o;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return null!=n&&"number"==typeof n.maxResults&&oe("options.maxResults",1,1e3,n.maxResults),r=n||{},o=Ge(e.storage,e._location,"/",r.pageToken,r.maxResults),[4,e.storage.makeRequestWithTokens(o)];case 1:return[2,t.sent().getPromise()]}})})}function ht(e){return(0,t.__awaiter)(this,void 0,void 0,function(){var n;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return e._throwIfRoot("getMetadata"),n=He(e.storage,e._location,Oe()),[4,e.storage.makeRequestWithTokens(n)];case 1:return[2,t.sent().getPromise()]}})})}function ft(e,n){return(0,t.__awaiter)(this,void 0,void 0,function(){var r;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return e._throwIfRoot("updateMetadata"),r=Xe(e.storage,e._location,n,Oe()),[4,e.storage.makeRequestWithTokens(r)];case 1:return[2,t.sent().getPromise()]}})})}function pt(e){return(0,t.__awaiter)(this,void 0,void 0,function(){var n;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return e._throwIfRoot("getDownloadURL"),n=We(e.storage,e._location,Oe()),[4,e.storage.makeRequestWithTokens(n)];case 1:return[2,t.sent().getPromise().then(function(e){if(null===e)throw T();return e})]}})})}function dt(e){return(0,t.__awaiter)(this,void 0,void 0,function(){var n;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return e._throwIfRoot("deleteObject"),n=Ve(e.storage,e._location),[4,e.storage.makeRequestWithTokens(n)];case 1:return[2,t.sent().getPromise()]}})})}function _t(e,t){var n=ye(e._location.path,t),r=new K(e._location.bucket,n);return new at(e.storage,r)}function gt(e){return/^[A-Za-z]+:\/\//.test(e)}function vt(e,t){return new at(e,t)}function bt(e,t){if(e instanceof Rt){var n=e;if(null==n._bucket)throw w();var r=new at(n,n._bucket);return null!=t?bt(r,t):r}if(void 0!==t){if(t.includes(".."))throw x('`path` param cannot contain ".."');return _t(e,t)}return e}function mt(e,t){if(t&&gt(t)){if(e instanceof Rt)return vt(e,t);throw x("To use ref(service, url), the first argument must be a Storage instance.")}return bt(e,t)}function yt(e,t){var n=null==t?void 0:t[a];return null==n?null:K.makeFromBucketSpec(n,e)}function wt(e,t,n){e.host="http://"+t+":"+n}var Rt=function(){function e(e,t,n,r,o,a){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._pool=r,this._url=o,this._firebaseVersion=a,this._bucket=null,this._host=i,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=s,this._maxUploadRetryTime=u,this._requests=new Set,this._bucket=null!=o?K.makeFromBucketSpec(o,this._host):yt(this._host,this.app.options)}return Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){this._host=e,null!=this._url?this._bucket=K.makeFromBucketSpec(this._url,e):this._bucket=yt(e,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(e){oe("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(e){oe("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e},enumerable:!1,configurable:!0}),e.prototype._getAuthToken=function(){return(0,t.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return(e=this._authProvider.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:if(null!==(n=t.sent()))return[2,n.accessToken];t.label=2;case 2:return[2,null]}})})},e.prototype._getAppCheckToken=function(){return(0,t.__awaiter)(this,void 0,void 0,function(){var e;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return(e=this._appCheckProvider.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:return[2,t.sent().token];case 2:return[2,null]}})})},e.prototype._delete=function(){return this._deleted||(this._deleted=!0,this._requests.forEach(function(e){return e.cancel()}),this._requests.clear()),Promise.resolve()},e.prototype._makeStorageReference=function(e){return new at(this,e)},e.prototype._makeRequest=function(e,t,n){var r=this;if(this._deleted)return new Z(O());var o=pe(e,this._appId,t,n,this._pool,this._firebaseVersion);return this._requests.add(o),o.getPromise().then(function(){return r._requests.delete(o)},function(){return r._requests.delete(o)}),o},e.prototype.makeRequestWithTokens=function(e){return(0,t.__awaiter)(this,void 0,void 0,function(){var n,r,o;return(0,t.__generator)(this,function(t){switch(t.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return n=t.sent(),r=n[0],o=n[1],[2,this._makeRequest(e,r,o)]}})})},e}();function kt(e,t,r){return st(e=(0,n.getModularInstance)(e),t,r)}function Tt(e){return ht(e=(0,n.getModularInstance)(e))}function xt(e,t){return ft(e=(0,n.getModularInstance)(e),t)}function Ot(e,t){return lt(e=(0,n.getModularInstance)(e),t)}function Pt(e){return ut(e=(0,n.getModularInstance)(e))}function Ut(e){return pt(e=(0,n.getModularInstance)(e))}function St(e){return dt(e=(0,n.getModularInstance)(e))}function Ct(e,t){return mt(e=(0,n.getModularInstance)(e),t)}function Et(e,t){return _t(e,t)}function At(e,t,n){wt(e,t,n)}var It=function(){function e(e,t,n){this._delegate=e,this.task=t,this.ref=n}return Object.defineProperty(e.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),e}(),jt=function(){function e(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(e.prototype,"snapshot",{get:function(){return new It(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),e.prototype.then=function(e,t){var n=this;return this._delegate.then(function(t){if(e)return e(new It(t,n,n._ref))},t)},e.prototype.on=function(e,t,n,r){var o=this,i=void 0;return t&&(i="function"==typeof t?function(e){return t(new It(e,o,o._ref))}:{next:t.next?function(e){return t.next(new It(e,o,o._ref))}:void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)},e}(),qt=function(){function e(e,t){this._delegate=e,this._service=t}return Object.defineProperty(e.prototype,"prefixes",{get:function(){var e=this;return this._delegate.prefixes.map(function(t){return new Mt(t,e._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){var e=this;return this._delegate.items.map(function(t){return new Mt(t,e._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),e}(),Mt=function(){function e(e,t){this._delegate=e,this.storage=t}return Object.defineProperty(e.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this._delegate.toString()},e.prototype.child=function(t){return new e(Et(this._delegate,t),this.storage)},Object.defineProperty(e.prototype,"root",{get:function(){return new e(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return null==t?null:new e(t,this.storage)},enumerable:!1,configurable:!0}),e.prototype.put=function(e,t){return this._throwIfRoot("put"),new jt(kt(this._delegate,e,t),this)},e.prototype.putString=function(e,n,r){void 0===n&&(n=E.RAW),this._throwIfRoot("putString");var o=I(n,e),i=(0,t.__assign)({},r);return null==i.contentType&&null!=o.contentType&&(i.contentType=o.contentType),new jt(new it(this._delegate,new ve(o.data,!0),i),this)},e.prototype.listAll=function(){var e=this;return Pt(this._delegate).then(function(t){return new qt(t,e.storage)})},e.prototype.list=function(e){var t=this;return Ot(this._delegate,e||void 0).then(function(e){return new qt(e,t.storage)})},e.prototype.getMetadata=function(){return Tt(this._delegate)},e.prototype.updateMetadata=function(e){return xt(this._delegate,e)},e.prototype.getDownloadURL=function(){return Ut(this._delegate)},e.prototype.delete=function(){return this._throwIfRoot("delete"),St(this._delegate)},e.prototype._throwIfRoot=function(e){if(""===this._delegate._location.path)throw P(e)},e}(),Lt=function(){function e(e,t){this.app=e,this._delegate=t}return Object.defineProperty(e.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),e.prototype.ref=function(e){if(gt(e))throw x("ref() expected a child path but got a URL, use refFromURL instead.");return new Mt(Ct(this._delegate,e),this)},e.prototype.refFromURL=function(e){if(!gt(e))throw x("refFromURL() expected a full URL but got a child path, use ref() instead.");try{K.makeFromUrl(e,this._delegate.host)}catch(t){throw x("refFromUrl() expected a valid full URL but got an invalid one.")}return new Mt(Ct(this._delegate,e),this)},e.prototype.setMaxUploadRetryTime=function(e){this._delegate.maxUploadRetryTime=e},e.prototype.setMaxOperationRetryTime=function(e){this._delegate.maxOperationRetryTime=e},e.prototype.useEmulator=function(e,t){At(this._delegate,e,t)},e}(),Bt="@firebase/storage",Nt="0.6.2",zt="storage";function Ft(t,n){var r=n.instanceIdentifier,o=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),a=t.getProvider("app-check-internal");return new Lt(o,new Rt(o,i,a,new V,r,e.default.SDK_VERSION))}function Dt(e){var t={TaskState:H,TaskEvent:D,StringFormat:E,Storage:Rt,Reference:Mt};e.INTERNAL.registerComponent(new r.Component(zt,Ft,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion(Bt,Nt)}Dt(e.default);
},{"@firebase/app":"Q47K","tslib":"CvJj","@firebase/util":"gYkb","@firebase/component":"KLrb"}],"OpHm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerPerformance=zt;var t=o(require("@firebase/app"));require("@firebase/installations");var e=require("tslib"),n=require("@firebase/util"),r=require("@firebase/logger"),i=require("@firebase/component");function o(t){return t&&t.__esModule?t:{default:t}}var a,s,c,u="@firebase/performance",p="0.4.17",f=p,l="FB-PERF-TRACE-START",g="FB-PERF-TRACE-STOP",m="FB-PERF-TRACE-MEASURE",h="_wt_",d="_fp",v="_fcp",_="_fid",b="@firebase/performance/config",y="@firebase/performance/configexpire",I="performance",T="Performance",A=((a={})["trace started"]="Trace {$traceName} was started before.",a["trace stopped"]="Trace {$traceName} is not running.",a["nonpositive trace startTime"]="Trace {$traceName} startTime should be positive.",a["nonpositive trace duration"]="Trace {$traceName} duration should be positive.",a["no window"]="Window is not available.",a["no app id"]="App id is not available.",a["no project id"]="Project id is not available.",a["no api key"]="Api key is not available.",a["invalid cc log"]="Attempted to queue invalid cc event",a["FB not default"]="Performance can only start when Firebase app instance is the default one.",a["RC response not ok"]="RC response is not ok",a["invalid attribute name"]="Attribute name {$attributeName} is invalid.",a["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",a["invalid custom metric name"]="Custom metric name {$customMetricName} is invalid",a["invalid String merger input"]="Input for String merger is invalid, contact support team to resolve.",a),E=new n.ErrorFactory(I,T,A),w=new r.Logger(T);w.logLevel=r.LogLevel.INFO;var S,M=function(){function t(t){if(this.window=t,!t)throw E.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!(0,n.isIndexedDBAvailable)()||(w.info("IndexedDB is not supported by current browswer"),!1):(w.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)},t.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}}).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===s&&(s=new t(c)),s},t}();function N(t){c=t}function k(t,e){var n=t.length-e.length;if(n<0||n>1)throw E.create("invalid String merger input");for(var r=[],i=0;i<t.length;i++)r.push(t.charAt(i)),e.length>i&&r.push(e.charAt(i));return r.join("")}var O,R,U=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=k("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=k("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw E.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw E.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw E.create("no api key");return t},t.prototype.getFlTransportFullUrl=function(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)},t.getInstance=function(){return void 0===S&&(S=new t),S},t}();function P(){var t=U.getInstance().installationsService.getId();return t.then(function(t){O=t}),t}function B(){return O}function F(){var t=U.getInstance().installationsService.getToken();return t.then(function(t){}),t}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN"}(R||(R={}));var D=["firebase_","google_","ga_"],C=new RegExp("^[a-zA-Z]\\w*$"),L=40,q=100;function j(){var t=M.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}function x(){switch(M.getInstance().document.visibilityState){case"visible":return R.VISIBLE;case"hidden":return R.HIDDEN;default:return R.UNKNOWN}}function W(){var t=M.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function K(t){return!(0===t.length||t.length>L)&&(!D.some(function(e){return t.startsWith(e)})&&!!t.match(C))}function V(t){return 0!==t.length&&t.length<=q}var $="0.0.1",J={loggingEnabled:!0},z="FIREBASE_INSTALLATIONS_AUTH";function H(t){var e=G();return e?(Z(e),Promise.resolve()):Y(t).then(Z).then(function(t){return Q(t)},function(){})}function G(){var t=M.getInstance().localStorage;if(t){var e=t.getItem(y);if(e&&tt(e)){var n=t.getItem(b);if(n)try{return JSON.parse(n)}catch(a){return}}}}function Q(t){var e=M.getInstance().localStorage;t&&e&&(e.setItem(b,JSON.stringify(t)),e.setItem(y,String(Date.now()+60*U.getInstance().configTimeToLive*60*1e3)))}var X="Could not fetch config, will use default configs";function Y(t){return F().then(function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+U.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+U.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:z+" "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:U.getInstance().getAppId(),app_version:f,sdk_version:$})});return fetch(r).then(function(t){if(t.ok)return t.json();throw E.create("RC response not ok")})}).catch(function(){w.info(X)})}function Z(t){if(!t)return t;var e=U.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=J.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(e.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=et(e.tracesSamplingRate),e.logNetworkAfterSampling=et(e.networkRequestsSamplingRate),t}function tt(t){return Number(t)>Date.now()}function et(t){return Math.random()<=t}var nt,rt=1;function it(){return rt=2,nt=nt||at()}function ot(){return 3===rt}function at(){return st().then(function(){return P()}).then(function(t){return H(t)}).then(function(){return ct()},function(){return ct()})}function st(){var t=M.getInstance().document;return new Promise(function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()})}function ct(){rt=3}var ut,pt=1e4,ft=5500,lt=3,gt=1e3,mt=lt,ht=[],dt=!1;function vt(){dt||(_t(ft),dt=!0)}function _t(t){setTimeout(function(){if(0!==mt)return ht.length?void bt():_t(pt)},t)}function bt(){var t=ht.splice(0,gt),n=t.map(function(t){return{source_extension_json_proto3:t.message,event_time_ms:String(t.eventTime)}});yt({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:U.getInstance().logSource,log_event:n},t).catch(function(){ht=(0,e.__spreadArray)((0,e.__spreadArray)([],t),ht),mt--,w.info("Tries left: "+mt+"."),_t(pt)})}function yt(t,n){return It(t).then(function(t){return t.ok||w.info("Call to Firebase backend failed."),t.json()}).then(function(t){var r=Number(t.nextRequestWaitMillis),i=pt;isNaN(r)||(i=Math.max(r,i));var o=t.logResponseDetails;Array.isArray(o)&&o.length>0&&"RETRY_REQUEST_LATER"===o[0].responseAction&&(ht=(0,e.__spreadArray)((0,e.__spreadArray)([],n),ht),w.info("Retry transport request later.")),mt=lt,_t(i)})}function It(t){var e=U.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(t)})}function Tt(t){if(!t.eventTime||!t.message)throw E.create("invalid cc log");ht=(0,e.__spreadArray)((0,e.__spreadArray)([],ht),[t])}function At(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Tt({message:t.apply(void 0,e),eventTime:Date.now()})}}function Et(t,e){ut||(ut=At(Nt)),ut(t,e)}function wt(t){var e=U.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&M.getInstance().requiredApisAvailable()&&(t.isAuto&&x()!==R.VISIBLE||(ot()?St(t):it().then(function(){return St(t)},function(){return St(t)})))}function St(t){if(B()){var e=U.getInstance();e.loggingEnabled&&e.logTraceAfterSampling&&setTimeout(function(){return Et(t,1)},0)}}function Mt(t){var e=U.getInstance();if(e.instrumentationEnabled){var n=t.url,r=e.logEndPointUrl.split("?")[0],i=e.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return Et(t,0)},0)}}function Nt(t,e){return 0===e?kt(t):Ot(t)}function kt(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:Rt(),network_request_metric:e};return JSON.stringify(n)}function Ot(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=t.counters);var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=n);var r={application_info:Rt(),trace_metric:e};return JSON.stringify(r)}function Rt(){return{google_app_id:U.getInstance().getAppId(),app_instance_id:B(),web_app_info:{sdk_version:f,page_url:M.getInstance().getUrl(),service_worker_status:j(),visibility_state:x(),effective_connection_type:W()},application_process_state:0}}var Ut=100,Pt="_",Bt=[d,v,_];function Ft(t,e){return!(0===t.length||t.length>Ut)&&(e&&e.startsWith(h)&&Bt.indexOf(t)>-1||!t.startsWith(Pt))}function Dt(t){var e=Math.floor(t);return e<t&&w.info("Metric value should be an Integer, setting the value as : "+e+"."),e}var Ct=function(){function t(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=M.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=l+"-"+this.randomId+"-"+this.name,this.traceStopMark=g+"-"+this.randomId+"-"+this.name,this.traceMeasure=n||m+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return t.prototype.start=function(){if(1!==this.state)throw E.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},t.prototype.stop=function(){if(2!==this.state)throw E.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),wt(this)},t.prototype.record=function(t,n,r){if(t<=0)throw E.create("nonpositive trace startTime",{traceName:this.name});if(n<=0)throw E.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*n),this.startTimeUs=Math.floor(1e3*t),r&&r.attributes&&(this.customAttributes=(0,e.__assign)({},r.attributes)),r&&r.metrics)for(var i=0,o=Object.keys(r.metrics);i<o.length;i++){var a=o[i];isNaN(Number(r.metrics[a]))||(this.counters[a]=Number(Math.floor(r.metrics[a])))}wt(this)},t.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]?this.putMetric(t,e):this.putMetric(t,this.counters[t]+e)},t.prototype.putMetric=function(t,e){if(!Ft(t,this.name))throw E.create("invalid custom metric name",{customMetricName:t});this.counters[t]=Dt(e)},t.prototype.getMetric=function(t){return this.counters[t]||0},t.prototype.putAttribute=function(t,e){var n=K(t),r=V(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw E.create("invalid attribute name",{attributeName:t});if(!r)throw E.create("invalid attribute value",{attributeValue:e})}},t.prototype.getAttribute=function(t){return this.customAttributes[t]},t.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},t.prototype.getAttributes=function(){return(0,e.__assign)({},this.customAttributes)},t.prototype.setStartTime=function(t){this.startTimeUs=t},t.prototype.setDuration=function(t){this.durationUs=t},t.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},t.createOobTrace=function(e,n,r){var i=M.getInstance().getUrl();if(i){var o=new t(h+i,!0),a=Math.floor(1e3*M.getInstance().getTimeOrigin());o.setStartTime(a),e&&e[0]&&(o.setDuration(Math.floor(1e3*e[0].duration)),o.putMetric("domInteractive",Math.floor(1e3*e[0].domInteractive)),o.putMetric("domContentLoadedEventEnd",Math.floor(1e3*e[0].domContentLoadedEventEnd)),o.putMetric("loadEventEnd",Math.floor(1e3*e[0].loadEventEnd)));if(n){var s=n.find(function(t){return"first-paint"===t.name});s&&s.startTime&&o.putMetric(d,Math.floor(1e3*s.startTime));var c=n.find(function(t){return"first-contentful-paint"===t.name});c&&c.startTime&&o.putMetric(v,Math.floor(1e3*c.startTime)),r&&o.putMetric(_,Math.floor(1e3*r))}wt(o)}},t.createUserTimingTrace=function(e){wt(new t(e,!1,e))},t}();function Lt(t){var e=t;if(e&&void 0!==e.responseStart){var n=M.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));Mt({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var qt=5e3;function jt(){B()&&(setTimeout(function(){return Wt()},0),setTimeout(function(){return xt()},0),setTimeout(function(){return Kt()},0))}function xt(){for(var t=M.getInstance(),e=0,n=t.getEntriesByType("resource");e<n.length;e++){Lt(n[e])}t.setupObserver("resource",Lt)}function Wt(){var t=M.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){Ct.createOobTrace(e,n),r=void 0},qt);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),Ct.createOobTrace(e,n,t))})}else Ct.createOobTrace(e,n)}function Kt(){for(var t=M.getInstance(),e=0,n=t.getEntriesByType("measure");e<n.length;e++){Vt(n[e])}t.setupObserver("measure",Vt)}function Vt(t){var e=t.name;e.substring(0,m.length)!==m&&Ct.createUserTimingTrace(e)}var $t=function(){function t(t){this.app=t,M.getInstance().requiredApisAvailable()&&(0,n.validateIndexedDBOpenable)().then(function(t){t&&(vt(),it().then(jt,jt))}).catch(function(t){w.info("Environment doesn't support IndexedDB: "+t)})}return t.prototype.trace=function(t){return new Ct(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return U.getInstance().instrumentationEnabled},set:function(t){U.getInstance().instrumentationEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return U.getInstance().dataCollectionEnabled},set:function(t){U.getInstance().dataCollectionEnabled=t},enumerable:!1,configurable:!0}),t}(),Jt="[DEFAULT]";function zt(t){t.INTERNAL.registerComponent(new i.Component("performance",function(t){return function(t,e){if(t.name!==Jt)throw E.create("FB not default");if("undefined"==typeof window)throw E.create("no window");return N(window),U.getInstance().firebaseAppInstance=t,U.getInstance().installationsService=e,new $t(t)}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())},"PUBLIC")),t.registerVersion(u,p)}zt(t.default);
},{"@firebase/app":"Q47K","@firebase/installations":"cfFX","tslib":"CvJj","@firebase/util":"gYkb","@firebase/logger":"srlT","@firebase/component":"KLrb"}],"QJU0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.factory=ee,exports.getGlobalVars=J,exports.registerAnalytics=ae,exports.resetGlobalVars=Y,exports.settings=Q;var e=require("tslib"),t=i(require("@firebase/app"));require("@firebase/installations");var r=require("@firebase/logger"),n=require("@firebase/util"),a=require("@firebase/component");function i(e){return e&&e.__esModule?e:{default:e}}var s,o,c="firebase_id",u="origin",l=6e4,d="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",f="https://www.googletagmanager.com/gtag/js";function p(t,r,n,a,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,c;return(0,e.__generator)(this,function(u){switch(u.label){case 0:return i&&i.global?(t(s.EVENT,n,a),[2]):[3,1];case 1:return[4,r];case 2:o=u.sent(),c=(0,e.__assign)((0,e.__assign)({},a),{send_to:o}),t(s.EVENT,n,c),u.label=3;case 3:return[2]}})})}function h(t,r,n,a){return(0,e.__awaiter)(this,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return a&&a.global?(t(s.SET,{screen_name:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,r];case 2:i=e.sent(),t(s.CONFIG,i,{update:!0,screen_name:n}),e.label=3;case 3:return[2]}})})}function m(t,r,n,a){return(0,e.__awaiter)(this,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return a&&a.global?(t(s.SET,{user_id:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,r];case 2:i=e.sent(),t(s.CONFIG,i,{update:!0,user_id:n}),e.label=3;case 3:return[2]}})})}function v(t,r,n,a){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,c,u,l;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(!a||!a.global)return[3,1];for(i={},o=0,c=Object.keys(n);o<c.length;o++)u=c[o],i["user_properties."+u]=n[u];return t(s.SET,i),[2,Promise.resolve()];case 1:return[4,r];case 2:l=e.sent(),t(s.CONFIG,l,{update:!0,user_properties:n}),e.label=3;case 3:return[2]}})})}function _(t,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,t];case 1:return n=e.sent(),window["ga-disable-"+n]=!r,[2]}})})}!function(e){e.EVENT="event",e.SET="set",e.CONFIG="config"}(s||(s={})),function(e){e.ADD_SHIPPING_INFO="add_shipping_info",e.ADD_PAYMENT_INFO="add_payment_info",e.ADD_TO_CART="add_to_cart",e.ADD_TO_WISHLIST="add_to_wishlist",e.BEGIN_CHECKOUT="begin_checkout",e.CHECKOUT_PROGRESS="checkout_progress",e.EXCEPTION="exception",e.GENERATE_LEAD="generate_lead",e.LOGIN="login",e.PAGE_VIEW="page_view",e.PURCHASE="purchase",e.REFUND="refund",e.REMOVE_FROM_CART="remove_from_cart",e.SCREEN_VIEW="screen_view",e.SEARCH="search",e.SELECT_CONTENT="select_content",e.SELECT_ITEM="select_item",e.SELECT_PROMOTION="select_promotion",e.SET_CHECKOUT_OPTION="set_checkout_option",e.SHARE="share",e.SIGN_UP="sign_up",e.TIMING_COMPLETE="timing_complete",e.VIEW_CART="view_cart",e.VIEW_ITEM="view_item",e.VIEW_ITEM_LIST="view_item_list",e.VIEW_PROMOTION="view_promotion",e.VIEW_SEARCH_RESULTS="view_search_results"}(o||(o={}));var g,I=new r.Logger("@firebase/analytics");function b(e,t){var r=document.createElement("script");r.src=f+"?l="+e+"&id="+t,r.async=!0,document.head.appendChild(r)}function w(e){var t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}function E(t,r,n,a,i,o){return(0,e.__awaiter)(this,void 0,void 0,function(){var c,u,l,d;return(0,e.__generator)(this,function(e){switch(e.label){case 0:c=a[i],e.label=1;case 1:return e.trys.push([1,7,,8]),c?[4,r[c]]:[3,3];case 2:return e.sent(),[3,6];case 3:return[4,Promise.all(n)];case 4:return u=e.sent(),(l=u.find(function(e){return e.measurementId===i}))?[4,r[l.appId]]:[3,6];case 5:e.sent(),e.label=6;case 6:return[3,8];case 7:return d=e.sent(),I.error(d),[3,8];case 8:return t(s.CONFIG,i,o),[2]}})})}function y(t,r,n,a,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,c,u,l,d,f,p,h;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),o=[],i&&i.send_to?(c=i.send_to,Array.isArray(c)||(c=[c]),[4,Promise.all(n)]):[3,2];case 1:for(u=e.sent(),l=function(e){var t=u.find(function(t){return t.measurementId===e}),n=t&&r[t.appId];if(!n)return o=[],"break";o.push(n)},d=0,f=c;d<f.length&&(p=f[d],"break"!==l(p));d++);e.label=2;case 2:return 0===o.length&&(o=Object.values(r)),[4,Promise.all(o)];case 3:return e.sent(),t(s.EVENT,a,i||{}),[3,5];case 4:return h=e.sent(),I.error(h),[3,5];case 5:return[2]}})})}function T(t,r,n,a){return function(i,o,c){return(0,e.__awaiter)(this,void 0,void 0,function(){var u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,6,,7]),i!==s.EVENT?[3,2]:[4,y(t,r,n,o,c)];case 1:return e.sent(),[3,5];case 2:return i!==s.CONFIG?[3,4]:[4,E(t,r,n,a,o,c)];case 3:return e.sent(),[3,5];case 4:t(s.SET,o),e.label=5;case 5:return[3,7];case 6:return u=e.sent(),I.error(u),[3,7];case 7:return[2]}})})}}function C(e,t,r,n,a){var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];window[n].push(arguments)};return window[a]&&"function"==typeof window[a]&&(i=window[a]),window[a]=T(i,e,t,r),{gtagCore:i,wrappedGtag:window[a]}}function N(){for(var e=window.document.getElementsByTagName("script"),t=0,r=Object.values(e);t<r.length;t++){var n=r[t];if(n.src&&n.src.includes(f))return n}return null}var A=((g={})["already-exists"]="A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",g["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",g["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate: {$reason}",g["invalid-analytics-context"]="Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",g["indexeddb-unavailable"]="IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",g["fetch-throttle"]="The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",g["config-fetch-failed"]="Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",g["no-api-key"]='The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',g["no-app-id"]='The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',g),M=new n.ErrorFactory("analytics","Analytics",A),D=30,O=1e3,F=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t=O),this.throttleMetadata=e,this.intervalMillis=t}return e.prototype.getThrottleMetadata=function(e){return this.throttleMetadata[e]},e.prototype.setThrottleMetadata=function(e,t){this.throttleMetadata[e]=t},e.prototype.deleteThrottleMetadata=function(e){delete this.throttleMetadata[e]},e}(),P=new F;function S(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function x(t){var r;return(0,e.__awaiter)(this,void 0,void 0,function(){var n,a,i,s,o,c,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=t.appId,a=t.apiKey,i={method:"GET",headers:S(a)},s=d.replace("{app-id}",n),[4,fetch(s,i)];case 1:if(200===(o=e.sent()).status||304===o.status)return[3,6];c="",e.label=2;case 2:return e.trys.push([2,4,,5]),[4,o.json()];case 3:return u=e.sent(),(null===(r=u.error)||void 0===r?void 0:r.message)&&(c=u.error.message),[3,5];case 4:return e.sent(),[3,5];case 5:throw M.create("config-fetch-failed",{httpStatus:o.status,responseMessage:c});case 6:return[2,o.json()]}})})}function k(t,r,n){return void 0===r&&(r=P),(0,e.__awaiter)(this,void 0,void 0,function(){var a,i,s,o,c,u,d=this;return(0,e.__generator)(this,function(f){if(a=t.options,i=a.appId,s=a.apiKey,o=a.measurementId,!i)throw M.create("no-app-id");if(!s){if(o)return[2,{measurementId:o,appId:i}];throw M.create("no-api-key")}return c=r.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new V,setTimeout(function(){return(0,e.__awaiter)(d,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return u.abort(),[2]})})},void 0!==n?n:l),[2,L({appId:i,apiKey:s,measurementId:o},c,u,r)]})})}function L(t,r,a,i){var s=r.throttleEndTimeMillis,o=r.backoffCount;return void 0===i&&(i=P),(0,e.__awaiter)(this,void 0,void 0,function(){var r,c,u,l,d,f,p;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=t.appId,c=t.measurementId,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,R(a,s)];case 2:return e.sent(),[3,4];case 3:if(u=e.sent(),c)return I.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+' provided in the "measurementId" field in the local Firebase config. ['+u.message+"]"),[2,{appId:r,measurementId:c}];throw u;case 4:return e.trys.push([4,6,,7]),[4,x(t)];case 5:return l=e.sent(),i.deleteThrottleMetadata(r),[2,l];case 6:if(!G(d=e.sent())){if(i.deleteThrottleMetadata(r),c)return I.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+' provided in the "measurementId" field in the local Firebase config. ['+d.message+"]"),[2,{appId:r,measurementId:c}];throw d}return f=503===Number(d.customData.httpStatus)?(0,n.calculateBackoffMillis)(o,i.intervalMillis,D):(0,n.calculateBackoffMillis)(o,i.intervalMillis),p={throttleEndTimeMillis:Date.now()+f,backoffCount:o+1},i.setThrottleMetadata(r,p),I.debug("Calling attemptFetch again in "+f+" millis"),[2,L(t,p,a,i)];case 7:return[2]}})})}function R(e,t){return new Promise(function(r,n){var a=Math.max(t-Date.now(),0),i=setTimeout(r,a);e.addEventListener(function(){clearTimeout(i),n(M.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function G(e){if(!(e instanceof n.FirebaseError&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}var V=function(){function e(){this.listeners=[]}return e.prototype.addEventListener=function(e){this.listeners.push(e)},e.prototype.abort=function(){this.listeners.forEach(function(e){return e()})},e}();function B(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(0,n.isIndexedDBAvailable)()?[3,1]:(I.warn(M.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),[2,!1]);case 1:return e.trys.push([1,3,,4]),[4,(0,n.validateIndexedDBOpenable)()];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),I.warn(M.create("indexeddb-unavailable",{errorInfo:t}).message),[2,!1];case 4:return[2,!0]}})})}function j(t,r,n,a,i,o){return(0,e.__awaiter)(this,void 0,void 0,function(){var l,d,f,p,h,m,v;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(l=k(t)).then(function(e){n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&I.warn("The measurement ID in the local Firebase config ("+t.options.measurementId+") does not match the measurement ID fetched from the server ("+e.measurementId+"). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(function(e){return I.error(e)}),r.push(l),d=B().then(function(e){return e?a.getId():void 0}),[4,Promise.all([l,d])];case 1:return f=e.sent(),p=f[0],h=f[1],N()||b(o,p.measurementId),i("js",new Date),(v={})[u]="firebase",v.update=!0,m=v,null!=h&&(m[c]=h),i(s.CONFIG,p.measurementId,m),[2,p.measurementId]}})})}var U,q,H={},W=[],z={},K="dataLayer",$="gtag",X=!1;function Y(e,t,r){void 0===e&&(e=!1),void 0===t&&(t={}),void 0===r&&(r=[]),X=e,H=t,W=r,K="dataLayer",$="gtag"}function J(){return{initializationPromisesMap:H,dynamicConfigPromisesList:W}}function Q(e){if(X)throw M.create("already-initialized");e.dataLayerName&&(K=e.dataLayerName),e.gtagName&&($=e.gtagName)}function Z(){var e=[];if((0,n.isBrowserExtension)()&&e.push("This is a browser extension environment."),(0,n.areCookiesEnabled)()||e.push("Cookies are not available."),e.length>0){var t=e.map(function(e,t){return"("+(t+1)+") "+e}).join(" "),r=M.create("invalid-analytics-context",{errorInfo:t});I.warn(r.message)}}function ee(e,t){Z();var r=e.options.appId;if(!r)throw M.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw M.create("no-api-key");I.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=H[r])throw M.create("already-exists",{id:r});if(!X){w(K);var n=C(H,W,z,K,$),a=n.wrappedGtag,i=n.gtagCore;q=a,U=i,X=!0}return H[r]=j(e,W,z,t,U,K),{app:e,logEvent:function(e,t,n){p(q,H[r],e,t,n).catch(function(e){return I.error(e)})},setCurrentScreen:function(e,t){h(q,H[r],e,t).catch(function(e){return I.error(e)})},setUserId:function(e,t){m(q,H[r],e,t).catch(function(e){return I.error(e)})},setUserProperties:function(e,t){v(q,H[r],e,t).catch(function(e){return I.error(e)})},setAnalyticsCollectionEnabled:function(e){_(H[r],e).catch(function(e){return I.error(e)})},INTERNAL:{delete:function(){return delete H[r],Promise.resolve()}}}}var te="@firebase/analytics",re="0.6.17",ne="analytics";function ae(e){e.INTERNAL.registerComponent(new a.Component(ne,function(e){return ee(e.getProvider("app").getImmediate(),e.getProvider("installations").getImmediate())},"PUBLIC").setServiceProps({settings:Q,EventName:o,isSupported:ie})),e.INTERNAL.registerComponent(new a.Component("analytics-internal",function(e){try{var t=e.getProvider(ne).getImmediate();return{logEvent:t.logEvent}}catch(r){throw M.create("interop-component-reg-failed",{reason:r})}},"PRIVATE")),e.registerVersion(te,re)}function ie(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:if((0,n.isBrowserExtension)())return[2,!1];if(!(0,n.areCookiesEnabled)())return[2,!1];if(!(0,n.isIndexedDBAvailable)())return[2,!1];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(0,n.validateIndexedDBOpenable)()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,!1];case 4:return[2]}})})}ae(t.default);
},{"tslib":"CvJj","@firebase/app":"Q47K","@firebase/installations":"cfFX","@firebase/logger":"srlT","@firebase/util":"gYkb","@firebase/component":"KLrb"}],"zwHN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerRemoteConfig=D;var t=n(require("@firebase/app"));require("@firebase/installations");var e=require("tslib"),i=require("@firebase/util"),r=require("@firebase/logger"),s=require("@firebase/component");function n(t){return t&&t.__esModule?t:{default:t}}var o,a=function(){function t(t,e,i,r){this.client=t,this.storage=e,this.storageCache=i,this.logger=r}return t.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var i=Date.now()-e,r=i<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+i+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},t.prototype.fetch=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,r,s,n,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return i=e.sent(),r=i[0],(s=i[1])&&this.isCachedDataFresh(t.cacheMaxAgeMillis,r)?[2,s]:(t.eTag=s&&s.eTag,[4,this.client.fetch(t)]);case 2:return n=e.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===n.status&&o.push(this.storage.setLastSuccessfulFetchResponse(n)),[4,Promise.all(o)];case 3:return e.sent(),[2,n]}})})},t}(),c=((o={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",o["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",o["registration-api-key"]="Undefined API key. Check Firebase app initialization.",o["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",o["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",o["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",o["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",o["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",o["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",o["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',o["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',o["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",o["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",o),u=new i.ErrorFactory("remoteconfig","Remote Config",c);function h(t,e){return t instanceof i.FirebaseError&&-1!==t.code.indexOf(e)}function l(t){return void 0===t&&(t=navigator),t.languages&&t.languages[0]||t.language}var g=function(){function t(t,e,i,r,s,n){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=i,this.projectId=r,this.apiKey=s,this.appId=n}return t.prototype.fetch=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,r,s,n,o,a,c,h,g,f,p,d,m,_,v,w,y,b,C;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:i=e.sent(),r=i[0],s=i[1],n=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",o=n+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,a={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},c={sdk_version:this.sdkVersion,app_instance_id:r,app_instance_id_token:s,app_id:this.appId,language_code:l()},h={method:"POST",headers:a,body:JSON.stringify(c)},g=fetch(o,h),f=new Promise(function(e,i){t.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",i(t)})}),e.label=2;case 2:return e.trys.push([2,5,,6]),[4,Promise.race([g,f])];case 3:return e.sent(),[4,g];case 4:return p=e.sent(),[3,6];case 5:throw d=e.sent(),m="fetch-client-network","AbortError"===d.name&&(m="fetch-timeout"),u.create(m,{originalErrorMessage:d.message});case 6:if(_=p.status,v=p.headers.get("ETag")||void 0,200!==p.status)return[3,11];b=void 0,e.label=7;case 7:return e.trys.push([7,9,,10]),[4,p.json()];case 8:return b=e.sent(),[3,10];case 9:throw C=e.sent(),u.create("fetch-client-parse",{originalErrorMessage:C.message});case 10:w=b.entries,y=b.state,e.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===y?_=500:"NO_CHANGE"===y?_=304:"NO_TEMPLATE"!==y&&"EMPTY_CONFIG"!==y||(w={}),304!==_&&200!==_)throw u.create("fetch-status",{httpStatus:_});return[2,{status:_,eTag:v,config:w}]}})})},t}(),f=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},t}(),p=!1,d="",m=0,_=["1","true","t","yes","y","on"],v=function(){function t(t,e){void 0===e&&(e=d),this._source=t,this._value=e}return t.prototype.asString=function(){return this._value},t.prototype.asBoolean=function(){return"static"===this._source?p:_.indexOf(this._value.toLowerCase())>=0},t.prototype.asNumber=function(){if("static"===this._source)return m;var t=Number(this._value);return isNaN(t)&&(t=m),t},t.prototype.getSource=function(){return this._source},t}(),w=6e4,y=432e5,b=function(){function t(t,e,i,r,s){this.app=t,this._client=e,this._storageCache=i,this._storage=r,this._logger=s,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:w,minimumFetchIntervalMillis:y},this.defaultConfig={}}return t.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=r.LogLevel.DEBUG;break;case"silent":this._logger.logLevel=r.LogLevel.SILENT;break;default:this._logger.logLevel=r.LogLevel.ERROR}},Object.defineProperty(t.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!1,configurable:!0}),t.prototype.activate=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,i,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=e.sent(),i=t[0],r=t[1],i&&i.config&&i.eTag&&i.eTag!==r?[4,Promise.all([this._storageCache.setActiveConfig(i.config),this._storage.setActiveConfigEtag(i.eTag)])]:[2,!1];case 2:return e.sent(),[2,!0]}})})},t.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},t.prototype.fetch=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,i,r,s=this;return(0,e.__generator)(this,function(n){switch(n.label){case 0:t=new f,setTimeout(function(){return(0,e.__awaiter)(s,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return t.abort(),[2]})})},this.settings.fetchTimeoutMillis),n.label=1;case 1:return n.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:t})];case 2:return n.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return n.sent(),[3,6];case 4:return i=n.sent(),r=h(i,"fetch-throttle")?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(r)];case 5:throw n.sent(),i;case 6:return[2]}})})},t.prototype.fetchAndActivate=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},t.prototype.getAll=function(){var t=this;return C(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(e,i){return e[i]=t.getValue(i),e},{})},t.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},t.prototype.getNumber=function(t){return this.getValue(t).asNumber()},t.prototype.getString=function(t){return this.getValue(t).asString()},t.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new v("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new v("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new v("static"))},t}();function C(t,i){return void 0===t&&(t={}),void 0===i&&(i={}),Object.keys((0,e.__assign)((0,e.__assign)({},t),i))}function T(t,e){var i=t.target.error||void 0;return u.create(e,{originalErrorMessage:i&&i.message})}var S="app_namespace_store",E="firebase_remote_config",M=1;function F(){return new Promise(function(t,e){var i=indexedDB.open(E,M);i.onerror=function(t){e(T(t,"storage-open"))},i.onsuccess=function(e){t(e.target.result)},i.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(S,{keyPath:"compositeKey"})}}})}var L=function(){function t(t,e,i,r){void 0===r&&(r=F()),this.appId=t,this.appName=e,this.namespace=i,this.openDbPromise=r}return t.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},t.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},t.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},t.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},t.prototype.getActiveConfig=function(){return this.get("active_config")},t.prototype.setActiveConfig=function(t){return this.set("active_config",t)},t.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},t.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},t.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},t.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},t.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},t.prototype.get=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.openDbPromise];case 1:return i=e.sent(),[2,new Promise(function(e,s){var n=i.transaction([S],"readonly").objectStore(S),o=r.createCompositeKey(t);try{var a=n.get(o);a.onerror=function(t){s(T(t,"storage-get"))},a.onsuccess=function(t){var i=t.target.result;e(i?i.value:void 0)}}catch(c){s(u.create("storage-get",{originalErrorMessage:c&&c.message}))}})]}})})},t.prototype.set=function(t,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,s=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.openDbPromise];case 1:return r=e.sent(),[2,new Promise(function(e,n){var o=r.transaction([S],"readwrite").objectStore(S),a=s.createCompositeKey(t);try{var c=o.put({compositeKey:a,value:i});c.onerror=function(t){n(T(t,"storage-set"))},c.onsuccess=function(){e()}}catch(h){n(u.create("storage-set",{originalErrorMessage:h&&h.message}))}})]}})})},t.prototype.delete=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.openDbPromise];case 1:return i=e.sent(),[2,new Promise(function(e,s){var n=i.transaction([S],"readwrite").objectStore(S),o=r.createCompositeKey(t);try{var a=n.delete(o);a.onerror=function(t){s(T(t,"storage-delete"))},a.onsuccess=function(){e()}}catch(c){s(u.create("storage-delete",{originalErrorMessage:c&&c.message}))}})]}})})},t.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},t}(),I=function(){function t(t){this.storage=t}return t.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},t.prototype.getActiveConfig=function(){return this.activeConfig},t.prototype.loadFromStorage=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,i,r,s,n,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return t=this.storage.getLastFetchStatus(),i=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),[4,t];case 1:return(s=e.sent())&&(this.lastFetchStatus=s),[4,i];case 2:return(n=e.sent())&&(this.lastSuccessfulFetchTimestampMillis=n),[4,r];case 3:return(o=e.sent())&&(this.activeConfig=o),[2]}})})},t.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},t.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},t}();function P(t,e){return new Promise(function(i,r){var s=Math.max(e-Date.now(),0),n=setTimeout(i,s);t.addEventListener(function(){clearTimeout(n),r(u.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function A(t){if(!(t instanceof i.FirebaseError&&t.customData))return!1;var e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}var k=function(){function t(t,e){this.client=t,this.storage=e}return t.prototype.fetch=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return i=e.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(t,i)]}})})},t.prototype.attemptFetch=function(t,r){var s=r.throttleEndTimeMillis,n=r.backoffCount;return(0,e.__awaiter)(this,void 0,void 0,function(){var r,o,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,P(t.signal,s)];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this.client.fetch(t)];case 3:return r=e.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return e.sent(),[2,r];case 5:if(!A(o=e.sent()))throw o;return a={throttleEndTimeMillis:Date.now()+(0,i.calculateBackoffMillis)(n),backoffCount:n+1},[4,this.storage.setThrottleMetadata(a)];case 6:return e.sent(),[2,this.attemptFetch(t,a)];case 7:return[2]}})})},t}(),N="@firebase/remote-config",O="0.1.42";function D(t){t.INTERNAL.registerComponent(new s.Component("remoteConfig",function(e,i){var s=i.instanceIdentifier,n=e.getProvider("app").getImmediate(),o=e.getProvider("installations").getImmediate();if("undefined"==typeof window)throw u.create("registration-window");var c=n.options,h=c.projectId,l=c.apiKey,f=c.appId;if(!h)throw u.create("registration-project-id");if(!l)throw u.create("registration-api-key");if(!f)throw u.create("registration-app-id");s=s||"firebase";var p=new L(f,n.name,s),d=new I(p),m=new r.Logger(N);m.logLevel=r.LogLevel.ERROR;var _=new g(o,t.SDK_VERSION,s,h,l,f),v=new k(_,p),w=new a(v,p,d,m),y=new b(n,w,d,p,m);return y.ensureInitialized(),y},"PUBLIC").setMultipleInstances(!0)),t.registerVersion(N,O)}D(t.default);
},{"@firebase/app":"Q47K","@firebase/installations":"cfFX","tslib":"CvJj","@firebase/util":"gYkb","@firebase/logger":"srlT","@firebase/component":"KLrb"}],"UdEV":[function(require,module,exports) {
"use strict";var e=require("@firebase/app"),r=require("@firebase/component"),t=require("tslib"),n=require("@firebase/util"),o=require("@firebase/logger");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,s=i(e),c=((a={})["already-activated"]="You are trying to activate AppCheck for FirebaseApp {$appName}, while it is already activated. AppCheck can only be activated once.",a["use-before-activation"]="AppCheck is being used before activate() is called for FirebaseApp {$appName}. Please make sure you call activate() before instantiating other Firebase services.",a["fetch-network-error"]="Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",a["fetch-parse-error"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",a["fetch-status-error"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",a["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",a["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",a["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",a["recaptcha-error"]="ReCAPTCHA error.",a),u=new n.ErrorFactory("appCheck","AppCheck",c),f=new Map,l={activated:!1,tokenObservers:[]},p={enabled:!1};function d(e){return f.get(e)||l}function h(e,r){f.set(e,r)}function g(){return p}var v="https://content-firebaseappcheck.googleapis.com/v1beta",_="exchangeRecaptchaToken",k="exchangeDebugToken",b={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4},w=function(){function e(e,r,t,n,o){if(this.operation=e,this.retryPolicy=r,this.getWaitDuration=t,this.lowerBound=n,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=n,n>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}return e.prototype.start=function(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(function(){})},e.prototype.stop=function(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)},e.prototype.isRunning=function(){return!!this.pending},e.prototype.process=function(e){return t.__awaiter(this,void 0,void 0,function(){var r;return t.__generator(this,function(t){switch(t.label){case 0:this.stop(),t.label=1;case 1:return t.trys.push([1,6,,7]),this.pending=new n.Deferred,[4,m(this.getNextRun(e))];case 2:return t.sent(),this.pending.resolve(),[4,this.pending.promise];case 3:return t.sent(),this.pending=new n.Deferred,[4,this.operation()];case 4:return t.sent(),this.pending.resolve(),[4,this.pending.promise];case 5:return t.sent(),this.process(!0).catch(function(){}),[3,7];case 6:return r=t.sent(),this.retryPolicy(r)?this.process(!1).catch(function(){}):this.stop(),[3,7];case 7:return[2]}})})},e.prototype.getNextRun=function(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var r=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),r},e}();function m(e){return new Promise(function(r){setTimeout(r,e)})}function E(){return self.grecaptcha}function T(e){if(!d(e).activated)throw u.create("use-before-activation",{appName:e.name})}function y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=16*Math.random()|0;return("x"===e?r:3&r|8).toString(16)})}function x(e){return n.base64.encodeString(JSON.stringify(e),!1)}function A(e,r){var n=e.url,o=e.body;return t.__awaiter(this,void 0,void 0,function(){var e,i,a,s,c,f,l,p,d,h;return t.__generator(this,function(t){switch(t.label){case 0:e={"Content-Type":"application/json"},(i=r.getImmediate({optional:!0}))&&(e["X-Firebase-Client"]=i.getPlatformInfoString()),a={method:"POST",body:JSON.stringify(o),headers:e},t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(n,a)];case 2:return s=t.sent(),[3,4];case 3:throw c=t.sent(),u.create("fetch-network-error",{originalErrorMessage:c.message});case 4:if(200!==s.status)throw u.create("fetch-status-error",{httpStatus:s.status});t.label=5;case 5:return t.trys.push([5,7,,8]),[4,s.json()];case 6:return f=t.sent(),[3,8];case 7:throw l=t.sent(),u.create("fetch-parse-error",{originalErrorMessage:l.message});case 8:if(!(p=f.ttl.match(/^([\d.]+)(s)$/))||!p[2]||isNaN(Number(p[1])))throw u.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+f.ttl});return d=1e3*Number(p[1]),h=Date.now(),[2,{token:f.attestationToken,expireTimeMillis:h+d,issuedAtTimeMillis:h}]}})})}function P(e,r){var t=e.options,n=t.projectId,o=t.appId,i=t.apiKey;return{url:v+"/projects/"+n+"/apps/"+o+":"+_+"?key="+i,body:{recaptcha_token:r}}}function I(e,r){var t=e.options,n=t.projectId,o=t.appId,i=t.apiKey;return{url:v+"/projects/"+n+"/apps/"+o+":"+k+"?key="+i,body:{debug_token:r}}}var C="firebase-app-check-database",R=1,N="firebase-app-check-store",M="debug-token",O=null;function D(){return O||(O=new Promise(function(e,r){try{var t=indexedDB.open(C,R);t.onsuccess=function(r){e(r.target.result)},t.onerror=function(e){var t;r(u.create("storage-open",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))},t.onupgradeneeded=function(e){var r=e.target.result;switch(e.oldVersion){case 0:r.createObjectStore(N,{keyPath:"compositeKey"})}}}catch(n){r(u.create("storage-open",{originalErrorMessage:n.message}))}}))}function S(e){return W(j(e))}function L(e,r){return K(j(e),r)}function B(e){return K(M,e)}function F(){return W(M)}function K(e,r){return t.__awaiter(this,void 0,void 0,function(){var n,o,i,a;return t.__generator(this,function(t){switch(t.label){case 0:return[4,D()];case 1:return n=t.sent(),o=n.transaction(N,"readwrite"),i=o.objectStore(N),a=i.put({compositeKey:e,value:r}),[2,new Promise(function(e,r){a.onsuccess=function(r){e()},o.onerror=function(e){var t;r(u.create("storage-set",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})]}})})}function W(e){return t.__awaiter(this,void 0,void 0,function(){var r,n,o,i;return t.__generator(this,function(t){switch(t.label){case 0:return[4,D()];case 1:return r=t.sent(),n=r.transaction(N,"readonly"),o=n.objectStore(N),i=o.get(e),[2,new Promise(function(e,r){i.onsuccess=function(r){var t=r.target.result;e(t?t.value:void 0)},n.onerror=function(e){var t;r(u.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})]}})})}function j(e){return e.options.appId+"-"+e.name}var H=new o.Logger("@firebase/app-check");function $(e){return t.__awaiter(this,void 0,void 0,function(){var r,o;return t.__generator(this,function(t){switch(t.label){case 0:if(!n.isIndexedDBAvailable())return[3,5];r=void 0,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,S(e)];case 2:return r=t.sent(),[3,4];case 3:return o=t.sent(),H.warn("Failed to read token from indexeddb. Error: "+o),[3,4];case 4:return[2,r];case 5:return[2,void 0]}})})}function U(e,r){return n.isIndexedDBAvailable()?L(e,r).catch(function(e){H.warn("Failed to write token to indexeddb. Error: "+e)}):Promise.resolve()}function z(){return t.__awaiter(this,void 0,void 0,function(){var e,r;return t.__generator(this,function(t){switch(t.label){case 0:e=void 0,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,F()];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[3,4];case 4:return e?[2,e]:(B(r=y()).catch(function(e){return H.warn("Failed to persist debug token to indexeddb. Error: "+e)}),console.log("AppCheck debug token: "+r+". You will need to whitelist it in the Firebase console for it to work"),[2,r])}})})}function X(){return g().enabled}function q(){return t.__awaiter(this,void 0,void 0,function(){var e;return t.__generator(this,function(r){if((e=g()).enabled&&e.token)return[2,e.token.promise];throw Error("\n            Can't get debug token in production mode.\n        ")})})}function G(){var e=n.getGlobal();if("string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){var r=g();r.enabled=!0;var t=new n.Deferred;r.token=t,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?t.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(z())}}var V={error:"UNKNOWN_ERROR"};function J(e,r,n){return void 0===n&&(n=!1),t.__awaiter(this,void 0,void 0,function(){var o,i,a,s,c,u,f,l,p,g;return t.__generator(this,function(v){switch(v.label){case 0:return T(e),o=d(e),i=o.token,a=void 0,i?[3,2]:[4,o.cachedTokenPromise];case 1:(s=v.sent())&&re(s)&&(i=s,h(e,t.__assign(t.__assign({},o),{token:i})),ee(e,{token:i.token})),v.label=2;case 2:return!n&&i&&re(i)?[2,{token:i.token}]:X()?(u=A,f=I,l=[e],[4,q()]):[3,6];case 3:return[4,u.apply(void 0,[f.apply(void 0,l.concat([v.sent()])),r])];case 4:return c=v.sent(),[4,U(e,c)];case 5:return v.sent(),h(e,t.__assign(t.__assign({},o),{token:c})),[2,{token:c.token}];case 6:return v.trys.push([6,8,,9]),[4,o.provider.getToken()];case 7:return i=v.sent(),[3,9];case 8:return p=v.sent(),H.error(p),a=p,[3,9];case 9:return i?[3,10]:(g=te(a),[3,12]);case 10:return g={token:i.token},h(e,t.__assign(t.__assign({},o),{token:i})),[4,U(e,i)];case 11:v.sent(),v.label=12;case 12:return ee(e,g),[2,g]}})})}function Y(e,r,n,o,i){var a=d(e),s={next:o,error:i,type:n},c=t.__assign(t.__assign({},a),{tokenObservers:t.__spreadArray(t.__spreadArray([],a.tokenObservers),[s])});if(!c.tokenRefresher){var u=Z(e,r);c.tokenRefresher=u}if(!c.tokenRefresher.isRunning()&&a.isTokenAutoRefreshEnabled&&c.tokenRefresher.start(),a.token&&re(a.token)){var f=a.token;Promise.resolve().then(function(){return o({token:f.token})}).catch(function(){})}else null==a.token&&a.cachedTokenPromise.then(function(e){e&&re(e)&&o({token:e.token})}).catch(function(){});h(e,c)}function Q(e,r){var n=d(e),o=n.tokenObservers.filter(function(e){return e.next!==r});0===o.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),h(e,t.__assign(t.__assign({},n),{tokenObservers:o}))}function Z(e,r){var n=this;return new w(function(){return t.__awaiter(n,void 0,void 0,function(){var n;return t.__generator(this,function(t){switch(t.label){case 0:return d(e).token?[3,2]:[4,J(e,r)];case 1:return n=t.sent(),[3,4];case 2:return[4,J(e,r,!0)];case 3:n=t.sent(),t.label=4;case 4:if(n.error)throw n.error;return[2]}})})},function(){return!0},function(){var r=d(e);if(r.token){var t=r.token.issuedAtTimeMillis+.5*(r.token.expireTimeMillis-r.token.issuedAtTimeMillis)+3e5,n=r.token.expireTimeMillis-3e5;return t=Math.min(t,n),Math.max(0,t-Date.now())}return 0},b.RETRIAL_MIN_WAIT,b.RETRIAL_MAX_WAIT)}function ee(e,r){for(var t=0,n=d(e).tokenObservers;t<n.length;t++){var o=n[t];try{"EXTERNAL"===o.type&&null!=r.error?o.error(r.error):o.next(r)}catch(i){}}}function re(e){return e.expireTimeMillis-Date.now()>0}function te(e){return{token:x(V),error:e}}var ne="https://www.google.com/recaptcha/api.js";function oe(e,r){var o=d(e),i=new n.Deferred;h(e,t.__assign(t.__assign({},o),{reCAPTCHAState:{initialized:i}}));var a="fire_app_check_"+e.name,s=document.createElement("div");s.id=a,s.style.display="none",document.body.appendChild(s);var c=E();return c?c.ready(function(){ae(e,r,c,a),i.resolve(c)}):se(function(){var t=E();if(!t)throw new Error("no recaptcha");t.ready(function(){ae(e,r,t,a),i.resolve(t)})}),i.promise}function ie(e){return t.__awaiter(this,void 0,void 0,function(){var r;return t.__generator(this,function(t){switch(t.label){case 0:return T(e),[4,d(e).reCAPTCHAState.initialized.promise];case 1:return r=t.sent(),[2,new Promise(function(t,n){var o=d(e).reCAPTCHAState;r.ready(function(){t(r.execute(o.widgetId,{action:"fire_app_check"}))})})]}})})}function ae(e,r,n,o){var i=n.render(o,{sitekey:r,size:"invisible"}),a=d(e);h(e,t.__assign(t.__assign({},a),{reCAPTCHAState:t.__assign(t.__assign({},a.reCAPTCHAState),{widgetId:i})}))}function se(e){var r=document.createElement("script");r.src=""+ne,r.onload=e,document.head.appendChild(r)}var ce=function(){function e(e){this._siteKey=e}return e.prototype.getToken=function(){return t.__awaiter(this,void 0,void 0,function(){var e;return t.__generator(this,function(r){switch(r.label){case 0:if(!this._app||!this._platformLoggerProvider)throw u.create("use-before-activation",{appName:""});r.label=1;case 1:return r.trys.push([1,3,,4]),[4,ie(this._app)];case 2:return e=r.sent(),[3,4];case 3:throw r.sent(),u.create("recaptcha-error");case 4:return[2,A(P(this._app,e),this._platformLoggerProvider)]}})})},e.prototype.initialize=function(e,r){this._app=e,this._platformLoggerProvider=r,oe(e,this._siteKey).catch(function(){})},e}(),ue=function(){function e(e){this._customProviderOptions=e}return e.prototype.getToken=function(){return t.__awaiter(this,void 0,void 0,function(){var e,r,o;return t.__generator(this,function(i){switch(i.label){case 0:if(!this._app)throw u.create("use-before-activation",{appName:""});return[4,this._customProviderOptions.getToken()];case 1:return e=i.sent(),r=n.issuedAtTime(e.token),o=null!==r&&r<Date.now()&&r>0?1e3*r:Date.now(),[2,t.__assign(t.__assign({},e),{issuedAtTimeMillis:o})]}})})},e.prototype.initialize=function(e){this._app=e},e}();function fe(e,r,n,o){var i=d(e);if(i.activated)throw u.create("already-activated",{appName:e.name});var a=t.__assign(t.__assign({},i),{activated:!0});a.cachedTokenPromise=$(e).then(function(r){return r&&re(r)&&h(e,t.__assign(t.__assign({},d(e)),{token:r})),r}),a.provider="string"==typeof r?new ce(r):r instanceof ce||r instanceof ue?r:new ue({getToken:r.getToken}),a.isTokenAutoRefreshEnabled=void 0===o?e.automaticDataCollectionEnabled:o,h(e,a),a.provider.initialize(e,n)}function le(e,r){var n=d(e);n.tokenRefresher&&(!0===r?n.tokenRefresher.start():n.tokenRefresher.stop()),h(e,t.__assign(t.__assign({},n),{isTokenAutoRefreshEnabled:r}))}function pe(e,r,n){return t.__awaiter(this,void 0,void 0,function(){var o;return t.__generator(this,function(t){switch(t.label){case 0:return[4,J(e,r,n)];case 1:if((o=t.sent()).error)throw o.error;return[2,{token:o.token}]}})})}function de(e,r,t,n,o){var i=function(){},a=function(){};return i=null!=t.next?t.next.bind(t):t,null!=t.error?a=t.error.bind(t):n&&(a=n),Y(e,r,"EXTERNAL",i,a),function(){return Q(e,i)}}function he(e,r){return{app:e,activate:function(t,n){return fe(e,t,r,n)},setTokenAutoRefreshEnabled:function(r){return le(e,r)},getToken:function(t){return pe(e,r,t)},onTokenChanged:function(t,n,o){return de(e,r,t,n)},INTERNAL:{delete:function(){for(var r=0,t=d(e).tokenObservers;r<t.length;r++){var n=t[r];Q(e,n.next)}return Promise.resolve()}}}}function ge(e,r){return{getToken:function(t){return J(e,r,t)},addTokenListener:function(t){return Y(e,r,"INTERNAL",t)},removeTokenListener:function(r){return Q(e,r)}}}var ve="@firebase/app-check",_e="0.3.0",ke="appCheck",be="app-check-internal";function we(e){e.INTERNAL.registerComponent(new r.Component(ke,function(e){return he(e.getProvider("app").getImmediate(),e.getProvider("platform-logger"))},"PUBLIC").setServiceProps({ReCaptchaV3Provider:ce,CustomProvider:ue}).setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(function(e,r,t){e.getProvider(be).initialize()})),e.INTERNAL.registerComponent(new r.Component(be,function(e){return ge(e.getProvider("app").getImmediate(),e.getProvider("platform-logger"))},"PUBLIC").setInstantiationMode("EXPLICIT")),e.registerVersion(ve,_e)}we(s.default),G();
},{"@firebase/app":"Q47K","@firebase/component":"KLrb","tslib":"CvJj","@firebase/util":"gYkb","@firebase/logger":"srlT"}],"gsxS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return e.default}});var e=r(require("@firebase/app"));function r(e){return e&&e.__esModule?e:{default:e}}require("@firebase/auth"),require("@firebase/database"),require("@firebase/firestore"),require("@firebase/firestore/bundle"),require("@firebase/functions"),require("@firebase/messaging"),require("@firebase/storage"),require("@firebase/performance"),require("@firebase/analytics"),require("@firebase/remote-config"),require("@firebase/app-check");var i="firebase",a="8.9.0";e.default.registerVersion(i,a,"app"),e.default.SDK_VERSION=a;var n="firebase",s="8.9.0";console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),e.default.registerVersion(n,s);
},{"@firebase/app":"Q47K","@firebase/auth":"bHFp","@firebase/database":"fbOU","@firebase/firestore":"PaOZ","@firebase/firestore/bundle":"GivO","@firebase/functions":"LER0","@firebase/messaging":"VjMm","@firebase/storage":"raud","@firebase/performance":"OpHm","@firebase/analytics":"QJU0","@firebase/remote-config":"zwHN","@firebase/app-check":"UdEV"}],"I4ic":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("firebase"));function a(e){return e&&e.__esModule?e:{default:e}}var d={apiKey:"AIzaSyDIYoUXW3DX_PNHtd6mOZXc3Vdmp4H7hHk",authDomain:"fredericiamuseum-display.firebaseapp.com",databaseURL:"https://fredericiamuseum-display-default-rtdb.europe-west1.firebasedatabase.app",projectId:"fredericiamuseum-display",storageBucket:"fredericiamuseum-display.appspot.com",messagingSenderId:"806832454518",appId:"1:806832454518:web:a94fa21faf411af24d9857"};e.default.initializeApp(d);var t=e.default.database(),r=e.default;exports.default=r;
},{"firebase":"gsxS"}],"WK2F":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=function t(i,s,o,n){e(this,t),this.name=i,this.idleVideoURL=s,this.volumeLevel=o,this.script=n};exports.default=t;
},{}],"BwtV":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function e(s,i){t(this,e),this.lines=s,this.startTimes=i};exports.default=e;
},{}],"Nz8H":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("./subtitles");var e=function e(s,i,o){t(this,e),this.questionText=s,this.subtitles=i,this.questionURL=o};exports.default=e;
},{"./subtitles":"BwtV"}],"Bj9A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateQuestionButton=s,exports.CreateCancelButton=u,exports.ShowQuestionWindow=l,exports.PlayVideo=r,exports.HideQuestionWindow=a,exports.CancelCurrentPlayedVideo=c,exports.CreateAndPopulateQuestionWindow=p,exports.SetupUI=y,exports.ChangeLanguage=m;var e,t,n,o,i=require("./App.js"),d=0;function s(){e=document.createElement("questionButton"),o.appendChild(e),e.style.position="absolute",e.style.zIndex=99,e.innerHTML='<img src="assets/questionButton.png" />',e.addEventListener("click",function(){r(1)})}function u(){t=document.createElement("cancelButton"),o.appendChild(t),t.style.position="absolute",t.style.zIndex=99,t.innerHTML='<img src="assets/cancelButton.png" />',t.addEventListener("click",function(){l()})}function l(){}function r(e){console.log("Playing video with index of: "+e),(0,i.GetVideoArray)()[d].pause(),document.getElementById("videoPlayer"+d).style.height="0px",document.getElementById("videoPlayer"+d).style.width="0px",d=e,document.getElementById("videoPlayer"+d).style.height="1100px",document.getElementById("videoPlayer"+d).style.width="720px",(0,i.GetVideoArray)()[d].play(),0!==d&&(0,i.GetVideoArray)()[d].on("ended",function(){r(0)})}function a(){}function c(){}function p(e,t){}function y(){n=document.getElementById("videoParent"),o=document.getElementById("overlay"),s(),u(),t.style.visibility="hidden"}function m(e){}
},{"./App.js":"FLHj"}],"FLHj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GetVideoArray=m;var e=n(require("video.js")),o=n(require("./firebase.js")),t=n(require("./character.js")),a=n(require("./dialogue.js")),i=n(require("./subtitles.js")),l=require("./ui.js");function n(e){return e&&e.__esModule?e:{default:e}}var r,u,d=o.default.database().ref("Characters"),s=0,c=[];r=new t.default(null,null,null,null);var f=1;function p(){d.on("value",function(e){u=e.val();var o=[],n=0;Object.keys(u).forEach(function(e){o[n]=u[e],n++}),r=new t.default(null,null,null,null);var d=o[f-1],s=d.Idle,c=d.Name,p=d.VolumeLevel,y=[];Object.keys(d.Script).forEach(function(e){var o=d.Script[e].Languages.DK,t=d.Script[e].VideoLink,l=o.Subtitles.ListOfLines,n=o.Subtitles.ListOfStartTime,r=o.Question,u=new i.default(l,n),s=new a.default(r,u,t);y.push(s)}),r.idleVideoURL=s,r.name=c,r.volumeLevel=p,r.script=y,(0,l.SetupUI)(),v()})}function v(){var o=(0,e.default)("videoPlayer0",{autoplay:!1,loop:!0,muted:!1,controls:!1,options:{loadingSpinner:!1,errorDisplay:!1}});o.src({type:"video/mp4",src:r.idleVideoURL}),o.load(),c.push(o);var t=(0,e.default)("videoPlayer1",{autoplay:!1,controls:!1,loop:!1});t.src({type:"Video/mp4",src:r.script[0].questionURL}),o.ready(function(){this.on("loadedmetadata",y)}),t.ready(function(){this.on("loadedmetadata",y)}),t.load(),c.push(t)}function y(){console.log("Video Loaded: "+s),++s==c.length&&h()}function h(){console.log("Videos finished loading, playing idle"),c.forEach(function(e){e.off("loadedmetadata",y)}),c[1].on("ended",function(){(0,l.PlayVideo)(0)}),(0,l.PlayVideo)(0)}function m(){return c}p();
},{"video.js":"U3gU","./firebase.js":"I4ic","./character.js":"WK2F","./dialogue.js":"Nz8H","./subtitles.js":"BwtV","./ui.js":"Bj9A"}]},{},["FLHj"], null)
//# sourceMappingURL=/csb-8k82p/App.e35d6b1e.js.map